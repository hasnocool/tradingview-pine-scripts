Script Name: Andean Scalping
Author: elpavohombre
Description: Andean Scalping Implementation - BETA

- Uses Andean Oscillator: alpaca.markets
- Implements a threshold moving average (SMA 1000) on the Andean Signal line at 1.1 factor to filter out small moves
- TP/SL using ATR bands at 3x multiplier
PineScript code:

Pine Scriptâ„¢ strategy
Andean Scalping
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
//@version=5
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’Â 
//Â Â -----------------------------------------------------------------------------
//Â Â CopyrightÂ 2022Â IasonÂ NikolasÂ |Â jason5480
//Â Â TemplateÂ TrailingÂ StrategyÂ scriptÂ mayÂ beÂ freelyÂ distributedÂ underÂ theÂ MITÂ license.
//
//Â Â PermissionÂ isÂ herebyÂ granted,Â freeÂ ofÂ charge,
//Â Â toÂ anyÂ personÂ obtainingÂ aÂ copyÂ ofÂ thisÂ softwareÂ andÂ associatedÂ documentationÂ filesÂ (theÂ "Software"),
//Â Â toÂ dealÂ inÂ theÂ SoftwareÂ withoutÂ restriction,Â includingÂ withoutÂ limitationÂ theÂ rightsÂ toÂ use,Â copy,Â modify,Â merge,
//Â Â publish,Â distribute,Â sublicense,Â and/orÂ sellÂ copiesÂ ofÂ theÂ Software,Â andÂ toÂ permitÂ personsÂ toÂ whomÂ theÂ SoftwareÂ isÂ furnishedÂ toÂ doÂ so,
//Â Â subjectÂ toÂ theÂ followingÂ conditions:
//
//Â Â TheÂ aboveÂ copyrightÂ noticeÂ andÂ thisÂ permissionÂ noticeÂ shallÂ beÂ includedÂ inÂ allÂ copiesÂ orÂ substantialÂ portionsÂ ofÂ theÂ Software.
//
//Â Â THEÂ SOFTWAREÂ ISÂ PROVIDEDÂ "ASÂ IS",Â WITHOUTÂ WARRANTYÂ OFÂ ANYÂ KIND,
//Â Â EXPRESSÂ ORÂ IMPLIED,Â INCLUDINGÂ BUTÂ NOTÂ LIMITEDÂ TOÂ THEÂ WARRANTIESÂ OFÂ MERCHANTABILITY,
//Â Â FITNESSÂ FORÂ AÂ PARTICULARÂ PURPOSEÂ ANDÂ NONINFRINGEMENT.Â INÂ NOÂ EVENTÂ SHALLÂ THEÂ AUTHORSÂ ORÂ COPYRIGHTÂ HOLDERSÂ BEÂ LIABLEÂ FORÂ ANYÂ CLAIM,
//Â Â DAMAGESÂ ORÂ OTHERÂ LIABILITY,Â WHETHERÂ INÂ ANÂ ACTIONÂ OFÂ CONTRACT,Â TORTÂ ORÂ OTHERWISE,Â ARISINGÂ FROM,
//Â Â OUTÂ OFÂ ORÂ INÂ CONNECTIONÂ WITHÂ THEÂ SOFTWAREÂ ORÂ THEÂ USEÂ ORÂ OTHERÂ DEALINGSÂ INÂ THEÂ SOFTWARE.
//
//Â Â -----------------------------------------------------------------------------
//
//Â Â Authors:Â Â @jason5480
//Â Â Revision:Â v1.1.4
//Â Â Date:Â Â Â Â Â 16-Aug-2022
//
//Â Â Description
//Â Â =============================================================================
//Â Â ThisÂ scriptÂ isÂ designedÂ toÂ beÂ usedÂ asÂ aÂ templateÂ forÂ buildingÂ newÂ strategies.
//Â Â TheÂ frameworkÂ provideÂ youÂ withÂ aÂ configurableÂ implementationÂ ofÂ theÂ entry,Â exit,
//Â Â stopÂ lossÂ andÂ takeÂ profitÂ trailingÂ logic.Â TheÂ proposedÂ wayÂ toÂ useÂ thatÂ scriptÂ 
//Â Â isÂ inÂ combinationÂ withÂ aÂ customizedÂ signalÂ indicatorÂ whereÂ youÂ implementedÂ your
//Â Â ownÂ logicÂ ofÂ startÂ andÂ endÂ dealÂ conditions.Â SeeÂ myÂ "TwoÂ MAÂ SignalÂ Indicator"Â 
//Â Â andÂ "TemplateÂ SignalÂ Indicator"Â inÂ myÂ profileÂ forÂ more.Â AnÂ otherÂ wayÂ toÂ utilize
//Â Â thisÂ scriptÂ (notÂ recomended)Â isÂ toÂ copyÂ itÂ andÂ replaceÂ theÂ startLongDeal,Â 
//Â Â startShortDeal,Â endLongDealÂ andÂ endShortDealÂ variablesÂ inÂ theÂ STRATEGYÂ 1Â module
//Â Â accordingÂ toÂ yourÂ needs!Â However,Â doingÂ thatÂ wayÂ youÂ willÂ haveÂ toÂ reimplement
//Â Â yourÂ changesÂ everyÂ timeÂ IÂ releaseÂ aÂ newÂ updateÂ ifÂ youÂ wantÂ toÂ recieveÂ theÂ newÂ 
//Â Â changesÂ IÂ madeÂ inÂ theÂ latestÂ release.
//Â Â 
//Â Â -----------------------------------------------------------------------------
//Â Â Disclaimer:
//Â Â Â Â 1.Â IÂ amÂ notÂ licensedÂ financialÂ advisorsÂ orÂ brokerÂ dealer.Â IÂ doÂ notÂ tellÂ you
//Â Â Â Â Â Â Â whenÂ orÂ whatÂ toÂ buyÂ orÂ sell.Â IÂ developedÂ thisÂ softwareÂ whichÂ enablesÂ you
//Â Â Â Â Â Â Â executeÂ manualÂ orÂ automatedÂ tradesÂ usingÂ TradingView.Â The
//Â Â Â Â Â Â Â softwareÂ allowsÂ youÂ toÂ setÂ theÂ criteriaÂ youÂ wantÂ forÂ enteringÂ andÂ exiting
//Â Â Â Â Â Â Â trades.
//Â Â Â Â 2.Â DoÂ notÂ tradeÂ withÂ moneyÂ youÂ cannotÂ affordÂ toÂ lose.
//Â Â Â Â 3.Â IÂ doÂ notÂ guaranteeÂ consistentÂ profitsÂ orÂ thatÂ anyoneÂ canÂ makeÂ moneyÂ withÂ no
//Â Â Â Â Â Â Â effort.Â AndÂ IÂ amÂ notÂ providingÂ youÂ theÂ holyÂ grail.
//Â Â Â Â 4.Â EveryÂ systemÂ canÂ haveÂ winningÂ andÂ losingÂ streaks.
//Â Â Â Â 5.Â MoneyÂ managementÂ playsÂ aÂ largeÂ roleÂ inÂ theÂ resultsÂ ofÂ yourÂ trading.Â For
//Â Â Â Â Â Â Â example:Â lotÂ size,Â accountÂ size,Â brokerÂ leverage,Â andÂ brokerÂ marginÂ call
//Â Â Â Â Â Â Â rulesÂ allÂ haveÂ anÂ effectÂ onÂ results.Â Also,Â yourÂ TakeÂ ProfitÂ andÂ StopÂ Loss
//Â Â Â Â Â Â Â settingsÂ forÂ individualÂ pairÂ tradesÂ andÂ forÂ overallÂ accountÂ equityÂ haveÂ a
//Â Â Â Â Â Â Â majorÂ impactÂ onÂ results.Â IfÂ youÂ areÂ newÂ toÂ tradingÂ andÂ doÂ notÂ understand
//Â Â Â Â Â Â Â theseÂ items,Â thenÂ IÂ recommendÂ youÂ seekÂ educationÂ materialsÂ toÂ furtherÂ your
//Â Â Â Â Â Â Â knowledge.
//
//Â Â Â Â YOUÂ NEEDÂ TOÂ FINDÂ ANDÂ USEÂ THEÂ TRADINGÂ SYSTEMÂ THATÂ WORKSÂ BESTÂ FORÂ YOUÂ ANDÂ YOUR
//Â Â Â Â TRADINGÂ TOLERANCE.
//
//Â Â Â Â IÂ HAVEÂ PROVIDEDÂ NOTHINGÂ MOREÂ THANÂ AÂ TOOLÂ WITHÂ OPTIONSÂ FORÂ YOUÂ TOÂ TRADEÂ WITHÂ THISÂ PROGRAMÂ ONÂ TRADINGVIEW.
//Â Â Â Â 
//Â Â Â Â IÂ acceptÂ suggestionsÂ toÂ improveÂ theÂ script!Â ForÂ anyÂ changeÂ proposalÂ toÂ theÂ existingÂ functionality,
//Â Â Â Â anyÂ additionalÂ fetureÂ youÂ haveÂ inÂ mind,Â orÂ evenÂ reportingÂ aÂ defectÂ (bug)Â youÂ found,Â youÂ shouldÂ writeÂ it
//Â Â Â Â downÂ hereÂ docs.google.com/spreadsheets/d/1xwpr2Ut4CmMX6kX9PxflWuvb4mZ6LFKJ1Y6C7LahQ5o/edit?usp=sharing
//Â Â Â Â andÂ letÂ meÂ knowÂ byÂ sendingÂ meÂ aÂ privateÂ messageÂ onÂ TradingView.
//Â Â Â Â IfÂ youÂ encounterÂ anyÂ problemsÂ IÂ willÂ beÂ happyÂ toÂ shareÂ themÂ withÂ me.
//Â Â -----------------------------------------------------------------------------
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â SETUPÂ ============================================================================================================
strategy(titleÂ =Â 'AndeanÂ Scalping',
Â Â Â Â Â Â Â Â Â shorttitleÂ =Â 'AndeanÂ Scalping',
Â Â Â Â Â Â Â Â Â overlayÂ =Â true,
Â Â Â Â Â Â Â Â Â pyramidingÂ =Â 0,
Â Â Â Â Â Â Â Â Â default_qty_typeÂ =Â strategy.percent_of_equity,
Â Â Â Â Â Â Â Â Â default_qty_valueÂ =Â 1,
Â Â Â Â Â Â Â Â Â initial_capitalÂ =Â 10000,
Â Â Â Â Â Â Â Â Â commission_typeÂ =Â strategy.commission.percent,
Â Â Â Â Â Â Â Â Â commission_valueÂ =Â 0.04,
Â Â Â Â Â Â Â Â Â max_lines_countÂ =Â 300,
Â Â Â Â Â Â Â Â Â max_labels_countÂ =Â 200)
importÂ jason5480/external_input_utils/3Â asÂ exiu
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ“†ğŸ“ˆÂ FILTERSÂ =====================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ filteringÂ outÂ longÂ andÂ shortÂ openÂ signalsÂ thatÂ doÂ notÂ meetÂ userÂ definedÂ rules
//Â Dependencies:Â NONE
//Â Results:Â longFiltersApproval,Â shortFiltersApproval
importÂ jason5480/time_filters/5Â asÂ tif
//Â INPUTÂ ============================================================================================================
src_timezoneÂ =Â input.string(defvalÂ =Â 'Exchange',Â titleÂ =Â 'TimezonesÂ Src->Dst',Â optionsÂ =Â ['Exchange',Â 'UTC',Â 'America/Los_Angeles',Â 'America/Phoenix',Â 'America/Vancouver',Â 'America/El_Salvador',Â 'America/Bogota',Â 'America/Chicago',Â 'America/New_York',Â 'America/Toronto',Â 'America/Argentina/Buenos_Aires',Â 'America/Sao_Paulo',Â 'Etc/UTC',Â 'Europe/London',Â 'Europe/Berlin',Â 'Europe/Madrid',Â 'Europe/Paris',Â 'Europe/Warsaw',Â 'Europe/Athens',Â 'Europe/Moscow',Â 'Asia/Tehran',Â 'Asia/Dubai',Â 'Asia/Ashkhabad',Â 'Asia/Kolkata',Â 'Asia/Almaty',Â 'Asia/Bangkok',Â 'Asia/Hong_Kong',Â 'Asia/Shanghai',Â 'Asia/Singapore',Â 'Asia/Taipei',Â 'Asia/Seoul',Â 'Asia/Tokyo',Â 'Australia/ACT',Â 'Australia/Adelaide',Â 'Australia/Brisbane',Â 'Australia/Sydney',Â 'Pacific/Auckland',Â 'Pacific/Fakaofo',Â 'Pacific/Chatham',Â 'Pacific/Honolulu'],Â inlineÂ =Â 'Timezone',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
dst_timezoneÂ =Â input.string(defvalÂ =Â 'Exchange',Â titleÂ =Â '->',Â optionsÂ =Â ['Exchange',Â 'UTC',Â 'America/Los_Angeles',Â 'America/Phoenix',Â 'America/Vancouver',Â 'America/El_Salvador',Â 'America/Bogota',Â 'America/Chicago',Â 'America/New_York',Â 'America/Toronto',Â 'America/Argentina/Buenos_Aires',Â 'America/Sao_Paulo',Â 'Etc/UTC',Â 'Europe/London',Â 'Europe/Berlin',Â 'Europe/Madrid',Â 'Europe/Paris',Â 'Europe/Warsaw',Â 'Europe/Athens',Â 'Europe/Moscow',Â 'Asia/Tehran',Â 'Asia/Dubai',Â 'Asia/Ashkhabad',Â 'Asia/Kolkata',Â 'Asia/Almaty',Â 'Asia/Bangkok',Â 'Asia/Hong_Kong',Â 'Asia/Shanghai',Â 'Asia/Singapore',Â 'Asia/Taipei',Â 'Asia/Seoul',Â 'Asia/Tokyo',Â 'Australia/ACT',Â 'Australia/Adelaide',Â 'Australia/Brisbane',Â 'Australia/Sydney',Â 'Pacific/Auckland',Â 'Pacific/Fakaofo',Â 'Pacific/Chatham',Â 'Pacific/Honolulu'],Â tooltipÂ =Â 'SourceÂ isÂ theÂ timezoneÂ toÂ beÂ usedÂ asÂ aÂ referenceÂ forÂ theÂ timeÂ settings.Â DestinationÂ isÂ theÂ timezoneÂ toÂ convertÂ intoÂ (e.g.Â theÂ charts\'Â timezone)',Â inlineÂ =Â 'Timezone',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
usefromDateÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'From',Â inlineÂ =Â 'FromÂ Date',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
fromDateÂ =Â input.time(defvalÂ =Â timestamp('01Â JanÂ 2022Â 00:00'),Â titleÂ =Â '',Â inlineÂ =Â 'FromÂ Date',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
usetoDateÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'Toâ€ƒ',Â inlineÂ =Â 'ToÂ Date',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
toDateÂ =Â input.time(defvalÂ =Â timestamp('01Â JulÂ 2022Â 00:00'),Â titleÂ =Â '',Â inlineÂ =Â 'ToÂ Date',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
useSessionDayÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'SessionÂ Days',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
monÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'Mon',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
tueÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'Tue',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
wedÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'Wed',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
thuÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'Thu',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
friÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'Fri',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
satÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'Sat',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
sunÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'Sun',Â inlineÂ =Â 'SessionÂ Days',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
useSessionStartÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'SessionÂ Start',Â inlineÂ =Â 'SessionÂ Start',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
sessionStartHourÂ =Â input.int(defvalÂ =Â 12,Â titleÂ =Â '',Â minvalÂ =Â 0,Â maxvalÂ =Â 23,Â stepÂ =Â 1,Â inlineÂ =Â 'SessionÂ Start',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
sessionStartMinuteÂ =Â input.int(defvalÂ =Â 00,Â titleÂ =Â ':',Â minvalÂ =Â 0,Â maxvalÂ =Â 59,Â stepÂ =Â 1,Â tooltipÂ =Â 'StartÂ timeÂ ofÂ theÂ session.',Â inlineÂ =Â 'SessionÂ Start',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
useSessionEndÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'SessionÂ End',Â inlineÂ =Â 'SessionÂ End',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
sessionEndHourÂ =Â input.int(defvalÂ =Â 20,Â titleÂ =Â '',Â minvalÂ =Â 0,Â maxvalÂ =Â 23,Â stepÂ =Â 1,Â inlineÂ =Â 'SessionÂ End',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
sessionEndMinuteÂ =Â input.int(defvalÂ =Â 00,Â titleÂ =Â ':',Â minvalÂ =Â 0,Â maxvalÂ =Â 59,Â stepÂ =Â 1,Â tooltipÂ =Â 'EndÂ timeÂ ofÂ theÂ session.',Â inlineÂ =Â 'SessionÂ End',Â groupÂ =Â 'ğŸ“†Â FiltersÂ -Â Time')
longTradesEnabledÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'LongÂ Trades',Â inlineÂ =Â 'Trades',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
shortTradesEnabledÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'ShortÂ Trades',Â tooltipÂ =Â 'EnableÂ long/shortÂ trades.',Â inlineÂ =Â 'Trades',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
emaFilterEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EMAÂ Filter',Â tooltipÂ =Â 'EnableÂ long/shortÂ tradesÂ basedÂ onÂ EMA.',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
emaTimeframeÂ =Â input.timeframe(defvalÂ =Â "",Â titleÂ =Â 'â€ƒâ€ƒEMAÂ Res/Len/Src',Â inlineÂ =Â 'EMAÂ Filter',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
emaLengthÂ =Â input.int(defvalÂ =Â 200,Â titleÂ =Â '',Â minvalÂ =Â 1,Â inlineÂ =Â 'EMAÂ Filter',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
emaSrcÂ =Â exiu.str_to_src(input.string(defvalÂ =Â 'close',Â titleÂ =Â '',Â optionsÂ =Â ['open',Â 'high',Â 'low',Â 'close',Â 'hl2',Â 'hlc3',Â 'ohlc4',Â 'hlcc4'],Â tooltipÂ =Â 'TheÂ timeframe,Â periodÂ andÂ sourceÂ forÂ theÂ EMAÂ calculation.',Â inlineÂ =Â 'EMAÂ Filter',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend'))
emaAtrBandEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EMAÂ ATRÂ Band',Â tooltipÂ =Â 'EnableÂ ATRÂ bandÂ forÂ EMAÂ filter.',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
filterAtrLengthÂ =Â input.int(defvalÂ =Â 5,Â titleÂ =Â 'â€ƒâ€ƒEMAÂ ATRÂ Len/Mul',Â minvalÂ =Â 1,Â inlineÂ =Â 'EMAÂ ATR',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
filterAtrMulÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â '',Â tooltipÂ =Â 'ATRÂ lengthÂ andÂ multiplierÂ toÂ beÂ usedÂ forÂ theÂ ATRÂ calculationÂ thatÂ willÂ beÂ addedÂ onÂ topÂ ofÂ theÂ EMAÂ filter.',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â inlineÂ =Â 'EMAÂ ATR',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
adxFilterEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'ADXÂ Filter',Â tooltipÂ =Â 'EnableÂ long/shortÂ tradesÂ basedÂ onÂ ADX.',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
adxSmoothingÂ =Â input.int(defvalÂ =Â 14,Â titleÂ =Â 'â€ƒâ€ƒSmooth/DIÂ Len',Â minvalÂ =Â 1,Â inlineÂ =Â 'ADXÂ Filter',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
diLengthÂ =Â input.int(defvalÂ =Â 14,Â titleÂ =Â '',Â minvalÂ =Â 1,Â tooltipÂ =Â 'ADXÂ SmoothingÂ lengthÂ andÂ DirectionÂ Length.',Â inlineÂ =Â 'ADXÂ Filter',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
adxThresholdÂ =Â input.float(defvalÂ =Â 39.4,Â titleÂ =Â 'â€ƒâ€ƒThreshold',Â minvalÂ =Â 0.1,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.1,Â tooltipÂ =Â 'ADXÂ lowerÂ threshold.',Â groupÂ =Â 'ğŸ“ˆÂ FiltersÂ -Â Trend')
//Â LOGICÂ ============================================================================================================
boolÂ dateFilterApprovalÂ =Â tif.is_in_date_range(usefromDate,Â fromDate,Â usetoDate,Â toDate,Â src_timezone,Â dst_timezone)
boolÂ sessionFilterApprovalÂ =Â tif.is_in_session(useSessionStart,Â sessionStartHour,Â sessionStartMinute,Â useSessionEnd,Â sessionEndHour,Â sessionEndMinute,Â useSessionDay,Â mon,Â tue,Â wed,Â thu,Â fri,Â sat,Â sun,Â src_timezone,Â dst_timezone)
boolÂ timeFilterApprovalÂ =Â dateFilterApprovalÂ andÂ sessionFilterApproval
emaLineÂ =Â request.security(symbolÂ =Â syminfo.tickerid,Â timeframeÂ =Â emaTimeframe,Â expressionÂ =Â ta.ema(emaSrc,Â emaLength),Â gapsÂ =Â barmerge.gaps_off)
emaAtrÂ =Â ta.atr(filterAtrLength)
emaUpperBandÂ =Â emaLineÂ +Â filterAtrMulÂ *Â emaAtr
emaLowerBandÂ =Â emaLineÂ -Â filterAtrMulÂ *Â emaAtr
boolÂ emaLongApprovalÂ =Â emaFilterEnabledÂ ?Â closeÂ >Â (emaAtrBandEnabledÂ ?Â emaUpperBandÂ :Â emaLine)Â andÂ openÂ >Â (emaAtrBandEnabledÂ ?Â emaUpperBandÂ :Â emaLine)Â :Â true
boolÂ emaShortApprovalÂ =Â emaFilterEnabledÂ ?Â closeÂ <Â (emaAtrBandEnabledÂ ?Â emaLowerBandÂ :Â emaLine)Â andÂ openÂ <Â (emaAtrBandEnabledÂ ?Â emaLowerBandÂ :Â emaLine)Â :Â true
[_,Â _,Â adx]Â =Â ta.dmi(diLength,Â adxSmoothing)
boolÂ adxApprovalÂ =Â adxFilterEnabledÂ ?Â adxÂ >Â adxThresholdÂ :Â true
boolÂ longFiltersApprovalÂ =Â longTradesEnabledÂ andÂ emaLongApprovalÂ andÂ adxApprovalÂ andÂ timeFilterApproval
boolÂ shortFiltersApprovalÂ =Â shortTradesEnabledÂ andÂ emaShortApprovalÂ andÂ adxApprovalÂ andÂ timeFilterApproval
//Â PLOTÂ =============================================================================================================
bgcolor(colorÂ =Â timeFilterApprovalÂ ?Â naÂ :Â color.new(color.gray,Â 90),Â offsetÂ =Â 1,Â titleÂ =Â 'TimeÂ Window')
emaLineColorÂ =Â emaLongApprovalÂ ?Â color.tealÂ :Â emaShortApprovalÂ ?Â color.maroonÂ :Â color.gray
plot(seriesÂ =Â emaFilterEnabledÂ ?Â emaLineÂ :Â na,Â colorÂ =Â emaLineColor,Â styleÂ =Â plot.style_linebr,Â linewidthÂ =Â 2,Â titleÂ =Â 'EMAÂ Line')
emaUpperBandPlotÂ =Â plot(seriesÂ =Â emaUpperBand,Â colorÂ =Â na,Â styleÂ =Â plot.style_linebr,Â linewidthÂ =Â 1,Â titleÂ =Â 'EMAÂ UpperÂ Band')
emaLowerBandPlotÂ =Â plot(seriesÂ =Â emaLowerBand,Â colorÂ =Â na,Â styleÂ =Â plot.style_linebr,Â linewidthÂ =Â 1,Â titleÂ =Â 'EMAÂ LowerÂ Band')
emaBandFillColorÂ =Â emaFilterEnabledÂ andÂ emaAtrBandEnabledÂ ?Â color.new(emaLineColor,Â 85)Â :Â na
fill(plot1Â =Â emaUpperBandPlot,Â plot2Â =Â emaLowerBandPlot,Â colorÂ =Â emaBandFillColor,Â titleÂ =Â 'EMAÂ Band')
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â â˜­Â SHAREDÂ VARIABLESÂ 1Â =============================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ generalÂ purposeÂ variableÂ thatÂ neededÂ forÂ severalÂ otherÂ modules
//Â Dependencies:Â NONE
//Â Results:Â currentPositionSize,Â previousPositionSize,Â positionSizeIncreased,Â positionSizeDecreased,Â longPositionCompleted,Â shortPositionCompleted
//Â LOGICÂ ============================================================================================================
//Â theÂ currentÂ andÂ previousÂ positionÂ sizes
floatÂ currentPositionSizeÂ =Â strategy.opentrades.size(strategy.opentradesÂ -Â 1)
floatÂ previousPositionSizeÂ =Â strategy.opentrades.size(strategy.opentradesÂ -Â 1)[1]
boolÂ positionSizeIncreasedÂ =Â currentPositionSizeÂ >Â previousPositionSize
boolÂ positionSizeDecreasedÂ =Â currentPositionSizeÂ <Â previousPositionSize
boolÂ longPositionCompletedÂ =Â currentPositionSizeÂ <=Â 0Â andÂ previousPositionSizeÂ >Â 0
boolÂ shortPositionCompletedÂ =Â currentPositionSizeÂ >=Â 0Â andÂ previousPositionSizeÂ <Â 0
//Â flagsÂ thtÂ areÂ trueÂ whenÂ alreadyÂ enteredÂ aÂ longÂ orÂ shortÂ position
boolÂ enteredLongPositionÂ =Â currentPositionSizeÂ >Â 0Â andÂ previousPositionSizeÂ <=Â 0
boolÂ enteredShortPositionÂ =Â currentPositionSizeÂ <Â 0Â andÂ previousPositionSizeÂ >=Â 0
//Â debugÂ flags
varÂ boolÂ showAlertsEnabledÂ =Â false
varÂ boolÂ debugModeEnabledÂ =Â false
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ› ï¸Â STRATEGYÂ 1Â ====================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ openÂ positionÂ logic.Â ThisÂ isÂ implementedÂ basedÂ onÂ dealÂ conditionsÂ definedÂ internallyÂ (inÂ thisÂ script)Â orÂ externalyÂ (basedÂ onÂ conditionsÂ thatÂ takeÂ asÂ inputÂ otherÂ indicator)
//Â Dependencies:Â FILTERS,Â SHAREDÂ VARIABLESÂ 1
//Â Results:Â openLongPosition,Â openShortPosition
importÂ HeWhoMustNotBeNamed/enhanced_ta/14Â asÂ eta
//Â INPUTÂ ============================================================================================================
dealModeÂ =Â input.string(defvalÂ =Â 'ğŸ”§Internal',Â titleÂ =Â 'DealÂ ConditionsÂ Mode',Â optionsÂ =Â ['ğŸ”§Internal',Â 'ğŸ”¨External'],Â tooltipÂ =Â 'UseÂ theÂ "Internal"Â MAÂ crossÂ over/underÂ logicÂ toÂ startÂ andÂ endÂ yourÂ deals.Â OrÂ useÂ anÂ "External"Â indicatorÂ toÂ constructÂ yourÂ ownÂ startÂ andÂ endÂ dealÂ conditions.',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
cooldownEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'CooldownÂ #Â ofÂ bars',Â inlineÂ =Â 'Cooldown',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
cooldownBarsÂ =Â input.int(defvalÂ =Â 7,Â titleÂ =Â '',Â minvalÂ =Â 1,Â tooltipÂ =Â 'DoÂ NOTÂ emitÂ openÂ positionÂ signalÂ ifÂ noÂ moreÂ thanÂ theÂ givenÂ numberÂ ofÂ barsÂ haveÂ passedÂ sinceÂ previousÂ positionÂ hasÂ beenÂ completed.Â AÂ newÂ startÂ dealÂ signalÂ willÂ beÂ neededÂ afterÂ thatÂ periodÂ toÂ openÂ aÂ newÂ position.',Â inlineÂ =Â 'Cooldown',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
and_lengthÂ Â =Â input.int(defval=50,Â title='AndeanÂ Length',Â group='ğŸ”§Â StrategyÂ -Â Internal')
sig_lengthÂ Â =Â input.int(defval=9,Â title='AndeanÂ SignalÂ Length',Â group='ğŸ”§Â StrategyÂ -Â Internal')
signal_threshold_lengthÂ Â =Â input.int(defval=1000,Â title='SignalÂ ThresholdÂ Length',Â group='ğŸ”§Â StrategyÂ -Â Internal')
signal_threshold_multiplierÂ Â =Â input.float(defval=1.1,Â step=0.1,Â title='SignalÂ ThresholdÂ Multiplier',Â group='ğŸ”§Â StrategyÂ -Â Internal')
externalInputÂ =Â input.source(defvalÂ =Â close,Â titleÂ =Â 'ExternalÂ Input',Â tooltipÂ =Â 'SelectÂ inputÂ fromÂ anÂ externalÂ indicator.Â TheÂ indicatorÂ shouldÂ beÂ addedÂ toÂ theÂ sameÂ chartÂ withÂ thisÂ strategyÂ andÂ theÂ desiredÂ valueÂ thatÂ willÂ takeÂ partÂ inÂ theÂ conditionÂ shouldÂ beÂ plotedÂ inÂ theÂ chart.',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
startLongDealOperatorÂ =Â input.string(defvalÂ =Â '/10',Â titleÂ =Â 'StartÂ LongÂ DealÂ whenÂ input',Â optionsÂ =Â ['==',Â '<',Â '>',Â '<=',Â '>=',Â '!=',Â 'crossover',Â 'crossunder',Â 'mod2',Â 'mod3',Â 'mod10',Â '/10',Â 'noop'],Â inlineÂ =Â 'StartÂ LongÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
startLongDealValueÂ =Â input.float(defvalÂ =Â 2.0,Â titleÂ =Â '',Â tooltipÂ =Â 'ConditonÂ toÂ startÂ aÂ LongÂ DealÂ basedÂ onÂ externalÂ input.',Â inlineÂ =Â 'StartÂ LongÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
endLongDealOperatorÂ =Â input.string(defvalÂ =Â '/10',Â titleÂ =Â 'EndÂ LongÂ DealÂ whenÂ input',Â optionsÂ =Â ['==',Â '<',Â '>',Â '<=',Â '>=',Â '!=',Â 'crossover',Â 'crossunder',Â 'mod2',Â 'mod3',Â 'mod10',Â '/10',Â 'noop'],Â inlineÂ =Â 'EndÂ LongÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
endLongDealValueÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â '',Â tooltipÂ =Â 'ConditonÂ toÂ endÂ aÂ LongÂ DealÂ basedÂ onÂ externalÂ input.',Â inlineÂ =Â 'EndÂ LongÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
startShortDealOperatorÂ =Â input.string(defvalÂ =Â 'mod10',Â titleÂ =Â 'StartÂ ShortÂ DealÂ whenÂ input',Â optionsÂ =Â ['==',Â '<',Â '>',Â '<=',Â '>=',Â '!=',Â 'crossover',Â 'crossunder',Â 'mod2',Â 'mod3',Â 'mod10',Â '/10',Â 'noop'],Â inlineÂ =Â 'StartÂ ShortÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
startShortDealValueÂ =Â input.float(defvalÂ =Â 2.0,Â titleÂ =Â '',Â tooltipÂ =Â 'ConditonÂ toÂ startÂ aÂ ShortÂ DealÂ basedÂ onÂ externalÂ input.',Â inlineÂ =Â 'StartÂ ShortÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
endShortDealOperatorÂ =Â input.string(defvalÂ =Â 'mod10',Â titleÂ =Â 'EndÂ ShortÂ DealÂ whenÂ input',Â optionsÂ =Â ['==',Â '<',Â '>',Â '<=',Â '>=',Â '!=',Â 'crossover',Â 'crossunder',Â 'mod2',Â 'mod3',Â 'mod10',Â '/10',Â 'noop'],Â inlineÂ =Â 'EndÂ ShortÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
endShortDealValueÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â '',Â tooltipÂ =Â 'ConditonÂ toÂ endÂ aÂ ShortÂ DealÂ basedÂ onÂ externalÂ input.',Â inlineÂ =Â 'EndÂ ShortÂ Deal',Â groupÂ =Â 'ğŸ”¨Â StrategyÂ -Â External')
//Â ANDEANÂ OSCILLATORÂ Â ============================================================================================================
varÂ alphaÂ =Â 2/(and_length+1)
varÂ up1Â =Â 0.,varÂ up2Â =Â 0.
varÂ dn1Â =Â 0.,varÂ dn2Â =Â 0.
CÂ =Â close
OÂ =Â open
up1Â :=Â nz(math.max(C,Â O,Â up1[1]Â -Â (up1[1]Â -Â C)Â *Â alpha),Â C)
up2Â :=Â nz(math.max(CÂ *Â C,Â OÂ *Â O,Â up2[1]Â -Â (up2[1]Â -Â CÂ *Â C)Â *Â alpha),Â CÂ *Â C)
dn1Â :=Â nz(math.min(C,Â O,Â dn1[1]Â +Â (CÂ -Â dn1[1])Â *Â alpha),Â C)
dn2Â :=Â nz(math.min(CÂ *Â C,Â OÂ *Â O,Â dn2[1]Â +Â (CÂ *Â CÂ -Â dn2[1])Â *Â alpha),Â CÂ *Â C)
bullÂ =Â math.sqrt(dn2Â -Â dn1Â *Â dn1)
bearÂ =Â math.sqrt(up2Â -Â up1Â *Â up1)
signalÂ =Â ta.ema(math.max(bull,Â bear),Â sig_length)
average_thresholdÂ =Â ta.sma(signal,Â signal_threshold_length)Â *Â signal_threshold_multiplier
plotchar(average_threshold,Â "AvgÂ Threshold",Â "")
and_startLongDealÂ =Â bullÂ >Â bearÂ andÂ bullÂ >Â signalÂ andÂ signalÂ >Â average_threshold
and_endLongDealÂ =Â bullÂ <Â signal
and_startShortDealÂ =Â bearÂ >Â bullÂ andÂ bearÂ >Â signalÂ andÂ signalÂ >Â average_threshold
and_endShortDealÂ =Â bearÂ <Â signal
//-----------------------------------------------------------------------------}
boolÂ startLongDealÂ =Â dealModeÂ ==Â 'ğŸ”§Internal'Â ?Â and_startLongDealÂ :Â exiu.eval_cond(externalInput,Â startLongDealOperator,Â startLongDealValue,Â false)
boolÂ endLongDealÂ =Â dealModeÂ ==Â 'ğŸ”§Internal'Â ?Â and_endLongDealÂ :Â exiu.eval_cond(externalInput,Â endLongDealOperator,Â endLongDealValue,Â true)
boolÂ startShortDealÂ =Â dealModeÂ ==Â 'ğŸ”§Internal'Â ?Â and_startShortDealÂ :Â exiu.eval_cond(externalInput,Â startShortDealOperator,Â startShortDealValue,Â false)
boolÂ endShortDealÂ =Â dealModeÂ ==Â 'ğŸ”§Internal'Â ?Â and_endShortDealÂ :Â exiu.eval_cond(externalInput,Â endShortDealOperator,Â endShortDealValue,Â true)
intÂ barsSinceCompleteÂ =Â nz(ta.barssince(currentPositionSizeÂ !=Â 0),Â 999999)
boolÂ cooldownApprovalÂ =Â cooldownEnabledÂ ?Â barsSinceCompleteÂ >Â cooldownBarsÂ :Â true
boolÂ openLongPositionÂ =Â longFiltersApprovalÂ andÂ startLongDealÂ andÂ cooldownApproval
boolÂ openShortPositionÂ =Â shortFiltersApprovalÂ andÂ startShortDealÂ andÂ cooldownApproval
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â â˜­Â SHAREDÂ VARIABLESÂ 2Â =============================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ generalÂ purposeÂ variableÂ thatÂ neededÂ forÂ severalÂ otherÂ modules
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 1,Â STRATEGYÂ 1
//Â Results:Â validOpenLongPosition,Â validOpenShortPosition,Â validOpenClose,Â barsSinceOpenLong,Â barsSinceOpenShort,
//Â Â Â Â Â Â Â Â Â Â barsSinceValidOpenLong,Â barsSinceValidOpenShort,Â barsSinceCloseLong,Â barsSinceCloseShort,Â longAtr,Â shortAtr
importÂ HeWhoMustNotBeNamed/arrayutils/21Â asÂ pa
//Â INPUTÂ ============================================================================================================
atrMethodÂ =Â input.string(defvalÂ =Â 'STATIC',Â titleÂ =Â 'ATRÂ Method',Â optionsÂ =Â ['STATIC',Â 'DYNAMIC',Â 'LADDER'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ ATRÂ usedÂ forÂ theÂ trailing.',Â groupÂ =Â 'â˜­Â SharedÂ Variables')
atrMaTypeÂ =Â str.lower(input.string(defvalÂ =Â 'RMA',Â titleÂ =Â 'â€ƒâ€ƒATRÂ SmoothÂ Type/Len',Â optionsÂ =Â ['SMA',Â 'EMA',Â 'HMA',Â 'RMA',Â 'WMA'],Â inlineÂ =Â 'ATR',Â groupÂ =Â 'â˜­Â SharedÂ Variables'))
atrLengthÂ =Â input.int(defvalÂ =Â 14,Â titleÂ =Â '',Â minvalÂ =Â 1,Â tooltipÂ =Â 'TheÂ smoothingÂ typeÂ andÂ theÂ lengthÂ toÂ beÂ usedÂ forÂ theÂ ATRÂ calculation.',Â inlineÂ =Â 'ATR',Â groupÂ =Â 'â˜­Â SharedÂ Variables')
//Â LOGICÂ ============================================================================================================
//Â theÂ openÂ signalsÂ whenÂ notÂ alreadyÂ intoÂ aÂ position
boolÂ validOpenLongPositionÂ =Â openLongPositionÂ andÂ notÂ (currentPositionSizeÂ >Â 0)
boolÂ validOpenShortPositionÂ =Â openShortPositionÂ andÂ notÂ (currentPositionSizeÂ <Â 0)
//Â TheÂ closeÂ priceÂ whenÂ lastÂ validÂ openÂ wasÂ triggered
floatÂ validOpenCloseÂ =Â ta.valuewhen(validOpenLongPositionÂ orÂ validOpenShortPosition,Â close,Â 0)
//Â countÂ howÂ farÂ areÂ theÂ lastÂ openÂ signalsÂ (validÂ orÂ not)
intÂ barsSinceOpenLongÂ =Â nz(ta.barssince(openLongPosition),Â 999999)
intÂ barsSinceOpenShortÂ =Â nz(ta.barssince(openShortPosition),Â 999999)
intÂ barsSinceValidOpenLongÂ =Â nz(ta.barssince(validOpenLongPosition),Â 999999)
intÂ barsSinceValidOpenShortÂ =Â nz(ta.barssince(validOpenShortPosition),Â 999999)
//Â countÂ howÂ farÂ areÂ theÂ lastÂ validÂ closeÂ signals
varÂ boolÂ closeLongPositionÂ =Â false
varÂ boolÂ closeShortPositionÂ =Â false
intÂ barsSinceCloseLongÂ =Â nz(ta.barssince(closeLongPositionÂ andÂ timeFilterApproval),Â 999999)
intÂ barsSinceCloseShortÂ =Â nz(ta.barssince(closeShortPositionÂ andÂ timeFilterApproval),Â 999999)
//Â calculateÂ atrÂ basedÂ onÂ methodÂ selected,Â staticÂ atrÂ whenÂ lastÂ openÂ signalÂ wasÂ triggered,Â dynamicÂ atrÂ isÂ theÂ currentÂ atrÂ thatÂ changeÂ overÂ time,Â ladderÂ atrÂ forÂ positiveÂ andÂ negativeÂ bars
floatÂ dynamicAtrÂ =Â eta.ma(ta.tr(true),Â atrMaType,Â atrLength)
floatÂ staticAtrÂ =Â ta.valuewhen(validOpenLongPositionÂ orÂ validOpenShortPosition,Â dynamicAtr,Â 0)
varÂ negativeTrsÂ =Â array.new<float>()
varÂ positiveTrsÂ =Â array.new<float>()
if(openÂ >Â close)
Â Â Â Â pa.push(negativeTrs,Â ta.tr(true),Â atrLength)
else
Â Â Â Â pa.push(positiveTrs,Â ta.tr(true),Â atrLength)
floatÂ ladderLongAtrÂ =Â pa.ma(negativeTrs,Â atrMaType,Â atrLength)
floatÂ ladderShortAtrÂ =Â pa.ma(positiveTrs,Â atrMaType,Â atrLength)
floatÂ longAtrÂ =Â switchÂ atrMethod
Â Â Â Â 'STATIC'Â =>Â staticAtr
Â Â Â Â 'DYNAMIC'Â =>Â dynamicAtr
Â Â Â Â 'LADDER'Â =>Â ladderLongAtr
Â Â Â Â =>Â na
floatÂ shortAtrÂ =Â switchÂ atrMethod
Â Â Â Â 'STATIC'Â =>Â staticAtr
Â Â Â Â 'DYNAMIC'Â =>Â dynamicAtr
Â Â Â Â 'LADDER'Â =>Â ladderShortAtr
Â Â Â Â =>Â na
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â â‡©Â ENTRYÂ ==========================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ trailingÂ entryÂ logicÂ implementationÂ basedÂ onÂ theÂ deviation
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 1,Â STRATEGYÂ 1,Â SHAREDÂ VARIABLESÂ 2
//Â Results:Â longPositionEntry,Â longIsActive,Â longTrEntryIsActive,Â shortPositionEntry,Â shortIsActive,Â shortTrEntryIsActive,Â entryBarId,Â entryPrice
//Â INPUTÂ ============================================================================================================
entryTrailingEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ Trailing',Â tooltipÂ =Â 'EnableÂ orÂ disableÂ theÂ trailingÂ forÂ entryÂ position.',Â groupÂ =Â 'â‡©Â Entry')
devEntryMethodÂ =Â input.string(defvalÂ =Â 'PERC',Â titleÂ =Â 'DeviationÂ Method',Â optionsÂ =Â ['PERC',Â 'ATR',Â 'LOC'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ deviationÂ forÂ theÂ trailingÂ entry.',Â groupÂ =Â 'â‡©Â Entry')
devEntryPercÂ =Â input.float(defvalÂ =Â 3.0,Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ %',Â minvalÂ =Â 0.01,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ stepÂ toÂ followÂ theÂ priceÂ whenÂ theÂ openÂ positionÂ conditionÂ isÂ met.',Â groupÂ =Â 'â‡©Â Entry')Â /Â 100.0Â 
devEntryAtrMulÂ =Â input.float(defvalÂ =Â 0.5,Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ ATRÂ Mul',Â minvalÂ =Â 0.01,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'MultiplierÂ toÂ beÂ usedÂ onÂ theÂ ATRÂ toÂ calculateÂ theÂ stepÂ forÂ followingÂ theÂ price,Â untilÂ theÂ entryÂ targetÂ isÂ reached.',Â groupÂ =Â 'â‡©Â Entry')
devEntryLenÂ =Â input.int(defvalÂ =Â 3,Â titleÂ =Â 'â€ƒâ€ƒDevÂ LocÂ ExtremaÂ Len/Ticks',Â minvalÂ =Â 1,Â inlineÂ =Â 'DeviationÂ EntryÂ LocalÂ Extrema',Â groupÂ =Â 'â‡©Â Entry')
devEntryTicksÂ =Â input.int(defvalÂ =Â 2,Â titleÂ =Â '',Â minvalÂ =Â 0,Â tooltipÂ =Â 'LocalÂ extremaÂ (minimum/maximum)Â withinÂ aÂ windowÂ ofÂ lengthÂ minus/plusÂ someÂ ticksÂ toÂ beÂ usedÂ forÂ theÂ entryÂ target.',Â inlineÂ =Â 'DeviationÂ EntryÂ LocalÂ Extrema',Â groupÂ =Â 'â‡©Â Entry')
//Â LOGICÂ ============================================================================================================
boolÂ longPositionEntryÂ =Â entryTrailingEnabledÂ ?Â enteredLongPositionÂ :Â validOpenLongPosition
//Â MarkÂ whenÂ longÂ positionÂ isÂ active
boolÂ longIsActiveÂ =Â longPositionEntryÂ orÂ currentPositionSizeÂ >Â 0
//Â countÂ howÂ farÂ isÂ theÂ lastÂ longÂ entryÂ signal
intÂ barsSinceEnterLongÂ =Â nz(ta.barssince(longPositionEntry),Â 999999)
boolÂ openLongIsActiveÂ =Â barsSinceCloseLongÂ >=Â barsSinceOpenLongÂ //Â closeÂ ->Â open
boolÂ enterLongIsPendingÂ =Â barsSinceEnterLongÂ >Â barsSinceValidOpenLongÂ //Â enterÂ ->Â validOpen
boolÂ tryEnterLongPositionÂ =Â entryTrailingEnabledÂ andÂ longFiltersApprovalÂ andÂ openLongIsActiveÂ andÂ enterLongIsPendingÂ andÂ currentPositionSizeÂ <=Â 0
floatÂ entryHighestHighÂ =Â ta.highest(high,Â devEntryLen)
floatÂ openEntryHighestHighÂ =Â ta.valuewhen(validOpenLongPosition,Â entryHighestHigh,Â 0)
getLongEntryOpenBaseScr()Â =>
Â Â Â Â switchÂ devEntryMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â validOpenClose
Â Â Â Â Â Â Â Â 'ATR'Â =>Â validOpenClose
Â Â Â Â Â Â Â Â 'LOC'Â =>Â openEntryHighestHigh
Â Â Â Â Â Â Â Â =>Â na
getLongEntryTrailingBaseScr()Â =>
Â Â Â Â switchÂ devEntryMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â low
Â Â Â Â Â Â Â Â 'ATR'Â =>Â low
Â Â Â Â Â Â Â Â 'LOC'Â =>Â entryHighestHigh
Â Â Â Â Â Â Â Â =>Â na
getLongEntryPrice(baseSrc)Â =>
Â Â Â Â switchÂ devEntryMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â +Â devEntryPerc)
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ +Â devEntryAtrMulÂ *Â longAtr
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ +Â devEntryTicksÂ *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
varÂ floatÂ longTrEntryPriceÂ =Â na
boolÂ isFirstValidOpenLongPositionÂ =Â entryTrailingEnabledÂ andÂ validOpenLongPositionÂ andÂ na(longTrEntryPrice[1])
longTrEntryPriceÂ :=Â ifÂ (isFirstValidOpenLongPosition)
Â Â Â Â getLongEntryPrice(getLongEntryOpenBaseScr())
elseÂ ifÂ (tryEnterLongPosition)
Â Â Â Â math.min(getLongEntryPrice(getLongEntryTrailingBaseScr()),Â nz(longTrEntryPrice[1],Â 999999))
else
Â Â Â Â na
boolÂ longTrEntryIsActiveÂ =Â notÂ na(longTrEntryPrice)
boolÂ shortPositionEntryÂ =Â entryTrailingEnabledÂ ?Â enteredShortPositionÂ :Â validOpenShortPosition
//Â MarkÂ whenÂ shortÂ positionÂ isÂ active
boolÂ shortIsActiveÂ =Â shortPositionEntryÂ orÂ currentPositionSizeÂ <Â 0
//Â countÂ howÂ farÂ isÂ theÂ lastÂ shortÂ entryÂ signal
intÂ barsSinceEnterShortÂ =Â nz(ta.barssince(shortPositionEntry),Â 999999)
boolÂ openShortIsActiveÂ =Â barsSinceCloseShortÂ >=Â barsSinceOpenShortÂ //Â closeÂ ->Â open
boolÂ enterShortIsPendingÂ =Â barsSinceEnterShortÂ >Â barsSinceValidOpenShortÂ //Â enterÂ ->Â validOpen
boolÂ tryEnterShortPositionÂ =Â entryTrailingEnabledÂ andÂ shortFiltersApprovalÂ andÂ openShortIsActiveÂ andÂ enterShortIsPendingÂ andÂ currentPositionSizeÂ >=Â 0
floatÂ entryLowestLowÂ =Â ta.lowest(low,Â devEntryLen)
floatÂ openEntryLowestLowÂ =Â ta.valuewhen(validOpenShortPosition,Â entryLowestLow,Â 0)
getShortEntryOpenBaseScr()Â =>
Â Â Â Â switchÂ devEntryMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â validOpenClose
Â Â Â Â Â Â Â Â 'ATR'Â =>Â validOpenClose
Â Â Â Â Â Â Â Â 'LOC'Â =>Â openEntryLowestLow
Â Â Â Â Â Â Â Â =>Â na
getShortEntryTrailingBaseScr()Â =>
Â Â Â Â switchÂ devEntryMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â high
Â Â Â Â Â Â Â Â 'ATR'Â =>Â high
Â Â Â Â Â Â Â Â 'LOC'Â =>Â entryLowestLow
Â Â Â Â Â Â Â Â =>Â na
getShortEntryPrice(baseSrc)Â =>
Â Â Â Â switchÂ devEntryMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â -Â devEntryPerc)
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ -Â devEntryAtrMulÂ *Â shortAtr
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ -Â devEntryTicksÂ *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
varÂ floatÂ shortTrEntryPriceÂ =Â na
boolÂ isFirstValidOpenShortPositionÂ =Â entryTrailingEnabledÂ andÂ validOpenShortPositionÂ andÂ na(shortTrEntryPrice[1])
shortTrEntryPriceÂ :=Â ifÂ (isFirstValidOpenShortPosition)
Â Â Â Â getShortEntryPrice(getShortEntryOpenBaseScr())
elseÂ ifÂ (tryEnterShortPosition)
Â Â Â Â math.max(getShortEntryPrice(getShortEntryTrailingBaseScr()),Â nz(shortTrEntryPrice[1]))
else
Â Â Â Â na
boolÂ shortTrEntryIsActiveÂ =Â notÂ na(shortTrEntryPrice)
//Â barÂ indexÂ whenÂ theÂ enterÂ signalÂ wasÂ triggered
intÂ entryBarIdÂ =Â ta.valuewhen(longPositionEntryÂ orÂ shortPositionEntry,Â bar_index,Â 0)
//Â currentÂ entryÂ positionÂ price
floatÂ posPriceÂ =Â strategy.opentrades.entry_price(strategy.opentradesÂ -Â 1)
//Â priceÂ whenÂ enteredÂ aÂ positionÂ orÂ potentialÂ entryÂ priceÂ inÂ caseÂ ofÂ trailingÂ Â 
floatÂ entryPriceÂ =Â (validOpenLongPositionÂ orÂ validOpenShortPosition)Â andÂ notÂ entryTrailingEnabledÂ ?Â close
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â longTrEntryIsActiveÂ ?Â longTrEntryPrice
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â shortTrEntryIsActiveÂ ?Â shortTrEntryPrice
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â posPrice
//Â PLOTÂ =============================================================================================================
varÂ trailingEntryColorÂ =Â color.new(color.blue,Â 0)
plot(seriesÂ =Â longTrEntryPrice,Â titleÂ =Â 'LongÂ TrÂ EntryÂ Price',Â colorÂ =Â trailingEntryColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â shortTrEntryPrice,Â titleÂ =Â 'ShortÂ TrÂ EntryÂ Price',Â colorÂ =Â trailingEntryColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
varÂ posColorÂ =Â color.new(color.white,Â 0)
plot(seriesÂ =Â posPrice,Â titleÂ =Â 'Position',Â colorÂ =Â posColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸŸ¢Â TAKEÂ PROFITÂ 1Â =================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ takeÂ profitÂ logicÂ implementationÂ basedÂ onÂ theÂ methodÂ andÂ theÂ numberÂ ofÂ stepÂ takeÂ profitÂ targetsÂ andÂ theÂ trailingÂ deviation
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 1
//Â Results:Â longTrailingTakeProfitExecuted,Â shortTrailingTakeProfitExecuted,Â longInitTrailingTakeProfitExecuted,Â shortInitTrailingTakeProfitExecuted
//Â INPUTÂ ============================================================================================================
numOfTakeProfitTargetsÂ =Â input.int(defvalÂ =Â 1,Â titleÂ =Â 'TakeÂ ProfitÂ Targets',Â minvalÂ =Â 0,Â tooltipÂ =Â 'TheÂ numberÂ ofÂ takeÂ profitÂ targetsÂ toÂ beÂ setÂ forÂ eachÂ entry.Â TheÂ firstÂ targetÂ isÂ theÂ initialÂ targetÂ andÂ everyÂ additionalÂ targetÂ isÂ aÂ stepÂ target.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
//Â LOGICÂ ============================================================================================================
//Â arraysÂ withÂ theÂ updatedÂ takeÂ ProfitÂ Prices
varÂ longTakeProfitPricesÂ =Â array.new<float>(numOfTakeProfitTargets,Â na)
varÂ shortTakeProfitPricesÂ =Â array.new<float>(numOfTakeProfitTargets,Â na)
//Â takeÂ profitÂ hasÂ toÂ communicateÂ theÂ executionÂ ofÂ takeÂ profitÂ targetsÂ withÂ theÂ stopÂ lossÂ logicÂ whenÂ 'TP'Â modeÂ isÂ selected
varÂ longTrailingTakeProfitExecutedÂ =Â array.new<bool>(numOfTakeProfitTargets,Â false)
varÂ shortTrailingTakeProfitExecutedÂ =Â array.new<bool>(numOfTakeProfitTargets,Â false)
//Â countÂ theÂ TakeÂ ProfitÂ targetsÂ thatÂ executed
intÂ longTrailingTakeProfitExecutedCountÂ =Â 0
intÂ shortTrailingTakeProfitExecutedCountÂ =Â 0
//Â calculateÂ theÂ highestÂ highÂ sinceÂ theÂ longÂ entry
varÂ floatÂ highestHighSinceLongEntryÂ =Â na
highestHighSinceLongEntryÂ :=Â ifÂ (longIsActive)
Â Â Â Â math.max(high,Â nz(highestHighSinceLongEntry[1],Â high))
else
Â Â Â Â na
//Â calculateÂ theÂ lowestÂ lowÂ sinceÂ theÂ shortÂ entry
varÂ floatÂ lowestLowSinceShortEntryÂ =Â na
lowestLowSinceShortEntryÂ :=Â ifÂ (shortIsActive)
Â Â Â Â math.min(low,Â nz(lowestLowSinceShortEntry[1],Â low))
else
Â Â Â Â na
forÂ [i,Â takeProfitPrice]Â inÂ longTakeProfitPrices
Â Â Â Â executedÂ =Â currentPositionSizeÂ >Â 0Â andÂ (array.get(longTrailingTakeProfitExecuted,Â i)Â orÂ (((positionSizeDecreasedÂ orÂ previousPositionSizeÂ ==Â 0))Â andÂ highestHighSinceLongEntryÂ >=Â takeProfitPrice))
Â Â Â Â array.set(longTrailingTakeProfitExecuted,Â i,Â executed)
Â Â Â Â ifÂ (executed)
Â Â Â Â Â Â Â Â longTrailingTakeProfitExecutedCountÂ :=Â longTrailingTakeProfitExecutedCountÂ +Â 1
forÂ [i,Â takeProfitPrice]Â inÂ shortTakeProfitPrices
Â Â Â Â executedÂ =Â currentPositionSizeÂ <Â 0Â andÂ (array.get(shortTrailingTakeProfitExecuted,Â i)Â orÂ (((positionSizeIncreasedÂ orÂ previousPositionSizeÂ ==Â 0))Â andÂ lowestLowSinceShortEntryÂ <=Â takeProfitPrice))
Â Â Â Â array.set(shortTrailingTakeProfitExecuted,Â i,Â executed)
Â Â Â Â ifÂ (executed)
Â Â Â Â Â Â Â Â shortTrailingTakeProfitExecutedCountÂ :=Â shortTrailingTakeProfitExecutedCountÂ +Â 1
//Â checkÂ ifÂ theÂ i-thÂ TakeÂ ProfitÂ targetÂ wasÂ executed
longIthTrailingTakeProfitExecuted(i)Â =>
Â Â Â Â array.size(longTrailingTakeProfitExecuted)Â >Â iÂ ?Â array.get(longTrailingTakeProfitExecuted,Â i)Â :Â false
shortIthTrailingTakeProfitExecuted(i)Â =>
Â Â Â Â array.size(shortTrailingTakeProfitExecuted)Â >Â iÂ ?Â array.get(shortTrailingTakeProfitExecuted,Â i)Â :Â false
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ› ï¸Â STRATEGYÂ 2Â ====================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ closeÂ positionÂ logic.Â ThisÂ isÂ implementedÂ basedÂ onÂ dealÂ conditionsÂ definedÂ internallyÂ (inÂ thisÂ script)Â orÂ externalyÂ (basedÂ onÂ conditionsÂ thatÂ takeÂ asÂ inputÂ otherÂ indicator)
//Â Dependencies:Â FILTERS,Â STRATEGYÂ 1,Â ENTRY
//Â Results:Â closeLongPosition,Â closeShortPosition
//Â INPUTÂ ============================================================================================================
ignoreEndDealsÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'IgnoreÂ EndÂ Deals',Â tooltipÂ =Â 'AÂ closeÂ signalÂ willÂ notÂ beÂ emitedÂ whenÂ theÂ endÂ dealÂ conditionÂ isÂ met,Â thusÂ youÂ willÂ notÂ exitÂ yourÂ existingÂ positionÂ basedÂ onÂ theÂ strategyÂ logic.Â IfÂ thisÂ optionÂ isÂ checked,Â youÂ willÂ exitÂ onlyÂ whenÂ theÂ stopÂ lossÂ orÂ theÂ takeÂ profitÂ targetsÂ areÂ triggered.',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
closeEarlyEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'CloseÂ EarlyÂ #Â ofÂ bars',Â inlineÂ =Â 'CloseÂ Early',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
closeEarlyBarsÂ =Â input.int(defvalÂ =Â 7,Â titleÂ =Â '',Â minvalÂ =Â 1,Â tooltipÂ =Â 'EmitÂ closeÂ positionÂ signalÂ ifÂ theÂ givenÂ numberÂ ofÂ barsÂ haveÂ passedÂ sinceÂ theÂ entryÂ andÂ theÂ firstÂ takeÂ profitÂ targetÂ hasÂ notÂ beenÂ reachedÂ yet.',Â inlineÂ =Â 'CloseÂ Early',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
closeAtSessionEndÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'CloseÂ atÂ SessionÂ End',Â tooltipÂ =Â 'CloseÂ allÂ positionsÂ atÂ theÂ marketÂ priceÂ atÂ theÂ endÂ ofÂ eachÂ sessionÂ orÂ theÂ endÂ ofÂ timeÂ window.',Â groupÂ =Â 'ğŸ› ï¸Â Strategy')
//Â LOGICÂ ============================================================================================================
closeLongPositionÂ :=Â (ignoreEndDealsÂ ?Â falseÂ :Â longTradesEnabledÂ andÂ endLongDeal)Â orÂ (closeEarlyEnabledÂ ?Â bar_indexÂ -Â entryBarIdÂ ==Â closeEarlyBarsÂ andÂ notÂ longIthTrailingTakeProfitExecuted(0)Â :Â false)
closeShortPositionÂ :=Â (ignoreEndDealsÂ ?Â falseÂ :Â shortTradesEnabledÂ andÂ endShortDeal)Â orÂ (closeEarlyEnabledÂ ?Â bar_indexÂ -Â entryBarIdÂ ==Â closeEarlyBarsÂ andÂ notÂ shortIthTrailingTakeProfitExecuted(0)Â :Â false)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â â˜­Â SHAREDÂ VARIABLESÂ 3Â =============================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ generalÂ purposeÂ variableÂ thatÂ neededÂ forÂ severalÂ otherÂ modules
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 1,Â STRATEGYÂ 2
//Â Results:Â validCloseLongPosition,Â validCloseShortPosition,Â closeClose
//Â LOGICÂ ============================================================================================================
//Â theÂ closeÂ signalsÂ whenÂ alreadyÂ intoÂ aÂ positionÂ toÂ thatÂ direction
boolÂ validCloseLongPositionÂ =Â closeLongPositionÂ andÂ currentPositionSizeÂ >Â 0
boolÂ validCloseShortPositionÂ =Â closeShortPositionÂ andÂ currentPositionSizeÂ <Â 0
//Â TheÂ closeÂ priceÂ whenÂ lastÂ validÂ closeÂ wasÂ triggered
floatÂ closeCloseÂ =Â ta.valuewhen(validCloseLongPositionÂ orÂ validCloseShortPosition,Â close,Â 0)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â â‡§Â EXITÂ ===========================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ trailingÂ exitÂ logicÂ implementationÂ basedÂ onÂ theÂ deviation
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 1,Â SHAREDÂ VARIABLESÂ 2,Â STRATEGYÂ 2,Â SHAREDÂ VARIABLESÂ 3
//Â Results:Â longTrExitIsActive,Â shortTrExitIsActive
//Â INPUTÂ ============================================================================================================
exitTrailingEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ Trailing',Â tooltipÂ =Â 'EnableÂ orÂ disableÂ theÂ trailingÂ forÂ exitÂ position.',Â groupÂ =Â 'â‡§Â Exit')
devExitMethodÂ =Â input.string(defvalÂ =Â 'PERC',Â titleÂ =Â 'DeviationÂ Method',Â optionsÂ =Â ['PERC',Â 'ATR',Â 'LOC'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ deviationÂ forÂ theÂ trailingÂ exit.',Â groupÂ =Â 'â‡§Â Exit')
devExitPercÂ =Â input.float(defvalÂ =Â 3.0,Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ %',Â minvalÂ =Â 0.01,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ stepÂ toÂ followÂ theÂ priceÂ whenÂ theÂ closeÂ positionÂ conditionÂ isÂ met.',Â groupÂ =Â 'â‡§Â Exit')Â /Â 100.0Â 
devExitAtrMulÂ =Â input.float(defvalÂ =Â 0.5,Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ ATRÂ Mul',Â minvalÂ =Â 0.01,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'MultiplierÂ toÂ beÂ usedÂ onÂ theÂ ATRÂ toÂ calculateÂ theÂ stepÂ forÂ followingÂ theÂ price,Â untilÂ theÂ exitÂ targetÂ isÂ reached.',Â groupÂ =Â 'â‡§Â Exit')
devExitLenÂ =Â input.int(defvalÂ =Â 3,Â titleÂ =Â 'â€ƒâ€ƒDevÂ LocÂ ExtremaÂ Len/Ticks',Â minvalÂ =Â 1,Â inlineÂ =Â 'DeviationÂ ExitÂ LocalÂ Extrema',Â groupÂ =Â 'â‡§Â Exit')
devExitTicksÂ =Â input.int(defvalÂ =Â 2,Â titleÂ =Â '',Â minvalÂ =Â 0,Â tooltipÂ =Â 'LocalÂ extremaÂ (minimum/maximum)Â withinÂ aÂ windowÂ ofÂ lengthÂ minus/plusÂ someÂ ticksÂ toÂ beÂ usedÂ forÂ theÂ entryÂ target.',Â inlineÂ =Â 'DeviationÂ ExitÂ LocalÂ Extrema',Â groupÂ =Â 'â‡§Â Exit')
//Â LOGICÂ ============================================================================================================
boolÂ exitLongIsPendingÂ =Â barsSinceOpenLongÂ >Â barsSinceCloseLongÂ andÂ currentPositionSizeÂ >Â 0Â //Â openÂ ->Â close
boolÂ tryExitLongPositionÂ =Â exitTrailingEnabledÂ andÂ exitLongIsPending
floatÂ exitLowestLowÂ =Â ta.lowest(low,Â devExitLen)
floatÂ closeExitLowestLowÂ =Â ta.valuewhen(validCloseLongPosition,Â exitLowestLow,Â 0)
getLongExitCloseBaseScr()Â =>
Â Â Â Â switchÂ devExitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â closeClose
Â Â Â Â Â Â Â Â 'ATR'Â =>Â closeClose
Â Â Â Â Â Â Â Â 'LOC'Â =>Â closeExitLowestLow
Â Â Â Â Â Â Â Â =>Â na
getLongTrExitBaseScr()Â =>
Â Â Â Â switchÂ devExitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â high
Â Â Â Â Â Â Â Â 'ATR'Â =>Â high
Â Â Â Â Â Â Â Â 'LOC'Â =>Â exitLowestLow
Â Â Â Â Â Â Â Â =>Â na
getLongTrExitPrice(baseSrc)Â =>
Â Â Â Â switchÂ devExitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â -Â devExitPerc)
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ -Â devExitAtrMulÂ *Â longAtr
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ -Â devExitTicksÂ *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
varÂ floatÂ longTrExitPriceÂ =Â na
boolÂ isFirstValidCloseLongPositionÂ =Â exitTrailingEnabledÂ andÂ validCloseLongPositionÂ andÂ na(longTrExitPrice[1])
longTrExitPriceÂ :=Â ifÂ (isFirstValidCloseLongPosition)
Â Â Â Â getLongTrExitPrice(getLongExitCloseBaseScr())
elseÂ ifÂ (tryExitLongPosition)
Â Â Â Â math.max(getLongTrExitPrice(getLongTrExitBaseScr()),Â nz(longTrExitPrice[1],Â 999999.9))
else
Â Â Â Â na
boolÂ longTrExitIsActiveÂ =Â notÂ na(longTrExitPrice)
boolÂ exitShortIsPendingÂ =Â barsSinceOpenShortÂ >Â barsSinceCloseShortÂ andÂ currentPositionSizeÂ <Â 0Â //Â openÂ ->Â close
boolÂ tryExitShortPositionÂ =Â exitTrailingEnabledÂ andÂ exitShortIsPending
floatÂ exitHighestHighÂ =Â ta.highest(high,Â devExitLen)
floatÂ closeExitHighestHighÂ =Â ta.valuewhen(validCloseShortPosition,Â exitHighestHigh,Â 0)
getShortExitCloseBaseScr()Â =>
Â Â Â Â switchÂ devExitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â closeClose
Â Â Â Â Â Â Â Â 'ATR'Â =>Â closeClose
Â Â Â Â Â Â Â Â 'LOC'Â =>Â closeExitHighestHigh
Â Â Â Â Â Â Â Â =>Â na
getShortTrExitBaseScr()Â =>
Â Â Â Â switchÂ devExitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â low
Â Â Â Â Â Â Â Â 'ATR'Â =>Â low
Â Â Â Â Â Â Â Â 'LOC'Â =>Â exitHighestHigh
Â Â Â Â Â Â Â Â =>Â na
getShortTrExitPrice(baseSrc)Â =>
Â Â Â Â switchÂ devExitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â +Â devExitPerc)
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ +Â devExitAtrMulÂ *Â shortAtr
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ +Â devExitTicksÂ *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
varÂ floatÂ shortTrExitPriceÂ =Â na
boolÂ isFirstValidCloseShortPositionÂ =Â exitTrailingEnabledÂ andÂ validCloseShortPositionÂ andÂ na(shortTrExitPrice[1])
shortTrExitPriceÂ :=Â ifÂ (isFirstValidCloseShortPosition)
Â Â Â Â getShortTrExitPrice(getShortExitCloseBaseScr())
elseÂ ifÂ (tryExitShortPosition)
Â Â Â Â math.min(getShortTrExitPrice(getShortTrExitBaseScr()),Â nz(shortTrExitPrice[1],Â 999999.9))
else
Â Â Â Â na
boolÂ shortTrExitIsActiveÂ =Â notÂ na(shortTrExitPrice)
//Â priceÂ whenÂ exitedÂ aÂ positionÂ orÂ potentialÂ exitÂ priceÂ inÂ caseÂ ofÂ trailingÂ Â 
floatÂ exitPriceÂ =Â longTrExitIsActiveÂ ?Â longTrExitPrice
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â shortTrExitIsActiveÂ ?Â shortTrExitPrice
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â close
//Â PLOTÂ =============================================================================================================
varÂ trailingExitColorÂ =Â color.new(color.purple,Â 0)
plot(seriesÂ =Â longTrExitPrice,Â titleÂ =Â 'LongÂ SellÂ Price',Â colorÂ =Â trailingExitColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â shortTrExitPrice,Â titleÂ =Â 'ShortÂ SellÂ Price',Â colorÂ =Â trailingExitColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ”´Â STOPÂ LOSSÂ =====================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ stopÂ lossÂ logicÂ implementationÂ basedÂ onÂ theÂ methodÂ andÂ theÂ trailingÂ mode
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 2,Â ENTRY,Â TAKEÂ PROFITÂ 1
//Â Results:Â longStopLossPrice,Â shortStopLossPrice
//Â INPUTÂ ============================================================================================================
stopLossMethodÂ =Â input.string(defvalÂ =Â 'PERC',Â titleÂ =Â 'StopÂ LossÂ Method',Â optionsÂ =Â ['PERC',Â 'ATR',Â 'LOC'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ stopÂ lossÂ (percentagewise,Â ATRÂ basedÂ orÂ basedÂ onÂ localÂ extrema).',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
longTrailingStopLossPercÂ =Â input.float(defvalÂ =Â 7.5,Â titleÂ =Â 'â€ƒâ€ƒLong/ShortÂ StopÂ LossÂ %',Â minvalÂ =Â 0.05,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â inlineÂ =Â 'StopÂ LossÂ Perc',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')Â /Â 100.0Â 
shortTrailingStopLossPercÂ =Â input.float(defvalÂ =Â 7.5,Â titleÂ =Â '',Â minvalÂ =Â 0.05,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ percentageÂ ofÂ theÂ priceÂ decrease/increaseÂ toÂ setÂ theÂ stopÂ lossÂ priceÂ targetÂ forÂ long/shortÂ positions.',Â inlineÂ =Â 'StopÂ LossÂ Perc',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')Â /Â 100.0Â 
longStopLossAtrMulÂ =Â input.float(defvalÂ =Â 3.0,Â titleÂ =Â 'â€ƒâ€ƒATRÂ Long/ShortÂ Mulâ€ƒâ€ƒ',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â inlineÂ =Â 'StopÂ LossÂ ATRÂ Multiplier',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
shortStopLossAtrMulÂ =Â input.float(defvalÂ =Â 3.0,Â titleÂ =Â '',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â tooltipÂ =Â 'ATRÂ multiplierÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ stopÂ loss.',Â inlineÂ =Â 'StopÂ LossÂ ATRÂ Multiplier',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stopLossLocLenÂ =Â input.int(defvalÂ =Â 5,Â titleÂ =Â 'â€ƒâ€ƒLocÂ ExtremaÂ Len/Ticksâ€ƒâ€ƒ',Â minvalÂ =Â 1,Â inlineÂ =Â 'StopÂ LossÂ LocalÂ Extrema',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stopLossLocTicksÂ =Â input.int(defvalÂ =Â 5,Â titleÂ =Â '',Â minvalÂ =Â 0,Â tooltipÂ =Â 'LocalÂ extremaÂ (minimum/maximum)Â withinÂ aÂ windowÂ ofÂ lengthÂ minus/plusÂ someÂ ticksÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ stopÂ loss.',Â inlineÂ =Â 'StopÂ LossÂ LocalÂ Extrema',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stopLossMoveActModeÂ =Â input.string(defvalÂ =Â 'MULTI',Â titleÂ =Â 'MoveÂ ActivationÂ Mode',Â optionsÂ =Â ['OFF',Â 'ONCE',Â 'MULTI'],Â tooltipÂ =Â 'MoveÂ theÂ stopÂ lossÂ toÂ theÂ entryÂ priceÂ (a.k.aÂ breakeven)Â whenÂ firstÂ takeÂ profitÂ priceÂ targetÂ isÂ reachedÂ (ONCE),Â orÂ moveÂ theÂ stopÂ lossÂ toÂ theÂ previousÂ takeÂ profitÂ targetÂ priceÂ everyÂ timeÂ aÂ newÂ takeÂ profitÂ isÂ reachedÂ (MULTI).Â Thus,Â moreÂ thanÂ oneÂ takeÂ profitÂ targetsÂ areÂ neededÂ toÂ seeÂ aÂ differenceÂ betweenÂ theÂ twoÂ modes!Â IfÂ bothÂ moveÂ andÂ trailingÂ areÂ activatedÂ theÂ stopÂ lossÂ isÂ definedÂ byÂ theÂ moreÂ strictÂ priceÂ atÂ anyÂ givenÂ time.',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stopLossTrailingActModeÂ =Â input.string(defvalÂ =Â 'TP',Â titleÂ =Â 'TrailingÂ ActivationÂ Mode',Â optionsÂ =Â ['OFF',Â 'START',Â 'TP'],Â tooltipÂ =Â 'EnablesÂ theÂ trailingÂ forÂ theÂ stopÂ lossÂ fromÂ theÂ veryÂ beginningÂ ofÂ theÂ entryÂ orderÂ (START),Â orÂ whenÂ theÂ i-thÂ takeÂ profitÂ orderÂ isÂ executedÂ (TP)Â orÂ notÂ atÂ allÂ (OFF).',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stopLossTrailingTPActNumÂ =Â input.int(defvalÂ =Â 3,Â titleÂ =Â 'â€ƒâ€ƒActÂ TakeÂ ProfitÂ #',Â minvalÂ =Â 1,Â tooltipÂ =Â 'TheÂ TakeÂ ProfitÂ numberÂ (fromÂ 1Â upÂ toÂ theÂ "TakeÂ ProfitÂ Targets"Â numberÂ setÂ inÂ TAKEÂ PROFITÂ section)Â thatÂ willÂ activateÂ theÂ trailingÂ ofÂ theÂ stopÂ lossÂ afterÂ itÂ isÂ reached.Â TheÂ TrailingÂ ActivationÂ shouldÂ beÂ setÂ toÂ "TP".',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stopLossTrailingDistModeÂ =Â input.string(defvalÂ =Â 'FIXED',Â titleÂ =Â 'TrailingÂ DistanceÂ Mode',Â optionsÂ =Â ['FIXED',Â 'STEP'],Â tooltipÂ =Â 'WhenÂ stopÂ lossÂ trailiningÂ isÂ activatedÂ theÂ distanceÂ willÂ trailÂ theÂ priceÂ accordingÂ toÂ theÂ stopÂ lossÂ methodÂ soÂ itÂ maintainsÂ itsÂ maximumÂ valueÂ fromÂ theÂ currentÂ high/lowÂ (FIXED),Â orÂ theÂ distanceÂ willÂ changeÂ everyÂ timeÂ aÂ newÂ takeÂ profitÂ isÂ reachedÂ andÂ willÂ addÂ theÂ correspondigÂ stepÂ valueÂ toÂ theÂ previous.Â Thus,Â moreÂ thanÂ oneÂ takeÂ profitÂ targetsÂ areÂ neededÂ toÂ seeÂ aÂ differenceÂ betweenÂ twoÂ modes!Â IfÂ bothÂ moveÂ andÂ trailingÂ areÂ activatedÂ theÂ stopÂ lossÂ isÂ definedÂ byÂ theÂ moreÂ strictÂ priceÂ atÂ anyÂ givenÂ time.',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
longStepTrailingStopLossPercÂ =Â input.float(defvalÂ =Â 2.5,Â titleÂ =Â 'â€ƒâ€ƒStepÂ Long/ShortÂ StopÂ LossÂ %',Â minvalÂ =Â -100.0,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â inlineÂ =Â 'StopÂ LossÂ PercÂ Step',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')Â /Â 100.0Â 
shortStepTrailingStopLossPercÂ =Â input.float(defvalÂ =Â 2.5,Â titleÂ =Â '',Â minvalÂ =Â -100.0,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ StepÂ percentageÂ ofÂ theÂ priceÂ decrease/increaseÂ toÂ setÂ theÂ stopÂ lossÂ priceÂ targetÂ forÂ long/shortÂ positionsÂ afterÂ theÂ firstÂ takeÂ profitÂ targetÂ isÂ reached.',Â inlineÂ =Â 'StopÂ LossÂ PercÂ Step',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')Â /Â 100.0Â 
longStepStopLossAtrMulÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â 'â€ƒâ€ƒStepÂ ATRÂ Long/ShortÂ Mulâ€ƒâ€ƒ',Â stepÂ =Â 0.1,Â inlineÂ =Â 'StopÂ LossÂ ATRÂ MultiplierÂ Step',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
shortStepStopLossAtrMulÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â '',Â stepÂ =Â 0.1,Â tooltipÂ =Â 'StepÂ ATRÂ multiplierÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ StopÂ LossÂ afterÂ theÂ firstÂ takeÂ profitÂ targetÂ isÂ reached.',Â inlineÂ =Â 'StopÂ LossÂ ATRÂ MultiplierÂ Step',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stepStopLossLocLenÂ =Â input.int(defvalÂ =Â 4,Â titleÂ =Â 'â€ƒâ€ƒStepÂ LocÂ ExtremaÂ Len/Ticks',Â inlineÂ =Â 'StopÂ LossÂ LocalÂ ExtremaÂ Step',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
stepStopLossLocTicksÂ =Â input.int(defvalÂ =Â 0,Â titleÂ =Â '',Â tooltipÂ =Â 'StepÂ LocalÂ extremaÂ (minimum/maximum)Â withinÂ aÂ windowÂ ofÂ lengthÂ minus/plusÂ someÂ ticksÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ stopÂ lossÂ afterÂ theÂ firstÂ takeÂ profitÂ targetÂ isÂ reached.',Â inlineÂ =Â 'StopÂ LossÂ LocalÂ ExtremaÂ Step',Â groupÂ =Â 'ğŸ”´Â StopÂ Loss')
//Â LOGICÂ ============================================================================================================
floatÂ stopLossLowestLowÂ =Â ta.lowest(low,Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â stopLossLocLenÂ +Â longTrailingTakeProfitExecutedCountÂ *Â stepStopLossLocLenÂ :Â stopLossLocLen))
getLongStopLossEntryBaseScr()Â =>
Â Â Â Â switchÂ stopLossMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'ATR'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'LOC'Â =>Â stopLossLowestLow
Â Â Â Â Â Â Â Â =>Â na
getLongStopLossTrailingBaseScr()Â =>
Â Â Â Â switchÂ stopLossMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â high
Â Â Â Â Â Â Â Â 'ATR'Â =>Â high
Â Â Â Â Â Â Â Â 'LOC'Â =>Â stopLossLowestLow
Â Â Â Â Â Â Â Â =>Â na
getLongStopLossPrice(baseSrc)Â =>
Â Â Â Â switchÂ stopLossMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â -Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â longTrailingStopLossPercÂ +Â longTrailingTakeProfitExecutedCountÂ *Â longStepTrailingStopLossPercÂ :Â longTrailingStopLossPerc))
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ -Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â longStopLossAtrMulÂ +Â longTrailingTakeProfitExecutedCountÂ *Â longStepStopLossAtrMulÂ :Â longStopLossAtrMul)Â *Â longAtr
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ -Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â stopLossLocTicksÂ +Â longTrailingTakeProfitExecutedCountÂ *Â stepStopLossLocTicksÂ :Â stopLossLocTicks)Â *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
//Â trailingÂ startsÂ whenÂ theÂ selectedÂ takeÂ profitÂ priceÂ isÂ reachedÂ ifÂ 'TP'Â modeÂ isÂ setÂ orÂ fromÂ theÂ veryÂ beginingÂ ifÂ 'START'Â modeÂ isÂ selected
boolÂ longStopLossTrailingEnabledÂ =Â stopLossTrailingActModeÂ ==Â 'START'Â orÂ (stopLossTrailingActModeÂ ==Â 'TP'Â andÂ longIthTrailingTakeProfitExecuted(stopLossTrailingTPActNumÂ -Â 1))
//Â calculateÂ theÂ stopÂ lossÂ priceÂ whenÂ enterÂ longÂ positionÂ andÂ peserveÂ itsÂ valueÂ untilÂ theÂ positionÂ closes
varÂ floatÂ longStopLossPriceÂ =Â na
longStopLossPriceÂ :=Â ifÂ (longTrEntryIsActiveÂ orÂ validOpenLongPositionÂ orÂ enteredLongPosition)
Â Â Â Â getLongStopLossPrice(getLongStopLossEntryBaseScr())
elseÂ ifÂ (longIsActive)
Â Â Â Â stopPriceÂ =Â longStopLossTrailingEnabledÂ ?Â getLongStopLossPrice(getLongStopLossTrailingBaseScr())Â :Â longStopLossPrice[1]
Â Â Â Â stopPriceÂ :=Â (stopLossMoveActModeÂ ==Â 'ONCE'Â andÂ longTrailingTakeProfitExecutedCountÂ >=Â 1)Â orÂ (stopLossMoveActModeÂ ==Â 'MULTI'Â andÂ longTrailingTakeProfitExecutedCountÂ ==Â 1)Â ?Â math.max(stopPrice,Â entryPrice)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â stopLossMoveActModeÂ ==Â 'MULTI'Â andÂ longTrailingTakeProfitExecutedCountÂ >Â 1Â ?Â math.max(stopPrice,Â array.get(longTakeProfitPrices,Â longTrailingTakeProfitExecutedCountÂ -Â 2))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â stopPrice
Â Â Â Â math.max(stopPrice,Â nz(longStopLossPrice[1]))
else
Â Â Â Â na
floatÂ longStopLossPercÂ =Â (entryPriceÂ -Â longStopLossPrice)Â /Â entryPrice
floatÂ stopLossHighestHighÂ =Â ta.highest(high,Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â stopLossLocLenÂ +Â shortTrailingTakeProfitExecutedCountÂ *Â stepStopLossLocLenÂ :Â stopLossLocLen))
getShortStopLossEntryBaseScr()Â =>
Â Â Â Â switchÂ stopLossMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'ATR'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'LOC'Â =>Â stopLossHighestHigh
getShortStopLossTrailingBaseScr()Â =>
Â Â Â Â switchÂ stopLossMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â low
Â Â Â Â Â Â Â Â 'ATR'Â =>Â low
Â Â Â Â Â Â Â Â 'LOC'Â =>Â stopLossHighestHigh
getShortStopLossPrice(baseSrc)Â =>
Â Â Â Â switchÂ stopLossMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â +Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â shortTrailingStopLossPercÂ +Â shortTrailingTakeProfitExecutedCountÂ *Â shortStepTrailingStopLossPercÂ :Â shortTrailingStopLossPerc))
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ +Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â shortStopLossAtrMulÂ +Â shortTrailingTakeProfitExecutedCountÂ *Â shortStepStopLossAtrMulÂ :Â shortStopLossAtrMul)Â *Â shortAtr
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ +Â (stopLossTrailingDistModeÂ ==Â 'STEP'Â ?Â stopLossLocTicksÂ +Â shortTrailingTakeProfitExecutedCountÂ *Â stepStopLossLocTicksÂ :Â stopLossLocTicks)Â *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
//Â trailingÂ startsÂ whenÂ theÂ selectedÂ takeÂ profitÂ priceÂ isÂ reachedÂ ifÂ 'TP'Â modeÂ isÂ setÂ orÂ fromÂ theÂ veryÂ beginingÂ ifÂ 'START'Â modeÂ isÂ selected
boolÂ shortStopLossTrailingEnabledÂ =Â stopLossTrailingActModeÂ ==Â 'START'Â orÂ (stopLossTrailingActModeÂ ==Â 'TP'Â andÂ shortIthTrailingTakeProfitExecuted(stopLossTrailingTPActNumÂ -Â 1))
//Â calculateÂ theÂ stopÂ lossÂ priceÂ whenÂ enterÂ shortÂ positionÂ andÂ peserveÂ itsÂ valueÂ untilÂ theÂ positionÂ closes
varÂ floatÂ shortStopLossPriceÂ =Â na
shortStopLossPriceÂ :=Â ifÂ (shortTrEntryIsActiveÂ orÂ validOpenShortPositionÂ orÂ enteredShortPosition)
Â Â Â Â getShortStopLossPrice(getShortStopLossEntryBaseScr())
elseÂ ifÂ (shortIsActive)
Â Â Â Â stopPriceÂ =Â shortStopLossTrailingEnabledÂ ?Â getShortStopLossPrice(getShortStopLossTrailingBaseScr())Â :Â shortStopLossPrice[1]
Â Â Â Â stopPriceÂ :=Â (stopLossMoveActModeÂ ==Â 'ONCE'Â andÂ shortTrailingTakeProfitExecutedCountÂ >=Â 1)Â orÂ (stopLossMoveActModeÂ ==Â 'MULTI'Â andÂ shortTrailingTakeProfitExecutedCountÂ ==Â 1)Â ?Â math.min(stopPrice,Â entryPrice)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â stopLossMoveActModeÂ ==Â 'MULTI'Â andÂ shortTrailingTakeProfitExecutedCountÂ >Â 1Â ?Â math.min(stopPrice,Â array.get(shortTakeProfitPrices,Â shortTrailingTakeProfitExecutedCountÂ -Â 2))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â stopPrice
Â Â Â Â math.min(stopPrice,Â nz(shortStopLossPrice[1],Â 999999.9))
else
Â Â Â Â na
floatÂ shortStopLossPercÂ =Â (shortStopLossPriceÂ -Â entryPrice)Â /Â entryPrice
//Â PLOTÂ =============================================================================================================
varÂ stopLossColorÂ =Â color.new(#e25141,Â 0)
plot(seriesÂ =Â debugModeEnabledÂ orÂ na(longTrEntryPrice)Â ?Â longStopLossPriceÂ :Â na,Â titleÂ =Â 'LongÂ StopÂ Loss',Â colorÂ =Â stopLossColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ orÂ na(shortTrEntryPrice)Â ?Â shortStopLossPriceÂ :Â na,Â titleÂ =Â 'ShortÂ StopÂ Loss',Â colorÂ =Â stopLossColor,Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸŸ¢Â TAKEÂ PROFITÂ 2Â =================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ takeÂ profitÂ logicÂ implementationÂ basedÂ onÂ theÂ methodÂ andÂ theÂ numberÂ ofÂ stepÂ takeÂ profitÂ targetsÂ andÂ theÂ trailingÂ deviation
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 2,Â ENTRY,Â TAKEÂ PROFITÂ 1
//Â Results:Â longTakeProfitPrices,Â shortTakeProfitPrices
//Â INPUTÂ ============================================================================================================
initTakeProfitMethodÂ =Â input.string(defvalÂ =Â 'PERC',Â titleÂ =Â 'InitÂ TakeÂ ProfitÂ Method',Â optionsÂ =Â ['PERC',Â 'ATR',Â 'RR',Â 'LOC'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ firstÂ takeÂ profitÂ priceÂ target.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
longInitTakeProfitPercÂ =Â input.float(defvalÂ =Â 10.0,Â titleÂ =Â 'â€ƒâ€ƒLong/ShortÂ InitÂ TakeÂ ProfitÂ %',Â minvalÂ =Â 0.05,Â stepÂ =Â 0.05,Â inlineÂ =Â 'InitÂ TakeÂ ProfitÂ Perc',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')Â /Â 100.0Â 
shortInitTakeProfitPercÂ =Â input.float(defvalÂ =Â 10.0,Â titleÂ =Â '',Â minvalÂ =Â 0.05,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ percentageÂ ofÂ theÂ priceÂ increase/decreaseÂ fromÂ theÂ openÂ priceÂ toÂ setÂ theÂ firstÂ takeÂ profitÂ priceÂ targetÂ forÂ long/shortÂ positions.',Â inlineÂ =Â 'InitÂ TakeÂ ProfitÂ Perc',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')Â /Â 100.0Â 
longInitTakeProfitAtrMulÂ =Â input.float(defvalÂ =Â 6.0,Â titleÂ =Â 'â€ƒâ€ƒInitÂ ATRÂ Long/ShortÂ Mulâ€ƒâ€ƒ',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â inlineÂ =Â 'InitÂ TakeÂ ProfitÂ ATRÂ Multiplier',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
shortInitTakeProfitAtrMulÂ =Â input.float(defvalÂ =Â 6.0,Â titleÂ =Â '',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â tooltipÂ =Â 'ATRÂ multiplierÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ firstÂ takeÂ profitÂ target.',Â inlineÂ =Â 'InitÂ TakeÂ ProfitÂ ATRÂ Multiplier',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
longInitRiskRewardRatioÂ =Â input.float(defvalÂ =Â 1.5,Â titleÂ =Â 'â€ƒâ€ƒInitÂ Long/ShortÂ RRÂ Ratioâ€ƒâ€ƒ',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â inlineÂ =Â 'InitÂ RiskÂ RewardÂ Ratio',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
shortInitRiskRewardRatioÂ =Â input.float(defvalÂ =Â 1.5,Â titleÂ =Â '',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â tooltipÂ =Â 'TheÂ Risk/RewardÂ RatioÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ firstÂ takeÂ profitÂ basedÂ onÂ theÂ stopÂ lossÂ priceÂ target.',Â inlineÂ =Â 'InitÂ RiskÂ RewardÂ Ratio',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
takeProfitLocLenÂ =Â input.int(defvalÂ =Â 14,Â titleÂ =Â 'â€ƒâ€ƒLocÂ ExtremaÂ Len/Ticksâ€ƒâ€ƒ',Â minvalÂ =Â 1,Â inlineÂ =Â 'TakeÂ ProfitÂ LocalÂ Extrema',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
takeProfitLocTicksÂ =Â input.int(defvalÂ =Â 5,Â titleÂ =Â '',Â minvalÂ =Â 0,Â tooltipÂ =Â 'LocalÂ extremaÂ (minimum/maximum)Â withinÂ aÂ windowÂ ofÂ lengthÂ minus/plusÂ someÂ ticksÂ toÂ beÂ usedÂ forÂ theÂ long/shortÂ takeÂ profit.',Â inlineÂ =Â 'TakeÂ ProfitÂ LocalÂ Extrema',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
stepTakeProfitMethodÂ =Â input.string(defvalÂ =Â 'PERC',Â titleÂ =Â 'StepÂ TakeÂ ProfitÂ Method',Â optionsÂ =Â ['PERC',Â 'ATR',Â 'RR'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ additionalÂ stepÂ takeÂ profitÂ priceÂ targets.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
longStepTakeProfitPercÂ =Â input.float(defvalÂ =Â 5.0,Â titleÂ =Â 'â€ƒâ€ƒLong/ShortÂ StepÂ TakeÂ ProfitÂ %',Â minvalÂ =Â 0.05,Â stepÂ =Â 0.05,Â inlineÂ =Â 'StepÂ TakeÂ ProfitÂ Perc',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')Â /Â 100.0Â 
shortStepTakeProfitPercÂ =Â input.float(defvalÂ =Â 5.0,Â titleÂ =Â '',Â minvalÂ =Â 0.05,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ percentageÂ ofÂ theÂ priceÂ toÂ beÂ added/subtractedÂ onÂ topÂ ofÂ theÂ firstÂ takeÂ profitÂ targetÂ forÂ eachÂ additionalÂ stepÂ takeÂ profitÂ priceÂ targetÂ forÂ long/shortÂ positions.',Â inlineÂ =Â 'StepÂ TakeÂ ProfitÂ Perc',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')Â /Â 100.0Â 
longStepTakeProfitAtrMulÂ =Â input.float(defvalÂ =Â 3.0,Â titleÂ =Â 'â€ƒâ€ƒStepÂ ATRÂ Long/ShortÂ Mulâ€ƒâ€ƒ',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â inlineÂ =Â 'StepÂ TakeÂ ProfitÂ ATRÂ Multiplier',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
shortStepTakeProfitAtrMulÂ =Â input.float(defvalÂ =Â 3.0,Â titleÂ =Â '',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â tooltipÂ =Â 'ATRÂ multiplierÂ toÂ beÂ added/subtractedÂ onÂ topÂ ofÂ theÂ firstÂ takeÂ profitÂ targetÂ forÂ eachÂ additionalÂ stepÂ takeÂ profitÂ priceÂ targetÂ forÂ theÂ long/shortÂ positions.',Â inlineÂ =Â 'StepÂ TakeÂ ProfitÂ ATRÂ Multiplier',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
longStepRiskRewardRatioÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â 'â€ƒâ€ƒStepÂ Long/ShortÂ RRÂ Ratioâ€ƒâ€ƒ',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â inlineÂ =Â 'StepÂ RiskÂ RewardÂ Ratio',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
shortStepRiskRewardRatioÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â '',Â minvalÂ =Â 0.1,Â stepÂ =Â 0.1,Â tooltipÂ =Â 'TheÂ Risk/RewardÂ RatioÂ toÂ beÂ added/subtractedÂ toÂ theÂ firstÂ takeÂ profitÂ targetÂ forÂ eachÂ additionalÂ stepÂ takeÂ profitÂ priceÂ targetÂ forÂ theÂ long/shortÂ positions.',Â inlineÂ =Â 'StepÂ RiskÂ RewardÂ Ratio',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
takeProfitTrailingEnabledÂ =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'EnableÂ Trailingâš ï¸ğŸ¨ï¸',Â tooltipÂ =Â 'EnableÂ orÂ disableÂ theÂ trailingÂ forÂ takeÂ profit.Â WARNING!Â ThisÂ featureÂ willÂ repaint.Â MakeÂ sureÂ youÂ useÂ itÂ alongÂ withÂ "BarÂ Magnifier"Â andÂ "DeepÂ Backtesting"Â forÂ realisticÂ backtestÂ results.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
devTakeProfitMethodÂ =Â input.string(defvalÂ =Â 'PERC',Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ Method',Â optionsÂ =Â ['PERC',Â 'ATR'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ deviationÂ forÂ theÂ trailingÂ takeÂ profit.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
devTakeProfitPercÂ =Â input.float(defvalÂ =Â 1.0,Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ %',Â minvalÂ =Â 0.01,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'TheÂ percentageÂ wiseÂ stepÂ toÂ beÂ usedÂ forÂ followingÂ theÂ price,Â whenÂ theÂ takeÂ profitÂ targetÂ isÂ reached.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')Â /Â 100.0Â 
devTakeProfitAtrMulÂ =Â input.float(defvalÂ =Â 0.01,Â titleÂ =Â 'â€ƒâ€ƒDeviationÂ ATRÂ Mul',Â minvalÂ =Â 0.01,Â stepÂ =Â 0.05,Â tooltipÂ =Â 'MultiplierÂ toÂ beÂ usedÂ onÂ theÂ ATRÂ toÂ calculateÂ theÂ stepÂ forÂ followingÂ theÂ price,Â whenÂ theÂ takeÂ profitÂ targetÂ isÂ reached.',Â groupÂ =Â 'ğŸŸ¢Â TakeÂ Profit')
//Â LOGICÂ ============================================================================================================
getTrailingOffsetTicks(takeProfitPrice,Â atr)Â =>
Â Â Â Â switchÂ devTakeProfitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â takeProfitPriceÂ *Â devTakeProfitPercÂ /Â syminfo.mintick
Â Â Â Â Â Â Â Â 'ATR'Â =>Â devTakeProfitAtrMulÂ *Â atrÂ /Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
floatÂ takeProfitHighestHighÂ =Â ta.highest(high,Â takeProfitLocLen)
getLongInitTakeProfitBaseScr()Â =>
Â Â Â Â switchÂ initTakeProfitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'ATR'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'RR'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'LOC'Â =>Â takeProfitHighestHigh
Â Â Â Â Â Â Â Â =>Â na
getLongTakeProfitPrice(baseSrc,Â takeProfitMethod,Â takeProfitPerc,Â takeProfitAtrMul,Â riskRewardRatio)Â =>
Â Â Â Â switchÂ takeProfitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â +Â takeProfitPerc)
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ +Â takeProfitAtrMulÂ *Â longAtr
Â Â Â Â Â Â Â Â 'RR'Â =>Â baseSrcÂ +Â riskRewardRatioÂ *Â (entryPriceÂ -Â longStopLossPrice)
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ -Â takeProfitLocTicksÂ *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
//Â calculateÂ takeÂ profitÂ pricesÂ whenÂ enterÂ longÂ positionÂ andÂ peserveÂ theirÂ valuesÂ untilÂ theÂ entireÂ positionÂ closes
forÂ [i,Â takeProfitPrice]Â inÂ longTakeProfitPrices
Â Â Â Â longTakeProfitPercÂ =Â iÂ *Â longStepTakeProfitPerc
Â Â Â Â longTakeProfitAtrMulÂ =Â iÂ *Â longStepTakeProfitAtrMul
Â Â Â Â longRiskRewardRatioÂ =Â iÂ *Â longStepRiskRewardRatio
Â Â Â Â ifÂ (longTrEntryIsActiveÂ orÂ validOpenLongPositionÂ orÂ enteredLongPosition)
Â Â Â Â Â Â Â Â array.set(longTakeProfitPrices,Â i,Â getLongTakeProfitPrice(getLongTakeProfitPrice(getLongInitTakeProfitBaseScr(),Â initTakeProfitMethod,Â longInitTakeProfitPerc,Â longInitTakeProfitAtrMul,Â longInitRiskRewardRatio),Â stepTakeProfitMethod,Â longTakeProfitPerc,Â longTakeProfitAtrMul,Â longRiskRewardRatio))
Â Â Â Â elseÂ ifÂ (longIsActive)
Â Â Â Â Â Â Â Â array.set(longTakeProfitPrices,Â i,Â nz(takeProfitPrice,Â getLongTakeProfitPrice(getLongTakeProfitPrice(getLongInitTakeProfitBaseScr(),Â initTakeProfitMethod,Â longInitTakeProfitPerc,Â longInitTakeProfitAtrMul,Â longInitRiskRewardRatio),Â stepTakeProfitMethod,Â longTakeProfitPerc,Â longTakeProfitAtrMul,Â longRiskRewardRatio)))
Â Â Â Â else
Â Â Â Â Â Â Â Â array.set(longTakeProfitPrices,Â i,Â na)
varÂ longTrailingTakeProfitOffsetTicksÂ =Â array.new<float>(numOfTakeProfitTargets,Â na)
ifÂ (longPositionEntry)
Â Â Â Â forÂ [i,Â takeProfitPrice]Â inÂ longTakeProfitPrices
Â Â Â Â Â Â Â Â array.set(longTrailingTakeProfitOffsetTicks,Â i,Â getTrailingOffsetTicks(takeProfitPrice,Â longAtr))
floatÂ takeProfitLowestLowÂ =Â ta.lowest(low,Â takeProfitLocLen)
getShortInitTakeProfitBaseScr()Â =>
Â Â Â Â switchÂ initTakeProfitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'ATR'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'RR'Â =>Â entryPrice
Â Â Â Â Â Â Â Â 'LOC'Â =>Â takeProfitLowestLow
Â Â Â Â Â Â Â Â =>Â na
getShortTakeProfitPrice(baseSrc,Â takeProfitMethod,Â takeProfitPerc,Â takeProfitAtrMul,Â riskRewardRatio)Â =>
Â Â Â Â switchÂ takeProfitMethod
Â Â Â Â Â Â Â Â 'PERC'Â =>Â baseSrcÂ *Â (1Â -Â takeProfitPerc)
Â Â Â Â Â Â Â Â 'ATR'Â =>Â baseSrcÂ -Â takeProfitAtrMulÂ *Â shortAtr
Â Â Â Â Â Â Â Â 'RR'Â =>Â baseSrcÂ -Â riskRewardRatioÂ *Â (shortStopLossPriceÂ -Â entryPrice)
Â Â Â Â Â Â Â Â 'LOC'Â =>Â baseSrcÂ +Â takeProfitLocTicksÂ *Â syminfo.mintick
Â Â Â Â Â Â Â Â =>Â na
//Â calculateÂ takeÂ profitÂ pricesÂ whenÂ enterÂ shortÂ positionÂ andÂ peserveÂ theirÂ valuesÂ untilÂ theÂ entireÂ positionÂ closes
forÂ [i,Â takeProfitPrice]Â inÂ shortTakeProfitPrices
Â Â Â Â shortTakeProfitPercÂ =Â iÂ *Â shortStepTakeProfitPerc
Â Â Â Â shortTakeProfitAtrMulÂ =Â iÂ *Â shortStepTakeProfitAtrMul
Â Â Â Â shortRiskRewardRatioÂ =Â iÂ *Â shortStepRiskRewardRatio
Â Â Â Â ifÂ (shortTrEntryIsActiveÂ orÂ validOpenShortPositionÂ orÂ enteredShortPosition)
Â Â Â Â Â Â Â Â array.set(shortTakeProfitPrices,Â i,Â getShortTakeProfitPrice(getShortTakeProfitPrice(getShortInitTakeProfitBaseScr(),Â initTakeProfitMethod,Â shortInitTakeProfitPerc,Â shortInitTakeProfitAtrMul,Â shortInitRiskRewardRatio),Â stepTakeProfitMethod,Â shortTakeProfitPerc,Â shortTakeProfitAtrMul,Â shortRiskRewardRatio))
Â Â Â Â elseÂ ifÂ (shortIsActive)
Â Â Â Â Â Â Â Â array.set(shortTakeProfitPrices,Â i,Â nz(takeProfitPrice,Â getShortTakeProfitPrice(getShortTakeProfitPrice(getShortInitTakeProfitBaseScr(),Â initTakeProfitMethod,Â shortInitTakeProfitPerc,Â shortInitTakeProfitAtrMul,Â shortInitRiskRewardRatio),Â stepTakeProfitMethod,Â shortTakeProfitPerc,Â shortTakeProfitAtrMul,Â shortRiskRewardRatio)))
Â Â Â Â else
Â Â Â Â Â Â Â Â array.set(shortTakeProfitPrices,Â i,Â na)
varÂ shortTrailingTakeProfitOffsetTicksÂ =Â array.new<float>(numOfTakeProfitTargets,Â na)
ifÂ (shortPositionEntry)
Â Â Â Â forÂ [i,Â takeProfitPrice]Â inÂ shortTakeProfitPrices
Â Â Â Â Â Â Â Â array.set(shortTrailingTakeProfitOffsetTicks,Â i,Â getTrailingOffsetTicks(takeProfitPrice,Â shortAtr))
//Â PLOTÂ =============================================================================================================
varÂ takeProfitColorÂ =Â color.new(#419388,Â 0)
varÂ winColorÂ =Â color.new(color.lime,Â 0)
updateLines(lines,Â prices,Â trasp)Â =>
Â Â Â Â forÂ [i,Â ln]Â inÂ lines
Â Â Â Â Â Â Â Â priceÂ =Â array.get(prices,Â i)
Â Â Â Â Â Â Â Â ifÂ (notÂ na(price)Â andÂ notÂ array.get(trasp,Â i))
Â Â Â Â Â Â Â Â Â Â Â Â line.set_y1(ln,Â price)
Â Â Â Â Â Â Â Â Â Â Â Â line.set_y2(ln,Â price)
Â Â Â Â Â Â Â Â Â Â Â Â line.set_x2(ln,Â bar_indexÂ +Â 1)
moveAllElements(fromArr,Â toArr)Â =>
Â Â Â Â lenÂ =Â array.size(fromArr)Â -Â 1
Â Â Â Â forÂ iÂ =Â 0Â toÂ lenÂ >=0Â ?Â lenÂ :Â na
Â Â Â Â Â Â Â Â array.push(toArr,Â array.pop(fromArr))
varÂ allLongTakeProfitLinesÂ =Â array.new<line>()
varÂ currentLongTakeProfitLinesÂ =Â array.new<line>()
ifÂ (longIsActive)
Â Â Â Â ifÂ (longPositionEntry)
Â Â Â Â Â Â Â Â moveAllElements(currentLongTakeProfitLines,Â allLongTakeProfitLines)
Â Â Â Â Â Â Â Â forÂ [i,Â takeProfitPrice]Â inÂ longTakeProfitPrices
Â Â Â Â Â Â Â Â Â Â Â Â pa.push(currentLongTakeProfitLines,Â line.new(x1Â =Â entryBarIdÂ +Â 1,Â y1Â =Â takeProfitPrice,Â x2Â =Â bar_indexÂ +Â 1,Â y2Â =Â takeProfitPrice,Â xlocÂ =Â xloc.bar_index,Â extendÂ =Â extend.none,Â colorÂ =Â color.from_gradient(i,Â 0,Â numOfTakeProfitTargets,Â takeProfitColor,Â winColor),Â styleÂ =Â line.style_solid,Â widthÂ =Â 1),Â numOfTakeProfitTargets)
Â Â Â Â updateLines(currentLongTakeProfitLines,Â longTakeProfitPrices,Â longTrailingTakeProfitExecuted)
varÂ allShortTakeProfitLinesÂ =Â array.new<line>()
varÂ currentShortTakeProfitLinesÂ =Â array.new<line>()
ifÂ (shortIsActive)
Â Â Â Â ifÂ (shortPositionEntry)
Â Â Â Â Â Â Â Â moveAllElements(currentShortTakeProfitLines,Â allShortTakeProfitLines)
Â Â Â Â Â Â Â Â forÂ [i,Â takeProfitPrice]Â inÂ shortTakeProfitPrices
Â Â Â Â Â Â Â Â Â Â Â Â pa.push(currentShortTakeProfitLines,Â line.new(x1Â =Â entryBarIdÂ +Â 1,Â y1Â =Â takeProfitPrice,Â x2Â =Â bar_indexÂ +Â 1,Â y2Â =Â takeProfitPrice,Â xlocÂ =Â xloc.bar_index,Â extendÂ =Â extend.none,Â colorÂ =Â color.from_gradient(i,Â 0,Â numOfTakeProfitTargets,Â takeProfitColor,Â winColor),Â styleÂ =Â line.style_solid,Â widthÂ =Â 1),Â numOfTakeProfitTargets)
Â Â Â Â updateLines(currentShortTakeProfitLines,Â shortTakeProfitPrices,Â shortTrailingTakeProfitExecuted)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ’°Â QUANTITY/RISKÂ MANAGEMENTÂ ======================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ calculationÂ ofÂ theÂ quantityÂ percentageÂ thatÂ willÂ beÂ usedÂ onÂ eachÂ entry
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 2,Â ENTRY,Â SHAREDÂ VARIABLESÂ 3,Â EXIT
//Â Results:Â longEntryBaseQuantity,Â shortEntryBaseQuantity,Â longRemainingQuantityPerc,Â shortRemainingQuantityPerc
importÂ jason5480/math_utils/3Â asÂ mu
//Â INPUTÂ ============================================================================================================
allTakeProfitsQuantityPercÂ =Â input.float(defvalÂ =Â 100.0,Â titleÂ =Â 'TakeÂ ProfitÂ QuantityÂ %',Â minvalÂ =Â 0.0,Â maxvalÂ =Â 100.0,Â stepÂ =Â 0.5,Â tooltipÂ =Â 'TheÂ percentageÂ ofÂ theÂ positionÂ thatÂ willÂ beÂ withdrawnÂ whenÂ ALLÂ theÂ takeÂ profitÂ priceÂ targetsÂ areÂ reached.Â IfÂ moreÂ thanÂ oneÂ takeÂ profitÂ targetÂ isÂ set,Â thenÂ ALLÂ targetsÂ willÂ shareÂ equallyÂ thisÂ amountÂ andÂ exitÂ accordingly.',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')Â /Â 100.0Â 
quantityMethodÂ =Â input.string(defvalÂ =Â 'RISK',Â titleÂ =Â 'QuantityÂ Method',Â optionsÂ =Â ['RISK',Â 'EQUITY'],Â tooltipÂ =Â 'TheÂ methodÂ toÂ calculateÂ theÂ quantityÂ toÂ enterÂ eachÂ newÂ position.',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')
riskPercÂ =Â input.float(defvalÂ =Â 2.0,Â titleÂ =Â 'â€ƒâ€ƒCapitalÂ atÂ RiskÂ %',Â minvalÂ =Â 1.0,Â maxvalÂ =Â 100.0,Â tooltipÂ =Â 'TheÂ maximumÂ percentageÂ ofÂ theÂ equityÂ toÂ riskÂ inÂ everyÂ tradeÂ whenÂ noÂ leverageÂ isÂ used.',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')Â /Â 100.0Â 
equityPercÂ =Â input.float(defvalÂ =Â 20.0,Â titleÂ =Â 'â€ƒâ€ƒEquityÂ %â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ',Â minvalÂ =Â 1.0,Â maxvalÂ =Â 100.0,Â tooltipÂ =Â 'TheÂ percentageÂ ofÂ theÂ equityÂ toÂ enterÂ inÂ everyÂ tradeÂ whenÂ noÂ leverageÂ isÂ used.',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')Â /Â 100.0Â 
minTradeÂ =Â input.int(defvalÂ =Â 10,Â titleÂ =Â 'MinimumÂ TradeÂ Price',Â minvalÂ =Â 1,Â tooltipÂ =Â 'TheÂ minimumÂ tradeÂ priceÂ inÂ quoteÂ currencyÂ thatÂ isÂ allowedÂ inÂ theÂ exchangeÂ forÂ aÂ validÂ newÂ position.',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')
longLeverageÂ =Â input.int(defvalÂ =Â 1,Â titleÂ =Â 'LeverageÂ Long/Shortâ€ƒ',Â minvalÂ =Â 1,Â inlineÂ =Â 'Leverage',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')
shortLeverageÂ =Â input.int(defvalÂ =Â 1,Â titleÂ =Â '',Â minvalÂ =Â 1,Â tooltipÂ =Â 'LeverageÂ factorÂ usedÂ toÂ multiplyÂ theÂ initialÂ riskÂ quantityÂ ofÂ eachÂ tradeÂ (byÂ borrowingÂ theÂ remainingÂ amount).Â Thus,Â theÂ profitsÂ andÂ lossesÂ areÂ multipliedÂ respectivelly.',Â inlineÂ =Â 'Leverage',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')
//Â LOGICÂ ============================================================================================================
varÂ floatÂ epsilonÂ =Â 0.0001
varÂ floatÂ takeProfitQuantityPercÂ =Â numOfTakeProfitTargetsÂ ==Â 0Â ?Â 0Â :Â mu.clamp_up((allTakeProfitsQuantityPercÂ /Â numOfTakeProfitTargets)Â +Â epsilon,Â 0.0,Â 1.0,Â 4)
varÂ intÂ quoteDecimalDigitsÂ =Â mu.num_of_decimal_digits(syminfo.mintickÂ *Â syminfo.pointvalue)
getLongRiskQuoteQuantity()Â =>
Â Â Â Â mu.clamp_down(strategy.equityÂ *Â riskPercÂ *Â longLeverageÂ /Â longStopLossPerc,Â minTrade,Â strategy.equityÂ *Â longLeverage,Â quoteDecimalDigits)
getLongEquityQuoteQuantity()Â =>
Â Â Â Â mu.clamp_down(strategy.equityÂ *Â equityPercÂ *Â longLeverage,Â minTrade,Â strategy.equityÂ *Â longLeverage,Â quoteDecimalDigits)
floatÂ longQuoteQuantityÂ =Â switchÂ quantityMethod
Â Â Â Â 'RISK'Â =>Â getLongRiskQuoteQuantity()
Â Â Â Â 'EQUITY'Â =>Â getLongEquityQuoteQuantity()
Â Â Â Â =>Â na
getLongQuoteQuantityPerc()Â =>
Â Â Â Â longQuoteQuantityÂ /Â strategy.equity
floatÂ longEntryQuoteQuantityPercÂ =Â na
longEntryQuoteQuantityPercÂ :=Â ifÂ (longTrEntryIsActiveÂ orÂ validOpenLongPosition)
Â Â Â Â getLongQuoteQuantityPerc()
elseÂ ifÂ (longIsActive)
Â Â Â Â nz(longEntryQuoteQuantityPerc[1],Â getLongQuoteQuantityPerc())
else
Â Â Â Â na
getLongBaseQuantity()Â =>
Â Â Â Â longQuoteQuantityÂ /Â entryPrice
varÂ floatÂ longEntryBaseQuantityÂ =Â na
longEntryBaseQuantityÂ :=Â ifÂ (longTrEntryIsActiveÂ orÂ validOpenLongPosition)
Â Â Â Â getLongBaseQuantity()
elseÂ ifÂ (longIsActive)
Â Â Â Â nz(longEntryBaseQuantity[1],Â getLongBaseQuantity())
else
Â Â Â Â na
getLongRisk()Â =>
Â Â Â Â switchÂ quantityMethod
Â Â Â Â Â Â Â Â 'RISK'Â =>Â riskPerc
Â Â Â Â Â Â Â Â 'EQUITY'Â =>Â equityPercÂ *Â longStopLossPerc
Â Â Â Â Â Â Â Â =>na
varÂ floatÂ longRiskÂ =Â na
longRiskÂ :=Â ifÂ (longTrEntryIsActiveÂ orÂ validOpenLongPosition)
Â Â Â Â getLongRisk()
elseÂ ifÂ (longIsActive)
Â Â Â Â nz(longRisk[1],Â getLongRisk())
else
Â Â Â Â na
floatÂ longRemainingQuantityPercÂ =Â 1Â -Â longTrailingTakeProfitExecutedCountÂ *Â takeProfitQuantityPerc
getShortRiskQuoteQuantity()Â =>
Â Â Â Â mu.clamp_down(strategy.equityÂ *Â riskPercÂ *Â shortLeverageÂ /Â shortStopLossPerc,Â minTrade,Â strategy.equityÂ *Â shortLeverage,Â quoteDecimalDigits)
getShortEquityQuoteQuantity()Â =>
Â Â Â Â mu.clamp_down(strategy.equityÂ *Â equityPercÂ *Â shortLeverage,Â minTrade,Â strategy.equityÂ *Â shortLeverage,Â quoteDecimalDigits)
floatÂ shortQuoteQuantityÂ =Â switchÂ quantityMethod
Â Â Â Â 'RISK'Â =>Â getShortRiskQuoteQuantity()
Â Â Â Â 'EQUITY'Â =>Â getShortEquityQuoteQuantity()
Â Â Â Â =>Â na
getShortQuoteQuantityPerc()Â =>
Â Â Â Â shortQuoteQuantityÂ /Â strategy.equity
floatÂ shortEntryQuoteQuantityPercÂ =Â na
shortEntryQuoteQuantityPercÂ :=Â ifÂ (shortTrEntryIsActiveÂ orÂ validOpenShortPosition)
Â Â Â Â getShortQuoteQuantityPerc()
elseÂ ifÂ (shortIsActive)
Â Â Â Â nz(shortEntryQuoteQuantityPerc[1],Â getShortQuoteQuantityPerc())
else
Â Â Â Â na
getShortBaseQuantity()Â =>
Â Â Â Â shortQuoteQuantityÂ /Â entryPrice
varÂ floatÂ shortEntryBaseQuantityÂ =Â na
shortEntryBaseQuantityÂ :=Â ifÂ (shortTrEntryIsActiveÂ orÂ validOpenShortPosition)
Â Â Â Â getShortBaseQuantity()
elseÂ ifÂ (shortIsActive)
Â Â Â Â nz(shortEntryBaseQuantity[1],Â getShortBaseQuantity())
else
Â Â Â Â na
getShortRisk()Â =>
Â Â Â Â switchÂ quantityMethod
Â Â Â Â Â Â Â Â 'RISK'Â =>Â riskPerc
Â Â Â Â Â Â Â Â 'EQUITY'Â =>Â equityPercÂ *Â shortStopLossPerc
Â Â Â Â Â Â Â Â =>na
varÂ floatÂ shortRiskÂ =Â na
shortRiskÂ :=Â ifÂ (shortTrEntryIsActiveÂ orÂ validOpenShortPosition)
Â Â Â Â getShortRisk()
elseÂ ifÂ (shortIsActive)
Â Â Â Â nz(shortRisk[1],Â getShortRisk())
else
Â Â Â Â na
floatÂ shortRemainingQuantityPercÂ =Â 1Â -Â shortTrailingTakeProfitExecutedCountÂ *Â takeProfitQuantityPerc
//Â PLOTÂ =============================================================================================================
varÂ buyColorÂ =Â color.new(color.green,Â 0)
varÂ sellColorÂ =Â color.new(color.red,Â 0)
varÂ textColorÂ =Â color.new(color.white,Â 0)
ifÂ (validOpenLongPosition)
Â Â Â Â label.new(xÂ =Â bar_index,Â yÂ =Â na,Â textÂ =Â 'Buy',Â ylocÂ =Â yloc.belowbar,Â colorÂ =Â buyColor,Â styleÂ =Â label.style_label_up,Â textcolorÂ =Â textColor)
ifÂ (validOpenShortPosition)
Â Â Â Â label.new(xÂ =Â bar_index,Â yÂ =Â na,Â textÂ =Â 'Sell',Â ylocÂ =Â yloc.abovebar,Â colorÂ =Â sellColor,Â styleÂ =Â label.style_label_down,Â textcolorÂ =Â textColor)
ifÂ (validCloseShortPosition)Â Â Â Â 
Â Â Â Â label.new(xÂ =Â bar_index,Â yÂ =Â na,Â textÂ =Â 'Buy',Â ylocÂ =Â yloc.belowbar,Â colorÂ =Â buyColor,Â styleÂ =Â label.style_label_up,Â textcolorÂ =Â textColor)
ifÂ (validCloseLongPosition)
Â Â Â Â label.new(xÂ =Â bar_index,Â yÂ =Â na,Â textÂ =Â 'Sell',Â ylocÂ =Â yloc.abovebar,Â colorÂ =Â sellColor,Â styleÂ =Â label.style_label_down,Â textcolorÂ =Â textColor)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ“ŠÂ STATSÂ =========================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ plottingÂ additionalÂ informationÂ forÂ statisticsÂ andÂ backtestingÂ purposes
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 1,Â ENTRY
//Â Results:Â NONE
//Â INPUTÂ ============================================================================================================
showStatsTableÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'ShowÂ StatsÂ Tableâš ï¸ğŸŒ',Â inlineÂ =Â 'StatsÂ Table',Â groupÂ =Â 'ğŸ“ŠÂ Stats')
statsTablePosÂ =Â input.string(defvalÂ =Â 'TR',Â titleÂ =Â '',Â optionsÂ =Â ['TR',Â 'TL',Â 'BR',Â 'BL'],Â tooltipÂ =Â 'ShowÂ theÂ tableÂ withÂ theÂ overallÂ tradeÂ statisticsÂ onÂ theÂ selectedÂ corner.Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â inlineÂ =Â 'StatsÂ Table',Â groupÂ =Â 'ğŸ“ŠÂ Stats')
showTradeStatsÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'ShowÂ TradeÂ Statsâš ï¸ğŸŒ',Â tooltipÂ =Â 'ShowÂ theÂ winning/losingÂ tradeÂ statsÂ whenÂ complete.Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â groupÂ =Â 'ğŸ“ŠÂ Stats')
//Â LOGICÂ ============================================================================================================
getTablePosition(pos)Â =>
Â Â Â Â switchÂ pos
Â Â Â Â Â Â Â Â 'TR'Â =>Â position.top_right
Â Â Â Â Â Â Â Â 'TL'Â =>Â position.top_left
Â Â Â Â Â Â Â Â 'BR'Â =>Â position.bottom_right
Â Â Â Â Â Â Â Â 'BL'Â =>Â position.bottom_left
Â Â Â Â Â Â Â Â =>Â position.middle_center
floatÂ currentLongProfitPercÂ =Â ifÂ ((longIsActiveÂ orÂ longPositionCompleted)Â andÂ (showStatsTableÂ orÂ showTradeStats))
Â Â Â Â floatÂ profitÂ =Â 0.0
Â Â Â Â forÂ [i,Â takeProfitPrice]Â inÂ longTakeProfitPrices
Â Â Â Â Â Â Â Â ifÂ (array.get(longTrailingTakeProfitExecuted,Â i))
Â Â Â Â Â Â Â Â Â Â Â Â floatÂ longTakeProfitPercÂ =Â (takeProfitPriceÂ -Â entryPrice)Â /Â entryPrice
Â Â Â Â Â Â Â Â Â Â Â Â profitÂ +=Â longTakeProfitPercÂ *Â takeProfitQuantityPerc
Â Â Â Â profitÂ -=Â (validCloseLongPositionÂ ?Â (entryPriceÂ -Â close)Â /Â entryPriceÂ :Â longStopLossPerc)Â *Â longRemainingQuantityPerc
else
Â Â Â Â na
floatÂ currentShortProfitPercÂ =Â ifÂ ((shortIsActiveÂ orÂ shortPositionCompleted)Â andÂ (showStatsTableÂ orÂ showTradeStats))Â 
Â Â Â Â floatÂ profitÂ =Â 0.0
Â Â Â Â forÂ [i,Â takeProfitPrice]Â inÂ shortTakeProfitPrices
Â Â Â Â Â Â Â Â ifÂ (array.get(shortTrailingTakeProfitExecuted,Â i))
Â Â Â Â Â Â Â Â Â Â Â Â floatÂ shortTakeProfitPercÂ =Â (entryPriceÂ -Â takeProfitPrice)Â /Â entryPrice
Â Â Â Â Â Â Â Â Â Â Â Â profitÂ +=Â shortTakeProfitPercÂ *Â takeProfitQuantityPerc
Â Â Â Â profitÂ -=Â (validCloseShortPositionÂ ?Â (closeÂ -Â entryPrice)Â /Â entryPriceÂ :Â shortStopLossPerc)Â *Â shortRemainingQuantityPerc
else
Â Â Â Â na
//Â StoreÂ theÂ winning/losingÂ profits
varÂ winTradeProfitsÂ =Â array.new<float>()
varÂ lossTradeProfitsÂ =Â array.new<float>()
varÂ winTradeWProfitsÂ =Â array.new<float>()
varÂ lossTradeWProfitsÂ =Â array.new<float>()
varÂ floatÂ winQuantityPercSumÂ =Â 0.0
varÂ floatÂ lossQuantityPercSumÂ =Â 0.0
//Â CountÂ winning/losingÂ streaks
varÂ intÂ maxWinningStreakÂ =Â 0
varÂ intÂ maxLosingStreakÂ =Â 0
varÂ intÂ currentWinningStreakÂ =Â 0
varÂ intÂ currentLosingStreakÂ =Â 0
ifÂ (showStatsTableÂ andÂ longPositionCompleted)
Â Â Â Â floatÂ longProfitÂ =Â 100.0Â *Â currentLongProfitPerc[1]
Â Â Â Â floatÂ longQuantityPercÂ =Â longEntryQuoteQuantityPerc[1]
Â Â Â Â floatÂ longWProfitÂ =Â longProfitÂ *Â longQuantityPerc
Â Â Â Â boolÂ isWinÂ =Â longProfitÂ >Â 0
Â Â Â Â ifÂ (isWin)
Â Â Â Â Â Â Â Â array.push(winTradeProfits,Â longProfit)
Â Â Â Â Â Â Â Â array.push(winTradeWProfits,Â longWProfit)
Â Â Â Â Â Â Â Â winQuantityPercSumÂ :=Â winQuantityPercSumÂ +Â longQuantityPerc
Â Â Â Â Â Â Â Â currentWinningStreakÂ :=Â currentWinningStreakÂ +Â 1
Â Â Â Â Â Â Â Â currentLosingStreakÂ :=Â 0
Â Â Â Â else
Â Â Â Â Â Â Â Â array.push(lossTradeProfits,Â longProfit)
Â Â Â Â Â Â Â Â array.push(lossTradeWProfits,Â longWProfit)
Â Â Â Â Â Â Â Â lossQuantityPercSumÂ :=Â lossQuantityPercSumÂ +Â longQuantityPerc
Â Â Â Â Â Â Â Â currentLosingStreakÂ :=Â currentLosingStreakÂ +Â 1
Â Â Â Â Â Â Â Â currentWinningStreakÂ :=Â 0
Â Â Â Â maxWinningStreakÂ :=Â math.max(currentWinningStreak,Â maxWinningStreak)
Â Â Â Â maxLosingStreakÂ :=Â math.max(currentLosingStreak,Â maxLosingStreak)
ifÂ (showStatsTableÂ andÂ shortPositionCompleted)
Â Â Â Â floatÂ shortProfitÂ =Â 100.0Â *Â currentShortProfitPerc[1]
Â Â Â Â floatÂ shortQuantityPercÂ =Â shortEntryQuoteQuantityPerc[1]
Â Â Â Â floatÂ shortWProfitÂ =Â shortProfitÂ *Â shortQuantityPerc
Â Â Â Â boolÂ isWinÂ =Â shortProfitÂ >Â 0
Â Â Â Â ifÂ (isWin)
Â Â Â Â Â Â Â Â array.push(winTradeProfits,Â shortProfit)
Â Â Â Â Â Â Â Â array.push(winTradeWProfits,Â shortWProfit)
Â Â Â Â Â Â Â Â winQuantityPercSumÂ :=Â winQuantityPercSumÂ +Â shortQuantityPerc
Â Â Â Â Â Â Â Â currentWinningStreakÂ :=Â currentWinningStreakÂ +Â 1
Â Â Â Â Â Â Â Â currentLosingStreakÂ :=Â 0
Â Â Â Â else
Â Â Â Â Â Â Â Â array.push(lossTradeProfits,Â shortProfit)
Â Â Â Â Â Â Â Â array.push(lossTradeWProfits,Â shortWProfit)
Â Â Â Â Â Â Â Â lossQuantityPercSumÂ :=Â lossQuantityPercSumÂ +Â shortQuantityPerc
Â Â Â Â Â Â Â Â currentLosingStreakÂ :=Â currentLosingStreakÂ +Â 1
Â Â Â Â Â Â Â Â currentWinningStreakÂ :=Â 0
Â Â Â Â maxWinningStreakÂ :=Â math.max(currentWinningStreak,Â maxWinningStreak)
Â Â Â Â maxLosingStreakÂ :=Â math.max(currentLosingStreak,Â maxLosingStreak)
//Â PLOTÂ =============================================================================================================
ifÂ (showStatsTableÂ andÂ (barstate.islastconfirmedhistoryÂ orÂ barstate.islast))
Â Â Â Â varÂ txtColorÂ =Â color.new(color.gray,Â 0)
Â Â Â Â varÂ bgColorÂ =Â color.new(color.black,Â 95)
Â Â Â Â varÂ winBgColorÂ =Â color.new(color.green,Â 95)
Â Â Â Â varÂ lossBgColorÂ =Â color.new(color.red,Â 95)
Â Â Â Â varÂ statsTableÂ =Â table.new(positionÂ =Â getTablePosition(statsTablePos),Â columnsÂ =Â 4,Â rowsÂ =Â 6,Â frame_colorÂ =Â color.new(color.black,Â 0),Â frame_widthÂ =Â 2,Â border_colorÂ =Â color.new(color.black,Â 0),Â border_widthÂ =Â 1)
Â Â Â Â //Â horizontalÂ headers
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 0,Â rowÂ =Â 0,Â bgcolorÂ =Â color.new(color.black,Â 95))
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 1,Â rowÂ =Â 0,Â textÂ =Â 'All',Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor,Â tooltipÂ =Â 'InÂ contrastÂ toÂ theÂ TVÂ backtestÂ engine,Â aÂ tradeÂ isÂ consideredÂ toÂ beÂ completeÂ whenÂ theÂ entireÂ entryÂ positionÂ wasÂ exitedÂ andÂ notÂ whenÂ aÂ moveÂ isÂ doneÂ (e.g.Â aÂ takeÂ profitÂ targetÂ isÂ reached).')
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 2,Â rowÂ =Â 0,Â textÂ =Â 'Wins',Â text_colorÂ =Â takeProfitColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â winBgColor,Â tooltipÂ =Â 'TheÂ winningÂ trades.')
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 3,Â rowÂ =Â 0,Â textÂ =Â 'Losses',Â text_colorÂ =Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â lossBgColor,Â tooltipÂ =Â 'TheÂ losingÂ trades.')
Â Â Â Â //Â verticalÂ headers
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 0,Â rowÂ =Â 1,Â textÂ =Â 'Trades',Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor,Â tooltipÂ =Â 'TheÂ totalÂ numberÂ ofÂ tradesÂ andÂ thoseÂ thatÂ hadÂ aÂ winning/losingÂ outcome.')
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 0,Â rowÂ =Â 2,Â textÂ =Â 'Streak',Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor,Â tooltipÂ =Â 'TheÂ maximumÂ consecutiveÂ numberÂ ofÂ wins/losesÂ inÂ aÂ row.')
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 0,Â rowÂ =Â 3,Â textÂ =Â 'Rate',Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor,Â tooltipÂ =Â 'TheÂ percentÂ ofÂ theÂ wins/losses.')
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 0,Â rowÂ =Â 4,Â textÂ =Â 'AvgÂ Profit',Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor,Â tooltipÂ =Â 'TheÂ averageÂ profitÂ (percentagewise)Â perÂ tradeÂ ofÂ all/winning/losingÂ trades.')
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 0,Â rowÂ =Â 5,Â textÂ =Â 'WAvgÂ Profit',Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor,Â tooltipÂ =Â 'TheÂ weightedÂ averageÂ profitÂ (percentagewise)Â perÂ tradeÂ ofÂ all/winning/losingÂ tradesÂ normalizedÂ byÂ theÂ entryÂ quantityÂ percentage.Â ThusÂ theÂ resultÂ isÂ non-compound.')
Â Â Â Â //Â Trades
Â Â Â Â intÂ numOfWinsÂ =Â array.size(winTradeProfits)
Â Â Â Â intÂ numOfLossesÂ =Â array.size(lossTradeProfits)
Â Â Â Â intÂ numOfTradesÂ =Â numOfWinsÂ +Â numOfLosses
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 1,Â rowÂ =Â 1,Â textÂ =Â str.tostring(numOfTrades),Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 2,Â rowÂ =Â 1,Â textÂ =Â str.tostring(numOfWins),Â text_colorÂ =Â takeProfitColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â winBgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 3,Â rowÂ =Â 1,Â textÂ =Â str.tostring(numOfLosses),Â text_colorÂ =Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â lossBgColor)
Â Â Â Â //Â Streak
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 1,Â rowÂ =Â 2,Â bgcolorÂ =Â bgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 2,Â rowÂ =Â 2,Â textÂ =Â str.tostring(maxWinningStreak),Â text_colorÂ =Â takeProfitColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â winBgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 3,Â rowÂ =Â 2,Â textÂ =Â str.tostring(maxLosingStreak),Â text_colorÂ =Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â lossBgColor)
Â Â Â Â //Â Rate
Â Â Â Â floatÂ winRateÂ =Â 100.0Â *Â numOfWinsÂ /Â numOfTrades
Â Â Â Â floatÂ loseRateÂ =Â 100.0Â *Â numOfLossesÂ /Â numOfTrades
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 1,Â rowÂ =Â 3,Â textÂ =Â str.tostring(winRateÂ +Â loseRate,Â format.percent),Â text_colorÂ =Â txtColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 2,Â rowÂ =Â 3,Â textÂ =Â str.tostring(winRate,Â format.percent),Â text_colorÂ =Â takeProfitColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â winBgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 3,Â rowÂ =Â 3,Â textÂ =Â str.tostring(loseRate,Â format.percent),Â text_colorÂ =Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â lossBgColor)
Â Â Â Â //Â AvgÂ Profit
Â Â Â Â floatÂ winAvgProfitÂ =Â array.avg(winTradeProfits)
Â Â Â Â floatÂ loseAvgProfitÂ =Â array.avg(lossTradeProfits)
Â Â Â Â floatÂ avgProfitÂ =Â (winAvgProfitÂ *Â numOfWinsÂ +Â loseAvgProfitÂ *Â numOfLosses)Â /Â numOfTrades
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 1,Â rowÂ =Â 4,Â textÂ =Â str.tostring(avgProfit,Â format.percent),Â text_colorÂ =Â avgProfitÂ >Â 0Â ?Â takeProfitColorÂ :Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 2,Â rowÂ =Â 4,Â textÂ =Â str.tostring(winAvgProfit,Â format.percent),Â text_colorÂ =Â takeProfitColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â winBgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 3,Â rowÂ =Â 4,Â textÂ =Â str.tostring(loseAvgProfit,Â format.percent),Â text_colorÂ =Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â lossBgColor)
Â Â Â Â //Â WAvgÂ Profit
Â Â Â Â floatÂ winWAvgProfitÂ =Â array.sum(winTradeWProfits)Â /Â winQuantityPercSum
Â Â Â Â floatÂ lossWAvgProfitÂ =Â array.sum(lossTradeWProfits)Â /Â lossQuantityPercSum
Â Â Â Â floatÂ wavgProfitÂ =Â (winWAvgProfitÂ *Â numOfWinsÂ +Â lossWAvgProfitÂ *Â numOfLosses)Â /Â numOfTrades
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 1,Â rowÂ =Â 5,Â textÂ =Â str.tostring(wavgProfit,Â format.percent),Â text_colorÂ =Â wavgProfitÂ >Â 0Â ?Â takeProfitColorÂ :Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â bgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 2,Â rowÂ =Â 5,Â textÂ =Â str.tostring(winWAvgProfit,Â format.percent),Â text_colorÂ =Â takeProfitColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â winBgColor)
Â Â Â Â table.cell(table_idÂ =Â statsTable,Â columnÂ =Â 3,Â rowÂ =Â 5,Â textÂ =Â str.tostring(lossWAvgProfit,Â format.percent),Â text_colorÂ =Â stopLossColor,Â text_sizeÂ =Â size.normal,Â bgcolorÂ =Â lossBgColor)
ifÂ (showTradeStatsÂ andÂ longPositionCompleted)
Â Â Â Â floatÂ longProfitÂ =Â 100.0Â *Â currentLongProfitPerc[1]
Â Â Â Â boolÂ isWinÂ =Â longProfitÂ >Â 0
Â Â Â Â stringÂ longProfitStrÂ =Â str.tostring(longProfit,Â format.percent)
Â Â Â Â intÂ takeProfitsExecutedÂ =Â longTrailingTakeProfitExecutedCount[1]
Â Â Â Â floatÂ stopLossPriceÂ =Â longStopLossPrice[1]
Â Â Â Â floatÂ tradePriceÂ =Â isWinÂ andÂ longTrailingTakeProfitExecutedCount[1]Â >Â 0Â ?Â math.max(array.get(longTakeProfitPrices[1],Â takeProfitsExecutedÂ -Â 1),Â stopLossPrice)Â :Â validCloseLongPositionÂ ?Â closeÂ :Â stopLossPrice
Â Â Â Â line.new(x1Â =Â entryBarIdÂ +Â 1,Â y1Â =Â tradePrice,Â x2Â =Â bar_index,Â y2Â =Â tradePrice,Â xlocÂ =Â xloc.bar_index,Â extendÂ =Â extend.none,Â colorÂ =Â isWinÂ ?Â winColorÂ :Â stopLossColor,Â styleÂ =Â line.style_arrow_both,Â widthÂ =Â 1)
Â Â Â Â label.new(xÂ =Â int((entryBarIdÂ +Â bar_indexÂ +Â 1)Â /Â 2),Â yÂ =Â tradePrice,Â textÂ =Â isWinÂ ?Â 'Win\n+'Â +Â longProfitStrÂ :Â 'Loss\n'Â +Â longProfitStr,Â ylocÂ =Â yloc.price,Â colorÂ =Â isWinÂ ?Â winColorÂ :Â stopLossColor,Â styleÂ =Â isWinÂ ?Â label.style_label_downÂ :Â label.style_label_up,Â textcolorÂ =Â textColor,Â sizeÂ =Â size.large,Â tooltipÂ =Â 'NumberÂ ofÂ TakeÂ ProfitÂ targetsÂ executed:Â 'Â +Â str.tostring(takeProfitsExecuted))
Â Â Â Â 
ifÂ (showTradeStatsÂ andÂ shortPositionCompleted)
Â Â Â Â floatÂ shortProfitÂ =Â 100.0Â *Â currentShortProfitPerc[1]
Â Â Â Â boolÂ isWinÂ =Â shortProfitÂ >Â 0
Â Â Â Â stringÂ shortProfitStrÂ =Â str.tostring(shortProfit,Â format.percent)
Â Â Â Â intÂ takeProfitsExecutedÂ =Â shortTrailingTakeProfitExecutedCount[1]
Â Â Â Â floatÂ stopLossPriceÂ =Â shortStopLossPrice[1]
Â Â Â Â floatÂ tradePriceÂ =Â isWinÂ andÂ shortTrailingTakeProfitExecutedCount[1]Â >Â 0Â ?Â math.min(array.get(shortTakeProfitPrices[1],Â takeProfitsExecutedÂ -Â 1),Â stopLossPrice)Â :Â validCloseShortPositionÂ ?Â closeÂ :Â stopLossPrice
Â Â Â Â line.new(x1Â =Â entryBarIdÂ +Â 1,Â y1Â =Â tradePrice,Â x2Â =Â bar_index,Â y2Â =Â tradePrice,Â xlocÂ =Â xloc.bar_index,Â extendÂ =Â extend.none,Â colorÂ =Â isWinÂ ?Â winColorÂ :Â stopLossColor,Â styleÂ =Â line.style_arrow_both,Â widthÂ =Â 1)
Â Â Â Â label.new(xÂ =Â int((entryBarIdÂ +Â bar_indexÂ +Â 1)Â /Â 2),Â yÂ =Â tradePrice,Â textÂ =Â isWinÂ ?Â 'Win\n+'Â +Â shortProfitStrÂ :Â 'Loss\n'Â +Â shortProfitStr,Â ylocÂ =Â yloc.price,Â colorÂ =Â isWinÂ ?Â winColorÂ :Â stopLossColor,Â styleÂ =Â isWinÂ ?Â label.style_label_upÂ :Â label.style_label_down,Â textcolorÂ =Â textColor,Â sizeÂ =Â size.large,Â tooltipÂ =Â 'NumberÂ ofÂ TakeÂ ProfitÂ targetsÂ executed:Â 'Â +Â str.tostring(takeProfitsExecuted))
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â â˜­Â SHAREDÂ VARIABLESÂ 4Â =============================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ conditionalÂ variablesÂ toÂ enterÂ andÂ exitÂ orders
//Â Dependencies:Â SHAREDÂ VARIABLESÂ 2,Â EXIT
//Â Results:Â ALL
//Â LOGICÂ ============================================================================================================
boolÂ doCloseLongÂ =Â notÂ exitTrailingEnabledÂ andÂ closeLongPosition
boolÂ doCloseShortÂ =Â notÂ exitTrailingEnabledÂ andÂ closeShortPosition
boolÂ doSLorExitTrLongÂ =Â longTrExitIsActiveÂ orÂ longIsActive
boolÂ doSLorExitTrShortÂ =Â shortTrExitIsActiveÂ orÂ shortIsActive
boolÂ doCloseAllÂ =Â closeAtSessionEndÂ andÂ notÂ timeFilterApproval
boolÂ doCnlTrEntryLongÂ =Â entryTrailingEnabledÂ andÂ longTrEntryIsActiveÂ andÂ closeLongPosition
boolÂ doCnlTrEntryShortÂ =Â entryTrailingEnabledÂ andÂ shortTrEntryIsActiveÂ andÂ closeShortPosition
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ””Â ALERTÂ MESSAGESÂ ================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ messageÂ outputsÂ whenÂ strategyÂ ordersÂ areÂ beingÂ executed
//Â Dependencies:Â ENTRY,Â TAKEÂ PROFITÂ 1,Â EXIT,Â STOPÂ LOSS,Â TAKEÂ PROFITÂ 2,Â QUANTITY/RISKÂ MANAGEMENT,Â SHAREDÂ VARIABLESÂ 4
//Â Results:Â ALL
importÂ jason5480/string_variables/8Â asÂ sv
//Â INPUTÂ ============================================================================================================
tickerPrefixÂ =Â input.string(defvalÂ =Â '',Â titleÂ =Â 'TickerÂ Prefix/Postfix',Â inlineÂ =Â 'Ticker',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
tickerPostfixÂ =Â input.string(defvalÂ =Â '',Â titleÂ =Â '',Â tooltipÂ =Â 'Prepend/AppendÂ aÂ customÂ stringÂ toÂ theÂ TVsÂ tickerÂ whenÂ youÂ useÂ {@{TICKER}}Â asÂ variableÂ inÂ theÂ alertÂ messages.',Â inlineÂ =Â 'Ticker',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
usePercRange100Â =Â input.bool(defvalÂ =Â true,Â titleÂ =Â 'PercentageÂ RangeÂ [0,Â 100]',Â tooltipÂ =Â 'EnableÂ toÂ multiplyÂ allÂ theÂ percentatgesÂ withÂ 100Â soÂ thatÂ theÂ valuesÂ rangeÂ fromÂ [0,Â 100]Â insteadÂ ofÂ [0,Â 1].',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
marginTicksÂ =Â input.int(defvalÂ =Â 5,Â titleÂ =Â 'MarginÂ Ticks',Â minvalÂ =Â 1,Â tooltipÂ =Â 'TheÂ ticksÂ thatÂ willÂ beÂ added/substractedÂ fromÂ entry/exitÂ priceÂ toÂ calculateÂ theÂ {${ENTRY+}},Â {${ENTRY-}},Â {${EXIT+}},Â {${EXIT-}}Â variables.Â ThoseÂ valuesÂ couldÂ beÂ usedÂ ifÂ youÂ wantÂ toÂ sendÂ aÂ limitÂ orderÂ toÂ yourÂ exchangeÂ andÂ theÂ priceÂ mightÂ goÂ toÂ theÂ "wrong"Â sideÂ dueÂ toÂ highÂ volatilityÂ ofÂ theÂ marketÂ andÂ delayÂ betweenÂ theÂ timeÂ ofÂ computationÂ andÂ execution.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
msgEventsEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ AllÂ EventÂ Alertsâš ï¸ğŸŒ',Â tooltipÂ =Â 'EnableÂ theÂ alertÂ messagesÂ thatÂ correspondÂ toÂ "orderÂ fills"Â ofÂ theÂ strategyÂ (e.g.Â entry,Â exit,Â Â close,Â takeÂ profitÂ andÂ stopÂ loss).Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgEnteredLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ Entry({@{TICKER}}):Â BoughtÂ atÂ marketÂ priceÂ ofÂ {${ENTRY}}Â {@{QUOTE}}Â anÂ amountÂ equalÂ toÂ {#{LBQ}}Â {@{BASE}}Â (forÂ {${LQQ}}Â {@{QUOTE}})Â andÂ aÂ riskÂ ofÂ {#{LRISK}}%.Â TheÂ stopÂ lossÂ wasÂ placedÂ atÂ {${LSL}}Â {@{QUOTE}}Â andÂ takeÂ profitÂ targetsÂ atÂ [{${LTP1}},Â {${LTP2}},Â {${LTP3}},Â {${LTP4}},Â {${LTP5}}]Â {@{QUOTE}}',Â titleÂ =Â 'EnterÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ enteredÂ longÂ position.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgEnteredShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ Entry({@{TICKER}}):Â SoldÂ atÂ marketÂ priceÂ ofÂ {${ENTRY}}Â {@{QUOTE}}Â anÂ amountÂ equalÂ toÂ {#{SBQ}}Â {@{BASE}}Â (forÂ {${SQQ}}Â {@{QUOTE}})Â andÂ aÂ riskÂ ofÂ {#{SRISK}}%.Â TheÂ stopÂ lossÂ wasÂ placedÂ atÂ {${SSL}}Â {@{QUOTE}}Â andÂ takeÂ profitÂ targetsÂ atÂ [{${STP1}},Â {${STP2}},Â {${STP3}},Â {${STP4}},Â {${STP5}}]Â {@{QUOTE}}',Â titleÂ =Â 'EnterÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ enteredÂ shortÂ position.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgEnteredTrLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ Entry({@{TICKER}}):Â BoughtÂ withÂ trailingÂ stop-limitÂ entryÂ orderÂ atÂ priceÂ ofÂ {${ENTRY}}Â {@{QUOTE}}Â anÂ amountÂ equalÂ toÂ {#{LBQ}}Â {@{BASE}}Â andÂ aÂ riskÂ ofÂ {#{LRISK}}%.Â TheÂ stopÂ lossÂ wasÂ placedÂ atÂ {${LSL}}Â {@{QUOTE}}Â andÂ takeÂ profitÂ targetsÂ atÂ [{${LTP1}},Â {${LTP2}},Â {${LTP3}},Â {${LTP4}},Â {${LTP5}}]Â {@{QUOTE}}',Â titleÂ =Â 'EnterÂ TrÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ enteredÂ longÂ positionÂ withÂ trailingÂ stopÂ order.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgEnteredTrShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ Entry({@{TICKER}}):Â SoldÂ withÂ trailingÂ stop-limitÂ entryÂ orderÂ atÂ priceÂ ofÂ {${ENTRY}}Â {@{QUOTE}}Â anÂ amountÂ equalÂ toÂ {#{SBQ}}Â {@{BASE}}Â andÂ aÂ riskÂ ofÂ {#{SRISK}}%.Â TheÂ stopÂ lossÂ wasÂ placedÂ atÂ {${SSL}}Â {@{QUOTE}}Â andÂ takeÂ profitÂ targetsÂ atÂ [{${STP1}},Â {${STP2}},Â {${STP3}},Â {${STP4}},Â {${STP5}}]Â {@{QUOTE}}',Â titleÂ =Â 'EnterÂ TrÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ enteredÂ shortÂ positionÂ withÂ trailingÂ stopÂ order.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgClosedLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ Close({@{TICKER}}):Â SoldÂ atÂ marketÂ priceÂ ofÂ {${EXIT}}Â {@{QUOTE}}Â {#{LRQP}}%Â ofÂ theÂ initialÂ position',Â titleÂ =Â 'CloseÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ closedÂ longÂ position.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgClosedShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ Close({@{TICKER}}):Â BoughtÂ atÂ marketÂ priceÂ ofÂ {${EXIT}}Â {@{QUOTE}}Â {#{SRQP}}%Â ofÂ theÂ initialÂ position',Â titleÂ =Â 'CloseÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ closedÂ shortÂ position.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgExitedTrLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â SoldÂ withÂ trailingÂ stop-limitÂ exitÂ orderÂ atÂ priceÂ ofÂ {${EXIT}}Â {@{QUOTE}}Â {#{LRQP}}%Â ofÂ theÂ initialÂ position',Â titleÂ =Â 'ExitÂ TrÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ exitedÂ longÂ positionÂ withÂ trailingÂ stopÂ order.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgExitedTrShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â BoughtÂ withÂ trailingÂ stop-limitÂ exitÂ orderÂ atÂ priceÂ ofÂ {${EXIT}}Â {@{QUOTE}}Â {#{SRQP}}%Â ofÂ theÂ initialÂ position',Â titleÂ =Â 'ExitÂ TrÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ exitedÂ shortÂ positionÂ withÂ trailingÂ stopÂ order.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
varÂ rawMsgRchTPLongÂ =Â array.new<string>(5,Â na)
varÂ rawMsgRchTPShortÂ =Â array.new<string>(5,Â na)
array.set(rawMsgRchTPLong,Â 0,Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 1Â executedÂ atÂ priceÂ ofÂ {${LTP1}}Â {@{QUOTE}}Â andÂ soldÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{LTPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP1Â Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ firstÂ quantityÂ takeÂ profitÂ targetÂ forÂ longÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPShort,Â 0,Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 1Â executedÂ atÂ priceÂ ofÂ {${STP1}}Â {@{QUOTE}}Â andÂ boughtÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{STPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP1Â Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ firstÂ quantityÂ takeÂ profitÂ targetÂ forÂ shortÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPLong,Â 1,Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 2Â executedÂ atÂ priceÂ ofÂ {${LTP2}}Â {@{QUOTE}}Â andÂ soldÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{LTPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP2Â Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ secondÂ quantityÂ takeÂ profitÂ targetÂ forÂ longÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPShort,Â 1,Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 2Â executedÂ atÂ priceÂ ofÂ {${STP2}}Â {@{QUOTE}}Â andÂ boughtÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{STPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP2Â Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ secondÂ quantityÂ takeÂ profitÂ targetÂ forÂ shortÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPLong,Â 2,Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 3Â executedÂ atÂ priceÂ ofÂ {${LTP3}}Â {@{QUOTE}}Â andÂ soldÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{LTPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP3Â Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ thirdÂ quantityÂ takeÂ profitÂ targetÂ forÂ longÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPShort,Â 2,Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 3Â executedÂ atÂ priceÂ ofÂ {${STP3}}Â {@{QUOTE}}Â andÂ boughtÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{STPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP3Â Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ thirdÂ quantityÂ takeÂ profitÂ targetÂ forÂ shortÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPLong,Â 3,Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 4Â executedÂ atÂ priceÂ ofÂ {${LTP4}}Â {@{QUOTE}}Â andÂ soldÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{LTPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP4Â Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ forthÂ quantityÂ takeÂ profitÂ targetÂ forÂ longÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPShort,Â 3,Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 4Â executedÂ atÂ priceÂ ofÂ {${STP4}}Â {@{QUOTE}}Â andÂ boughtÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{STPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP4Â Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ forthÂ quantityÂ takeÂ profitÂ targetÂ forÂ shortÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPLong,Â 4,Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 5Â executedÂ atÂ priceÂ ofÂ {${LTP5}}Â {@{QUOTE}}Â andÂ soldÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{LTPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP5Â Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ fifthÂ quantityÂ takeÂ profitÂ targetÂ forÂ longÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
array.set(rawMsgRchTPShort,Â 4,Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â TakeÂ ProfitÂ 5Â executedÂ atÂ priceÂ ofÂ {${STP5}}Â {@{QUOTE}}Â andÂ boughtÂ {#{TPQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{STPBQ}}Â {@{BASE}}',Â titleÂ =Â 'TP5Â Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ fifthÂ quantityÂ takeÂ profitÂ targetÂ forÂ shortÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages'))
rawMsgRchSLLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ Exit({@{TICKER}}):Â StopÂ LossÂ executedÂ atÂ priceÂ ofÂ {${LSL}}Â {@{QUOTE}}Â andÂ soldÂ {#{LRQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{LRBQ}}Â {@{BASE}}',Â titleÂ =Â 'SLÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ lastÂ quantityÂ stopÂ lossÂ targetÂ forÂ longÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgRchSLShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ Exit({@{TICKER}}):Â StopÂ LossÂ executedÂ atÂ priceÂ ofÂ {${SSL}}Â {@{QUOTE}}Â andÂ boughtÂ {#{SRQP}}%Â ofÂ theÂ initialÂ position,Â thatÂ equalsÂ toÂ anÂ amountÂ ofÂ {#{SRBQ}}Â {@{BASE}}',Â titleÂ =Â 'SLÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ lastÂ quantityÂ stopÂ lossÂ targetÂ forÂ shortÂ positionÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgClosedAllÂ =Â input.text_area(defvalÂ =Â 'CloseÂ All({@{TICKER}}):Â ClosedÂ allÂ positionsÂ atÂ marketÂ priceÂ ofÂ {${CLOSE}}Â {@{QUOTE}}',Â titleÂ =Â 'CloseÂ All',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ closedÂ allÂ positions.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
msgChgTrEntryEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ TrÂ EntryÂ ChangeÂ Alertsâš ï¸ğŸŒ',Â tooltipÂ =Â 'EnableÂ theÂ alertÂ messagesÂ thatÂ correspondÂ toÂ "alert()Â functionÂ calls"Â whenÂ theÂ trailingÂ entryÂ priceÂ changes.Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgChgTrEntryLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ TrailingÂ EntryÂ Update({@{TICKER}}):Â LongÂ trailingÂ stop-limitÂ entryÂ orderÂ changedÂ andÂ setÂ atÂ newÂ priceÂ ofÂ {${ENTRY}}Â {@{QUOTE}}',Â titleÂ =Â 'ChgÂ TrÂ EntryÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ longÂ trailingÂ stop-limitÂ entryÂ orderÂ changed.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgChgTrEntryShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ TrailingÂ EntryÂ Update({@{TICKER}}):Â ShortÂ trailingÂ stop-limitÂ entryÂ orderÂ changedÂ andÂ setÂ atÂ newÂ priceÂ ofÂ {${ENTRY}}Â {@{QUOTE}}',Â titleÂ =Â 'ChgÂ TrÂ EntryÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ shortÂ trailingÂ stop-limitÂ entryÂ orderÂ changed.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
msgChgTrExitEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ TrÂ ExitÂ ChangeÂ Alertsâš ï¸ğŸŒ',Â tooltipÂ =Â 'EnableÂ theÂ alertÂ messagesÂ thatÂ correspondÂ toÂ "alert()Â functionÂ calls"Â whenÂ theÂ trailingÂ exitÂ priceÂ changes.Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgChgTrExitLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ TrailingÂ ExitÂ Update({@{TICKER}}):Â LongÂ trailingÂ stop-limitÂ exitÂ orderÂ changedÂ andÂ setÂ atÂ newÂ priceÂ ofÂ {${EXIT}}Â {@{QUOTE}}',Â titleÂ =Â 'ChgÂ TrÂ ExitÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ longÂ trailingÂ stop-limitÂ exitÂ orderÂ changed.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgChgTrExitShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ TrailingÂ ExitÂ Update({@{TICKER}}):Â ShortÂ trailingÂ stop-limitÂ exitÂ orderÂ changedÂ andÂ setÂ atÂ newÂ priceÂ ofÂ {${EXIT}}Â {@{QUOTE}}',Â titleÂ =Â 'ChgÂ TrÂ ExitÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ shortÂ trailingÂ stop-limitÂ exitÂ orderÂ changed.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
msgChgSLEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ StopÂ LossÂ ChangeÂ Alertsâš ï¸ğŸŒ',Â tooltipÂ =Â 'EnableÂ theÂ alertÂ messagesÂ thatÂ correspondÂ toÂ "alert()Â functionÂ calls"Â whenÂ theÂ stopÂ lossÂ priceÂ changes.Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgChgSLLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ StopÂ LossÂ Update({@{TICKER}}):Â StopÂ LossÂ valueÂ changedÂ andÂ setÂ atÂ newÂ priceÂ ofÂ {${LSL}}Â {@{QUOTE}}',Â titleÂ =Â 'ChgÂ SLÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ stopÂ lossÂ targetÂ forÂ longÂ positionÂ changed.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgChgSLShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ StopÂ LossÂ Update({@{TICKER}}):Â StopÂ LossÂ valueÂ changedÂ andÂ setÂ atÂ newÂ priceÂ ofÂ {${SSL}}Â {@{QUOTE}}',Â titleÂ =Â 'ChgÂ SLÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ stopÂ lossÂ targetÂ forÂ shortÂ positionÂ changed.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
msgCnlTrEntryEnabledÂ =Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'EnableÂ TrÂ EntryÂ CancelÂ Alertsâš ï¸ğŸŒ',Â tooltipÂ =Â 'EnableÂ theÂ alertÂ messagesÂ thatÂ correspondÂ toÂ "alert()Â functionÂ calls"Â whenÂ trailingÂ forÂ entryÂ andÂ itÂ cancels.Â WARNING!Â ComputationalÂ heavyÂ operation.Â IfÂ youÂ getÂ aÂ timeoutÂ errorÂ adjustÂ theÂ timeÂ windowÂ filterÂ orÂ disableÂ otherÂ computationalÂ heavyÂ operations.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgCnlTrEntryLongÂ =Â input.text_area(defvalÂ =Â 'LongÂ TrailingÂ EntryÂ Cancel({@{TICKER}}):Â LongÂ trailingÂ stop-limitÂ entryÂ orderÂ canceled',Â titleÂ =Â 'CnlÂ TrÂ EntryÂ Long',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ longÂ trailingÂ stop-limitÂ entryÂ orderÂ canceled.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
rawMsgCnlTrEntryShortÂ =Â input.text_area(defvalÂ =Â 'ShortÂ TrailingÂ EntryÂ Cancel({@{TICKER}}):Â ShortÂ trailingÂ stop-limitÂ entryÂ orderÂ canceled',Â titleÂ =Â 'CnlÂ TrÂ EntryÂ Short',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ shortÂ trailingÂ stop-limitÂ entryÂ orderÂ canceled.Â InÂ theÂ "Condition"Â comboboxÂ ofÂ theÂ "CreateÂ Alert"Â dialogÂ theÂ "OrderÂ fillsÂ andÂ alert()Â functionÂ calls"Â orÂ theÂ "alert()Â functionÂ callsÂ only"Â optionsÂ shouldÂ beÂ selectedÂ toÂ beÂ ableÂ toÂ receiveÂ thisÂ alertÂ message.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')
msgMaxDrawdownÂ =Â msgEventsEnabledÂ ?Â input.text_area(defvalÂ =Â 'MaxÂ drawdownÂ wasÂ reached:Â AllÂ pendingÂ ordersÂ areÂ cancelled,Â allÂ openÂ positionsÂ areÂ closedÂ andÂ noÂ newÂ ordersÂ canÂ beÂ placed!Â RIPâš°ï¸',Â titleÂ =Â 'MaxÂ Drawdown',Â tooltipÂ =Â 'AlertÂ messageÂ emitedÂ whenÂ theÂ maxÂ drawdownÂ limitÂ isÂ reached.Â TextÂ thatÂ willÂ replaceÂ theÂ \'{{strategy.order.alert_message}}\'Â placeholderÂ whenÂ oneÂ isÂ usedÂ inÂ theÂ "Message"Â fieldÂ ofÂ theÂ "CreateÂ Alert"Â dialog.',Â groupÂ =Â 'ğŸ””Â AlertÂ Messages')Â :Â na
//Â LOGICÂ ============================================================================================================
varÂ variableNamesÂ =Â array.new<string>(37,Â na)
varÂ variableValuesÂ =Â array.new<float>(array.size(variableNames),Â na)
varÂ stringVariableNamesÂ =Â array.new<string>(3,Â na)
varÂ stringVariableValuesÂ =Â array.new<string>(array.size(stringVariableNames),Â na)
varÂ boolÂ variableNamesInitÂ =Â false
ifÂ ((msgEventsEnabledÂ orÂ msgChgTrEntryEnabledÂ orÂ msgChgTrExitEnabledÂ orÂ msgChgSLEnabledÂ orÂ msgCnlTrEntryEnabled)Â andÂ notÂ variableNamesInit)
Â Â Â Â array.set(variableNames,Â 0,Â 'OPEN')Â //Â OpenÂ price
Â Â Â Â array.set(variableNames,Â 1,Â 'HIGH')Â //Â HighÂ price
Â Â Â Â array.set(variableNames,Â 2,Â 'LOW')Â //Â LowÂ price
Â Â Â Â array.set(variableNames,Â 3,Â 'CLOSE')Â //Â CloseÂ price
Â Â Â Â array.set(variableNames,Â 4,Â 'LBQ')Â //Â LongÂ baseÂ currencyÂ entryÂ quantity
Â Â Â Â array.set(variableNames,Â 5,Â 'SBQ')Â //Â ShortÂ baseÂ currencyÂ entryÂ quantity
Â Â Â Â array.set(variableNames,Â 6,Â 'LQQ')Â //Â LongÂ quoteÂ currencyÂ entryÂ quantity
Â Â Â Â array.set(variableNames,Â 7,Â 'SQQ')Â //Â ShortÂ quoteÂ currencyÂ entryÂ quantity
Â Â Â Â array.set(variableNames,Â 8,Â 'LQQP')Â //Â LongÂ quoteÂ currencyÂ entryÂ quantityÂ percentage
Â Â Â Â array.set(variableNames,Â 9,Â 'SQQP')Â //Â ShortÂ quoteÂ currencyÂ entryÂ quantityÂ percentage
Â Â Â Â array.set(variableNames,Â 10,Â 'TPQP')Â //Â TakeÂ ProfitÂ quantityÂ percentage
Â Â Â Â array.set(variableNames,Â 11,Â 'LRQP')Â //Â LongÂ remainingÂ quantityÂ percentage
Â Â Â Â array.set(variableNames,Â 12,Â 'SRQP')Â //Â ShortÂ remainingÂ quantityÂ percentage
Â Â Â Â array.set(variableNames,Â 13,Â 'LTPBQ')Â //Â LongÂ TakeÂ ProfitÂ baseÂ quantity
Â Â Â Â array.set(variableNames,Â 14,Â 'STPBQ')Â //Â ShortÂ TakeÂ ProfitÂ baseÂ quantity
Â Â Â Â array.set(variableNames,Â 15,Â 'LRBQ')Â //Â LongÂ remainingÂ baseÂ quantity
Â Â Â Â array.set(variableNames,Â 16,Â 'SRBQ')Â //Â ShortÂ remainingÂ baseÂ quantity
Â Â Â Â array.set(variableNames,Â 17,Â 'LRISK')Â //Â LongÂ riskÂ percentageÂ ofÂ theÂ entryÂ quantity
Â Â Â Â array.set(variableNames,Â 18,Â 'SRISK')Â //Â ShortÂ riskÂ percentageÂ ofÂ theÂ entryÂ quantity
Â Â Â Â array.set(variableNames,Â 19,Â 'ENTRY')Â //Â EntryÂ price
Â Â Â Â array.set(variableNames,Â 20,Â 'ENTRY+')Â //Â EntryÂ priceÂ plusÂ theÂ marginÂ ticks
Â Â Â Â array.set(variableNames,Â 21,Â 'ENTRY-')Â //Â EntryÂ priceÂ minusÂ theÂ marginÂ ticks
Â Â Â Â array.set(variableNames,Â 22,Â 'EXIT')Â //Â ExitÂ price
Â Â Â Â array.set(variableNames,Â 23,Â 'EXIT+')Â //Â ExitÂ priceÂ plusÂ theÂ marginÂ ticks
Â Â Â Â array.set(variableNames,Â 24,Â 'EXIT-')Â //Â ExitÂ priceÂ minusÂ theÂ marginÂ ticks
Â Â Â Â array.set(variableNames,Â 25,Â 'LSL')Â //Â LongÂ StopÂ LossÂ price
Â Â Â Â array.set(variableNames,Â 26,Â 'SSL')Â //Â ShortÂ StopÂ LossÂ price
Â Â Â Â array.set(variableNames,Â 27,Â 'LTP1')Â //Â LongÂ TakeÂ ProfitÂ targetÂ 1Â price
Â Â Â Â array.set(variableNames,Â 28,Â 'STP1')Â //Â ShortÂ TakeÂ ProfitÂ targetÂ 1Â price
Â Â Â Â array.set(variableNames,Â 29,Â 'LTP2')Â //Â LongÂ TakeÂ ProfitÂ targetÂ 2Â price
Â Â Â Â array.set(variableNames,Â 30,Â 'STP2')Â //Â ShortÂ TakeÂ ProfitÂ targetÂ 2Â price
Â Â Â Â array.set(variableNames,Â 31,Â 'LTP3')Â //Â LongÂ TakeÂ ProfitÂ targetÂ 3Â price
Â Â Â Â array.set(variableNames,Â 32,Â 'STP3')Â //Â ShortÂ TakeÂ ProfitÂ targetÂ 3Â price
Â Â Â Â array.set(variableNames,Â 33,Â 'LTP4')Â //Â LongÂ TakeÂ ProfitÂ targetÂ 4Â price
Â Â Â Â array.set(variableNames,Â 34,Â 'STP4')Â //Â ShortÂ TakeÂ ProfitÂ targetÂ 4Â price
Â Â Â Â array.set(variableNames,Â 35,Â 'LTP5')Â //Â LongÂ TakeÂ ProfitÂ targetÂ 5Â price
Â Â Â Â array.set(variableNames,Â 36,Â 'STP5')Â //Â ShortÂ TakeÂ ProfitÂ targetÂ 5Â price
Â Â Â Â 
Â Â Â Â variableNamesInitÂ :=Â true
ifÂ (msgEventsEnabledÂ orÂ msgChgTrEntryEnabledÂ orÂ msgChgTrExitEnabledÂ orÂ msgChgSLEnabledÂ orÂ msgCnlTrEntryEnabled)
Â Â Â Â varÂ floatÂ percMulÂ =Â usePercRange100Â ?Â 100.0Â :Â 1.0
Â Â Â Â 
Â Â Â Â array.set(variableValues,Â 0,Â open)
Â Â Â Â array.set(variableValues,Â 1,Â high)
Â Â Â Â array.set(variableValues,Â 2,Â low)
Â Â Â Â array.set(variableValues,Â 3,Â close)
Â Â Â Â array.set(variableValues,Â 4,Â longEntryBaseQuantity)
Â Â Â Â array.set(variableValues,Â 5,Â shortEntryBaseQuantity)
Â Â Â Â array.set(variableValues,Â 6,Â longQuoteQuantity)
Â Â Â Â array.set(variableValues,Â 7,Â shortQuoteQuantity)
Â Â Â Â array.set(variableValues,Â 8,Â longEntryQuoteQuantityPercÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 9,Â shortEntryQuoteQuantityPercÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 10,Â takeProfitQuantityPercÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 11,Â longRemainingQuantityPercÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 12,Â shortRemainingQuantityPercÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 13,Â longEntryBaseQuantityÂ *Â takeProfitQuantityPerc)
Â Â Â Â array.set(variableValues,Â 14,Â shortEntryBaseQuantityÂ *Â takeProfitQuantityPerc)
Â Â Â Â array.set(variableValues,Â 15,Â longEntryBaseQuantityÂ *Â longRemainingQuantityPerc)
Â Â Â Â array.set(variableValues,Â 16,Â shortEntryBaseQuantityÂ *Â shortRemainingQuantityPerc)
Â Â Â Â array.set(variableValues,Â 17,Â longRiskÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 18,Â shortRiskÂ *Â percMul)
Â Â Â Â array.set(variableValues,Â 19,Â entryPrice)
Â Â Â Â array.set(variableValues,Â 20,Â entryPriceÂ +Â marginTicksÂ *Â syminfo.mintick)
Â Â Â Â array.set(variableValues,Â 21,Â entryPriceÂ -Â marginTicksÂ *Â syminfo.mintick)
Â Â Â Â array.set(variableValues,Â 22,Â exitPrice)
Â Â Â Â array.set(variableValues,Â 23,Â exitPriceÂ +Â marginTicksÂ *Â syminfo.mintick)
Â Â Â Â array.set(variableValues,Â 24,Â exitPriceÂ -Â marginTicksÂ *Â syminfo.mintick)
Â Â Â Â array.set(variableValues,Â 25,Â longStopLossPrice)
Â Â Â Â array.set(variableValues,Â 26,Â shortStopLossPrice)
Â Â Â Â ifÂ (array.size(longTakeProfitPrices)Â >Â 0)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 27,Â array.get(longTakeProfitPrices,Â 0))
Â Â Â Â ifÂ (array.size(shortTakeProfitPrices)Â >Â 0)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 28,Â array.get(shortTakeProfitPrices,Â 0))
Â Â Â Â ifÂ (array.size(longTakeProfitPrices)Â >Â 1)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 29,Â array.get(longTakeProfitPrices,Â 1))
Â Â Â Â ifÂ (array.size(shortTakeProfitPrices)Â >Â 1)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 30,Â array.get(shortTakeProfitPrices,Â 1))
Â Â Â Â ifÂ (array.size(longTakeProfitPrices)Â >Â 2)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 31,Â array.get(longTakeProfitPrices,Â 2))
Â Â Â Â ifÂ (array.size(shortTakeProfitPrices)Â >Â 2)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 32,Â array.get(shortTakeProfitPrices,Â 2))
Â Â Â Â ifÂ (array.size(longTakeProfitPrices)Â >Â 3)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 33,Â array.get(longTakeProfitPrices,Â 3))
Â Â Â Â ifÂ (array.size(shortTakeProfitPrices)Â >Â 3)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 34,Â array.get(shortTakeProfitPrices,Â 3))
Â Â Â Â ifÂ (array.size(longTakeProfitPrices)Â >Â 4)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 35,Â array.get(longTakeProfitPrices,Â 4))
Â Â Â Â ifÂ (array.size(shortTakeProfitPrices)Â >Â 4)
Â Â Â Â Â Â Â Â array.set(variableValues,Â 36,Â array.get(shortTakeProfitPrices,Â 4))
varÂ boolÂ stringVariablesInitÂ =Â false
ifÂ ((msgEventsEnabledÂ orÂ msgChgTrEntryEnabledÂ orÂ msgChgTrExitEnabledÂ orÂ msgChgSLEnabledÂ orÂ msgCnlTrEntryEnabled)Â andÂ notÂ stringVariablesInit)
Â Â Â Â array.set(stringVariableNames,Â 0,Â 'TICKER')
Â Â Â Â array.set(stringVariableNames,Â 1,Â 'BASE')
Â Â Â Â array.set(stringVariableNames,Â 2,Â 'QUOTE')
Â Â Â Â 
Â Â Â Â array.set(stringVariableValues,Â 0,Â tickerPrefixÂ +Â syminfo.tickerÂ +Â tickerPostfix)
Â Â Â Â array.set(stringVariableValues,Â 1,Â syminfo.basecurrency)
Â Â Â Â array.set(stringVariableValues,Â 2,Â syminfo.currency)
Â Â Â Â 
Â Â Â Â stringVariablesInitÂ :=Â true
//Â createÂ theÂ actualÂ messages
msgEnteredLongÂ =Â msgEventsEnabledÂ andÂ validOpenLongPositionÂ ?Â sv.eval_vars(rawMsgEnteredLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgEnteredShortÂ =Â msgEventsEnabledÂ andÂ validOpenShortPositionÂ ?Â sv.eval_vars(rawMsgEnteredShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgEnteredTrLongÂ =Â msgEventsEnabledÂ andÂ longTrEntryIsActiveÂ ?Â sv.eval_vars(rawMsgEnteredTrLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgEnteredTrShortÂ =Â msgEventsEnabledÂ andÂ shortTrEntryIsActiveÂ ?Â sv.eval_vars(rawMsgEnteredTrShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgClosedLongÂ =Â msgEventsEnabledÂ andÂ doCloseLongÂ ?Â sv.eval_vars(rawMsgClosedLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgClosedShortÂ =Â msgEventsEnabledÂ andÂ doCloseShortÂ ?Â sv.eval_vars(rawMsgClosedShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgExitedTrLongÂ =Â msgEventsEnabledÂ andÂ doSLorExitTrLongÂ ?Â sv.eval_vars(rawMsgExitedTrLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgExitedTrShortÂ =Â msgEventsEnabledÂ andÂ doSLorExitTrShortÂ ?Â sv.eval_vars(rawMsgExitedTrShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
varÂ msgRchTPLongÂ =Â array.new<string>(array.size(rawMsgRchTPLong),Â na)
varÂ msgRchTPShortÂ =Â array.new<string>(array.size(rawMsgRchTPShort),Â na)
ifÂ (msgEventsEnabled)
Â Â Â Â ifÂ (doSLorExitTrLong)
Â Â Â Â Â Â Â Â forÂ [i,Â rawMsg]Â inÂ rawMsgRchTPLong
Â Â Â Â Â Â Â Â Â Â Â Â array.set(msgRchTPLong,Â i,Â sv.eval_vars(rawMsg,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues))
Â Â Â Â ifÂ (doSLorExitTrShort)
Â Â Â Â Â Â Â Â forÂ [i,Â rawMsg]Â inÂ rawMsgRchTPShort
Â Â Â Â Â Â Â Â Â Â Â Â array.set(msgRchTPShort,Â i,Â sv.eval_vars(rawMsg,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues))
msgRchSLLongÂ =Â msgEventsEnabledÂ andÂ doSLorExitTrLongÂ ?Â sv.eval_vars(rawMsgRchSLLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgRchSLShortÂ =Â msgEventsEnabledÂ andÂ doSLorExitTrShortÂ ?Â sv.eval_vars(rawMsgRchSLShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgClosedAllÂ =Â msgEventsEnabledÂ andÂ doCloseAllÂ ?Â sv.eval_vars(rawMsgClosedAll,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgChgTrEntryLongÂ =Â msgChgTrEntryEnabledÂ ?Â sv.eval_vars(rawMsgChgTrEntryLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgChgTrEntryShortÂ =Â msgChgTrEntryEnabledÂ ?Â sv.eval_vars(rawMsgChgTrEntryShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgChgTrExitLongÂ =Â msgChgTrExitEnabledÂ ?Â sv.eval_vars(rawMsgChgTrExitLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgChgTrExitShortÂ =Â msgChgTrExitEnabledÂ ?Â sv.eval_vars(rawMsgChgTrExitShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgChgSLLongÂ =Â msgChgSLEnabledÂ ?Â sv.eval_vars(rawMsgChgSLLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgChgSLShortÂ =Â msgChgSLEnabledÂ ?Â sv.eval_vars(rawMsgChgSLShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgCnlTrEntryLongÂ =Â msgCnlTrEntryEnabledÂ andÂ doCnlTrEntryLongÂ ?Â sv.eval_vars(rawMsgCnlTrEntryLong,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
msgCnlTrEntryShortÂ =Â msgCnlTrEntryEnabledÂ andÂ doCnlTrEntryShortÂ ?Â sv.eval_vars(rawMsgCnlTrEntryShort,Â variableNames,Â variableValues,Â stringVariableNames,Â stringVariableValues)Â :Â na
//Â signalÂ changeÂ alerts
ifÂ (msgChgTrEntryEnabledÂ andÂ ta.change(longTrEntryPrice))
Â Â Â Â alert(messageÂ =Â msgChgTrEntryLong)
ifÂ (msgChgTrEntryEnabledÂ andÂ ta.change(shortTrEntryPrice))
Â Â Â Â alert(messageÂ =Â msgChgTrEntryShort)
ifÂ (msgChgTrExitEnabledÂ andÂ ta.change(longTrExitPrice))
Â Â Â Â alert(messageÂ =Â msgChgTrExitLong)
Â Â Â Â 
ifÂ (msgChgTrExitEnabledÂ andÂ ta.change(shortTrExitPrice))
Â Â Â Â alert(messageÂ =Â msgChgTrExitShort)
Â Â Â Â 
ifÂ (msgChgSLEnabledÂ andÂ na(longTrEntryPrice)Â andÂ ta.change(longStopLossPrice))
Â Â Â Â alert(messageÂ =Â msgChgSLLong)
Â Â Â Â 
ifÂ (msgChgSLEnabledÂ andÂ na(shortTrEntryPrice)Â andÂ ta.change(shortStopLossPrice))
Â Â Â Â alert(messageÂ =Â msgChgSLShort)
Â Â Â Â 
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸ—²Â POSITIONÂ ORDERSÂ ===============================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ theÂ actualÂ executionÂ ofÂ theÂ strategyÂ orders
//Â Dependencies:Â STRATEGYÂ 1,Â ENTRY,Â STRATEGYÂ 2,Â EXIT,Â STOPÂ LOSS,Â TAKEÂ PROFITÂ 2,Â QUANTITYÂ MANAGEMENT,Â SHAREDÂ VARIABLESÂ 4,Â ALERTÂ MESSAGES
//Â Results:Â NONE
//Â INPUTÂ ============================================================================================================
maxDrawdownÂ =Â input.int(defvalÂ =Â 25,Â titleÂ =Â 'MaxÂ DrawdownÂ %',Â minvalÂ =Â 1,Â maxvalÂ =Â 100,Â tooltipÂ =Â 'TheÂ maximumÂ drawdownÂ toÂ stopÂ trading.',Â groupÂ =Â 'ğŸ’°Â Quantity/RiskÂ Management')
//Â LOGICÂ ============================================================================================================
//Â closeÂ allÂ positionsÂ atÂ theÂ endÂ ofÂ theÂ session
ifÂ (doCloseAll)
Â Â Â Â strategy.close_all(commentÂ =Â showAlertsEnabledÂ ?Â msgClosedAllÂ :Â 'AC',Â alert_messageÂ =Â msgClosedAll)
//Â closeÂ onÂ trendÂ reversalÂ whenÂ notÂ exitÂ trailing
ifÂ (doCloseLong)
Â Â Â Â strategy.close(idÂ =Â 'LongÂ Entry',Â commentÂ =Â showAlertsEnabledÂ ?Â msgClosedLongÂ :Â 'LC',Â alert_messageÂ =Â msgClosedLong)
//Â closeÂ onÂ trendÂ reversalÂ whenÂ notÂ exitÂ trailing
ifÂ (doCloseShort)
Â Â Â Â strategy.close(idÂ =Â 'ShortÂ Entry',Â commentÂ =Â showAlertsEnabledÂ ?Â msgClosedShortÂ :Â 'SC',Â alert_messageÂ =Â msgClosedShort)
//Â gettingÂ intoÂ LONGÂ position
ifÂ (entryTrailingEnabledÂ ?Â longTrEntryIsActiveÂ :Â validOpenLongPosition)
Â Â Â Â strategy.entry(idÂ =Â 'LongÂ Entry',Â directionÂ =Â strategy.long,Â stopÂ =Â longTrEntryPrice,Â qtyÂ =Â longEntryBaseQuantity,Â commentÂ =Â showAlertsEnabledÂ ?Â entryTrailingEnabledÂ ?Â msgEnteredTrLongÂ :Â msgEnteredLongÂ :Â 'LEn',Â alert_messageÂ =Â entryTrailingEnabledÂ ?Â msgEnteredTrLongÂ :Â msgEnteredLong)
//Â cancelÂ existingÂ entryÂ trailingÂ stopÂ ordersÂ (ifÂ any)
ifÂ (doCnlTrEntryLong)
Â Â Â Â strategy.cancel(idÂ =Â 'LongÂ Entry')
Â Â Â Â ifÂ (msgCnlTrEntryEnabled)
Â Â Â Â Â Â Â Â alert(messageÂ =Â msgCnlTrEntryLong)
//Â calculateÂ theÂ tightestÂ stopÂ orderÂ byÂ combiningÂ theÂ stopÂ lossÂ andÂ trailingÂ exitÂ (ifÂ any)
floatÂ longTightestStopÂ =Â na(longTrExitPrice)Â ?Â longStopLossPriceÂ :Â math.max(nz(longTrExitPrice),Â nz(longStopLossPrice))
boolÂ isLongTrailingExitTighterÂ =Â longTrExitIsActiveÂ andÂ longTrExitPriceÂ >Â longStopLossPrice
//Â submitÂ exitÂ orderÂ forÂ trailingÂ takeÂ profitÂ priceÂ alsoÂ setÂ theÂ stopÂ lossÂ forÂ theÂ takeÂ profitÂ percentageÂ inÂ caseÂ thatÂ stopÂ lossÂ isÂ reachedÂ first
//Â submitÂ exitÂ stopÂ orderÂ onÂ trendÂ reversalÂ whenÂ exitÂ trailing
forÂ [i,Â longTakeProfitPrice]Â inÂ longTakeProfitPrices
Â Â Â Â ifÂ (longTrExitIsActiveÂ orÂ (longIsActiveÂ andÂ notÂ array.get(longTrailingTakeProfitExecuted,Â i)))
Â Â Â Â Â Â Â Â alertMessageÂ =Â array.get(msgRchTPLong,Â iÂ %Â array.size(msgRchTPLong))
Â Â Â Â Â Â Â Â commentÂ =Â 'LTP'Â +Â str.tostring(iÂ +Â 1)
Â Â Â Â Â Â Â Â strategy.exit(idÂ =Â 'LongÂ TakeÂ ProfitÂ 'Â +Â str.tostring(iÂ +Â 1)Â +Â 'Â /Â StopÂ LossÂ /Â TrailingÂ Exit',Â from_entryÂ =Â 'LongÂ Entry',Â qty_percentÂ =Â 100.0Â *Â takeProfitQuantityPerc,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â limitÂ =Â takeProfitTrailingEnabledÂ ?Â naÂ :Â longTakeProfitPrice,Â stopÂ =Â longTightestStop,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â trail_priceÂ =Â takeProfitTrailingEnabledÂ ?Â longTakeProfitPriceÂ :Â na,Â trail_offsetÂ =Â takeProfitTrailingEnabledÂ ?Â array.get(longTrailingTakeProfitOffsetTicks,Â i)Â :Â na,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â comment_profitÂ =Â showAlertsEnabledÂ ?Â alertMessageÂ :Â comment,Â comment_lossÂ =Â allTakeProfitsQuantityPercÂ ==Â 1.0Â andÂ iÂ ==Â numOfTakeProfitTargetsÂ -Â 1Â ?Â isLongTrailingExitTighterÂ ?Â msgExitedTrLongÂ :Â msgRchSLLongÂ :Â isLongTrailingExitTighterÂ ?Â 'LTrEx'Â +Â str.tostring(iÂ +Â 1)Â :Â 'LSL'Â +Â str.tostring(iÂ +Â 1),Â comment_trailingÂ =Â showAlertsEnabledÂ ?Â alertMessageÂ :Â comment,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert_profitÂ =Â alertMessage,Â alert_lossÂ =Â allTakeProfitsQuantityPercÂ ==Â 1.0Â andÂ iÂ ==Â numOfTakeProfitTargetsÂ -Â 1Â ?Â isLongTrailingExitTighterÂ ?Â msgExitedTrLongÂ :Â msgRchSLLongÂ :Â na,Â alert_trailingÂ =Â alertMessage)
//Â submitÂ exitÂ orderÂ forÂ trailingÂ stopÂ lossÂ priceÂ forÂ theÂ remainingÂ percentÂ ofÂ theÂ quantityÂ notÂ reservedÂ byÂ theÂ takeÂ profitÂ order
//Â submitÂ exitÂ stopÂ orderÂ onÂ trendÂ reversalÂ whenÂ exitÂ trailing
ifÂ (doSLorExitTrLong)
Â Â Â Â strategy.exit(idÂ =Â 'LongÂ StopÂ LossÂ /Â TrailingÂ Exit',Â from_entryÂ =Â 'LongÂ Entry',Â stopÂ =Â longTightestStop,
Â Â Â Â Â Â Â Â Â Â comment_lossÂ =Â showAlertsEnabledÂ ?Â isLongTrailingExitTighterÂ ?Â msgExitedTrLongÂ :Â msgRchSLLongÂ :Â isLongTrailingExitTighterÂ ?Â 'LTrEx'Â :Â 'LSL',Â alert_lossÂ =Â isLongTrailingExitTighterÂ ?Â msgExitedTrLongÂ :Â msgRchSLLong)
//Â gettingÂ intoÂ SHORTÂ position
ifÂ (entryTrailingEnabledÂ ?Â shortTrEntryIsActiveÂ :Â validOpenShortPosition)
Â Â Â Â strategy.entry(idÂ =Â 'ShortÂ Entry',Â directionÂ =Â strategy.short,Â stopÂ =Â shortTrEntryPrice,Â qtyÂ =Â shortEntryBaseQuantity,Â commentÂ =Â showAlertsEnabledÂ ?Â entryTrailingEnabledÂ ?Â msgEnteredTrShortÂ :Â msgEnteredShortÂ :Â 'SEn',Â alert_messageÂ =Â entryTrailingEnabledÂ ?Â msgEnteredTrShortÂ :Â msgEnteredShort)
//Â cancelÂ existingÂ entryÂ trailingÂ stopÂ ordersÂ (ifÂ any)
ifÂ (doCnlTrEntryShort)
Â Â Â Â strategy.cancel(idÂ =Â 'ShortÂ Entry')
Â Â Â Â ifÂ (msgCnlTrEntryEnabled)
Â Â Â Â Â Â Â Â alert(messageÂ =Â msgCnlTrEntryShort)
//Â calculateÂ theÂ tightestÂ stopÂ orderÂ byÂ combiningÂ theÂ stopÂ lossÂ andÂ trailingÂ exitÂ (ifÂ any)
floatÂ shortTightestStopÂ =Â na(shortTrExitPrice)Â ?Â shortStopLossPriceÂ :Â math.min(nz(shortTrExitPrice,Â 999999.9),Â nz(shortStopLossPrice,Â 999999.9))
boolÂ isShortTrailingExitTighterÂ =Â shortTrExitIsActiveÂ andÂ shortTrExitPriceÂ <Â shortStopLossPrice
//Â submitÂ exitÂ orderÂ forÂ trailingÂ takeÂ profitÂ priceÂ alsoÂ setÂ theÂ stopÂ lossÂ forÂ theÂ takeÂ profitÂ percentageÂ inÂ caseÂ thatÂ stopÂ lossÂ isÂ reachedÂ first
//Â submitÂ exitÂ stopÂ orderÂ onÂ trendÂ reversalÂ whenÂ exitÂ trailing
forÂ [i,Â shortTakeProfitPrice]Â inÂ shortTakeProfitPrices
Â Â Â Â ifÂ (shortTrExitIsActiveÂ orÂ (shortIsActiveÂ andÂ notÂ array.get(shortTrailingTakeProfitExecuted,Â i)))
Â Â Â Â Â Â Â Â alertMessageÂ =Â array.get(msgRchTPShort,Â iÂ %Â array.size(msgRchTPShort))
Â Â Â Â Â Â Â Â commentÂ =Â 'STP'Â +Â str.tostring(iÂ +Â 1)
Â Â Â Â Â Â Â Â strategy.exit(idÂ =Â 'ShortÂ TakeÂ ProfitÂ 'Â +Â str.tostring(iÂ +Â 1)Â +Â 'Â /Â StopÂ LossÂ /Â TrailingÂ Exit',Â from_entryÂ =Â 'ShortÂ Entry',Â qty_percentÂ =Â 100.0Â *Â takeProfitQuantityPerc,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â limitÂ =Â takeProfitTrailingEnabledÂ ?Â naÂ :Â shortTakeProfitPrice,Â stopÂ =Â shortTightestStop,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â trail_priceÂ =Â takeProfitTrailingEnabledÂ ?Â shortTakeProfitPriceÂ :Â na,Â trail_offsetÂ =Â takeProfitTrailingEnabledÂ ?Â array.get(shortTrailingTakeProfitOffsetTicks,Â i)Â :Â na,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â comment_profitÂ =Â showAlertsEnabledÂ ?Â alertMessageÂ :Â comment,Â comment_lossÂ =Â allTakeProfitsQuantityPercÂ ==Â 1.0Â andÂ iÂ ==Â numOfTakeProfitTargetsÂ -Â 1Â ?Â isShortTrailingExitTighterÂ ?Â msgExitedTrShortÂ :Â msgRchSLShortÂ :Â isShortTrailingExitTighterÂ ?Â 'STrEx'Â +Â str.tostring(iÂ +Â 1)Â :Â 'SSL'Â +Â str.tostring(iÂ +Â 1),Â comment_trailingÂ =Â showAlertsEnabledÂ ?Â alertMessageÂ :Â comment,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert_profitÂ =Â alertMessage,Â alert_lossÂ =Â allTakeProfitsQuantityPercÂ ==Â 1.0Â andÂ iÂ ==Â numOfTakeProfitTargetsÂ -Â 1Â ?Â isShortTrailingExitTighterÂ ?Â msgExitedTrShortÂ :Â msgRchSLShortÂ :Â na,Â alert_trailingÂ =Â alertMessage)
//Â submitÂ exitÂ orderÂ forÂ trailingÂ stopÂ lossÂ priceÂ forÂ theÂ remainingÂ percentÂ ofÂ theÂ quantityÂ notÂ reservedÂ byÂ theÂ takeÂ profitÂ order
//Â submitÂ exitÂ stopÂ orderÂ onÂ trendÂ reversalÂ whenÂ exitÂ trailing
ifÂ (doSLorExitTrShort)
Â Â Â Â strategy.exit(idÂ =Â 'ShortÂ StopÂ LossÂ /Â TrailingÂ Exit',Â from_entryÂ =Â 'ShortÂ Entry',Â stopÂ =Â shortTightestStop,
Â Â Â Â Â Â Â Â Â Â comment_lossÂ =Â showAlertsEnabledÂ ?Â isShortTrailingExitTighterÂ ?Â msgExitedTrShortÂ :Â msgRchSLShortÂ :Â isShortTrailingExitTighterÂ ?Â 'STrEx'Â :Â 'SSL',Â alert_lossÂ =Â isShortTrailingExitTighterÂ ?Â msgExitedTrShortÂ :Â msgRchSLShort)
//Â limitÂ theÂ maximumÂ drawdown
strategy.risk.max_drawdown(valueÂ =Â maxDrawdown,Â typeÂ =Â strategy.percent_of_equity,Â alert_messageÂ =Â msgMaxDrawdown)
//
//Â â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
//Â ğŸÂ DEBUGÂ =========================================================================================================
//Â Description:Â ModuleÂ responsibleÂ forÂ plottingÂ additionalÂ informationÂ forÂ debugingÂ purposes
//Â Dependencies:Â ALL
//Â Results:Â showAlertsEnabled,Â debugModeEnabled
//Â INPUTÂ ============================================================================================================
showAlertsEnabledÂ :=Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'ShowÂ Alerts',Â tooltipÂ =Â 'ShowÂ alertÂ messagesÂ thatÂ correspondÂ toÂ eventsÂ inÂ theÂ chart.',Â groupÂ =Â 'ğŸÂ Debug')
debugModeEnabledÂ :=Â input.bool(defvalÂ =Â false,Â titleÂ =Â 'DebugÂ Mode',Â tooltipÂ =Â 'EnableÂ debugÂ mode.',Â groupÂ =Â 'ğŸÂ Debug')
//Â PLOTÂ =============================================================================================================
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â tryEnterLongPositionÂ :Â na,Â titleÂ =Â 'DbgÂ TryÂ EnterÂ Long',Â styleÂ =Â shape.arrowup,Â locationÂ =Â location.belowbar,Â colorÂ =Â color.new(buyColor,Â 70),Â sizeÂ =Â size.tiny)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â tryEnterShortPositionÂ :Â na,Â titleÂ =Â 'DbgÂ TryÂ EnterÂ Short',Â styleÂ =Â shape.arrowdown,Â locationÂ =Â location.abovebar,Â colorÂ =Â color.new(sellColor,Â 70),Â sizeÂ =Â size.tiny)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â longPositionEntryÂ :Â na,Â titleÂ =Â 'DbgÂ LongÂ Entry',Â styleÂ =Â shape.flag,Â locationÂ =Â location.belowbar,Â colorÂ =Â color.new(buyColor,Â 70),Â sizeÂ =Â size.small)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â shortPositionEntryÂ :Â na,Â titleÂ =Â 'DbgÂ ShortÂ Entry',Â styleÂ =Â shape.flag,Â locationÂ =Â location.abovebar,Â colorÂ =Â color.new(sellColor,Â 70),Â sizeÂ =Â size.small)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â longPositionCompletedÂ :Â na,Â titleÂ =Â 'DbgÂ LongÂ Completed',Â styleÂ =Â shape.square,Â locationÂ =Â location.belowbar,Â colorÂ =Â color.new(buyColor,Â 70),Â sizeÂ =Â size.small)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â shortPositionCompletedÂ :Â na,Â titleÂ =Â 'DbgÂ ShortÂ Completed',Â styleÂ =Â shape.square,Â locationÂ =Â location.abovebar,Â colorÂ =Â color.new(sellColor,Â 70),Â sizeÂ =Â size.small)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â longIsActiveÂ :Â na,Â titleÂ =Â 'DbgÂ ActiveÂ Long',Â styleÂ =Â shape.labelup,Â locationÂ =Â location.belowbar,Â colorÂ =Â color.new(buyColor,Â 70),Â sizeÂ =Â size.tiny)
plotshape(seriesÂ =Â debugModeEnabledÂ ?Â shortIsActiveÂ :Â na,Â titleÂ =Â 'DbgÂ ActiveÂ Short',Â styleÂ =Â shape.labeldown,Â locationÂ =Â location.abovebar,Â colorÂ =Â color.new(sellColor,Â 70),Â sizeÂ =Â size.tiny)
plot(seriesÂ =Â debugModeEnabledÂ ?Â entryPriceÂ :Â na,Â titleÂ =Â 'DbgÂ EntryÂ Price',Â colorÂ =Â color.new(posColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 0Â ?Â array.get(longTakeProfitPrices,Â 0)Â :Â na,Â titleÂ =Â 'DbgÂ LongÂ TakeÂ ProfitÂ 1',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 0Â ?Â array.get(shortTakeProfitPrices,Â 0)Â :Â na,Â titleÂ =Â 'DbgÂ ShortÂ TakeÂ ProfitÂ 1',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 1Â ?Â array.get(longTakeProfitPrices,Â 1)Â :Â na,Â titleÂ =Â 'DbgÂ LongÂ TakeÂ ProfitÂ 2',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 1Â ?Â array.get(shortTakeProfitPrices,Â 1)Â :Â na,Â titleÂ =Â 'DbgÂ ShortÂ TakeÂ ProfitÂ 2',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 2Â ?Â array.get(longTakeProfitPrices,Â 2)Â :Â na,Â titleÂ =Â 'DbgÂ LongÂ TakeÂ ProfitÂ 3',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 2Â ?Â array.get(shortTakeProfitPrices,Â 2)Â :Â na,Â titleÂ =Â 'DbgÂ ShortÂ TakeÂ ProfitÂ 3',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 3Â ?Â array.get(longTakeProfitPrices,Â 3)Â :Â na,Â titleÂ =Â 'DbgÂ LongÂ TakeÂ ProfitÂ 4',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 3Â ?Â array.get(shortTakeProfitPrices,Â 3)Â :Â na,Â titleÂ =Â 'DbgÂ ShortÂ TakeÂ ProfitÂ 4',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 4Â ?Â array.get(longTakeProfitPrices,Â 4)Â :Â na,Â titleÂ =Â 'DbgÂ LongÂ TakeÂ ProfitÂ 5',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
plot(seriesÂ =Â debugModeEnabledÂ andÂ array.size(shortTakeProfitPrices)Â >Â 4Â ?Â array.get(shortTakeProfitPrices,Â 4)Â :Â na,Â titleÂ =Â 'DbgÂ ShortÂ TakeÂ ProfitÂ 5',Â colorÂ =Â color.new(takeProfitColor,Â 70),Â linewidthÂ =Â 1,Â styleÂ =Â plot.style_linebr,Â offsetÂ =Â 1)
//Â ==================================================================================================================
Expand (1566 lines)