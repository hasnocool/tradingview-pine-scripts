Script Name: Risk Reward Calculator [lovealgotrading]
Author: lovealgotrading
Description: OVERVIEW: 
 
This Risk Reward Calculator strategy can help you maximize your RR value with help of algorithmic trading.

 
 INDICATOR: 
 
I wanted to setup my trades more easier with this indicator, I didn't want to calculate everytime before orders, with help this indicator we can calculate R:R value, avarage price, stoploss price,  take-profit price, order...
PineScript code:

Pine Scriptâ„¢ strategy
Risk Reward Calculator [lovealgotrading]
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//Â Â©Â Baby_whale_to_moon
//Â IÂ wantÂ toÂ sayÂ thankÂ youÂ toÂ Â©Â EvoCrypto
//@version=5
strategy('RiskÂ RewardÂ Calculator',Â shorttitle='R:R',Â overlay=true,Â max_bars_backÂ =Â 2000,Â pyramidingÂ =Â 4,Â initial_capitalÂ =Â 5000,Â commission_valueÂ =Â 0.1Â ,slippageÂ =Â 1)
//INPUTSÂ -----------------------------------------------------------------------
startDateÂ Â =Â input.time(defval=timestamp('1Â aprÂ 2023Â 13:30Â +0000'),Â title='Start_Date',Â groupÂ =Â "Â #########Â â³Â Â STRATEGYÂ WORKÂ TIMEÂ â³###########"Â )
endDateÂ =Â input.time(defval=timestamp('20Â octÂ Â 2030Â 13:30Â +0000'),Â title='End_Date',Â groupÂ =Â "Â #########Â â³Â Â STRATEGYÂ WORKÂ TIMEÂ â³###########"Â )
inDateRangeÂ Â =Â timeÂ >Â startDateÂ Â andÂ timeÂ <Â endDate
take_profit_levelÂ =Â input.float(0,Â step=0.1,Â minval=0,Â title='TakeÂ ProfitÂ Price',Â groupÂ =Â "Â #########Â âš ï¸Â Â STRATEGYÂ RISKÂ SETTINGSÂ âš ï¸#########")
Stop_LevelÂ =Â input.float(0,Â minval=0,Â step=0.1,Â title='StopÂ LossÂ Price',Â groupÂ =Â "Â #########Â âš ï¸Â Â STRATEGYÂ RISKÂ SETTINGSÂ âš ï¸#########")
Risk_AmountÂ =Â input.float(100,Â minval=0,Â step=0.1,Â title='RiskÂ AmountÂ InÂ Dollar',Â groupÂ =Â "Â #########Â âš ï¸Â Â STRATEGYÂ RISKÂ SETTINGSÂ âš ï¸#########")
AlertÂ =Â input.bool(true,titleÂ =Â "SumÂ ofÂ transactionsÂ weightÂ mustÂ beÂ 100%",Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Price_1_valÂ =Â input.float(0,Â step=0.1,Â minval=0,Â title='EntryÂ PriceÂ One',Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Weight_1Â =Â input.string('NaN',Â 'Â âš–ï¸Â Weight',Â options=['NaN',Â '90Â %',Â '80Â %',Â 'â€¢Â 75Â %',Â '70Â %',Â '60Â %',Â 'â€¢Â 50Â %',Â '40Â %',Â '30Â %',Â 'â€¢Â 25Â %',Â '20Â %',Â '10Â %'],Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Price_2_valÂ =Â input.float(0,Â step=0.1,Â minval=0,Â title='EntryÂ PriceÂ Two',Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Weight_2Â =Â input.string('NaN',Â 'Â âš–ï¸Â Weight',Â options=['NaN',Â '90Â %',Â '80Â %',Â 'â€¢Â 75Â %',Â '70Â %',Â '60Â %',Â 'â€¢Â 50Â %',Â '40Â %',Â '30Â %',Â 'â€¢Â 25Â %',Â '20Â %',Â '10Â %'],Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Price_3_valÂ =Â input.float(0,Â step=0.1,Â minval=0,Â title='EntryÂ PriceÂ Three',Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Weight_3Â =Â input.string('NaN',Â 'Â âš–ï¸Â Weight',Â options=['NaN',Â '90Â %',Â '80Â %',Â 'â€¢Â 75Â %',Â '70Â %',Â '60Â %',Â 'â€¢Â 50Â %',Â '40Â %',Â '30Â %',Â 'â€¢Â 25Â %',Â '20Â %',Â '10Â %'],Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Price_4_valÂ =Â input.float(0,Â step=0.1,Â minval=0,Â title='EntryÂ PriceÂ Four',Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Weight_4Â =Â input.string('NaN',Â 'Â âš–ï¸Â Weight',Â options=['NaN',Â '90Â %',Â '80Â %',Â 'â€¢Â 75Â %',Â '70Â %',Â '60Â %',Â 'â€¢Â 50Â %',Â '40Â %',Â '30Â %',Â 'â€¢Â 25Â %',Â '20Â %',Â '10Â %'],Â groupÂ =Â "Â #########Â â­ï¸Â STRATEGYÂ ENTRYÂ SETTINGSÂ Â â­ï¸########")
Alert_message_missÂ =Â input.bool(true,titleÂ =Â "DON'TÂ FORGETÂ PASTEÂ YOURÂ WEBHOOKÂ URLÂ WHENÂ YOUÂ SETÂ ALERT",Â groupÂ =Â "############Â ğŸ¤–Â ALGOÂ TRADEÂ ALERTSÂ ğŸ¤–Â ############")
Long_messageÂ =Â input("",titleÂ =Â "LongÂ EntryÂ Code",Â groupÂ =Â "############Â ğŸ¤–Â ALGOÂ TRADEÂ ALERTSÂ ğŸ¤–Â ############")
Long_Exit_messageÂ =Â input("",titleÂ =Â "LongÂ Stop-TakeÂ ProfitÂ Code",Â groupÂ =Â "############Â ğŸ¤–Â ALGOÂ TRADEÂ ALERTSÂ ğŸ¤–Â ############")
Short_messageÂ =Â input("",titleÂ =Â "ShortÂ EntryÂ Code",Â groupÂ =Â "############Â ğŸ¤–Â ALGOÂ TRADEÂ ALERTSÂ ğŸ¤–Â ############")
Short_Exit_messageÂ =Â input("",titleÂ =Â "ShortÂ Stop-TakeÂ ProfitÂ Code",Â groupÂ =Â "############Â ğŸ¤–Â ALGOÂ TRADEÂ ALERTSÂ ğŸ¤–Â ############")
Alert_messageÂ =Â input("{{strategy.order.alert_message}}",titleÂ =Â "CodeÂ WhenÂ SetÂ Alert",Â groupÂ =Â "############Â ğŸ¤–Â ALGOÂ TRADEÂ ALERTSÂ ğŸ¤–Â ############")
show_labelÂ =Â input.bool(title='Â Â ShowÂ Labels',defval=true,Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
VisualÂ =Â input.string('AllÂ Timeframes',Â 'CalculatorÂ Visual',Â options=['AllÂ Timeframes',Â 'IntradayÂ Only',Â 'Daily/Weekly/MonthlyÂ Only'],Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
Label_SizeÂ =Â input.string(size.small,Â 'LabelÂ Size',Â options=[size.tiny,Â size.small,Â size.normal,Â size.large,Â size.huge],Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
Show_Real_DistanceÂ =Â input(true,Â title='Real-TimeÂ DistanceÂ InÂ Label',Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
Show_Stop_DistanceÂ =Â input(true,Â title='StopÂ LossÂ DistanceÂ InÂ Label',Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
Show_Order_AmountÂ =Â input(true,Â title='DollarÂ OrderÂ AmountÂ InÂ Label',Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
Show_PriceÂ =Â input(true,Â title='ShowÂ PriceÂ InputsÂ InÂ Label',Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
Use_One_LabelÂ =Â input(false,Â title='ShowÂ AllÂ TextÂ InÂ OneÂ Label',Â groupÂ =Â "Â ############Â ğŸÂ Â LABELÂ SETTINGSÂ Â ğŸÂ ############")
//bgcolor(show_labelÂ andÂ inDateRangeÂ ?Â color.rgb(175,Â 246,Â 255,Â 90)Â :Â naÂ ,Â titleÂ =Â "STRATEGYÂ WORKÂ TIMEÂ BG"Â )
//TIMEFRAMEÂ --------------------------------------------------------------------
TimeframeÂ =Â timeframe.isintradayÂ andÂ VisualÂ ==Â 'IntradayÂ Only'Â orÂ timeframe.isdwmÂ andÂ VisualÂ ==Â 'Daily/Weekly/MonthlyÂ Only'Â orÂ VisualÂ ==Â 'AllÂ Timeframes'
//QUALIFIERSÂ -------------------------------------------------------------------
take_profit_level_TrueÂ =Â TimeframeÂ ?Â take_profit_levelÂ !=Â 0Â :Â na
Stop_TrueÂ =Â TimeframeÂ ?Â Stop_LevelÂ !=Â 0Â :Â na
Price_1_val_TrueÂ =Â TimeframeÂ ?Â Price_1_valÂ !=Â 0Â :Â na
Price_2_val_TrueÂ =Â TimeframeÂ ?Â Price_1_valÂ !=Â 0Â andÂ Price_2_valÂ !=Â 0Â :Â na
Price_3_val_TrueÂ =Â TimeframeÂ ?Â Price_1_valÂ !=Â 0Â andÂ Price_2_valÂ !=Â 0Â andÂ Price_3_valÂ !=Â 0Â :Â na
Price_4_val_TrueÂ =Â TimeframeÂ ?Â Price_1_valÂ !=Â 0Â andÂ Price_2_valÂ !=Â 0Â andÂ Price_3_valÂ !=Â 0Â andÂ Price_4_valÂ !=Â 0Â :Â na
Avg_Price_TrueÂ =Â TimeframeÂ ?Â Price_2_val_TrueÂ orÂ Price_3_val_TrueÂ :Â na
quantity(dolar)Â =>
Â Â Â Â ifÂ closeÂ >Â 5000Â 
Â Â Â Â Â Â Â Â math.round(dolarÂ /Â close,Â 3)
Â Â Â Â elseÂ ifÂ closeÂ <Â 5000Â andÂ closeÂ >Â 200
Â Â Â Â Â Â Â Â math.round(dolarÂ /Â close,Â 2)
Â Â Â Â elseÂ ifÂ closeÂ <Â 200Â andÂ closeÂ >Â 50
Â Â Â Â Â Â Â Â math.round(dolarÂ /Â close,Â 1)
Â Â Â Â elseÂ ifÂ closeÂ <Â 50
Â Â Â Â Â Â Â Â math.round(dolarÂ /Â close,Â 0)
//PRICEÂ 1Â ----------------------------------------------------------------------
Weight_One_OptionsÂ =Â Weight_1Â ==Â 'NaN'Â ?Â 1Â :Â Weight_1Â ==Â '90Â %'Â ?Â 0.90Â :Â Weight_1Â ==Â '80Â %'Â ?Â 0.80Â :Â Weight_1Â ==Â 'â€¢Â 75Â %'Â ?Â 0.75Â :Â Weight_1Â ==Â '70Â %'Â ?Â 0.70Â :Â Weight_1Â ==Â '60Â %'Â ?Â 0.60Â :Â Weight_1Â ==Â 'â€¢Â 50Â %'Â ?Â 0.50Â :Â Weight_1Â ==Â '40Â %'Â ?Â 0.40Â :Â Weight_1Â ==Â '30Â %'Â ?Â 0.30Â :Â Weight_1Â ==Â 'â€¢Â 25Â %'Â ?Â 0.25Â :Â Weight_1Â ==Â '20Â %'Â ?Â 0.20Â :Â Weight_1Â ==Â '10Â %'Â ?Â 0.10Â :Â na
Weight_OneÂ =Â Price_1_valÂ *Â Weight_One_Options
Real_Price_1_val_DistanceÂ =Â Price_1_val_TrueÂ andÂ closeÂ >Â Price_1_valÂ ?Â (closeÂ -Â Price_1_val)Â /Â closeÂ *Â 100Â :Â Price_1_val_TrueÂ andÂ closeÂ <Â Price_1_valÂ ?Â (Price_1_valÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
//PRICEÂ 2Â ----------------------------------------------------------------------
Weight_Two_OptionsÂ =Â Weight_2Â ==Â 'NaN'Â ?Â 1Â :Â Weight_2Â ==Â '90Â %'Â ?Â 0.90Â :Â Weight_2Â ==Â '80Â %'Â ?Â 0.80Â :Â Weight_2Â ==Â 'â€¢Â 75Â %'Â ?Â 0.75Â :Â Weight_2Â ==Â '70Â %'Â ?Â 0.70Â :Â Weight_2Â ==Â '60Â %'Â ?Â 0.60Â :Â Weight_2Â ==Â 'â€¢Â 50Â %'Â ?Â 0.50Â :Â Weight_2Â ==Â '40Â %'Â ?Â 0.40Â :Â Weight_2Â ==Â '30Â %'Â ?Â 0.30Â :Â Weight_2Â ==Â 'â€¢Â 25Â %'Â ?Â 0.25Â :Â Weight_2Â ==Â '20Â %'Â ?Â 0.20Â :Â Weight_2Â ==Â '10Â %'Â ?Â 0.10Â :Â na
Weight_TwoÂ =Â Price_2_valÂ *Â Weight_Two_Options
Real_Price_2_val_DistanceÂ =Â Price_2_val_TrueÂ andÂ closeÂ >Â Price_2_valÂ ?Â (closeÂ -Â Price_2_val)Â /Â closeÂ *Â 100Â :Â Price_2_val_TrueÂ andÂ closeÂ <Â Price_2_valÂ ?Â (Price_2_valÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
//PRICEÂ 3Â ----------------------------------------------------------------------
Weight_Three_OptionsÂ =Â Weight_3Â ==Â 'NaN'Â ?Â 1Â :Â Weight_3Â ==Â '90Â %'Â ?Â 0.90Â :Â Weight_3Â ==Â '80Â %'Â ?Â 0.80Â :Â Weight_3Â ==Â 'â€¢Â 75Â %'Â ?Â 0.75Â :Â Weight_3Â ==Â '70Â %'Â ?Â 0.70Â :Â Weight_3Â ==Â '60Â %'Â ?Â 0.60Â :Â Weight_3Â ==Â 'â€¢Â 50Â %'Â ?Â 0.50Â :Â Weight_3Â ==Â '40Â %'Â ?Â 0.40Â :Â Weight_3Â ==Â '30Â %'Â ?Â 0.30Â :Â Weight_3Â ==Â 'â€¢Â 25Â %'Â ?Â 0.25Â :Â Weight_3Â ==Â '20Â %'Â ?Â 0.20Â :Â Weight_3Â ==Â '10Â %'Â ?Â 0.10Â :Â na
Weight_ThreeÂ =Â Price_3_valÂ *Â Weight_Three_Options
Real_Price_3_val_DistanceÂ =Â Price_3_val_TrueÂ andÂ closeÂ >Â Price_3_valÂ ?Â (closeÂ -Â Price_3_val)Â /Â closeÂ *Â 100Â :Â Price_3_val_TrueÂ andÂ closeÂ <Â Price_3_valÂ ?Â (Price_3_valÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
//PRICEÂ 4Â ----------------------------------------------------------------------
Weight_Four_OptionsÂ =Â Weight_4Â ==Â 'NaN'Â ?Â 1Â :Â Weight_4Â ==Â '90Â %'Â ?Â 0.90Â :Â Weight_4Â ==Â '80Â %'Â ?Â 0.80Â :Â Weight_4Â ==Â 'â€¢Â 75Â %'Â ?Â 0.75Â :Â Weight_4Â ==Â '70Â %'Â ?Â 0.70Â :Â Weight_4Â ==Â '60Â %'Â ?Â 0.60Â :Â Weight_4Â ==Â 'â€¢Â 50Â %'Â ?Â 0.50Â :Â Weight_4Â ==Â '40Â %'Â ?Â 0.40Â :Â Weight_4Â ==Â '30Â %'Â ?Â 0.30Â :Â Weight_4Â ==Â 'â€¢Â 25Â %'Â ?Â 0.25Â :Â Weight_4Â ==Â '20Â %'Â ?Â 0.20Â :Â Weight_4Â ==Â '10Â %'Â ?Â 0.10Â :Â na
Weight_FourÂ =Â Price_4_valÂ *Â Weight_Four_Options
Real_Price_4_val_DistanceÂ =Â Price_4_val_TrueÂ andÂ closeÂ >Â Price_4_valÂ ?Â (closeÂ -Â Price_4_val)Â /Â closeÂ *Â 100Â :Â Price_4_val_TrueÂ andÂ closeÂ <Â Price_4_valÂ ?Â (Price_4_valÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
//AVERAGEÂ PRICEÂ ----------------------------------------------------------------
Avg_2_TrueÂ =Â Weight_1Â ==Â 'NaN'Â andÂ Weight_2Â ==Â 'NaN'
Avg_3_TrueÂ =Â Weight_1Â ==Â 'NaN'Â andÂ Weight_2Â ==Â 'NaN'Â andÂ Weight_3Â ==Â 'NaN'
Avg_4_TrueÂ =Â Weight_1Â ==Â 'NaN'Â andÂ Weight_2Â ==Â 'NaN'Â andÂ Weight_3Â ==Â 'NaN'Â andÂ Weight_4Â ==Â 'NaN'
Avg_PriceÂ =Â Price_2_val_TrueÂ andÂ Avg_2_TrueÂ andÂ Price_3_valÂ ==Â 0Â andÂ Price_4_valÂ ==Â 0Â ?Â math.avg(Price_1_val,Â Price_2_val)Â :Â Price_3_val_TrueÂ andÂ Avg_3_TrueÂ ?Â math.avg(Price_1_val,Â Price_2_val,Â Price_3_val)Â :Â Price_4_val_TrueÂ andÂ Avg_4_TrueÂ ?Â math.avg(Price_1_val,Â Price_2_val,Â Price_3_val,Â Price_4_val)Â :Â Weight_OneÂ +Â Weight_TwoÂ +Â Weight_ThreeÂ +Â Weight_Four
Real_Avg_Price_DistanceÂ =Â Avg_Price_TrueÂ andÂ closeÂ >Â Avg_PriceÂ ?Â (closeÂ -Â Avg_Price)Â /Â closeÂ *Â 100Â :Â Avg_Price_TrueÂ andÂ closeÂ <Â Avg_PriceÂ ?Â (Avg_PriceÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
//POSITIONÂ SETTINGSÂ ------------------------------------------------------------
Real_Stop_DistanceÂ =Â Stop_TrueÂ andÂ closeÂ >Â Stop_LevelÂ ?Â (closeÂ -Â Stop_Level)Â /Â closeÂ *Â 100Â :Â Stop_TrueÂ andÂ closeÂ <Â Stop_LevelÂ ?Â (Stop_LevelÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
Stop_DistanceÂ =Â Avg_PriceÂ !=Â 0Â andÂ Stop_TrueÂ andÂ Avg_PriceÂ >Â Stop_LevelÂ ?Â (Avg_PriceÂ -Â Stop_Level)Â /Â Avg_PriceÂ *Â 100Â :Â Avg_PriceÂ !=Â 0Â andÂ Stop_TrueÂ andÂ Avg_PriceÂ <Â Stop_LevelÂ ?Â (Stop_LevelÂ -Â Avg_Price)Â /Â Avg_PriceÂ *Â 100Â :Â Real_Stop_Distance
Real_TP_DistanceÂ =Â take_profit_level_TrueÂ andÂ closeÂ >Â take_profit_levelÂ ?Â (closeÂ -Â take_profit_level)Â /Â closeÂ *Â 100Â :Â take_profit_level_TrueÂ andÂ closeÂ <Â take_profit_levelÂ ?Â (take_profit_levelÂ -Â close)Â /Â closeÂ *Â 100Â :Â na
TP_DistanceÂ =Â Avg_PriceÂ !=Â 0Â andÂ take_profit_level_TrueÂ andÂ Avg_PriceÂ >Â take_profit_levelÂ ?Â (Avg_PriceÂ -Â take_profit_level)Â /Â Avg_PriceÂ *Â 100Â :Â Avg_PriceÂ !=Â 0Â andÂ take_profit_level_TrueÂ andÂ Avg_PriceÂ <Â take_profit_levelÂ ?Â (take_profit_levelÂ -Â Avg_Price)Â /Â Avg_PriceÂ *Â 100Â :Â Real_TP_Distance
Position_SizeÂ =Â Risk_AmountÂ /Â Stop_DistanceÂ *Â 100
Order_OneÂ =Â Weight_1Â !=Â 'NaN'Â ?Â Position_SizeÂ *Â Weight_One_OptionsÂ :Â Weight_1Â ==Â 'NaN'Â andÂ Price_2_valÂ ==Â 0Â andÂ Price_3_valÂ ==Â 0Â ?Â Position_SizeÂ :Â Weight_1Â ==Â 'NaN'Â andÂ Price_2_val_TrueÂ andÂ Price_3_valÂ ==Â 0Â ?Â Position_SizeÂ /Â 2Â :Â Weight_1Â ==Â 'NaN'Â andÂ Price_3_val_TrueÂ ?Â Position_SizeÂ /Â 3Â :Â Weight_1Â ==Â 'NaN'Â andÂ Price_4_val_TrueÂ ?Â Position_SizeÂ /Â 4Â :Â na
Order_TwoÂ =Â Weight_2Â !=Â 'NaN'Â ?Â Position_SizeÂ *Â Weight_Two_OptionsÂ :Â Weight_2Â ==Â 'NaN'Â andÂ Price_2_val_TrueÂ andÂ Price_3_valÂ ==Â 0Â ?Â Position_SizeÂ /Â 2Â :Â Weight_2Â ==Â 'NaN'Â andÂ Price_3_val_TrueÂ ?Â Position_SizeÂ /Â 3Â :Â Weight_2Â ==Â 'NaN'Â andÂ Price_4_val_TrueÂ ?Â Position_SizeÂ /Â 4Â :Â na
Order_ThreeÂ =Â Weight_3Â !=Â 'NaN'Â ?Â Position_SizeÂ *Â Weight_Three_OptionsÂ :Â Weight_3Â ==Â 'NaN'Â andÂ Price_3_val_TrueÂ ?Â Position_SizeÂ /Â 3Â :Â Weight_3Â ==Â 'NaN'Â andÂ Price_4_val_TrueÂ ?Â Position_SizeÂ /Â 4Â :Â na
Order_FourÂ =Â Weight_4Â !=Â 'NaN'Â ?Â Position_SizeÂ *Â Weight_Four_OptionsÂ :Â Weight_4Â ==Â 'NaN'Â andÂ Price_4_val_TrueÂ ?Â Position_SizeÂ /Â 4Â :Â na
//LABELÂ LOCATIONSÂ --------------------------------------------------------------
Stop_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â (Price_3_val_TrueÂ ?Â 115Â :Â Price_2_val_TrueÂ ?Â 95Â :Â Price_1_val_TrueÂ ?Â 75Â :Â 55))
Price_1_val_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â 15Â )
Price_2_val_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â 35)
Price_3_val_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â 55)
Price_4_val_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â 75)
Avg_Price_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â (Price_3_val_TrueÂ ?Â 115Â :Â Price_2_val_TrueÂ ?Â 95Â :Â Price_1_val_TrueÂ ?Â 75Â :Â 55))
One_Label_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â 50)
take_profit_level_LocationÂ =Â timenowÂ +Â math.round(ta.change(time)Â *Â (Price_3_val_TrueÂ ?Â 115Â :Â Price_2_val_TrueÂ ?Â 95Â :Â Price_1_val_TrueÂ ?Â 75Â :Â 55))
//COLORSÂ -----------------------------------------------------------------------
Stop_ColorÂ =Â #b71c1c
Price_ColorÂ =Â #0011ff
Label_ColorÂ =Â #2db3fb
Text_ColorÂ =Â #000000
//TakeÂ ProfitÂ PLOTÂ ---------------------------------------------------------------
Take_Profit_LineÂ =Â take_profit_level_TrueÂ ?Â line.new(x1=startDate,Â y1=take_profit_level,Â x2=endDate,Â y2=take_profit_level,Â style=line.style_dashed,Â xlocÂ =Â xloc.bar_time,Â width=2,Â color=color.lime)Â :Â na
line.delete(Take_Profit_Line[1])
plot(take_profit_level_TrueÂ ?Â take_profit_levelÂ :Â na,Â title='TakeÂ Profit',Â color=color.new(color.lime,Â 100))
Take_Profit_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Avg_PriceÂ !=Â 0Â andÂ take_profit_level_TrueÂ andÂ Avg_PriceÂ <Â take_profit_levelÂ orÂ Avg_PriceÂ ==Â 0Â andÂ take_profit_level_TrueÂ andÂ closeÂ <Â take_profit_levelÂ andÂ show_labelÂ andÂ show_labelÂ ?Â label.new(x=take_profit_level_Location,Â y=take_profit_level,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=color.lime,Â textcolor=Text_Color,Â size=Label_Size,Â text='TPÂ Long'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_TP_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'TakeProfitÂ â†’Â 'Â +Â str.tostring(TP_Distance,Â '0.00')Â +Â 'Â %'Â +Â '\n'Â +Â 'WinÂ $Â â†’Â 'Â +Â str.tostring(Position_SizeÂ *Â TP_DistanceÂ /Â 100,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(take_profit_level)Â :Â na))Â :Â Avg_PriceÂ !=Â 0Â andÂ take_profit_level_TrueÂ andÂ Avg_PriceÂ >Â take_profit_levelÂ orÂ Avg_PriceÂ ==Â 0Â andÂ take_profit_level_TrueÂ andÂ closeÂ >Â take_profit_levelÂ andÂ show_labelÂ ?Â label.new(x=take_profit_level_Location,Â y=take_profit_level,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=color.lime,Â textcolor=Text_Color,Â size=Label_Size,Â text='TPÂ Short'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_TP_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'TakeProfitÂ â†’Â 'Â +Â str.tostring(TP_Distance,Â '0.00')Â +Â 'Â %'Â +Â '\n'Â +Â 'WinÂ $Â â†’Â 'Â +Â str.tostring(Position_SizeÂ *Â TP_DistanceÂ /Â 100,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Stop_Level)Â :Â na))Â :Â na
label.delete(Take_Profit_Label[1])
//STOPÂ LOSSÂ PLOTÂ ---------------------------------------------------------------
Stop_LineÂ =Â Stop_TrueÂ ?Â line.new(x1=startDate,Â y1=Stop_Level,Â x2=endDate,Â y2=Stop_Level,Â style=line.style_dashed,xlocÂ =Â xloc.bar_time,Â width=2,Â color=Stop_Color)Â :Â na
line.delete(Stop_Line[1])
plot(Stop_TrueÂ ?Â Stop_LevelÂ :Â na,Â title='StopÂ Loss',Â color=color.new(Stop_Color,Â 100))
Stop_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Avg_PriceÂ !=Â 0Â andÂ Stop_TrueÂ andÂ Avg_PriceÂ >Â Stop_LevelÂ orÂ Avg_PriceÂ ==Â 0Â andÂ Stop_TrueÂ andÂ closeÂ >Â Stop_LevelÂ andÂ show_labelÂ ?Â label.new(x=Stop_Location,Â y=Stop_Level,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=color.red,Â textcolor=Text_Color,Â size=Label_Size,Â text='StopÂ LONG'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Stop_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'StopLossÂ â†’Â 'Â +Â str.tostring(Stop_Distance,Â '0.00')Â +Â 'Â %'Â +Â '\n'Â +Â 'LossÂ $Â â†’Â 'Â +Â str.tostring(Position_SizeÂ *Â Stop_DistanceÂ /Â 100,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Stop_Level)Â :Â na))Â :Â Avg_PriceÂ !=Â 0Â andÂ Stop_TrueÂ andÂ Avg_PriceÂ <Â Stop_LevelÂ orÂ Avg_PriceÂ ==Â 0Â andÂ Stop_TrueÂ andÂ closeÂ <Â Stop_LevelÂ andÂ show_labelÂ ?Â label.new(x=Stop_Location,Â y=Stop_Level,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=color.red,Â textcolor=Text_Color,Â size=Label_Size,Â text='StopÂ SHORT'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Stop_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'StopLossÂ â†’Â 'Â +Â str.tostring(Stop_Distance,Â '0.00')Â +Â 'Â %'Â +Â '\n'Â +Â 'LossÂ $Â â†’Â 'Â +Â str.tostring(Position_SizeÂ *Â Stop_DistanceÂ /Â 100,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Stop_Level)Â :Â na))Â :Â na
label.delete(Stop_Label[1])
//PRICEÂ 1Â PLOTÂ -----------------------------------------------------------------
Price_1_val_LineÂ =Â Price_1_val_TrueÂ ?Â line.new(x1=startDate,Â y1=Price_1_val,Â x2=endDate,Â y2=Price_1_val,xlocÂ =Â xloc.bar_time,Â color=Price_Color)Â :Â na
line.delete(Price_1_val_Line[1])
plot(Price_1_val_TrueÂ ?Â Price_1_valÂ :Â na,Â title='PriceÂ One',Â color=color.new(Price_Color,Â 100))
Price_1_val_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Price_1_val_TrueÂ andÂ closeÂ >Â Price_1_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_1_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ <Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_1_val_Location,Â y=Price_1_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(1)Â 'Â +Â (trueÂ ?Â 'BuyÂ â†’Â 'Â +Â str.tostring(Order_One,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_1)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_1_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_1_val)Â :Â na))Â :Â Price_1_val_TrueÂ andÂ closeÂ <Â Price_1_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_1_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ >Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_1_val_Location,Â y=Price_1_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(1)Â 'Â +Â (trueÂ ?Â 'SellÂ â†’Â 'Â +Â str.tostring(Order_One,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_1)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_1_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_1_val)Â :Â na))Â :Â na
label.delete(Price_1_val_Label[1])
//PRICEÂ 2Â PLOTÂ -----------------------------------------------------------------
Price_2_val_LineÂ =Â Price_2_val_TrueÂ ?Â line.new(x1=startDate,Â y1=Price_2_val,Â x2=endDate,Â y2=Price_2_val,xlocÂ =Â xloc.bar_time,Â color=Price_Color)Â :Â na
line.delete(Price_2_val_Line[1])
plot(Price_2_val_TrueÂ ?Â Price_2_valÂ :Â na,Â title='PriceÂ Two',Â color=color.new(Price_Color,Â 100))
Price_2_val_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Price_2_val_TrueÂ andÂ closeÂ >Â Price_2_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_2_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ <Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_2_val_Location,Â y=Price_2_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(2)Â 'Â +Â (trueÂ ?Â 'BuyÂ â†’Â 'Â +Â str.tostring(Order_Two,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_2)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_2_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_2_val)Â :Â na))Â :Â Price_2_val_TrueÂ andÂ closeÂ <Â Price_2_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_2_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ >Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_2_val_Location,Â y=Price_2_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(2)Â 'Â +Â (trueÂ ?Â 'SellÂ â†’Â 'Â +Â str.tostring(Order_Two,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_2)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_2_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_2_val)Â :Â na))Â :Â na
label.delete(Price_2_val_Label[1])
//PRICEÂ 3Â PLOTÂ -----------------------------------------------------------------
Price_3_val_LineÂ =Â Price_3_val_TrueÂ ?Â line.new(x1=startDate,Â y1=Price_3_val,Â x2=endDate,Â y2=Price_3_val,xlocÂ =Â xloc.bar_time,Â color=Price_Color)Â :Â na
line.delete(Price_3_val_Line[1])
plot(Price_3_val_TrueÂ ?Â Price_3_valÂ :Â na,Â title='PriceÂ Three',Â color=color.new(Price_Color,Â 100))
Price_3_val_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Price_3_val_TrueÂ andÂ closeÂ >Â Price_3_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_3_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ <Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_3_val_Location,Â y=Price_3_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(3)Â 'Â +Â (trueÂ ?Â 'BuyÂ â†’Â 'Â +Â str.tostring(Order_Three,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_3)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_3_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_3_val)Â :Â na))Â :Â Price_3_val_TrueÂ andÂ closeÂ <Â Price_3_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_3_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ >Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_3_val_Location,Â y=Price_3_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(3)Â 'Â +Â (trueÂ ?Â 'SellÂ â†’Â 'Â +Â str.tostring(Order_Three,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_3)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_3_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_3_val)Â :Â na))Â :Â na
label.delete(Price_3_val_Label[1])
//PRICEÂ 4Â PLOTÂ -----------------------------------------------------------------
Price_4_val_LineÂ =Â Price_4_val_TrueÂ ?Â line.new(x1=startDate,Â y1=Price_4_val,Â x2=endDate,Â y2=Price_4_val,xlocÂ =Â xloc.bar_time,Â color=Price_Color)Â :Â na
line.delete(Price_4_val_Line[1])
plot(Price_4_val_TrueÂ ?Â Price_4_valÂ :Â na,Â title='PriceÂ Four',Â color=color.new(Price_Color,Â 100))
Price_4_val_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Price_4_val_TrueÂ andÂ closeÂ >Â Price_4_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_4_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ <Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_4_val_Location,Â y=Price_4_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(4)Â 'Â +Â (trueÂ ?Â 'BuyÂ â†’Â 'Â +Â str.tostring(Order_Four,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_4)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_4_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_4_val)Â :Â na))Â :Â Price_4_val_TrueÂ andÂ closeÂ <Â Price_4_valÂ andÂ Stop_LevelÂ ==Â 0Â orÂ Price_4_val_TrueÂ andÂ Stop_TrueÂ andÂ Stop_LevelÂ >Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Price_4_val_Location,Â y=Price_4_val,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='(4)Â 'Â +Â (trueÂ ?Â 'SellÂ â†’Â 'Â +Â str.tostring(Order_Four,Â '#Â $')Â +Â '\n'Â +Â 'OpenÂ PositionÂ â†’Â 'Â +Â str.tostring(Weight_4)Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_4_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_4_val)Â :Â na))Â :Â na
label.delete(Price_4_val_Label[1])
//AVERAGEÂ PRICEÂ PLOTÂ -----------------------------------------------------------
Avg_Price_LineÂ =Â Avg_Price_TrueÂ ?Â line.new(x1=startDate,Â y1=Avg_Price,Â x2=endDate,Â y2=Avg_Price,Â style=line.style_dashed,xlocÂ =Â xloc.bar_time,Â color=color.yellow)Â :Â na
line.delete(Avg_Price_Line[1])
plot(Avg_Price_TrueÂ ?Â Avg_PriceÂ :Â na,Â title='AverageÂ Price',Â color=color.new(color.yellow,Â 100))
Avg_Price_LabelÂ =Â Use_One_LabelÂ ?Â naÂ :Â Avg_Price_TrueÂ andÂ closeÂ >Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Avg_Price_Location,Â y=Avg_Price,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=color.yellow,Â textcolor=Text_Color,Â size=Label_Size,Â text='AVRÂ PriceÂ â†’Â 'Â +Â str.tostring(Avg_Price)Â Â +Â '\n'Â +Â 'Â R:RÂ â†’Â 'Â +Â str.tostring(TP_DistanceÂ /Â Stop_Distance,Â '0.00')Â +Â '\n'Â +Â 'AllÂ PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $')Â :Â Avg_Price_TrueÂ andÂ closeÂ <Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=Avg_Price_Location,Â y=Avg_Price,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=color.yellow,Â textcolor=Text_Color,Â size=Label_Size,Â text='AVRÂ PriceÂ â†’Â 'Â +Â str.tostring(Avg_Price)Â Â +Â '\n'Â +Â 'Â R:RÂ â†’Â 'Â +Â str.tostring(TP_DistanceÂ /Â Stop_Distance,Â '0.00')Â +Â '\n'Â +Â 'AllÂ PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $')Â :Â na
label.delete(Avg_Price_Label[1])
//ONEÂ LABELÂ --------------------------------------------------------------------
One_LabelÂ =Â Use_One_LabelÂ andÂ Avg_PriceÂ !=Â 0Â andÂ Stop_TrueÂ andÂ Avg_PriceÂ >Â Stop_LevelÂ orÂ Use_One_LabelÂ andÂ Avg_PriceÂ ==Â 0Â andÂ Stop_TrueÂ andÂ closeÂ >Â Stop_LevelÂ orÂ Use_One_LabelÂ andÂ Stop_LevelÂ ==Â 0Â andÂ Avg_Price_TrueÂ andÂ closeÂ >Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=One_Label_Location,Â y=close,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_up,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='TPÂ Long'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_TP_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'TakeProfitÂ â†’Â 'Â +Â str.tostring(TP_Distance,Â '0.00')Â +Â 'Â %'Â +Â '\n'Â +Â 'WinÂ $Â â†’Â 'Â +Â str.tostring(Position_SizeÂ *Â TP_DistanceÂ /Â 100,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(take_profit_level)Â :Â na)Â +Â Â '\n\n\n'Â +'R:RÂ â†’Â 'Â +Â str.tostring(TP_DistanceÂ /Â Stop_Distance,Â '0.00')Â +Â '\n'Â +Â 'AllÂ PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â +Â '\n\n'+(Price_1_val_TrueÂ ?Â 'PriceÂ 1'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'OrderÂ â†’Â 'Â +Â str.tostring(Order_One,Â '#Â $')Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_1_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_1_val)Â :Â na)Â :Â na)Â +Â (Price_2_val_TrueÂ ?Â '\n\nÂ PriceÂ 2'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'OrderÂ â†’Â 'Â +Â str.tostring(Order_Two,Â '#Â $')Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_2_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_2_val)Â :Â na)Â :Â na)Â +Â (Price_3_val_TrueÂ ?Â '\n\nÂ PriceÂ 3'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'OrderÂ â†’Â 'Â +Â str.tostring(Order_Three,Â '#Â $')Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_3_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_3_val)Â :Â na)Â :Â na)Â +Â (Avg_Price_TrueÂ ?Â '\n\nÂ AverageÂ Price'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Avg_Price_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Avg_Price)Â :Â na)Â :Â na)Â +Â (Stop_TrueÂ ?Â '\n\nÂ StopÂ Loss'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Stop_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'StopLossÂ â†’Â 'Â +Â str.tostring(Stop_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Stop_Level)Â :Â na)Â :Â na))Â :Â Use_One_LabelÂ andÂ Avg_PriceÂ !=Â 0Â andÂ Stop_TrueÂ andÂ Avg_PriceÂ <Â Stop_LevelÂ orÂ Use_One_LabelÂ andÂ Avg_PriceÂ ==Â 0Â andÂ Stop_TrueÂ andÂ closeÂ <Â Stop_LevelÂ orÂ Use_One_LabelÂ andÂ Stop_LevelÂ ==Â 0Â andÂ Avg_Price_TrueÂ andÂ closeÂ <Â Avg_PriceÂ andÂ show_labelÂ ?Â label.new(x=One_Label_Location,Â y=close,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â style=label.style_label_down,Â color=Label_Color,Â textcolor=Text_Color,Â size=Label_Size,Â text='TPÂ Short'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_TP_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'TakeProfitÂ â†’Â 'Â +Â str.tostring(TP_Distance,Â '0.00')Â +Â 'Â %'Â +Â '\n'Â +Â 'WinÂ $Â â†’Â 'Â +Â str.tostring(Position_SizeÂ *Â TP_DistanceÂ /Â 100,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(take_profit_level)Â :Â na)Â +Â Â '\n\n'Â +Â (Stop_TrueÂ ?Â 'StopÂ Loss'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Stop_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Stop_DistanceÂ ?Â '\n'Â +Â 'StopLossÂ â†’Â 'Â +Â str.tostring(Stop_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Stop_Level)Â :Â na)Â :Â na)Â +Â (Avg_Price_TrueÂ ?Â '\n\nÂ AverageÂ Price'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Avg_Price_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Avg_Price)Â :Â na)Â :Â na)Â +Â (Price_3_val_TrueÂ ?Â '\n\nÂ PriceÂ 3'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'OrderÂ â†’Â 'Â +Â str.tostring(Order_Three,Â '#Â $')Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_3_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_3_val)Â :Â na)Â :Â na)Â +Â (Price_2_val_TrueÂ ?Â '\n\nÂ PriceÂ 2'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'OrderÂ â†’Â 'Â +Â str.tostring(Order_Two,Â '#Â $')Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_2_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_2_val)Â :Â na)Â :Â na)Â Â +Â (Price_1_val_TrueÂ ?Â '\n\nÂ PriceÂ 1'Â +Â '\nâ€”â€”â€”â€”â€”â€”â€”'Â +Â (Show_Order_AmountÂ ?Â '\n'Â +Â 'OrderÂ â†’Â 'Â +Â str.tostring(Order_One,Â '#Â $')Â :Â na)Â +Â (Show_Real_DistanceÂ ?Â '\n'Â +Â 'DistanceÂ â†’Â 'Â +Â str.tostring(Real_Price_1_val_Distance,Â '0.00')Â +Â 'Â %'Â :Â na)Â +Â (Show_PriceÂ ?Â '\n'Â +Â 'PriceÂ â†’Â 'Â +Â str.tostring(Price_1_val)Â :Â na)Â +Â '\n\n\n'Â +'R:RÂ â†’Â 'Â +Â str.tostring(TP_DistanceÂ /Â Stop_Distance,Â '0.00')Â +Â '\n'Â +Â 'AllÂ PositionÂ â†’Â 'Â +Â str.tostring(Position_Size,Â '#')Â +Â 'Â $'Â Â :Â na))Â :Â na
label.delete(One_Label[1])
//Â StrategyÂ entriesÂ LONG
ifÂ strategy.opentradesÂ ==Â 0Â andÂ inDateRangeÂ Â andÂ Avg_PriceÂ <Â take_profit_levelÂ Â andÂ Weight_1Â !=Â 'NaN'Â andÂ Price_1_val_TrueÂ andÂ close[1]Â >Â Price_1_val
Â Â Â Â strategy.entry('Long_Open',Â strategy.long,Â qty=Â quantity(Order_One),Â limitÂ =Â Price_1_val,Â alert_messageÂ =Â Long_message)
ifÂ strategy.opentradesÂ ==Â 1Â andÂ inDateRangeÂ andÂ Avg_PriceÂ <Â take_profit_levelÂ andÂ Weight_2Â !=Â 'NaN'Â andÂ Price_2_val_TrueÂ andÂ Â close[1]Â >Â Price_2_val
Â Â Â Â strategy.entry('Long_Open',Â strategy.long,Â qty=Â quantity(Order_Two),Â limitÂ =Â Price_2_val,Â alert_messageÂ =Â Long_message)
ifÂ strategy.opentradesÂ ==Â 2Â andÂ inDateRangeÂ andÂ Avg_PriceÂ <Â take_profit_levelÂ andÂ Weight_3Â !=Â 'NaN'Â andÂ Price_3_val_TrueÂ andÂ close[1]Â >Â Price_3_val
Â Â Â Â strategy.entry('Long_Open',Â strategy.long,Â qty=Â quantity(Order_Three),Â limitÂ =Â Price_3_val,Â alert_messageÂ =Â Long_message)
ifÂ strategy.opentradesÂ ==Â 3Â andÂ inDateRangeÂ andÂ Avg_PriceÂ <Â take_profit_levelÂ andÂ Weight_4Â !=Â 'NaN'Â andÂ Price_4_val_TrueÂ andÂ close[1]Â >Â Price_4_val
Â Â Â Â strategy.entry('Long_Open',Â strategy.long,Â qty=Â quantity(Order_Four),Â limitÂ =Â Price_4_val,Â alert_messageÂ =Â Long_message)
//Â StrategyÂ entriesÂ SHORT
ifÂ strategy.opentradesÂ ==Â 0Â andÂ inDateRangeÂ Â andÂ Avg_PriceÂ >Â take_profit_levelÂ Â andÂ Weight_1Â !=Â 'NaN'Â andÂ Price_1_val_TrueÂ andÂ close[1]Â <Â Price_1_val
Â Â Â Â strategy.entry('Short_Open',Â strategy.short,Â qty=Â quantity(Order_One),Â limitÂ =Â Price_1_val,Â alert_messageÂ =Â Short_message)
ifÂ strategy.opentradesÂ ==Â 1Â andÂ inDateRangeÂ andÂ Avg_PriceÂ >Â take_profit_levelÂ andÂ Weight_2Â !=Â 'NaN'Â andÂ Price_2_val_TrueÂ andÂ Â close[1]Â <Â Price_2_val
Â Â Â Â strategy.entry('Short_Open',Â strategy.short,Â qty=Â quantity(Order_Two),Â limitÂ =Â Price_2_val,Â alert_messageÂ =Â Short_message)
ifÂ strategy.opentradesÂ ==Â 2Â andÂ inDateRangeÂ andÂ Avg_PriceÂ >Â take_profit_levelÂ andÂ Weight_3Â !=Â 'NaN'Â andÂ Price_3_val_TrueÂ andÂ close[1]Â <Â Price_3_val
Â Â Â Â strategy.entry('Short_Open',Â strategy.short,Â qty=Â quantity(Order_Three),Â limitÂ =Â Price_3_val,Â alert_messageÂ =Â Short_message)
ifÂ strategy.opentradesÂ ==Â 3Â andÂ inDateRangeÂ andÂ Avg_PriceÂ >Â take_profit_levelÂ andÂ Weight_4Â !=Â 'NaN'Â andÂ Price_4_val_TrueÂ andÂ close[1]Â <Â Price_4_val
Â Â Â Â strategy.entry('Short_Open',Â strategy.short,Â qty=Â quantity(Order_Four),Â limitÂ =Â Price_4_val,Â alert_messageÂ =Â Short_message)
ifÂ strategy.opentradesÂ >Â 0Â andÂ inDateRangeÂ andÂ strategy.position_sizeÂ >Â 0Â 
Â Â Â Â strategy.exit('Long__Close',from_entryÂ =Â "Long_Open",Â stop=Stop_Level,Â limitÂ =Â take_profit_levelÂ ,Â qty_percent=100,Â alert_messageÂ =Long_Exit_message)
ifÂ strategy.opentradesÂ >Â 0Â andÂ inDateRangeÂ andÂ strategy.position_sizeÂ <Â 0Â 
Â Â Â Â strategy.exit('Short__Close',from_entryÂ =Â "Short_Open",Â stop=Stop_Level,Â limitÂ =Â take_profit_levelÂ ,Â qty_percent=100,Â alert_messageÂ =Short_Exit_message)
Expand (252 lines)