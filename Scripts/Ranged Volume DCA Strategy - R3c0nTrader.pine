Script Name: Ranged Volume DCA Strategy - R3c0nTrader
Author: R3c0nTrader
Description: Update: Republishing this as Public Open-Source script.

Credits:
Thank you "EvoCrypto" for granting me permission to use "Ranged Volume" to create this strategy.
Thank you "junyou0424" for granting me permission to use "DCA Bot with SuperTrend Emulator" which I used for adding bot inputs, calculations, and strategy

What does this do?
This script is mainly used...
PineScript code:

Pine Scriptâ„¢ strategy
Ranged Volume DCA Strategy - R3c0nTrader
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
//Â Â©Â RangedÂ VolumeÂ DCAÂ StrategyÂ -Â R3c0nTraderÂ verÂ 2022-07-30
//Â ForÂ backtestingÂ withÂ 3CommasÂ DCAÂ BotÂ settings
//Â ThankÂ youÂ "EvoCrypto"Â forÂ grantingÂ meÂ permissionÂ toÂ useÂ "RangedÂ Volume"Â toÂ createÂ thisÂ strategy
//Â ThankÂ youÂ "junyou0424"Â forÂ grantingÂ meÂ permissionÂ toÂ useÂ "DCAÂ BotÂ withÂ SuperTrendÂ Emulator"Â whichÂ IÂ usedÂ forÂ addingÂ botÂ inputs,Â calculations,Â andÂ strategy
//@version=5
strategy("RangedÂ VolumeÂ DCAÂ StrategyÂ -Â R3c0nTrader",Â shorttitle="RangedÂ VolÂ DCAÂ Strategy",Â format=format.volume,Â overlay=true,Â pyramiding=999,Â default_qty_type=strategy.cash,Â initial_capital=10000,Â commission_value=0.0,Â max_labels_count=500)
//Â DeclareÂ Variables
varÂ pnl_pctÂ =Â 0.0
varÂ stopValueÂ =Â float(0.0)
varÂ trailing_priceÂ =Â float(0.0)
CloseÂ =Â 0.0
OpenÂ =Â 0.0
buyÂ =Â bool(false)
sellÂ =Â bool(false)
use_labelsÂ =Â bool(false)
buy_messageÂ =Â ""
sell_messageÂ =Â ""
//Â INPUTS
//Â StartÂ andÂ EndÂ Dates----------------------------------------------------------
i_startTimeÂ =Â input.time(defval=timestamp('01Â JanÂ 2015Â 00:00Â +0000'),Â title='StartÂ Time',Â group="DateÂ Range")
i_endTimeÂ =Â input.time(defval=timestamp('31Â DecÂ 2050Â 23:59Â +0000'),Â title='EndÂ Time',Â group="DateÂ Range")
inDateRangeÂ =Â timeÂ >=Â i_startTimeÂ andÂ timeÂ <=Â i_endTime
//------------------------------------------------------------------------------
//Â Start:Â PreventÂ repainting----------------------------------------------------
stop_repainting_choiceÂ =Â input.bool(false,title='DisableÂ repainting?',Â 
Â Â Â tooltip='PerÂ PineÂ v5Â UserÂ Manual:Â YouÂ canÂ veryÂ wellÂ decideÂ toÂ useÂ repaintingÂ indicatorsÂ ifÂ youÂ understandÂ howÂ theyÂ behave,Â andÂ thatÂ behaviorÂ meetsÂ yourÂ tradingÂ methodologyâ€™sÂ requirements.'Â +
Â Â Â 'Donâ€™tÂ beÂ oneÂ ofÂ thoseÂ newcomersÂ toÂ tradingÂ whoÂ slapÂ â€œrepaintâ€Â sentencesÂ onÂ publishedÂ scriptsÂ asÂ ifÂ itÂ discreditsÂ them.Â DoingÂ soÂ onlyÂ revealsÂ yourÂ incomprehensionÂ ofÂ theÂ subject.'Â +
Â Â Â 'Whatâ€™sÂ importantÂ isÂ thatÂ youÂ understandÂ howÂ theÂ toolsÂ youÂ useÂ work,Â andÂ ifÂ theirÂ behaviorÂ isÂ compatibleÂ withÂ yourÂ objectives,Â repaintingÂ orÂ not.Â RepaintingÂ isÂ aÂ complexÂ matter.Â ItÂ hasÂ manyÂ facesÂ andÂ manyÂ causes.',
Â Â Â group='Repainting')
nonRepaintingSecurity(sym,Â tf,Â src)Â =>
Â Â Â Â request.security(sym,Â tf,Â src[barstate.isrealtimeÂ ?Â 1Â :Â 0])[barstate.isrealtimeÂ ?Â 0Â :Â 1]
//Â End:Â PreventÂ repainting------------------------------------------------------
//Â Start:Â Bull/SellÂ IndicatorÂ Options-------------------------------------------
highlight_tradesÂ =Â input.bool(true,Â title='HighlightÂ backgroundÂ colorÂ forÂ trades?',Â tooltip='UsedÂ toÂ addÂ aÂ greenÂ orÂ redÂ backgroundÂ colorÂ withÂ theÂ buyÂ andÂ sellÂ arrows.',Â group="Buy/SellÂ IndicatorÂ Options")
buy_colorÂ =Â input.color(color.new(color.green,Â 70),Â 'BuyÂ backgroundÂ color',Â group="Buy/SellÂ IndicatorÂ Options")
sell_colorÂ =Â input.color(color.new(color.red,Â 70),Â 'SellÂ backgroundÂ color',Â group="Buy/SellÂ IndicatorÂ Options")
use_labelsÂ :=Â input.bool(false,Â title='UseÂ Labels?',Â tooltip='EnableÂ toÂ showÂ labels.Â ToÂ removeÂ theÂ otherÂ text,Â youÂ mustÂ openÂ theÂ "Style"Â menuÂ andÂ uncheckÂ "SignalÂ labels"Â andÂ "Quantity".Â \n\nOnlyÂ 500Â labelsÂ canÂ beÂ displayedÂ onÂ theÂ chart.',Â group="Buy/SellÂ IndicatorÂ Options")
//Â End:Â Bull/SellÂ IndicatorÂ Options---------------------------------------------
//Â Start:Â 3CommasÂ BotÂ ----------------------------------------------------------
boolÂ cfg_enable_bot_controlÂ Â Â Â Â =Â input.bool(title='EnableÂ 3CommasÂ Webhook?',Â defval=false,Â group='3commasÂ BotÂ Settings',Â 
Â Â Â tooltip='IfÂ thisÂ isÂ enabledÂ theÂ strategyÂ canÂ controlÂ someÂ botÂ operationsÂ viaÂ WebhookÂ calls.\n\nToÂ enableÂ WebhookÂ calls,Â checkÂ thisÂ option,Â selectÂ theÂ botÂ type,'Â +Â 
Â Â Â 'Â enterÂ theÂ BotÂ idÂ andÂ EmailÂ Token.\n\nAfterÂ theÂ strategyÂ isÂ configured,Â createÂ anÂ alertÂ onÂ theÂ strategy,Â selectÂ "alert()Â functionÂ callsÂ only",Â 'Â +Â 
Â Â Â 'checkÂ "WebhookÂ URL",Â enterÂ theÂ 3CommasÂ webhookÂ URL,Â andÂ enterÂ theÂ "AlertÂ Name"')
bot_typeÂ =Â input.string("SimpleÂ bot",Â title="SelectÂ theÂ botÂ type",Â options=["SimpleÂ bot",Â "CompositeÂ bot"],Â group='3commasÂ BotÂ Settings',
Â Â Â tooltip='SelectÂ theÂ botÂ type.Â IfÂ "SimpleÂ bot"Â isÂ selectedÂ theÂ currencyÂ pairÂ (e.g.Â BTCUSDÂ orÂ BTCUSDT)Â willÂ notÂ beÂ passedÂ inÂ theÂ alert.Â 'Â +
Â Â Â '\nIfÂ "CompositeÂ bot"Â isÂ selectedÂ theÂ currencyÂ pairÂ willÂ beÂ passedÂ inÂ theÂ alert.')
stringÂ cfg_bot_idÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â =Â input.string(title='BotÂ id',Â defval='bot_id',Â tooltipÂ =Â 'GoÂ toÂ yourÂ 3CommasÂ botÂ settings>ExpandÂ "MessageÂ forÂ dealÂ startÂ signal"',Â group='3commasÂ BotÂ Settings')
stringÂ cfg_email_tokenÂ Â Â Â Â Â Â Â Â Â =Â input.string(title='EmailÂ token',Â defval='email_token',Â tooltipÂ =Â 'GoÂ toÂ yourÂ 3CommasÂ botÂ settings>ExpandÂ "MessageÂ forÂ dealÂ startÂ signal"',Â group='3commasÂ BotÂ Settings')
ifÂ cfg_enable_bot_control
Â Â Â Â ifÂ bot_typeÂ ==Â "SimpleÂ bot"
Â Â Â Â Â Â Â Â buy_messageÂ :=Â '{"message_type":"bot",Â "bot_id":"'Â +Â cfg_bot_idÂ +Â '",Â "email_token":"'Â +Â cfg_email_tokenÂ +Â '",Â "delay_seconds":0}'
Â Â Â Â Â Â Â Â sell_messageÂ :=Â '{"action":Â "close_at_market_price_all",Â "message_type":"bot",Â "bot_id":"'Â +Â cfg_bot_idÂ +Â '",Â "email_token":"'Â +Â cfg_email_tokenÂ +Â '",Â "delay_seconds":0}'
Â Â Â Â elseÂ ifÂ bot_typeÂ ==Â "CompositeÂ bot"
Â Â Â Â Â Â Â Â buy_messageÂ :=Â '{"message_type":"bot",Â "bot_id":"'Â +Â cfg_bot_idÂ +Â '",Â "email_token":"'Â +Â cfg_email_tokenÂ +Â '",Â "delay_seconds":0,Â "pair":"'Â +Â str.tostring(syminfo.currency)Â +Â '_'Â +Â str.tostring(syminfo.basecurrency)Â +Â '"}'
Â Â Â Â Â Â Â Â sell_messageÂ :=Â '{"action":Â "close_at_market_price_all",Â "message_type":"bot",Â "bot_id":"'Â +Â cfg_bot_idÂ +Â '",Â "email_token":"'Â +Â cfg_email_tokenÂ +Â '",Â "delay_seconds":0,Â "pair":"'Â +Â str.tostring(syminfo.currency)Â +Â '_'Â +Â str.tostring(syminfo.basecurrency)Â +Â '"}'
//Â End:Â 3CommasÂ BotÂ ------------------------------------------------------------
//RangedÂ VolumeÂ Settings
Range_LengthÂ Â Â Â =Â Â Â input.int(5,Â Â Â Â Â Â Â Â title="VolumeÂ RangeÂ Length",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â minval=1)
Heikin_AshiÂ Â Â Â Â =Â Â Â input(false,Â Â Â Â Â title="HeikinÂ Ashi")
Display_BarsÂ Â Â Â =Â Â Â input(true,Â Â Â Â Â title="ShowÂ BarÂ Colors")
Display_BreakÂ Â Â =Â Â Â input(true,Â Â Â Â Â title="ShowÂ Break-Out")
Display_RangeÂ Â Â =Â Â Â input(true,Â Â Â Â Â title="ShowÂ Range")
truncate(number,Â decimals)Â =>
Â Â Â Â factorÂ =Â math.pow(10,Â decimals)
Â Â Â Â int(numberÂ *Â factor)Â /Â factor
//Â 3CommasÂ Inputs
sourceInputÂ =Â input.source(close,Â "Source")
price_deviationÂ =Â input.float(6.0,Â title='PriceÂ deviationÂ toÂ openÂ safetyÂ ordersÂ (%)',Â step=0.25,Â minval=0.0)Â /Â 100
take_profitÂ =Â input.float(22.0,Â title='TargetÂ TakeÂ ProfitÂ (%)',Â step=0.5,Â minval=0.0)Â /Â 100
trailingÂ =Â input.float(0.0,Â title='TrailingÂ deviation.Â Default=Â 0.0Â (%)',Â step=0.1,Â minval=0.0)Â /Â 100
base_orderÂ =Â input(100.0,Â title='BaseÂ order')
safe_orderÂ =Â input(200.0,Â title='SafetyÂ order')
safe_order_volume_scaleÂ =Â input.float(2.0,Â step=0.5,Â title='SafetyÂ orderÂ volumeÂ scale')
safe_order_step_scaleÂ =Â input.float(1.4,Â step=0.1,Â title='SafetyÂ orderÂ stepÂ scale')
max_safe_orderÂ =Â input(5,Â title='MaxÂ safetyÂ orders')
sourceInput01_func()Â =>
Â Â Â Â sourceInput01_fÂ =Â stop_repainting_choiceÂ ?Â nonRepaintingSecurity(syminfo.tickerid,Â timeframe.period,Â sourceInput)Â :Â sourceInput
varÂ current_soÂ =Â 0
varÂ initial_orderÂ =Â 0.0
varÂ previous_high_valueÂ =Â 0.0
varÂ original_ttp_valueÂ =Â 0.0
//Â CalculateÂ ourÂ keyÂ levels
take_profit_levelÂ =Â strategy.position_avg_priceÂ *Â (1Â +Â take_profit)
//Â SETTINGSÂ 
CloseÂ :=Â Heikin_AshiÂ ?Â request.security(ticker.heikinashi(syminfo.tickerid),Â timeframe.period,Â sourceInput01_func())Â :Â sourceInput01_func()
OpenÂ :=Â Heikin_AshiÂ ?Â request.security(ticker.heikinashi(syminfo.tickerid),Â timeframe.period,Â open)Â :Â open
PositiveÂ =Â volume
NegativeÂ =Â -volume
HighestÂ =Â stop_repainting_choiceÂ ?Â ta.highest(volume,Â Range_Length)[1]Â :Â ta.highest(volume,Â Range_Length)
LowestÂ =Â stop_repainting_choiceÂ ?Â ta.lowest(-volume,Â Range_Length)[1]Â :Â ta.lowest(-volume,Â Range_Length)
UpÂ Â Â Â Â Â Â Â Â Â Â Â Â Â =Â Â Â HighestÂ >Â Highest[1]Â andÂ CloseÂ >Â Open
DnÂ Â Â Â Â Â Â Â Â Â Â Â Â Â =Â Â Â HighestÂ >Â Highest[1]Â andÂ CloseÂ <Â Open
Volume_ColorÂ =Â 
Â Display_BreakÂ andÂ UpÂ ?Â color.new(#ffeb3b,Â 20)Â :Â 
Â Display_BreakÂ andÂ DnÂ ?Â color.new(#f44336,Â 20)Â :Â 
Â CloseÂ >Â OpenÂ ?Â color.new(#00c0ff,Â 20)Â :Â 
Â CloseÂ <Â OpenÂ ?Â color.new(#0001f6,Â 20)Â :Â na
//PlotÂ barÂ colorÂ forÂ volumeÂ rangeÂ indicator
barcolor(Volume_Color,Â title='RangedÂ VolumeÂ BarÂ Coloring:Â (YouÂ mustÂ disableÂ barÂ coloringÂ inÂ anyÂ studiesÂ youÂ addedÂ orÂ thisÂ mayÂ notÂ workÂ properly)')
//Â OpenÂ FirstÂ Position
//Â ifÂ strategy.position_sizeÂ ==Â 0Â andÂ sourceInputÂ >Â 0Â andÂ (Up)Â andÂ inDateRange
ifÂ strategy.position_sizeÂ ==Â 0Â andÂ sourceInput01_func()Â >Â 0Â andÂ UpÂ andÂ inDateRange
Â Â Â Â ifÂ use_labels
Â Â Â Â Â Â Â Â label.new(bar_index,Â sourceInput01_func(),Â 'LongÂ @Â 'Â +Â str.tostring(math.round(sourceInput01_func(),4)),Â styleÂ =Â label.style_label_up,Â color=color.green)
Â Â Â Â Â Â Â Â strategy.entry('LongÂ @'Â +Â str.tostring(sourceInput01_func())+'ğŸ’âœ‹ğŸ¤š',Â strategy.long,Â qty=base_orderÂ /Â sourceInput01_func())
Â Â Â Â else
Â Â Â Â Â Â Â Â strategy.entry('LongÂ @'Â +Â str.tostring(sourceInput01_func())+'ğŸ’âœ‹ğŸ¤š',Â strategy.long,Â qty=base_orderÂ /Â sourceInput01_func())
Â Â Â Â initial_orderÂ :=Â sourceInput
Â Â Â Â current_soÂ :=Â 1
Â Â Â Â previous_high_valueÂ :=Â 0.0
Â Â Â Â original_ttp_valueÂ :=Â 0
Â Â Â Â buyÂ :=Â true
thresholdÂ =Â 0.0
ifÂ safe_order_step_scaleÂ ==Â 1.0
Â Â Â Â thresholdÂ :=Â initial_orderÂ -Â initial_orderÂ *Â price_deviationÂ *Â safe_order_step_scaleÂ *Â current_so
elseÂ ifÂ current_soÂ <=Â max_safe_order
Â Â Â Â thresholdÂ :=Â initial_orderÂ -Â initial_orderÂ *Â ((price_deviationÂ *Â math.pow(safe_order_step_scale,Â current_so)Â -Â price_deviation)Â /Â (safe_order_step_scaleÂ -Â 1))
elseÂ ifÂ current_soÂ >Â max_safe_order
Â Â Â Â thresholdÂ :=Â initial_orderÂ -Â initial_orderÂ *Â ((price_deviationÂ *Â math.pow(safe_order_step_scale,Â max_safe_order)Â -Â price_deviation)Â /Â (safe_order_step_scaleÂ -Â 1))
Â Â Â Â 
//Â AverageÂ downÂ whenÂ lowestÂ candleÂ valueÂ crossesÂ belowÂ threshold
ifÂ current_soÂ >Â 0Â andÂ lowÂ <=Â thresholdÂ andÂ current_soÂ <=Â max_safe_orderÂ andÂ previous_high_valueÂ ==Â 0.0
Â Â Â Â //Â TriggerÂ aÂ safetyÂ orderÂ atÂ theÂ SafetyÂ OrderÂ "threshold"Â price
Â Â Â Â strategy.entry('ğŸ˜¨ğŸ™Â SOÂ 'Â +Â str.tostring(current_so)Â +Â '@'Â +Â str.tostring(threshold),Â direction=strategy.long,Â qty=safe_orderÂ *Â math.pow(safe_order_volume_scale,Â current_soÂ -Â 1)Â /Â threshold)
Â Â Â Â current_soÂ +=Â 1
//Â TakeÂ Profit!
//Â TakeÂ profitÂ whenÂ takeÂ profitÂ levelÂ isÂ equalÂ toÂ orÂ higherÂ thanÂ theÂ highÂ ofÂ theÂ candle
ifÂ take_profit_levelÂ <=Â highÂ andÂ strategy.position_sizeÂ >Â 0Â orÂ previous_high_valueÂ >Â 0.0
Â Â Â Â pnl_pctÂ :=Â truncate((closeÂ -Â strategy.position_avg_price)Â /Â strategy.position_avg_price*100,3)
Â Â Â Â ifÂ trailingÂ >Â 0.0
Â Â Â Â Â Â Â Â //Â 'trailing_price'Â willÂ containÂ theÂ largestÂ percentage-basedÂ stopÂ value
Â Â Â Â Â Â Â Â trailing_priceÂ :=Â ifÂ (strategy.position_sizeÂ >Â 0)
Â Â Â Â Â Â Â Â Â Â Â Â stopValueÂ :=Â closeÂ *Â (1Â -Â trailing)
Â Â Â Â Â Â Â Â Â Â Â Â //Â TheÂ 'max'Â functionÂ isÂ whatÂ allowsÂ theÂ percentage-basedÂ stopÂ toÂ 'Trail'.
Â Â Â Â Â Â Â Â Â Â Â Â //Â IfÂ theÂ stopValueÂ isÂ higherÂ thanÂ theÂ previousÂ trailing_priceÂ (whichÂ wasÂ theÂ oldÂ stopValue)Â thenÂ weÂ keepÂ theÂ higherÂ value
Â Â Â Â Â Â Â Â Â Â Â Â //Â TheÂ trailing_priceÂ canÂ onlyÂ increaseÂ orÂ remainÂ theÂ same.Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â math.max(stopValue,Â trailing_price[1])
Â Â Â Â Â Â Â Â elseÂ 
Â Â Â Â Â Â Â Â Â Â Â Â 0
Â Â Â Â Â Â Â Â take_profit_levelÂ :=Â trailing_price
Â Â Â Â Â Â Â Â ifÂ previous_high_valueÂ >Â 0.0
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ highÂ >=Â previous_high_value
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â previous_high_valueÂ :=Â sourceInput
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ highÂ <=Â trailing_price
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ use_labels
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â label.new(bar_index,Â sourceInput01_func(),Â textÂ =Â 'CloseÂ (trailing)Â @Â 'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%',Â styleÂ =Â label.style_label_down,Â color=color.yellow)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strategy.close_all(comment=Â 'CloseÂ (trailing)Â @'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%')
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â else
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strategy.close_all(comment=Â 'CloseÂ (trailing)Â @'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%')
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sellÂ :=Â true
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â SendÂ SellÂ AlertÂ toÂ 3CommasÂ bot
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert(sell_message,Â alert.freq_once_per_bar_close)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â elseÂ ifÂ closeÂ <=Â trailing_price
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ use_labels
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â label.new(bar_index,Â sourceInput01_func(),Â textÂ =Â 'CloseÂ (trailing)Â @Â 'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%',Â styleÂ =Â label.style_label_down,Â color=color.yellow)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strategy.close_all(comment=Â 'CloseÂ (trailing)Â @'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%')
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â else
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strategy.close_all(comment=Â 'CloseÂ (trailing)Â @'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%')
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sellÂ :=Â true
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â SendÂ SellÂ AlertÂ toÂ 3CommasÂ bot
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert(sell_message,Â alert.freq_once_per_bar_close)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â else
Â Â Â Â Â Â Â Â Â Â Â Â previous_high_valueÂ :=Â high
Â Â Â Â Â Â Â Â Â Â Â Â original_ttp_valueÂ :=Â high
Â Â Â Â else
Â Â Â Â Â Â Â Â ifÂ use_labelsÂ andÂ strategy.position_sizeÂ >Â 0Â andÂ sellÂ ==Â falseÂ 
Â Â Â Â Â Â Â Â Â Â Â Â label.new(bar_index,Â sourceInput01_func(),Â textÂ =Â 'CloseÂ @Â 'Â +Â str.tostring(math.round(high,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%',Â styleÂ =Â label.style_label_down,Â color=color.yellow)Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â strategy.close_all(comment=Â 'ğŸ’°Â CloseÂ @'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%')
Â Â Â Â Â Â Â Â else
Â Â Â Â Â Â Â Â Â Â Â Â strategy.close_all(comment=Â 'ğŸ’°Â CloseÂ @'Â +Â str.tostring(math.round(close,4))Â +Â ',Â 'Â +Â str.tostring(pnl_pct)Â +Â '%')
Â Â Â Â Â Â Â Â sellÂ :=Â true
Â Â Â Â Â Â Â Â //Â SendÂ SellÂ AlertÂ toÂ 3CommasÂ bot
Â Â Â Â Â Â Â Â alert(sell_message,Â alert.freq_once_per_bar_close)
Â Â Â Â Â Â Â Â 
//Â ZeroÂ outÂ valuesÂ afterÂ tradeÂ isÂ closed
ifÂ sell
Â Â Â Â current_soÂ :=Â 0
Â Â Â Â previous_high_valueÂ :=Â 0
Â Â Â Â original_ttp_valueÂ :=Â 0
Â Â Â Â stopValueÂ :=Â 0
Â Â Â Â trailingÂ :=Â 0
Â Â Â Â trailing_priceÂ :=Â 0
//Â EndÂ TakeÂ Profit--------------------------------------------------------------
//Â Start:Â ClearÂ theÂ trailingÂ valuesÂ ifÂ noÂ openÂ trades---------------------------
ifÂ strategy.opentradesÂ ==Â 0
Â Â Â Â original_ttp_valueÂ :=Â 0
Â Â Â Â stopValueÂ :=Â 0
//Â End:Â ClearÂ theÂ trailingÂ valuesÂ ifÂ noÂ openÂ trades-----------------------------
//Â Start:Â Plots-----------------------------------------------------------------
//Â PlotÂ TrailingÂ StopÂ LossÂ andÂ associatedÂ originalÂ TTPÂ value
plot(original_ttp_valueÂ >Â 0Â ?Â original_ttp_valueÂ :Â na,Â style=plot.style_linebr,Â color=color.white,Â linewidth=3,Â title="OriginalÂ TTPÂ Value",Â editable=true)
plot(stopValueÂ >Â 0Â ?Â stopValueÂ :Â na,Â style=plot.style_linebr,Â color=color.red,Â linewidth=3,Â title="StopÂ Value",Â editable=true)
plot(trailing_priceÂ >Â 0Â ?Â trailing_priceÂ :Â na,Â style=plot.style_linebr,Â color=color.yellow,Â linewidth=3,Â title="TrailingÂ stopÂ loss",Â editable=true)
//Â PlotÂ TP
plot(strategy.position_sizeÂ >Â 0Â ?Â take_profit_levelÂ :Â na,Â style=plot.style_linebr,Â color=color.green,Â linewidth=2,Â title="TakeÂ Profit")
//Â PlotÂ AllÂ SafetyÂ OrderÂ linesÂ exceptÂ forÂ lastÂ oneÂ asÂ brightÂ blue
plot(strategy.position_sizeÂ >Â 0Â andÂ current_soÂ <=Â max_safe_orderÂ andÂ current_soÂ >Â 0Â ?Â thresholdÂ :Â na,Â style=plot.style_linebr,Â color=color.new(#00ffff,0),Â linewidth=2,Â title="SafetyÂ Order")
//Â PlotÂ LastÂ SafetyÂ OrderÂ LineÂ asÂ Red
plot(strategy.position_sizeÂ >Â 0Â andÂ current_soÂ >Â max_safe_orderÂ ?Â thresholdÂ :Â na,Â style=plot.style_linebr,Â color=color.red,Â linewidth=2,Â title="NoÂ SafetyÂ OrdersÂ Left")
//Â PlotÂ AverageÂ PositionÂ PriceÂ LineÂ asÂ Orange
plot(strategy.position_sizeÂ >Â 0Â ?Â strategy.position_avg_priceÂ :Â na,Â style=plot.style_linebr,Â color=color.orange,Â linewidth=2,Â title="AvgÂ PositionÂ Price")
//Â FillÂ TPÂ AreaÂ andÂ SOÂ Area
h1Â =Â plot(strategy.position_avg_price,Â color=color.new(#000000,100),Â title="AvgÂ PriceÂ PlotÂ Area",Â display=display.none,Â editable=false)
h2Â =Â plot(take_profit_level,Â color=color.new(#000000,100),Â title="TakeÂ ProfitÂ PlotÂ Area",Â display=display.none,Â editable=false)
h3Â =Â plot(threshold,Â color=color.new(#000000,100),Â title="SOÂ PlotÂ Area",Â display=display.none,Â editable=false)
//Â TPÂ Area
fill(h1,h2,color=color.new(#38761d,70),Â title="TakeÂ ProfitÂ PlotÂ Area")
//Â CurrentÂ SOÂ Area
fill(h1,h3,color=color.new(#3d85c6,70),Â title="SOÂ PlotÂ Area")
//Â ThisÂ willÂ removeÂ theÂ extraneousÂ sellÂ signalsÂ beforeÂ weÂ useÂ themÂ toÂ plotÂ with
sellÂ :=Â strategy.position_sizeÂ >Â 0Â ?Â sellÂ :Â false
//Â PlotÂ HighlightÂ forÂ Buy/SellÂ Arrows
sessioncolorÂ =Â ifÂ highlight_trades
Â Â Â Â switchÂ 
Â Â Â Â Â Â Â Â buyÂ =>Â Â buy_color
Â Â Â Â Â Â Â Â sellÂ =>Â sell_color
Â Â Â Â Â Â Â Â =>Â color(na)
bgcolor(sessioncolor,Â editable=false)
//Â SendÂ BuyÂ AlertÂ toÂ 3CommasÂ bot
ifÂ buy
Â Â Â Â alert(buy_message,Â alert.freq_once_per_bar_close)
Â Â Â Â buyÂ :=Â false
//Â End:Â Plots-------------------------------------------------------------------
Expand (259 lines)