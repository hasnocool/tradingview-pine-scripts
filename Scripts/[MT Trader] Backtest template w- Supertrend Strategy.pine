Script Name: [MT Trader] Backtest template w- Supertrend Strategy
Author: VertMT
Description: ---EN:  In this strategy template you will find some functions already pre-programmed to be used in your strategies to speed up the programming process, among them we can highlight the default stop loss and take profit functions, which will help to set easily and quickly, defining the price range in which we want to prevent large losses or protect our profits from...
PineScript code:

Pine Scriptâ„¢ strategy
[MT Trader] Backtest template w/ Supertrend Strategy
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *
//#Â *Â Â ScriptÂ Â Â Â Â Â Â |Â Â [MTÂ Trader]Â BacktestÂ TemplateÂ w/Â SupertrendÂ Strategy
//#Â *Â Â DescriptionÂ Â |Â Â SmallÂ templateÂ openÂ sourceÂ madeÂ inÂ pinescriptÂ withÂ theÂ purposeÂ ofÂ testingÂ 
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â differentÂ strategiesÂ andÂ howÂ theyÂ couldÂ beÂ improved
//#Â *
//#Â *Â Â AuthorÂ Â Â Â Â Â Â |Â Â Â©VertMT
//#Â *
//#Â *Â Â PinescriptÂ Â Â |Â Â https://www.tradingview.com/pine-script-docs/en/v5/Introduction.html
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @version=5
//#Â *
//#Â *Â Â RevisionÂ History
//#Â *Â Â Â Â ReleaseÂ Â Â Â |Â Â JulÂ 30,Â 2022Â Â |Â InitialÂ Release
//#Â *
//#Â *
//#Â *Â Â ReferenceÂ Â Â Â |Â Â https://tradingview.com/script/wzevYXew-TEMPLATE-Code-Block-Comments/
//#Â *
//#Â *
//#Â *Â Â Â Â â–ˆâ–ˆâ–ˆâ–„Â â–„â–ˆâ–ˆâ–ˆâ–“Â â–„â–„â–„â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“
//#Â *Â Â Â â–“â–ˆâ–ˆâ–’â–€â–ˆâ–€Â â–ˆâ–ˆâ–’Â â–“Â Â â–ˆâ–ˆâ–’Â â–“â–’
//#Â *Â Â Â â–“â–ˆâ–ˆÂ Â Â Â â–“â–ˆâ–ˆâ–‘Â â–’Â â–“â–ˆâ–ˆâ–‘Â â–’â–‘
//#Â *Â Â Â â–’â–ˆâ–ˆÂ Â Â Â â–’â–ˆâ–ˆÂ Â â–‘Â â–“â–ˆâ–ˆâ–“Â â–‘Â 
//#Â *Â Â Â â–’â–ˆâ–ˆâ–’Â Â Â â–‘â–ˆâ–ˆâ–’Â Â Â â–’â–ˆâ–ˆâ–’Â â–‘Â 
//#Â *Â Â Â â–‘Â â–’â–‘Â Â Â â–‘Â Â â–‘Â Â Â â–’Â â–‘â–‘Â Â Â 
//#Â *Â Â Â â–‘Â Â â–‘Â Â Â Â Â Â â–‘Â Â Â Â Â â–‘Â Â Â Â 
//#Â *Â Â Â â–‘Â Â Â Â Â Â â–‘Â Â Â Â Â Â â–‘Â Â Â Â Â Â 
//#Â *
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//@version=5
strategy("[MTÂ Trader]Â BacktestÂ templateÂ w/Â SuperTrendÂ Strategy",Â overlay=true,Â pyramidingÂ =Â 0,Â calc_on_order_fillsÂ =Â false,Â commission_typeÂ =Â strategy.commission.percent,Â commission_valueÂ =Â 0.03,Â default_qty_typeÂ =Â strategy.percent_of_equity,Â default_qty_valueÂ =Â 100,Â initial_capital=100,Â currency=currency.USD,Â process_orders_on_close=true,Â backtest_fill_limits_assumption=0)
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 1.Â ğŸ“†Â TimeframeÂ ğŸ“†Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *
//#Â *Â Â Â Â Â Â Â Â InÂ thisÂ sectionÂ youÂ canÂ configureÂ theÂ strategyÂ soÂ thatÂ itÂ onlyÂ runsÂ betweenÂ 2Â 
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â timeÂ periods,Â beingÂ alsoÂ ableÂ toÂ adjustÂ toÂ anyÂ timeÂ zone.
//#Â *
//#Â *Â Â Â Â Â Â Â Â EnÂ esteÂ apartadoÂ seÂ puedeÂ configurarÂ laÂ estrategiaÂ paraÂ queÂ soloÂ seÂ ejecuteÂ entre
//#Â *Â Â Â Â Â Â Â Â 2Â periodosÂ deÂ tiempo,Â siendoÂ capazÂ tambienÂ deÂ ajustarseÂ aÂ cualquierÂ zonaÂ horaria.
//#Â *
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
dateFilterÂ Â =Â input.bool(group='ğŸ“†Â TimeframeÂ ğŸ“†',Â defval=false)
startTimeÂ Â Â =Â input.time(group='ğŸ“†Â TimeframeÂ ğŸ“†',Â defval=timestamp('01Â JanÂ 2022Â 00:00'),Â title='StartÂ Time')
endTimeÂ Â Â Â Â =Â input.time(group='ğŸ“†Â TimeframeÂ ğŸ“†',Â defval=timestamp('31Â DecÂ 2022Â 23:45'),Â title='EndÂ Time')
zoneTimeÂ Â Â Â =Â input.string("UTC",Â optionsÂ =Â ["UTC-10",Â "UTC-8",Â "UTC-7",Â "UTC-6",Â "UTC-5",Â "UTC-4",Â "UTC-3",Â "UTC",Â "UTC+1",Â "UTC+2",Â "UTC+3",Â "UTC+4",Â "UTC+4:30",Â "UTC+5",Â "UTC+5:30",Â "UTC+6",Â "UTC+7",Â "UTC+8",Â "UTC+9",Â "UTC+9:30",Â "UTC+10",Â "UTC+11",Â "UTC+12",Â "UTC+12:45",Â "UTC+13"],Â title='UTC',Â group='ğŸ“†Â TimeframeÂ ğŸ“†',Â tooltip="MatchÂ thisÂ timeÂ zoneÂ withÂ thatÂ ofÂ yourÂ graphÂ soÂ thatÂ allÂ valuesÂ areÂ displayedÂ correctly.Â \n\nHagaÂ coincidirÂ estaÂ zonaÂ horariaÂ conÂ laÂ deÂ suÂ grÃ¡ficoÂ paraÂ queÂ todosÂ losÂ valoresÂ seÂ muestrenÂ correctamente.")
cTimeÂ =Â timestamp(year(timenow),Â month(timenow),Â dayofmonth(timenow),Â hour(timenow),Â minute(timenow))
sTimeÂ =Â timestamp(year(startTime),Â month(startTime),Â dayofmonth(startTime),Â hour(startTime),Â minute(startTime),Â second(startTime))
eTimeÂ =Â timestamp(year(endTime),Â month(endTime),Â dayofmonth(endTime),Â hour(endTime),Â minute(endTime),Â second(endTime))
bgcolor(dateFilterÂ andÂ timeÂ ==Â sTimeÂ orÂ dateFilterÂ andÂ timeÂ ==Â eTime?color.new(color.white,Â 80):na,Â title="DateÂ Range")
plotshape(dateFilterÂ andÂ timeÂ ==Â sTime,Â title="StartÂ Time",Â style=shape.labelup,Â location=location.belowbar,Â color=color.white,Â text="Start",Â textcolor=color.black,Â size=size.tiny)
plotshape(dateFilterÂ andÂ timeÂ ==Â eTime,Â title="EndÂ Time",Â Â Â style=shape.labelup,Â location=location.belowbar,Â color=color.white,Â text="End",Â Â Â textcolor=color.black,Â size=size.tiny)
zcTimeÂ =Â zoneTimeÂ ==Â "UTC-10"Â ?Â cTimeÂ -Â 10*60*60000Â :Â zoneTimeÂ ==Â "UTC-8"Â ?Â cTimeÂ -Â 8*60*60000Â :Â zoneTimeÂ ==Â "UTC-7"Â ?Â cTimeÂ -Â 7*60*60000Â :Â zoneTimeÂ ==Â "UTC-6"Â ?Â cTimeÂ -Â 6*60*60000Â :Â zoneTimeÂ ==Â "UTC-5"Â ?Â cTimeÂ -Â 5*60*60000Â :Â zoneTimeÂ ==Â "UTC-4"Â ?Â cTimeÂ -Â 4*60*60000Â :Â zoneTimeÂ ==Â "UTC-3"Â ?Â cTimeÂ -Â 3*60*60000Â :Â zoneTimeÂ ==Â "UTC"Â ?Â cTimeÂ -Â 0*60*60000Â :Â zoneTimeÂ ==Â "UTC+1"Â ?Â cTimeÂ +Â 1*60*60000Â :Â Â zoneTimeÂ ==Â "UTC+2"Â ?Â cTimeÂ +Â 2*60*60000Â :Â zoneTimeÂ ==Â "UTC+3"Â ?Â cTimeÂ +Â 3*60*60000Â :Â zoneTimeÂ ==Â "UTC+4"Â ?Â cTimeÂ +Â 4*60*60000Â :Â zoneTimeÂ ==Â "UTC+4:30"Â ?Â cTimeÂ +Â 4*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+5"Â ?Â cTimeÂ +Â 5*60*60000Â :Â zoneTimeÂ ==Â "UTC+5"Â ?Â cTimeÂ +Â 5*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+6"Â ?Â cTimeÂ +Â 6*60*60000Â :Â zoneTimeÂ ==Â "UTC+7"Â ?Â cTimeÂ +Â 7*60*60000Â :Â zoneTimeÂ ==Â "UTC+8"Â ?Â cTimeÂ +Â 8*60*60000Â :Â zoneTimeÂ ==Â "UTC+9"Â ?Â cTimeÂ +Â 9*60*60000Â :Â zoneTimeÂ ==Â "UTC+9"Â ?Â cTimeÂ +Â 9*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+10"Â ?Â cTimeÂ +Â 10*60*60000Â :Â zoneTimeÂ ==Â "UTC+11"Â ?Â cTimeÂ +Â 11*60*60000Â :Â zoneTimeÂ ==Â "UTC+12"Â ?Â cTimeÂ +Â 12*60*60000Â :Â zoneTimeÂ ==Â "UTC+12:45"Â ?Â cTimeÂ +Â 12*60*60000Â +Â 45*60000Â :Â zoneTimeÂ ==Â "UTC+13"Â ?Â cTimeÂ +Â 13*60*60000Â :Â 0
zsTimeÂ =Â zoneTimeÂ ==Â "UTC-10"Â ?Â sTimeÂ -Â 10*60*60000Â :Â zoneTimeÂ ==Â "UTC-8"Â ?Â sTimeÂ -Â 8*60*60000Â :Â zoneTimeÂ ==Â "UTC-7"Â ?Â sTimeÂ -Â 7*60*60000Â :Â zoneTimeÂ ==Â "UTC-6"Â ?Â sTimeÂ -Â 6*60*60000Â :Â zoneTimeÂ ==Â "UTC-5"Â ?Â sTimeÂ -Â 5*60*60000Â :Â zoneTimeÂ ==Â "UTC-4"Â ?Â sTimeÂ -Â 4*60*60000Â :Â zoneTimeÂ ==Â "UTC-3"Â ?Â sTimeÂ -Â 3*60*60000Â :Â zoneTimeÂ ==Â "UTC"Â ?Â sTimeÂ -Â 0*60*60000Â :Â zoneTimeÂ ==Â "UTC+1"Â ?Â sTimeÂ +Â 1*60*60000Â :Â Â zoneTimeÂ ==Â "UTC+2"Â ?Â sTimeÂ +Â 2*60*60000Â :Â zoneTimeÂ ==Â "UTC+3"Â ?Â sTimeÂ +Â 3*60*60000Â :Â zoneTimeÂ ==Â "UTC+4"Â ?Â sTimeÂ +Â 4*60*60000Â :Â zoneTimeÂ ==Â "UTC+4:30"Â ?Â sTimeÂ +Â 4*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+5"Â ?Â sTimeÂ +Â 5*60*60000Â :Â zoneTimeÂ ==Â "UTC+5"Â ?Â sTimeÂ +Â 5*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+6"Â ?Â sTimeÂ +Â 6*60*60000Â :Â zoneTimeÂ ==Â "UTC+7"Â ?Â sTimeÂ +Â 7*60*60000Â :Â zoneTimeÂ ==Â "UTC+8"Â ?Â sTimeÂ +Â 8*60*60000Â :Â zoneTimeÂ ==Â "UTC+9"Â ?Â sTimeÂ +Â 9*60*60000Â :Â zoneTimeÂ ==Â "UTC+9"Â ?Â sTimeÂ +Â 9*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+10"Â ?Â sTimeÂ +Â 10*60*60000Â :Â zoneTimeÂ ==Â "UTC+11"Â ?Â sTimeÂ +Â 11*60*60000Â :Â zoneTimeÂ ==Â "UTC+12"Â ?Â sTimeÂ +Â 12*60*60000Â :Â zoneTimeÂ ==Â "UTC+12:45"Â ?Â sTimeÂ +Â 12*60*60000Â +Â 45*60000Â :Â zoneTimeÂ ==Â "UTC+13"Â ?Â sTimeÂ +Â 13*60*60000Â :Â 0
zeTimeÂ =Â zoneTimeÂ ==Â "UTC-10"Â ?Â eTimeÂ -Â 10*60*60000Â :Â zoneTimeÂ ==Â "UTC-8"Â ?Â eTimeÂ -Â 8*60*60000Â :Â zoneTimeÂ ==Â "UTC-7"Â ?Â eTimeÂ -Â 7*60*60000Â :Â zoneTimeÂ ==Â "UTC-6"Â ?Â eTimeÂ -Â 6*60*60000Â :Â zoneTimeÂ ==Â "UTC-5"Â ?Â eTimeÂ -Â 5*60*60000Â :Â zoneTimeÂ ==Â "UTC-4"Â ?Â eTimeÂ -Â 4*60*60000Â :Â zoneTimeÂ ==Â "UTC-3"Â ?Â eTimeÂ -Â 3*60*60000Â :Â zoneTimeÂ ==Â "UTC"Â ?Â eTimeÂ -Â 0*60*60000Â :Â zoneTimeÂ ==Â "UTC+1"Â ?Â eTimeÂ +Â 1*60*60000Â :Â Â zoneTimeÂ ==Â "UTC+2"Â ?Â eTimeÂ +Â 2*60*60000Â :Â zoneTimeÂ ==Â "UTC+3"Â ?Â eTimeÂ +Â 3*60*60000Â :Â zoneTimeÂ ==Â "UTC+4"Â ?Â eTimeÂ +Â 4*60*60000Â :Â zoneTimeÂ ==Â "UTC+4:30"Â ?Â eTimeÂ +Â 4*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+5"Â ?Â eTimeÂ +Â 5*60*60000Â :Â zoneTimeÂ ==Â "UTC+5"Â ?Â eTimeÂ +Â 5*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+6"Â ?Â eTimeÂ +Â 6*60*60000Â :Â zoneTimeÂ ==Â "UTC+7"Â ?Â eTimeÂ +Â 7*60*60000Â :Â zoneTimeÂ ==Â "UTC+8"Â ?Â eTimeÂ +Â 8*60*60000Â :Â zoneTimeÂ ==Â "UTC+9"Â ?Â eTimeÂ +Â 9*60*60000Â :Â zoneTimeÂ ==Â "UTC+9"Â ?Â eTimeÂ +Â 9*60*60000Â +Â 30*60000Â :Â zoneTimeÂ ==Â "UTC+10"Â ?Â eTimeÂ +Â 10*60*60000Â :Â zoneTimeÂ ==Â "UTC+11"Â ?Â eTimeÂ +Â 11*60*60000Â :Â zoneTimeÂ ==Â "UTC+12"Â ?Â eTimeÂ +Â 12*60*60000Â :Â zoneTimeÂ ==Â "UTC+12:45"Â ?Â eTimeÂ +Â 12*60*60000Â +Â 45*60000Â :Â zoneTimeÂ ==Â "UTC+13"Â ?Â eTimeÂ +Â 13*60*60000Â :Â 0
tradeDateIsAllowed()Â =>
Â Â Â Â dateFilterÂ ?Â timeÂ >=Â sTimeÂ andÂ timeÂ <=Â eTimeÂ :Â true
dateRangeÂ =Â tradeDateIsAllowed()
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 2.Â ğŸ”°Â StrategyÂ ğŸ”°Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HereÂ areÂ locatedÂ theÂ optionsÂ thatÂ youÂ canÂ useÂ inÂ thisÂ strategy.
//#Â *
//#Â *Â Â Â Â Â Â Â Â Â Â Â AquiÂ seÂ encuentranÂ ubicadosÂ lasÂ opcionesÂ queÂ puedesÂ utilizarÂ enÂ estaÂ estrategia.
//#Â *Â Â 
//#Â *Â Â 
//#Â *Â Â HeikinÂ AshiÂ Â |Â Â https://tradingview.com/script/U1QGgSOw-Heikin-Ashi-Source-Function-HTF/
//#Â *
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
superTrendÂ Â Â Â =Â Â Â input.bool(group='ğŸ”°Â StrategyÂ ğŸ”°',Â defval=true,Â Â Â Â title="Supertrend")
closeNewEntryÂ =Â Â Â input.bool(group='ğŸ”°Â StrategyÂ ğŸ”°',Â defval=true,Â Â Â Â title="CloseÂ PositionÂ onÂ NewÂ Entry",Â tooltip="WhenÂ itÂ isÂ activeÂ andÂ aÂ newÂ alertÂ isÂ fired,Â theÂ currentÂ positionÂ isÂ closedÂ toÂ openÂ aÂ newÂ one,Â otherwise,Â theÂ operationsÂ onlyÂ closeÂ whenÂ reachÂ sl/tpÂ \n\nCuandoÂ estÃ¡Â activaÂ yÂ unaÂ nuevaÂ alertaÂ esÂ disparadaÂ seÂ cierraÂ laÂ posicionÂ actualÂ paraÂ abrirÂ unaÂ nueva,Â enÂ casoÂ contrarioÂ lasÂ operacionesÂ soloÂ seÂ cierranÂ alÂ tocarÂ sl/tp")
heikinPriceÂ Â Â =Â Â Â input.bool(group='ğŸ”°Â StrategyÂ ğŸ”°',Â defval=false,Â Â Â title="HeikinÂ AshiÂ Entry",Â tooltip="WhenÂ activated,Â entriesÂ willÂ beÂ basedÂ onÂ HeikinÂ AshiÂ candlesÂ butÂ executedÂ atÂ JapaneseÂ candlesÂ prices.Â DisableÂ theÂ borderÂ ofÂ theÂ candlesÂ fromÂ chartÂ settingsÂ forÂ aÂ betterÂ experience.Â \n\nCuandoÂ seÂ active,Â lasÂ entradasÂ seÂ basarÃ¡nÂ enÂ velasÂ heikinÂ ashiÂ peroÂ seÂ ejecutarÃ¡nÂ aÂ preciosÂ deÂ velasÂ japonesas.Â DeshabiliteÂ elÂ bordeÂ deÂ lasÂ velasÂ desdeÂ laÂ configuraciÃ³nÂ delÂ grÃ¡ficoÂ paraÂ unaÂ mejorÂ experiencia.")
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 1.Â HeikinÂ AshiÂ EntryÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
heikin(_src)Â Â =>Â 
Â Â Â Â CloseÂ Â =Â notÂ heikinPriceÂ ?Â closeÂ :Â ohlc4
Â Â Â Â OpenÂ Â Â =Â float(na)
Â Â Â Â OpenÂ Â :=Â notÂ heikinPriceÂ ?Â openÂ Â :Â na(Open[1])Â ?Â (openÂ +Â close)Â /Â 2Â :Â (nz(Open[1])Â +Â nz(Close[1]))Â /Â 2
Â Â Â Â HighÂ Â Â =Â notÂ heikinPriceÂ ?Â highÂ Â :Â math.max(high,Â math.max(Open,Â Close))
Â Â Â Â LowÂ Â Â Â =Â notÂ heikinPriceÂ ?Â lowÂ Â Â :Â math.min(low,Â Â math.min(Open,Â Close))
Â Â Â Â HL2Â Â Â Â =Â notÂ heikinPriceÂ ?Â hl2Â Â Â :Â math.avg(High,Â Low)Â 
Â Â Â Â HLC3Â Â Â =Â notÂ heikinPriceÂ ?Â hlc3Â Â :Â math.avg(High,Â Low,Â Close)Â 
Â Â Â Â OHLC4Â Â =Â notÂ heikinPriceÂ ?Â ohlc4Â :Â math.avg(Open,Â High,Â Low,Â Close)
Â Â Â Â HLCC4Â Â =Â notÂ heikinPriceÂ ?Â ohlc4Â :Â math.avg(High,Â Low,Â Close,Â Close)
Â Â Â Â PriceÂ Â =Â _srcÂ ==Â 'close'Â ?Â CloseÂ :Â _srcÂ ==Â 'open'Â ?Â OpenÂ :Â _srcÂ ==Â 'high'Â ?Â HighÂ :Â _srcÂ ==Â 'low'Â ?Â LowÂ :Â _srcÂ ==Â 'hl2'Â ?Â HL2Â :Â _srcÂ ==Â 'hlc3'Â ?Â HLC3Â :Â _srcÂ ==Â 'ohlc4'Â ?Â OHLC4Â :Â HLCC4
Â Â Â Â SourceÂ =Â math.round(PriceÂ /Â syminfo.mintick)Â *Â syminfo.mintick
heikinColorÂ Â Â =Â heikin('close')Â >Â heikin('open')Â ?Â #26a69aÂ :Â #ef5350
plotcandle(heikin('open'),Â heikin('high'),Â heikin('low'),Â heikin('close'),Â title="HeikinÂ Ashi",Â color=heikinColor,Â wickcolor=heikinColor,Â bordercolor=heikinColor)
barcolor(color=color.new(heikinPriceÂ ?Â heikinColor:na,Â 100))
OpenÂ Â =Â heikinPriceÂ ?Â heikin('open')Â Â :Â open
HighÂ Â =Â heikinPriceÂ ?Â heikin('high')Â Â :Â high
LowÂ Â Â =Â heikinPriceÂ ?Â heikin('low')Â Â Â :Â low
CloseÂ =Â heikinPriceÂ ?Â heikin('close')Â :Â close
HL2Â Â Â =Â heikinPriceÂ ?Â heikin('hl2')Â Â Â :Â hl2
HLC3Â Â =Â heikinPriceÂ ?Â heikin('hl3')Â Â Â :Â hlc3
OHLC4Â =Â heikinPriceÂ ?Â heikin('ohlc4')Â :Â ohlc4
HLCC4Â =Â heikinPriceÂ ?Â heikin('hlcc4')Â :Â hlcc4
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 2-1.Â IndicatorsÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HereÂ areÂ theÂ indicatorsÂ usedÂ forÂ theÂ strategy
//#Â *
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â AquiÂ seÂ encuentranÂ losÂ indicadoresÂ usadosÂ paraÂ laÂ estrategia.
//#Â *
//#Â *Â Â 
//#Â *Â Â SupertrendÂ Â |Â Â https://tradingview.com/script/P5Gu6F8k/
//#Â *Â Â 
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 1.Â SupertrendÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
stPeriodsÂ Â Â Â =Â input(group="Supertrend",Â title='ATRÂ Period',Â defval=10)
stSourceXÂ Â Â Â =Â input(group="Supertrend",Â title='Source',Â defval=hl2)
stMultiplierÂ =Â input.float(group="Supertrend",Â title='ATRÂ Multiplier',Â defval=3.0,Â step=0.1)
stChangeATRÂ Â =Â input(group="Supertrend",Â title='ChangeÂ ATRÂ CalculationÂ MethodÂ ?',Â defval=false)
showsignalsÂ Â =Â input(group="Supertrend",Â title='PlotÂ Supertrend',Â defval=false)
varipÂ floatÂ stSourceÂ =Â 0.0
stSourceÂ :=Â stSourceXÂ ==Â closeÂ ?Â CloseÂ :Â stSourceXÂ ==Â openÂ ?Â OpenÂ :Â stSourceXÂ ==Â highÂ ?Â HighÂ :Â stSourceXÂ ==Â lowÂ ?Â LowÂ :Â stSourceXÂ ==Â hl2Â ?Â HL2Â :Â stSourceXÂ ==Â hlc3Â ?Â HLC3Â :Â stSourceXÂ ==Â ohlc4Â ?Â OHLC4Â :Â HLCC4
trÂ Â Â =Â math.max(HighÂ -Â Low,Â math.abs(HighÂ -Â Close[1]),Â math.abs(LowÂ -Â Close[1]))Â Â Â Â //Â TheÂ trueÂ rangeÂ andÂ functionsÂ thatÂ needÂ olhcÂ needÂ toÂ beÂ calculatedÂ withÂ theÂ customÂ olhcÂ valuesÂ 
atr2Â =Â ta.sma(tr,Â stPeriods)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â inÂ linesÂ 117-124Â forÂ theÂ heikinÂ ashiÂ entries,Â otherwiseÂ theÂ functionsÂ willÂ beÂ calculatedÂ with
atrÂ Â =Â stChangeATRÂ ?Â atr2Â :Â ta.rma(tr,Â stPeriods)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â JapaneseÂ valuesÂ andÂ theÂ entriesÂ willÂ beÂ inÂ JapaneseÂ candlesticks.
upÂ Â Â =Â stSourceÂ -Â stMultiplierÂ *Â atr
up1Â Â =Â nz(up[1],Â up)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ElÂ rangoÂ verdaderoÂ yÂ lasÂ funcionesÂ queÂ necesitanÂ olhc,Â necesitanÂ serÂ calculadosÂ conÂ losÂ valoresÂ 
upÂ Â Â :=Â Close[1]Â >Â up1Â ?Â math.max(up,Â up1)Â :Â upÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â olhcÂ personalizadosÂ enÂ lasÂ lÃ­neasÂ 117-124Â paraÂ lasÂ entradasÂ heikinÂ ashi,Â deÂ loÂ contrarioÂ lasÂ 
dnÂ Â Â =Â stSourceÂ +Â stMultiplierÂ *Â atrÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â funcionesÂ serÃ¡nÂ calculadasÂ conÂ valoresÂ japonesesÂ yÂ lasÂ entradasÂ estarÃ¡nÂ enÂ velasÂ japonesas.
dn1Â Â =Â nz(dn[1],Â dn)
dnÂ Â Â :=Â Close[1]Â <Â dn1Â ?Â math.min(dn,Â dn1)Â :Â dn
trendÂ =Â 1
trendÂ :=Â nz(trend[1],Â trend)
trendÂ :=Â trendÂ ==Â -1Â andÂ CloseÂ >Â dn1Â ?Â 1Â :Â trendÂ ==Â 1Â andÂ CloseÂ <Â up1Â ?Â -1Â :Â trend
supertrendÂ =Â trendÂ ==Â 1Â ?Â trueÂ :Â falseÂ Â Â Â Â Â Â Â Â //ğŸ”µ
supertrendBuyÂ Â =Â trendÂ ==Â 1Â andÂ trend[1]Â ==Â -1Â //ğŸŸ¢
supertrendSellÂ =Â trendÂ ==Â -1Â andÂ trend[1]Â ==Â 1Â //ğŸ”´
upPlotÂ =Â plot(trendÂ ==Â 1Â andÂ showsignalsÂ ?Â upÂ :Â na,Â title='Supertrend',Â style=plot.style_linebr,Â color=color.new(color.green,Â 0),Â linewidth=2)
dnPlotÂ =Â plot(trendÂ !=Â 1Â andÂ showsignalsÂ ?Â dnÂ :Â na,Â title='Supertrend',Â style=plot.style_linebr,Â color=color.new(color.red,Â Â Â 0),Â linewidth=2)
plotshape(supertrendBuyÂ Â andÂ showsignalsÂ ?Â upÂ :Â na,Â title='Supertrend',Â style=shape.circle,Â Â Â Â Â Â color=color.new(color.green,Â 0),Â location=location.absolute,Â size=size.tiny)
plotshape(supertrendBuyÂ Â andÂ showsignalsÂ ?Â upÂ :Â na,Â title='Supertrend',Â style=shape.labelup,Â Â Â Â Â color=color.new(color.green,Â 0),Â location=location.absolute,Â text='Buy',Â Â textcolor=color.new(color.white,Â 0))
plotshape(supertrendSellÂ andÂ showsignalsÂ ?Â dnÂ :Â na,Â title='Supertrend',Â style=shape.circle,Â Â Â Â Â Â color=color.new(color.red,Â Â Â 0),Â location=location.absolute,Â size=size.tiny)
plotshape(supertrendSellÂ andÂ showsignalsÂ ?Â dnÂ :Â na,Â title='Supertrend',Â style=shape.labeldown,Â Â Â color=color.new(color.red,Â Â Â 0),Â location=location.absolute,Â text='Sell',Â textcolor=color.new(color.white,Â 0))
mPlotÂ =Â plot(ohlc4,Â title='Supertrend',Â style=plot.style_circles,Â linewidth=0,Â color=color.new(color.white,Â 100))
longFillColorÂ Â =Â trendÂ ==Â Â 1Â ?Â color.greenÂ :Â color.white
shortFillColorÂ =Â trendÂ ==Â -1Â ?Â color.redÂ Â Â :Â color.white
fill(mPlot,Â upPlot,Â title='UpTrendÂ Highligter',Â Â Â color=color.new(longFillColor,Â Â 90))
fill(mPlot,Â dnPlot,Â title='DownTrendÂ Highligter',Â color=color.new(shortFillColor,Â 90))
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 3.Â StopÂ LossÂ andÂ TakeÂ ProfitÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *
//#Â *Â Â Â Â Â Â Â Â Â Â Â VariousÂ optionsÂ forÂ stopÂ lossÂ andÂ takeÂ profitÂ areÂ alreadyÂ pre-programmedÂ toÂ 
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â protectÂ theÂ investmentÂ fromÂ unexpectedÂ marketÂ movements.
//#Â *
//#Â *Â Â Â Â Â Â Â Â Â Â Â DiversasÂ opcionesÂ paraÂ stopÂ lossÂ yÂ takeÂ profitÂ seÂ encuentranÂ yaÂ pre-programadasÂ 
//#Â *Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â paraÂ asiÂ protegerÂ laÂ inversionÂ deÂ movimientosÂ innesperadosÂ delÂ mercado
//#Â *
//#Â *
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
SLÂ Â Â Â Â Â Â =Â input.bool(Â Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="UseÂ StopÂ Loss",Â Â Â Â Â defval=true)
optionSLÂ =Â input.string(Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="TypeÂ ofÂ Stop",Â Â Â Â Â Â defval="LastÂ High/Low",Â Â Â Â Â Â Â Â optionsÂ =Â ["FixedÂ %",Â "FixedÂ $",Â "ATR",Â "LastÂ High/Low",Â "Custom"])
fixedPSLÂ =Â input.float(Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="FixedÂ %",Â Â Â Â Â Â Â Â Â Â Â defval=1,Â Â Â minvalÂ =Â 0)Â Â /Â 100
fixedESLÂ =Â input.float(Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="FixedÂ $",Â Â Â Â Â Â Â Â Â Â Â defval=100,Â minvalÂ =Â 0)
atrLÂ Â Â Â Â =Â input.int(Â Â Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="ATRÂ Lenght",Â Â Â Â Â Â Â Â defval=14,Â Â minvalÂ =Â 1)
atrMÂ Â Â Â Â =Â input.float(Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="ATRÂ Multiplier",Â Â Â Â defval=1,Â Â Â minvalÂ =Â 0)
leftBHLÂ Â =Â input.int(Â Â Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="LastÂ H/LÂ Left",Â Â Â Â Â defval=5,Â Â Â minvalÂ =Â 1)
rightBHLÂ =Â input.int(Â Â Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="lastÂ H/LÂ Right",Â Â Â Â defval=5,Â Â Â minvalÂ =Â 1)
customSLÂ =Â input.string(Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="Custom",Â Â Â Â Â Â Â Â Â Â Â Â defval="Custom",Â Â Â Â Â Â Â Â Â optionsÂ =Â ["Custom"])
trailSLÂ Â =Â input.bool(Â Â Â group="ğŸ”´Â StopÂ LossÂ ğŸ”´",Â Â Â title="TrailngÂ StopÂ Loss",Â defval=false,Â Â Â Â Â Â Â Â Â Â Â Â tooltip="TheÂ maximumÂ stopÂ lossÂ priceÂ willÂ decreaseÂ asÂ theÂ closingÂ priceÂ movesÂ furtherÂ awayÂ fromÂ theÂ entryÂ price.Â \n\nElÂ precioÂ maximoÂ deÂ stopÂ lossÂ iraÂ disminuyendoÂ mientrasÂ elÂ precioÂ deÂ cierreÂ seÂ alejeÂ masÂ delÂ precioÂ deÂ entrada")
TPÂ Â Â Â Â Â Â =Â input.bool(Â Â Â group="ğŸŸ¢Â TakeÂ ProfitÂ ğŸŸ¢",Â title="UseÂ TakeÂ Profit",Â Â Â defval=true)
optionTPÂ =Â input.string(Â group="ğŸŸ¢Â TakeÂ ProfitÂ ğŸŸ¢",Â title="TypeÂ ofÂ Stop",Â Â Â Â Â Â defval="RatioÂ 1:#",Â Â Â Â Â Â Â Â optionsÂ =Â ["FixedÂ %",Â "FixedÂ $",Â "RatioÂ 1:#",Â "Custom"])
fixedPTPÂ =Â input.float(Â Â group="ğŸŸ¢Â TakeÂ ProfitÂ ğŸŸ¢",Â title="FixedÂ %",Â Â Â Â Â Â Â Â Â Â Â defval=1,Â Â Â minvalÂ =Â 0)Â Â /Â 100
fixedETPÂ =Â input.float(Â Â group="ğŸŸ¢Â TakeÂ ProfitÂ ğŸŸ¢",Â title="FixedÂ $",Â Â Â Â Â Â Â Â Â Â Â defval=100,Â minvalÂ =Â 0)
ratioTPÂ Â =Â input.float(Â Â group="ğŸŸ¢Â TakeÂ ProfitÂ ğŸŸ¢",Â title="RatioÂ 1:",Â Â Â Â Â Â Â Â Â Â defval=1,Â Â Â minvalÂ =Â 0)
customTPÂ =Â input.string(Â group="ğŸŸ¢Â TakeÂ ProfitÂ ğŸŸ¢",Â title="Custom",Â Â Â Â Â Â Â Â Â Â Â Â defval="Custom",Â Â Â Â Â Â Â Â Â optionsÂ =Â ["Custom"])
inOperationBÂ =Â strategy.position_sizeÂ >Â Â 0Â ?Â trueÂ :Â false
inOperationSÂ =Â strategy.position_sizeÂ <Â Â 0Â ?Â trueÂ :Â false
inOperationÂ Â =Â strategy.position_sizeÂ !=Â 0Â ?Â trueÂ :Â false
varipÂ floatÂ stopLossBÂ Â Â =Â 0
varipÂ floatÂ takeProfitBÂ =Â 0
varipÂ floatÂ stopLossSÂ Â Â =Â 0
varipÂ floatÂ takeProfitSÂ =Â 0
varipÂ floatÂ entryPriceÂ Â =Â 0
varipÂ floatÂ entryPriceBÂ =Â 0
varipÂ floatÂ entryPriceSÂ =Â 0
varipÂ floatÂ trailingBÂ =Â 0
varipÂ floatÂ trailingSÂ =Â 0
buyÂ Â =Â superTrendÂ andÂ supertrendBuyÂ Â //ğŸŸ¢
sellÂ =Â superTrendÂ andÂ supertrendSellÂ //ğŸ”´
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 1.Â ATRÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
atrHighÂ =Â ta.rma(ta.tr(true),Â atrL)Â *Â atrMÂ +Â high
atrLowÂ Â =Â lowÂ -Â ta.rma(ta.tr(true),Â atrL)Â *Â atrM
atrHighPlotÂ =Â plot(atrHigh,Â title='ATRÂ SellÂ StopÂ Loss',Â color=color.new(color.red,Â Â Â notÂ inOperationÂ andÂ optionSLÂ ==Â "ATR"Â ?Â 70Â :Â 100),Â style=plot.style_stepline)
atrLowPlotÂ Â =Â plot(atrLow,Â Â title='ATRÂ BuyÂ StopÂ Loss',Â Â color=color.new(color.green,Â notÂ inOperationÂ andÂ optionSLÂ ==Â "ATR"Â ?Â 70Â :Â 100),Â style=plot.style_stepline)
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 2.Â PivotÂ PointsÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
mbÂ =Â leftBHLÂ +Â rightBHLÂ +Â 1
highestbars_1Â =Â ta.highestbars(mb)
lowestbars_1Â Â =Â ta.lowestbars(mb)
iff_1Â =Â highestbars_1Â ==Â -leftBHLÂ ?Â high[leftBHL]Â :Â na
iff_2Â =Â lowestbars_1Â Â ==Â -leftBHLÂ ?Â Â low[leftBHL]Â :Â na
lowestÂ Â =Â notÂ na(high[mb])Â ?Â iff_1Â :Â na
highestÂ =Â notÂ na(Â low[mb])Â ?Â iff_2Â :Â na
varipÂ floatÂ highestHighÂ =Â 0
varipÂ floatÂ lowestLowÂ =Â 0
highestHighÂ :=Â ta.valuewhen(lowest,Â high[leftBHL],Â 0)
lowestLowÂ Â Â :=Â ta.valuewhen(highest,Â low[leftBHL],Â 0)
plotshape(highest,Â title="LastÂ Low",Â Â color=color.new(color.red,Â Â Â optionSLÂ ==Â "LastÂ High/Low"Â ?Â Â 0Â :Â 100),Â style=shape.triangleup,Â Â Â location=location.belowbar,Â size=size.tiny,Â offset=-leftBHL)
plotshape(lowest,Â Â title="LastÂ High",Â color=color.new(color.lime,Â Â optionSLÂ ==Â "LastÂ High/Low"Â ?Â Â 0Â :Â 100),Â style=shape.triangledown,Â location=location.abovebar,Â size=size.tiny,Â offset=-leftBHL)
plot(lowestLow,Â Â Â Â title='LastÂ Low',Â Â color=color.new(color.red,Â Â Â optionSLÂ ==Â "LastÂ High/Low"Â ?Â 70Â :Â 100),Â style=plot.style_stepline)
plot(highestHigh,Â Â title='LastÂ High',Â color=color.new(color.green,Â optionSLÂ ==Â "LastÂ High/Low"Â ?Â 70Â :Â 100),Â style=plot.style_stepline)
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 3.Â StopÂ LossÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
calculateSL()Â =>
Â Â Â Â varipÂ floatÂ stopResultÂ =Â 0
Â Â Â Â varipÂ floatÂ stopÂ =Â 0
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "FixedÂ %"Â Â Â Â Â Â Â andÂ buyÂ Â 
Â Â Â Â Â Â Â Â stopÂ :=Â entryPriceBÂ -Â (Â entryPriceBÂ *Â fixedPSL)
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "FixedÂ %"Â Â Â Â Â Â Â andÂ sellÂ Â 
Â Â Â Â Â Â Â Â stopÂ :=Â entryPriceSÂ +Â (Â entryPriceSÂ *Â fixedPSL)
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "FixedÂ $"Â Â Â Â Â Â Â andÂ buyÂ Â Â 
Â Â Â Â Â Â Â Â stopÂ :=Â entryPriceBÂ -Â fixedESL
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "FixedÂ $"Â Â Â Â Â Â Â andÂ sellÂ Â 
Â Â Â Â Â Â Â Â stopÂ :=Â entryPriceSÂ +Â fixedESL
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "LastÂ High/Low"Â andÂ buyÂ Â Â 
Â Â Â Â Â Â Â Â stopÂ :=Â lowestLowÂ Â 
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "LastÂ High/Low"Â andÂ sellÂ Â 
Â Â Â Â Â Â Â Â stopÂ :=Â highestHigh
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "ATR"Â Â Â Â Â Â Â Â Â Â Â andÂ buyÂ Â Â 
Â Â Â Â Â Â Â Â stopÂ :=Â atrLowÂ 
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "ATR"Â Â Â Â Â Â Â Â Â Â Â andÂ sellÂ Â 
Â Â Â Â Â Â Â Â stopÂ :=Â atrHigh
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "Custom"Â Â Â Â Â Â Â Â andÂ buyÂ Â Â 
Â Â Â Â Â Â Â Â stopÂ :=Â entryPriceBÂ -Â (Â entryPriceBÂ *Â fixedPSL)
Â Â Â Â 
Â Â Â Â ifÂ optionSLÂ ==Â "Custom"Â Â Â Â Â Â Â Â andÂ sellÂ Â 
Â Â Â Â Â Â Â Â stopÂ :=Â entryPriceSÂ +Â (Â entryPriceSÂ *Â fixedPSL)
Â Â Â Â 
Â Â Â Â stopResultÂ :=Â stop
Â Â Â Â 
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 4.Â TakeÂ ProfitÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
calculateTP()Â =>
Â Â Â Â varipÂ floatÂ takeResultÂ =Â 0
Â Â Â Â varipÂ floatÂ takeÂ =Â 0
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "FixedÂ %"Â Â Â Â Â Â Â Â Â Â Â Â andÂ buyÂ 
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceBÂ +Â (Â entryPriceBÂ *Â fixedPTP)
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "FixedÂ %"Â Â Â Â Â Â Â Â Â Â Â Â andÂ sell
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceSÂ -Â (Â entryPriceSÂ *Â fixedPTP)
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "FixedÂ $"Â Â Â Â Â Â Â Â Â Â Â Â andÂ buyÂ 
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceBÂ +Â fixedETP
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "FixedÂ $"Â Â Â Â Â Â Â Â Â Â Â Â andÂ sell
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceSÂ -Â fixedETP
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "RatioÂ 1:#"Â Â Â Â Â Â Â Â Â Â andÂ buyÂ 
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceBÂ +Â (Â trailingBÂ *Â ratioTPÂ )
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "RatioÂ 1:#"Â Â Â Â Â Â Â Â Â Â andÂ sell
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceSÂ -Â (Â trailingSÂ *Â ratioTPÂ )
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "Custom"Â Â Â Â Â Â Â Â Â Â Â Â Â andÂ buy
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceBÂ +Â (Â entryPriceBÂ *Â fixedPTP)
Â Â Â Â Â Â Â Â 
Â Â Â Â ifÂ optionTPÂ ==Â "Custom"Â Â Â Â Â Â Â Â Â Â Â Â Â andÂ sell
Â Â Â Â Â Â Â Â takeÂ :=Â entryPriceSÂ -Â (Â entryPriceSÂ *Â fixedPTP)
Â Â Â Â Â Â Â Â 
Â Â Â Â takeResultÂ :=Â take
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 5.Â BUYÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ifÂ inOperationBÂ andÂ trailSLÂ andÂ notÂ buy
Â Â Â Â stopLossBNewÂ =Â closeÂ -Â trailingB
Â Â Â Â stopLossBÂ :=Â stopLossBNewÂ >Â stopLossBÂ ?Â stopLossBNewÂ :Â stopLossB[1]
Â Â Â Â strategy.exit("BuyÂ Exit",Â "Buy",Â stop=stopLossB,Â limit=takeProfitB)
ifÂ dateRangeÂ andÂ buyÂ andÂ (((inOperationÂ andÂ closeNewEntry)Â orÂ notÂ inOperation))
Â Â Â Â entryPriceÂ Â :=Â close
Â Â Â Â entryPriceBÂ :=Â close
Â Â Â Â stopLossBÂ Â Â :=Â SLÂ ?Â calculateSL()Â :Â na
Â Â Â Â trailingBÂ Â Â :=Â closeÂ -Â stopLossB
Â Â Â Â takeProfitBÂ :=Â TPÂ ?Â calculateTP()Â :Â na
Â Â Â Â strategy.entry("Buy",Â strategy.long,Â limit=entryPriceB)
Â Â Â Â strategy.exit("BuyÂ Exit",Â "Buy",Â stop=stopLossB,Â limit=takeProfitB)
ifÂ sellÂ andÂ inOperationBÂ andÂ notÂ closeNewEntry
Â Â Â Â strategy.cancel("Buy")
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 6.Â SELLÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ifÂ inOperationSÂ andÂ trailSLÂ andÂ notÂ sell
Â Â Â Â stopLossSNewÂ =Â closeÂ +Â trailingS
Â Â Â Â stopLossSÂ :=Â stopLossSNewÂ >Â stopLossSÂ ?Â stopLossSNewÂ :Â stopLossS[1]
Â Â Â Â strategy.exit("SellÂ Exit",Â "Sell",Â stop=stopLossS,Â limit=takeProfitS)
ifÂ dateRangeÂ andÂ sellÂ andÂ (((inOperationÂ andÂ closeNewEntry)Â orÂ notÂ inOperation))
Â Â Â Â entryPriceÂ Â :=Â close
Â Â Â Â entryPriceSÂ :=Â close
Â Â Â Â stopLossSÂ Â Â :=Â SLÂ ?Â calculateSL()Â :Â na
Â Â Â Â trailingSÂ Â Â :=Â stopLossSÂ -Â close
Â Â Â Â takeProfitSÂ :=Â TPÂ ?Â calculateTP()Â :Â na
Â Â Â Â strategy.entry("Sell",Â strategy.short,Â limit=entryPriceS)
Â Â Â Â strategy.exit("SellÂ Exit",Â "Sell",Â stop=stopLossS,Â limit=takeProfitS)
ifÂ sellÂ andÂ inOperationSÂ andÂ notÂ closeNewEntry
Â Â Â Â strategy.cancel("Sell")
slbpÂ =Â plot(stopLossB,Â Â Â color=color.new(color.red,Â Â Â inOperationBÂ ?Â Â 0Â :Â 100),Â style=plot.style_linebr,Â linewidth=3,Â title="StopÂ LossÂ B")
slspÂ =Â plot(stopLossS,Â Â Â color=color.new(color.red,Â Â Â inOperationSÂ ?Â Â 0Â :Â 100),Â style=plot.style_linebr,Â linewidth=3,Â title="StopÂ LossÂ S")
tpbpÂ =Â plot(takeProfitB,Â color=color.new(color.green,Â inOperationBÂ ?Â Â 0Â :Â 100),Â style=plot.style_linebr,Â linewidth=3,Â title="TakeÂ ProfitÂ B")
tpspÂ =Â plot(takeProfitS,Â color=color.new(color.green,Â inOperationSÂ ?Â Â 0Â :Â 100),Â style=plot.style_linebr,Â linewidth=3,Â title="TakeÂ ProfitÂ S")
epbpÂ =Â plot(entryPriceB,Â color=color.new(color.gray,Â Â inOperationBÂ ?Â 50Â :Â 100),Â style=plot.style_linebr,Â linewidth=3,Â title="EntryÂ PriceÂ B")
epspÂ =Â plot(entryPriceS,Â color=color.new(color.gray,Â Â inOperationSÂ ?Â 50Â :Â 100),Â style=plot.style_linebr,Â linewidth=3,Â title="EntryÂ PriceÂ S")
fill(epbp,Â slbp,Â color=color.new(color.red,Â Â Â inOperationBÂ ?Â 75Â :Â 100))
fill(epbp,Â tpbp,Â color=color.new(color.green,Â inOperationBÂ ?Â 75Â :Â 100))
fill(epsp,Â slsp,Â color=color.new(color.red,Â Â Â inOperationSÂ ?Â 75Â :Â 100))
fill(epsp,Â tpsp,Â color=color.new(color.green,Â inOperationSÂ ?Â 75Â :Â 100))
newWinÂ Â =Â (strategy.wintradesÂ Â >Â strategy.wintrades[1])Â andÂ (strategy.losstradesÂ ==Â strategy.losstrades[1])Â andÂ (strategy.eventradesÂ ==Â strategy.eventrades[1])
newLossÂ =Â (strategy.wintradesÂ ==Â strategy.wintrades[1])Â andÂ (strategy.losstradesÂ Â >Â strategy.losstrades[1])Â andÂ (strategy.eventradesÂ ==Â strategy.eventrades[1])
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”Â 4.Â LabelÂ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
//#Â *
//#Â *Â Â Â Â Â Â TheÂ dataÂ collectedÂ fromÂ theÂ entireÂ backtestÂ willÂ beÂ displayedÂ inÂ aÂ labelÂ forÂ betterÂ analysis.
//#Â *
//#Â *Â Â Â Â Â Â Â LosÂ datosÂ recopiladosÂ deÂ todoÂ elÂ backtestÂ seÂ mostraranÂ enÂ unÂ labelÂ paraÂ unÂ mejorÂ analisis
//#Â *
//#Â *
//Â â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
plotDashboardÂ =Â input.bool(group="ğŸ“ŠÂ Dashboard",Â title="PlotÂ Dashboard",Â defval=true)
MTLabel(ftimestamp,Â etimestamp,Â profit,Â winRate,Â pFactor,Â closedTrades,Â winTrades,Â lossTrades,Â avgWin,Â avgLoss,Â maxWinRow,Â maxLossRow)Â =>
Â Â Â Â stringÂ _textÂ =Â 'Â Â Â Â Â Â Â Â Â ğŸ”°MTÂ BacktesterğŸ”°'Â +Â '\n'
Â Â Â Â _textÂ +=Â 'â–â–â–â–â–â–â–â–â–â–'Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â Since:'Â +Â '\n'
Â Â Â Â _textÂ +=Â str.format("Â Â Â Â {0,date,long}Â Â ",Â ftimestamp)Â +Â str.format("{0,time,HH:mm}",Â ftimestamp)Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â To:'Â +Â '\n'
Â Â Â Â _textÂ +=Â str.format("Â Â Â Â {0,date,long}Â Â ",Â etimestamp)Â +Â str.format("{0,time,HH:mm}",Â etimestamp)Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'â–â–â–â–â–â–â–â–â–â–'Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â #ï¸âƒ£Trades:Â Â 'Â +Â str.tostring(closedTrades,Â '##.##')Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â Profit:'Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â Â Â Â Â 'Â +Â (profitÂ <Â 0Â ?Â "ğŸ”´Â "Â :Â "ğŸŸ¢Â ")Â +Â str.tostring(profit,Â '##.##')Â +Â '%Â \n'
Â Â Â Â _textÂ +=Â 'Â WinÂ Rate:'Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â Â Â Â Â 'Â +Â (winRateÂ <Â 50Â ?Â "ğŸ”´Â "Â :Â winRateÂ <Â 75Â ?Â "ğŸŸ¡Â "Â :Â "ğŸŸ¢Â ")Â +Â str.tostring(winRate,Â '##.##')Â +Â '%Â \n'
Â Â Â Â _textÂ +=Â 'Â ProfitÂ Factor:'Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â Â Â Â Â 'Â +Â (pFactorÂ <Â 1Â ?Â "ğŸ”´Â "Â :Â pFactorÂ <Â 1.5Â ?Â "ğŸŸ¡Â "Â :Â "ğŸŸ¢Â ")Â +Â str.tostring(pFactor,Â '##.###')Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â WinÂ Trades:Â Â Â 'Â +Â str.tostring(winTrades,Â '######')Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â LossÂ Trades:Â Â Â 'Â +Â str.tostring(lossTrades,Â '######')Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â AvgÂ Win:Â Â 'Â +Â str.tostring(avgWin,Â '##.##')Â +Â '%\n'
Â Â Â Â _textÂ +=Â 'Â AvgÂ Loss:Â Â 'Â +Â str.tostring(avgLoss,Â '##.##')Â +Â '%\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â MaxÂ WinÂ inÂ aÂ Row:Â Â 'Â +Â str.tostring(maxWinRow,Â '######')Â Â +Â '\n'
Â Â Â Â _textÂ +=Â 'Â MaxÂ LossÂ inÂ aÂ Row:Â Â 'Â +Â str.tostring(maxLossRow,Â '######')Â Â +Â '\n'
Â Â Â Â _textÂ +=Â ''Â +Â '\n'
Â Â Â Â _textÂ +=Â 'â–â–â–â–â–â–â–â–â–â–'Â +Â '\n'
firstBarÂ =Â barstate.isfirstÂ ?Â trueÂ :Â false
fvalueÂ =Â ta.valuewhen(firstBar,Â time,Â 0)
ftimestampÂ =Â dateFilterÂ ?Â zsTimeÂ :Â timestamp(year(fvalue),Â month(fvalue),Â dayofmonth(fvalue),Â 0,Â 0,Â 0)
etimestampÂ =Â dateFilterÂ ?Â zeTimeÂ :Â zcTime
profitÂ =Â (Â strategy.netprofitÂ /Â strategy.initial_capitalÂ )Â *Â 100
winRateÂ =Â (Â strategy.wintradesÂ /Â strategy.closedtradesÂ )Â *Â 100
pFactorÂ =Â (Â strategy.grossprofitÂ /Â strategy.grosslossÂ )
closedTradesÂ =Â strategy.closedtrades
winTradesÂ =Â strategy.wintrades
lossTradesÂ =Â strategy.losstrades
avgWinÂ =Â ((Â strategy.grossprofitÂ /Â strategy.wintradesÂ )Â *Â 100Â )Â /Â strategy.initial_capital
avgLossÂ =Â ((Â strategy.grosslossÂ /Â strategy.losstradesÂ )Â *Â 100Â )Â /Â strategy.initial_capital
varipÂ intÂ winRowÂ Â Â Â Â =Â 0
varipÂ intÂ lossRowÂ Â Â Â =Â 0
varipÂ intÂ maxWinRowÂ Â =Â 0
varipÂ intÂ maxLossRowÂ =Â 0
ifÂ newWin
Â Â Â Â lossRowÂ :=Â 0
Â Â Â Â winRowÂ :=Â winRowÂ +Â 1
Â Â Â Â ifÂ winRowÂ >Â maxWinRow
Â Â Â Â Â Â Â Â maxWinRowÂ :=Â winRow
Â Â Â Â Â Â Â Â 
ifÂ newLoss
Â Â Â Â winRowÂ :=Â 0
Â Â Â Â lossRowÂ :=Â lossRowÂ +Â 1
Â Â Â Â ifÂ lossRowÂ >Â maxLossRow
Â Â Â Â Â Â Â Â maxLossRowÂ :=Â lossRow
labelÂ laÂ =Â na
label.delete(la[1])
txtÂ =Â MTLabel(ftimestamp,Â etimestamp,Â profit,Â winRate,Â pFactor,Â closedTrades,Â winTrades,Â lossTrades,Â avgWin,Â avgLoss,Â maxWinRow,Â maxLossRow)
xvalÂ =Â timeframe.periodÂ ==Â "1"Â ?Â timenowÂ +Â 300000Â :Â timeframe.periodÂ ==Â "3"Â ?Â timenowÂ +Â (15*60000)Â :Â timeframe.periodÂ ==Â "5"Â ?Â timenowÂ +Â (25*60000)Â :Â timeframe.periodÂ ==Â "15"Â ?Â timenowÂ +Â (75*60000)Â :Â timeframe.periodÂ ==Â "30"Â ?Â timenowÂ +Â (150*60000)Â :Â timeframe.periodÂ ==Â "45"Â ?Â timenowÂ +Â (225*60000)Â :Â timeframe.periodÂ ==Â "60"Â ?Â timenowÂ +Â (300*60000)Â :Â timeframe.periodÂ ==Â "180"Â ?Â timenowÂ +Â (600*60000)Â :Â timeframe.periodÂ ==Â "240"Â ?Â timenowÂ +Â (1200*60000)Â :Â timeframe.periodÂ ==Â "D"Â ?Â timenowÂ +Â (7200*60000)Â :Â timenowÂ +Â (50400*60000)
laÂ :=Â plotDashboardÂ ?Â label.new(x=xval,Â xloc=xloc.bar_time,Â yloc=yloc.price,Â y=close,Â text=txt,Â color=color.new(color.black,Â 50),Â style=label.style_label_left,Â textcolor=color.white,Â size=size.normal,Â textalign=text.align_left)Â :Â na
Expand (484 lines)