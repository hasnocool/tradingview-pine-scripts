Script Name: Ultimate Strategy Template (Advanced Edition)
Author: Daveatt
Description: Hello traders

This script is an upgraded version of that one below

  

 New features 

- Upgraded to Pinescript version 5
- Added the exit SL/TP now in real-time 
- Added text fields for the alerts - easier to send the commands to your trading bots

 Step 1: Create your connector 

Adapt your indicator with only 2 lines of code and then connect it to this...
PineScript code:

Pine Scriptâ„¢ strategy
Ultimate Strategy Template (Advanced Edition)
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
//@version=5
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//Â Â©Â Daveatt
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â SAMPLEÂ INDICATORÂ Â |
//Â #Â =========================================================================Â #
//Â SampleÂ scriptÂ toÂ plugÂ toÂ theÂ strategyÂ template
//Â //@version=5
//indicator(title='MovingÂ AverageÂ Cross',Â shorttitle='MovingÂ AverageÂ Cross',Â overlay=true,Â precision=6,Â max_labels_count=500,Â max_lines_count=500)
//Â type_ma1Â =Â input.string(title='MA1Â type',Â defval='SMA',Â options=['RMA',Â 'SMA',Â 'EMA'])
//Â length_ma1Â =Â input(10,Â title='[ALLÂ butÂ VWAP]Â MA1Â length')
//Â type_ma2Â =Â input.string(title='MA2Â type',Â defval='SMA',Â options=['RMA',Â 'SMA',Â 'EMA'])
//Â length_ma2Â =Â input(100,Â title='[ALLÂ butÂ VWAP]Â MA2Â length')
//Â //Â MA
//Â f_ma(smoothing,Â src,Â length)Â =>
//Â Â Â Â Â rma_1Â =Â ta.rma(src,Â length)
//Â Â Â Â Â sma_1Â =Â ta.sma(src,Â length)
//Â Â Â Â Â ema_1Â =Â ta.]ema(src,Â length)
//Â Â Â Â Â iff_1Â =Â smoothingÂ ==Â 'EMA'Â ?Â ema_1Â :Â src
//Â Â Â Â Â iff_2Â =Â smoothingÂ ==Â 'SMA'Â ?Â sma_1Â :Â iff_1
//Â Â Â Â Â smoothingÂ ==Â 'RMA'Â ?Â rma_1Â :Â iff_2
//Â MA1Â =Â f_ma(type_ma1,Â close,Â length_ma1)
//Â MA2Â =Â f_ma(type_ma2,Â close,Â length_ma2)
//Â //Â buyÂ andÂ sellÂ conditions
//Â buyÂ =Â ta.crossover(MA1,Â MA2)
//Â sellÂ =Â ta.crossunder(MA1,Â MA2)
//Â plot(MA1,Â color=color.new(color.green,Â 0),Â title='PlotÂ MA1',Â linewidth=3)
//Â plot(MA2,Â color=color.new(color.red,Â 0),Â title='PlotÂ MA2',Â linewidth=3)
//Â plotshape(buy,Â title='LONGÂ SIGNAL',Â style=shape.circle,Â location=location.belowbar,Â color=color.new(color.green,Â 0),Â size=size.normal)
//Â plotshape(sell,Â title='SHORTÂ SIGNAL',Â style=shape.circle,Â location=location.abovebar,Â color=color.new(color.red,Â 0),Â size=size.normal)
//Â ///////////////////////////Â SIGNALÂ FORÂ STRATEGYÂ /////////////////////////
//Â SignalÂ =Â buyÂ ?Â 1Â :Â sellÂ ?Â -1Â :Â 0
//Â plot(Signal,Â title='ğŸ”ŒConnectorğŸ”Œ',Â displayÂ =Â display.data_window)
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â SAMPLEÂ INDICATORÂ Â |
//Â #Â =========================================================================Â #
VERSIONÂ =Â "V7"
SCRIPT_NAMEÂ =Â "BESTÂ StrategyÂ TemplateÂ "Â +Â VERSION
Â Â Â Â 
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â STRATEGYÂ Â |
//Â #Â =========================================================================Â #
//Â TheseÂ valuesÂ areÂ usedÂ bothÂ inÂ theÂ strategy()Â headerÂ andÂ inÂ theÂ script'sÂ relevantÂ inputsÂ asÂ defaultÂ valuesÂ soÂ theyÂ match.
//Â UnlessÂ theseÂ valuesÂ matchÂ inÂ theÂ script'sÂ InputsÂ andÂ theÂ TVÂ backtestingÂ Properties,Â resultsÂ betweenÂ themÂ cannotÂ beÂ compared.
InitCapitalÂ =Â 10000000
InitPositionÂ =Â 2.0
InitCommissionÂ =Â 0.075
InitPyramidMaxÂ =Â 1
CalcOnorderFillsÂ =Â false
ProcessOrdersOnCloseÂ =Â true
CalcOnEveryTickÂ =Â false
CloseEntriesRuleÂ =Â "FIFO"
strategy(title=SCRIPT_NAME,Â shorttitle=SCRIPT_NAME,Â 
Â overlay=true,Â pyramiding=InitPyramidMax,Â initial_capital=InitCapital,Â default_qty_type=strategy.percent_of_equity,Â process_orders_on_close=ProcessOrdersOnClose,
Â default_qty_value=InitPosition,Â commission_type=strategy.commission.percent,Â commission_value=InitCommission,Â calc_on_order_fills=CalcOnorderFills,Â 
Â calc_on_every_tick=CalcOnEveryTick,
Â precision=9,Â max_lines_count=500,Â max_labels_count=500)
//Â #Â =========================================================================Â #
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ||Â Â Â AlertsÂ Â ||
//Â #Â =========================================================================Â #
//Â #Â =========================================================================Â #
i_alert_txt_entry_longÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "LongÂ EntryÂ Message",Â groupÂ =Â "Alerts")
i_alert_txt_entry_shortÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "ShortÂ EntryÂ Message",Â groupÂ =Â "Alerts")
i_alert_txt_exit_SL_longÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "LongÂ ExitÂ SLÂ Message",Â groupÂ =Â "Alerts")
i_alert_txt_exit_TP1_longÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "LongÂ ExitÂ TP1Â Message",Â groupÂ =Â "Alerts")
i_alert_txt_exit_custom_longÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "LongÂ CustomÂ ExitÂ Message",Â groupÂ =Â "Alerts")
i_alert_txt_exit_SL_shortÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "ShortÂ ExitÂ SLÂ Message",Â groupÂ =Â "Alerts")
i_alert_txt_exit_TP1_shortÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "ShortÂ ExitÂ TP1Â Message",Â groupÂ =Â "Alerts")
i_alert_txt_exit_custom_shortÂ =Â input.text_area(defvalÂ =Â "",Â titleÂ =Â "ShortÂ CustomÂ ExitÂ Message",Â groupÂ =Â "Alerts")
//Â â€”â€”â€”â€”â€”Â YouÂ captureÂ theÂ SourceÂ ofÂ yourÂ indicatorÂ here
ext_source_Â =Â input.source(close,Â title='DataÂ source',Â groupÂ =Â "General")
//Â CustomÂ closeÂ signal
custom_closeÂ =Â input.bool(false,Â title='UseÂ CustomÂ Close?',Â groupÂ =Â "General")
//Â LastÂ tradesÂ dataÂ displayedÂ inÂ aÂ table
display_last_trade_dataÂ =Â input.bool(true,Â titleÂ =Â "DisplayÂ theÂ currentÂ openedÂ tradesÂ data",Â groupÂ =Â "Table")
_table_locationÂ =Â input.string(title="TableÂ Location",Â defval="TOPÂ RIGHT",Â options=["TOPÂ LEFT",Â "TOPÂ CENTER",Â "TOPÂ RIGHT",Â "BOTTOMÂ LEFT",Â "BOTTOMÂ CENTER",Â "BOTTOMÂ RIGHT"],Â groupÂ =Â "Table")
_table_txt_sizeÂ Â Â Â =Â input.string("Normal",Â titleÂ =Â "TxtÂ Size",Â options=["Tiny",Â "Small",Â "Normal",Â "Large",Â "Huge"],Â groupÂ =Â "Table")
table_cell_bg_colorÂ =Â input.color(color.white,Â titleÂ =Â "CellsÂ BackgroundÂ Color",Â groupÂ =Â "Table",Â inlineÂ =Â "table_cells")
table_cell_txt_colorÂ =Â input.color(color.black,Â titleÂ =Â "CellsÂ TextÂ Color",Â groupÂ =Â "Table",Â inlineÂ =Â "table_cells")
table_frame_colorÂ =Â input.color(color.black,Â titleÂ =Â "FrameÂ Color",Â groupÂ =Â "Table",Â inlineÂ =Â "table_frame")
table_frame_widthÂ =Â input.int(1,Â titleÂ =Â "FrameÂ Width",Â minvalÂ =Â 0,Â groupÂ =Â "Table",Â inlineÂ =Â "table_frame")
table_border_colorÂ =Â input.color(color.black,Â titleÂ =Â "BorderÂ Color",Â groupÂ =Â "Table",Â inlineÂ =Â "table_borders")
table_border_widthÂ =Â input.int(1,Â titleÂ =Â "BorderÂ Width",Â minvalÂ =Â 0,Â groupÂ =Â "Table",Â inlineÂ =Â "table_borders")
table_header_bg_colorÂ =Â input.color(#0b3880,Â titleÂ =Â "HeaderÂ BackgroundÂ Color",Â groupÂ =Â "TableÂ Header",Â inlineÂ =Â "header_color")
table_header_txt_colorÂ =Â input.color(color.white,Â titleÂ =Â "HeaderÂ TextÂ Color",Â groupÂ =Â "TableÂ Header",Â inlineÂ =Â "header_color")
//Â PieÂ ChartÂ Winners/Losers
display_pie_chartÂ =Â false//input.bool(true,Â titleÂ =Â "DisplayÂ PieÂ ChartÂ Winners/Losers",Â groupÂ =Â "PieÂ Chart")
//Â â€”â€”â€”â€”â€”Â BarÂ Coloring
clrBarsÂ =Â input.bool(true,Â title='ColourÂ CandlesÂ toÂ TradeÂ OrderÂ state',Â group='Coloring')
CloseSessionÂ =Â input.bool(false,Â title='CloseÂ positionsÂ atÂ marketÂ atÂ theÂ endÂ ofÂ eachÂ sessionÂ ?',Â group='Session')
SessionÂ =Â input.session(title='TradingÂ Session',Â defval='0000-2345',Â group='Session')
OpenDirectionÂ =Â input.string(defval='ALL',Â title='OpenÂ Â TradingÂ Direction',Â options=['ALL',Â 'LONG',Â 'SHORT'],Â group='Direction')
CloseDirectionÂ =Â input.string(defval='ALL',Â title='CloseÂ TradingÂ Direction',Â options=['ALL',Â 'LONG',Â 'SHORT'],Â group='Direction')
closeOnOppositeÂ =Â input.bool(true,Â title='CloseÂ onÂ OppositeÂ Signal',Â group='Strategy')
//Â â€”â€”â€”â€”â€”Â DateÂ rangeÂ filtering
DateFilterÂ =Â input.bool(false,Â 'DateÂ RangeÂ Filtering',Â group='Date')
//Â â€”â€”â€”â€”â€”Â SyntaxÂ comingÂ fromÂ https://www.tradingview.com/blog/en/new-parameter-for-date-input-added-to-pine-21812/
i_startTimeÂ =Â input.time(defval=timestamp('01Â JanÂ 2019Â 13:30Â +0000'),Â title='StartÂ Time',Â group='Date')
i_endTimeÂ =Â input.time(defval=timestamp('30Â DecÂ 2021Â 23:30Â +0000'),Â title='EndÂ Time',Â group='Date')
TradeDateIsAllowed()Â =>
Â Â Â Â DateFilterÂ ?Â timeÂ >=Â i_startTimeÂ andÂ timeÂ <=Â i_endTimeÂ :Â true
//Â â€”â€”â€”â€”â€”Â SetÂ theÂ maxÂ losingÂ streakÂ lengthÂ withÂ anÂ input
setmaxLosingStreakÂ =Â input.bool(title='SetÂ MaxÂ numberÂ ofÂ consecutiveÂ lossÂ trades',Â defval=false,Â group='RiskÂ Management')
maxLosingStreakÂ =Â input.int(title='MaxÂ ofÂ consecutiveÂ lossÂ trades',Â defval=15,Â minval=1,Â group='RiskÂ Management')
setmaxWinStreakÂ =Â input.bool(title='SetÂ MaxÂ numberÂ ofÂ consecutiveÂ wonÂ trades',Â defval=false,Â group='RiskÂ Management')
maxWinStreakÂ =Â input.int(title='MaxÂ WinningÂ StreakÂ Length',Â defval=15,Â minval=1,Â group='RiskÂ Management')
//Â â€”â€”â€”â€”â€”Â SetÂ theÂ maxÂ consecutiveÂ daysÂ withÂ aÂ loss
setmaxLosingDaysStreakÂ =Â input.bool(title='SetÂ MAXÂ consecutiveÂ daysÂ withÂ aÂ lossÂ inÂ aÂ row',Â defval=false,Â group='RiskÂ Management')
maxLosingDaysStreakÂ =Â input.int(title='MaxÂ ofÂ consecutiveÂ daysÂ withÂ aÂ lossÂ inÂ aÂ row',Â defval=3,Â minval=1,Â group='RiskÂ Management')
setMaxDrawdownÂ =Â input.bool(title='SetÂ MaxÂ TotalÂ DrawDown',Â defval=false,Â group='RiskÂ Management')
//Â â€”â€”â€”â€”â€”Â InputÂ forÂ theÂ strategy'sÂ maximumÂ drawdownÂ (inÂ %Â ofÂ strategyÂ equity)
maxPercDdÂ =Â input.int(title='MaxÂ DrawdownÂ (%)',Â defval=10,Â minval=1,Â maxval=100,Â group='RiskÂ Management')
setMaxIntradayLossÂ =Â input.bool(title='SetÂ MaxÂ IntradayÂ Loss',Â defval=false,Â group='RiskÂ Management')
//Â â€”â€”â€”â€”â€”Â InputÂ forÂ theÂ strategy'sÂ maximumÂ intradayÂ lossÂ (inÂ %Â ofÂ strategyÂ equity)
maxIntradayLossÂ =Â input.int(title='MaxÂ IntradayÂ LossÂ (%)',Â defval=3,Â minval=1,Â maxval=100,Â group='RiskÂ Management')
setNumberDailyTradesÂ =Â input.bool(title='LimitÂ theÂ numberÂ ofÂ tradesÂ perÂ day',Â defval=false,Â group='RiskÂ Management')
maxDailyTradesÂ =Â input.int(title='NumberÂ MAXÂ ofÂ dailyÂ trades',Â defval=10,Â minval=1,Â maxval=100,Â group='RiskÂ Management')
setNumberWeeklyTradesÂ =Â input.bool(title='LimitÂ theÂ numberÂ ofÂ tradesÂ perÂ week',Â defval=false,Â group='RiskÂ Management')
maxWeeklyTradesÂ =Â input.int(title='NumberÂ MAXÂ ofÂ weeklyÂ trades',Â defval=50,Â minval=1,Â maxval=100,Â group='RiskÂ Management')
//Â HardÂ Exit
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â StopÂ LossÂ |
//Â #Â =========================================================================Â #
StopTypeÂ =Â input.string(title='StopÂ TypeÂ Selection',Â defval='Percent',Â options=['None',Â 'Percent',Â 'Trailing',Â 'ATR'],Â group='StopÂ Loss')
//Â â€”â€”â€”â€”â€”Â Percent
LossPercÂ =Â input.float(title='StopÂ LossÂ (%)',Â minval=0.0,Â step=0.5,Â defval=10,Â group='PercentÂ StopÂ Loss')Â *Â 0.01
TrailPercÂ =Â input.float(title='TrailÂ StopÂ LossÂ (%)',Â minval=0.0,Â step=0.5,Â defval=3,Â group='TrailingÂ StopÂ Loss',Â tooltipÂ =Â "ActivatedÂ whenÂ theÂ selectedÂ StopÂ LossÂ =Â Trailing")Â *Â 0.01
//Â â€”â€”â€”â€”â€”Â ATR
atrStopLengthÂ =Â input.int(title='StopÂ Length',Â defval=14,Â group='ATRÂ StopÂ Loss')
riskRatioATRÂ =Â input.float(defval=1,Â title='RiskÂ Ratio',Â step=0.10,Â group='ATRÂ StopÂ Loss')
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â TakeÂ ProfitÂ |
//Â #Â =========================================================================Â #
TakeProfitTypeÂ =Â input.string(title='TakeÂ ProfitÂ TypeÂ Selection',Â defval='Percent',Â options=['None',Â 'Percent',Â 'ATR'],Â group='TakeÂ Profit')
TP1_ratioÂ =Â 100//input.float(defval=50,Â title='ClosingÂ X%Â atÂ TP1',Â group='TakeÂ Profit',Â tooltip='Example:Â 50Â closingÂ 50%Â ofÂ theÂ positionÂ onceÂ TP1Â isÂ reached.\nForÂ 1Â TPÂ only,Â setÂ 100Â toÂ closeÂ 100%Â ofÂ theÂ trade')
//Â â€”â€”â€”â€”â€”Â TP1Â â€”â€”â€”â€”â€”
//Â â€”â€”â€”â€”â€”Â Percent
ProfitPerc1Â =Â input.float(title='TakeÂ ProfitÂ (%)',Â minval=0.0,Â step=0.5,Â defval=5,Â group='TakeÂ ProfitÂ 1')Â *Â 0.01
//Â â€”â€”â€”â€”â€”Â ATR
atrTakeProfitLength1Â =Â input.int(title='TakeÂ ProfitÂ Length',Â defval=14,Â group='ATRÂ TakeÂ ProfitÂ 1',Â inline='ATRÂ TP1')
rewardRatioATR1Â =Â input.float(defval=2,Â title='RewardÂ Ratio',Â step=0.10,Â group='ATRÂ TakeÂ ProfitÂ 1',Â inline='ATRÂ TP1')
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â StopÂ LossÂ toÂ BreakevenÂ |
//Â #Â =========================================================================Â #
use_sl_beÂ Â Â Â Â Â Â Â Â =Â input.bool(false,Â titleÂ =Â "UseÂ StopÂ LossÂ toÂ BreakevenÂ Mode?",Â groupÂ =Â "StopÂ LossÂ Breakeven")
sl_be_modeÂ Â Â Â Â Â Â Â =Â input.string("$",Â titleÂ =Â "Mode",Â options=["pips",Â "%",Â "$"],Â groupÂ =Â "StopÂ LossÂ Breakeven")
sl_be_valueÂ Â Â Â Â Â Â =Â input.float(1,Â stepÂ =Â 0.1,Â minvalÂ =Â 0,Â titleÂ =Â "StopÂ LossÂ toÂ BreakevenÂ +/-Â X",Â groupÂ =Â "StopÂ LossÂ Breakeven")
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â CustomÂ ExitÂ |
//Â #Â =========================================================================Â #
custom_exit_modeÂ Â Â Â Â Â Â Â =Â input.string(title='CustomÂ ExitÂ TypeÂ Selection',Â defval='None',Â options=['None',Â 'NumberÂ ofÂ bars'],Â group='CustomÂ Exit')
i_custom_exit_nb_barsÂ Â Â =Â input.int(5,Â titleÂ =Â "NbÂ barsÂ toÂ exit",Â groupÂ =Â "CustomÂ Exit",Â tooltipÂ =Â "ExitÂ theÂ trade(s)Â afterÂ XÂ barsÂ haveÂ closedÂ sinceÂ theÂ tradeÂ open")
BIG_NUMBER_COUNTÂ =Â 1000
//Â variablesÂ initialisation
ext_sourceÂ =Â nz(ext_source_)
//Â 1Â isÂ bullÂ signal
bullÂ =Â ext_sourceÂ ==Â 1
//Â -1Â isÂ bearÂ signal
bearÂ =Â ext_sourceÂ ==Â -1
plotshape(
Â seriesÂ Â Â Â Â =Â bullÂ andÂ notÂ bull[1],
Â titleÂ Â Â Â Â Â =Â "Buy",
Â styleÂ Â Â Â Â Â =Â shape.triangleup,
Â locationÂ Â Â =Â location.bottom,
Â colorÂ Â Â Â Â Â =Â color.new(colorÂ =Â color.green,Â transpÂ =Â 0),
Â sizeÂ Â Â Â Â Â Â =Â size.normal
Â )
plotshape(
Â seriesÂ Â Â Â Â =Â bearÂ andÂ notÂ bear[1],
Â titleÂ Â Â Â Â Â =Â "Sell",
Â styleÂ Â Â Â Â Â =Â shape.triangledown,
Â locationÂ Â Â =Â location.top,
Â colorÂ Â Â Â Â Â =Â color.new(colorÂ =Â color.red,Â transpÂ =Â 0),
Â sizeÂ Â Â Â Â Â Â =Â size.normal
Â )
//Â 2Â exitÂ customÂ closeÂ long
exit_bullÂ =Â custom_closeÂ andÂ ext_sourceÂ ==Â 2
//Â -2Â exitÂ customÂ closeÂ short
exit_bearÂ =Â custom_closeÂ andÂ ext_sourceÂ ==Â -2
//Â EntryÂ Price
entry_priceÂ =Â ta.valuewhen(condition=(bear[1]Â andÂ strategy.position_size[1]Â >=Â 0)Â orÂ (bull[1]Â andÂ strategy.position_size[1]Â <=Â 0),Â source=close,Â occurrence=0)
entry_price_longÂ Â =Â ta.valuewhen(condition=(bullÂ andÂ strategy.position_sizeÂ <=Â 0),Â source=close,Â occurrence=0)
entry_price_shortÂ =Â ta.valuewhen(condition=(bearÂ andÂ strategy.position_sizeÂ >=Â 0),Â source=close,Â occurrence=0)
//Â â€”â€”â€”â€”â€”Â RISKÂ MANAGEMENT
condintradaylossÂ =Â setMaxIntradayLossÂ ?Â maxIntradayLossÂ :Â 100
strategy.risk.max_intraday_loss(value=condintradayloss,Â type=strategy.percent_of_equity)
condmaxdrawdownÂ =Â setMaxDrawdownÂ ?Â maxPercDdÂ :Â 100
strategy.risk.max_drawdown(value=condmaxdrawdown,Â type=strategy.percent_of_equity)
//Â dailyÂ tradesÂ calculation
oktoTradeDailyÂ =Â true
tradesIntradayCountÂ =Â setNumberDailyTradesÂ ?Â maxDailyTradesÂ :Â BIG_NUMBER_COUNT
strategy.risk.max_intraday_filled_orders(count=tradesIntradayCount)
//Â weeklyÂ tradesÂ calculation
tradesLastWeekÂ =Â 0
tradesLastWeekÂ :=Â ifÂ dayofweekÂ ==Â dayofweek.mondayÂ andÂ dayofweekÂ !=Â dayofweek[1]
Â Â Â Â strategy.closedtrades[1]Â +Â strategy.opentrades[1]
else
Â Â Â Â tradesLastWeek[1]
//Â CalculateÂ numberÂ ofÂ tradesÂ thisÂ week
weeklyTradesÂ =Â strategy.closedtradesÂ +Â strategy.opentradesÂ -Â tradesLastWeek
okToTradeWeeklyÂ =Â setNumberWeeklyTradesÂ ?Â weeklyTradesÂ <Â maxWeeklyTradesÂ :Â true
//Â consecutiveÂ lossÂ daysÂ inÂ aÂ row
countConsLossDaysÂ =Â setmaxLosingDaysStreakÂ ?Â maxLosingDaysStreakÂ :Â BIG_NUMBER_COUNT
strategy.risk.max_cons_loss_days(countConsLossDays)
//Â CalculateÂ theÂ totalÂ losingÂ streaks
//Â CheckÂ ifÂ there'sÂ aÂ newÂ losingÂ tradeÂ thatÂ increasedÂ theÂ streak
newLossÂ =Â strategy.losstradesÂ >Â strategy.losstrades[1]Â andÂ strategy.wintradesÂ ==Â strategy.wintrades[1]Â andÂ strategy.eventradesÂ ==Â strategy.eventrades[1]
//Â DetermineÂ currentÂ losingÂ streakÂ length
streakLossLenÂ =Â 0
streakLossLenÂ :=Â ifÂ newLoss
Â Â Â Â nz(streakLossLen[1])Â +Â 1
else
Â Â Â Â ifÂ strategy.wintradesÂ >Â strategy.wintrades[1]Â orÂ strategy.eventradesÂ >Â strategy.eventrades[1]
Â Â Â Â Â Â Â Â 0
Â Â Â Â else
Â Â Â Â Â Â Â Â nz(streakLossLen[1])
//Â CheckÂ ifÂ losingÂ streakÂ isÂ underÂ maxÂ allowed
okToTradeLossStreakÂ =Â setmaxLosingStreakÂ ?Â streakLossLenÂ <Â maxLosingStreakÂ :Â true
//Â CalculateÂ theÂ totalÂ winningÂ streaks
//Â SeeÂ ifÂ there'sÂ aÂ newÂ winnerÂ thatÂ increasedÂ theÂ streak
newWinÂ =Â strategy.wintradesÂ >Â strategy.wintrades[1]Â andÂ strategy.losstradesÂ ==Â strategy.losstrades[1]Â andÂ strategy.eventradesÂ ==Â strategy.eventrades[1]
//Â FigureÂ outÂ currentÂ winningÂ streakÂ length
streakWinLenÂ =Â 0
streakWinLenÂ :=Â ifÂ newWin
Â Â Â Â nz(streakWinLen[1])Â +Â 1
else
Â Â Â Â ifÂ strategy.losstradesÂ >Â strategy.losstrades[1]Â orÂ strategy.eventradesÂ >Â strategy.eventrades[1]
Â Â Â Â Â Â Â Â 0
Â Â Â Â else
Â Â Â Â Â Â Â Â nz(streakWinLen[1])
//Â CheckÂ ifÂ winningÂ streakÂ isÂ underÂ maxÂ allowed
okToTradeWinStreakÂ =Â setmaxWinStreakÂ ?Â streakWinLenÂ <Â maxWinStreakÂ :Â true
varÂ floatÂ longPercStopPriceÂ =Â 0.
varÂ floatÂ shortPercStopPriceÂ =Â 0.
//Â StopÂ lossÂ management
ifÂ strategy.position_sizeÂ >Â 0
Â Â Â Â longPercStopPriceÂ Â :=Â entry_price_longÂ Â *Â (1Â -Â LossPerc)
elseÂ ifÂ strategy.position_sizeÂ <Â 0
Â Â Â Â shortPercStopPriceÂ :=Â entry_price_shortÂ *Â (1Â +Â LossPerc)
//Â trailing
//Â DetermineÂ trailÂ stopÂ lossÂ prices
varÂ floatÂ longTrailStopPriceÂ =Â 0.0
varÂ floatÂ shortTrailStopPriceÂ =Â 0.0
varÂ floatÂ final_SL_LongÂ =Â 0.0
varÂ floatÂ final_SL_ShortÂ =Â 0.0
varÂ MaxReachedÂ =Â 0.0Â Â Â Â Â Â Â Â //Â MaxÂ high/lowÂ reachedÂ sinceÂ beginningÂ ofÂ trade.
signal_candleÂ =Â (bullÂ andÂ strategy.position_sizeÂ <=Â 0)
Â orÂ (bearÂ andÂ strategy.position_sizeÂ >=Â 0)
ifÂ signal_candle[1]
Â Â Â Â MaxReachedÂ :=Â strategy.position_sizeÂ >Â 0Â ?Â highÂ :Â low
//Â UpdateÂ MaxÂ pointÂ reachedÂ duringÂ tradeÂ (usedÂ bothÂ forÂ trailingÂ stopÂ referenceÂ pointÂ andÂ in-tradeÂ maxÂ drawdownÂ calcs).
//Â startÂ trailingÂ onlyÂ whenÂ beyongÂ theÂ breakevenÂ point
MaxReachedÂ :=Â strategy.position_sizeÂ >Â 0
Â ?Â math.max(nz(MaxReached,Â high),Â high)
Â :Â strategy.position_sizeÂ <Â 0Â ?Â math.min(nz(MaxReached,low),Â low)Â :Â na
//ifÂ strategy.position_sizeÂ >Â 0
//Â Â Â Â stopValueÂ =Â closeÂ *Â (1Â -Â TrailPerc)
//Â Â Â Â longTrailStopPriceÂ :=Â math.max(stopValue,Â longTrailStopPrice)
//else
//Â Â Â Â longTrailStopPriceÂ :=Â 0
//ifÂ strategy.position_sizeÂ <Â 0
//Â Â Â Â stopValueÂ =Â closeÂ *Â (1Â +Â TrailPerc)
//Â Â Â Â shortTrailStopPriceÂ :=Â math.min(stopValue,Â shortTrailStopPrice)
//else
//Â Â Â Â shortTrailStopPriceÂ :=Â 999999
ifÂ strategy.position_sizeÂ >Â 0
Â Â Â Â longTrailStopPriceÂ Â :=Â Â MaxReachedÂ *Â (1Â -Â TrailPerc)
elseÂ ifÂ strategy.position_sizeÂ <Â 0
Â Â Â Â shortTrailStopPriceÂ :=Â Â MaxReachedÂ *Â (1Â +Â TrailPerc)
useSLÂ =Â StopTypeÂ !=Â 'None'
use_SL_PercentÂ =Â StopTypeÂ ==Â 'Percent'
use_SL_TrailÂ =Â StopTypeÂ ==Â 'Trailing'
use_SL_ATRÂ =Â StopTypeÂ ==Â 'ATR'
//Â UseÂ thisÂ functionÂ toÂ returnÂ theÂ correctÂ pipÂ valueÂ forÂ pipsÂ onÂ ForexÂ symbols
pip()Â =>Â syminfo.mintick
//Â ATR
//Â FunctionÂ atrÂ (averageÂ trueÂ range)Â returnsÂ theÂ RMAÂ ofÂ trueÂ range.Â 
//Â TrueÂ rangeÂ isÂ max(highÂ -Â low,Â abs(highÂ -Â close[1]),Â abs(lowÂ -Â close[1]))
atr_stopÂ =Â ta.atr(atrStopLength)
atr_tp1Â =Â ta.atr(atrTakeProfitLength1)
//Â ATRÂ usedÂ forÂ Risk:Reward
varÂ floatÂ RR_STOP_ATRÂ =Â 0.0
//RR_STOP_ATRÂ :=Â nz(RR_STOP_ATR[1])
varÂ floatÂ RR_TP1_ATRÂ =Â 0.0
//RR_TP1_ATRÂ :=Â nz(RR_TP1_ATR[1])
//Â CapturigÂ theÂ atrÂ valueÂ atÂ signalÂ timeÂ only
ifÂ (bullÂ andÂ strategy.position_sizeÂ <=Â 0)Â orÂ (bearÂ andÂ strategy.position_sizeÂ >=Â 0)
Â Â Â Â RR_STOP_ATRÂ :=Â atr_stop
Â Â Â Â RR_TP1_ATRÂ :=Â atr_tp1
ifÂ (strategy.position_sizeÂ <=Â 0Â andÂ bull)
Â Â Â Â ifÂ use_SL_Percent
Â Â Â Â Â Â Â Â final_SL_LongÂ :=Â longPercStopPrice
Â Â Â Â elseÂ ifÂ use_SL_ATR
Â Â Â Â Â Â Â Â final_SL_LongÂ :=Â entry_price_longÂ -Â RR_STOP_ATRÂ *Â riskRatioATR
elseÂ ifÂ (strategy.position_sizeÂ >=Â 0Â andÂ bear)
Â Â Â Â ifÂ use_SL_Percent
Â Â Â Â Â Â Â Â final_SL_ShortÂ :=Â shortPercStopPrice
Â Â Â Â elseÂ ifÂ use_SL_ATR
Â Â Â Â Â Â Â Â final_SL_ShortÂ :=Â entry_price_shortÂ +Â RR_STOP_ATRÂ *Â riskRatioATR
ifÂ use_SL_Trail
Â Â Â Â ifÂ strategy.position_sizeÂ >Â 0
Â Â Â Â Â Â Â Â final_SL_LongÂ :=Â longTrailStopPrice
Â Â Â Â elseÂ ifÂ strategy.position_sizeÂ <Â 0
Â Â Â Â Â Â Â Â final_SL_ShortÂ :=Â shortTrailStopPrice
//Â TakeÂ ProfitÂ Manangement
useTakeProfitÂ =Â TakeProfitTypeÂ !=Â 'None'
use_TP_PercentÂ =Â TakeProfitTypeÂ ==Â 'Percent'
use_TP_ATRÂ =Â TakeProfitTypeÂ ==Â 'ATR'
varÂ floatÂ TP1longPriceÂ =Â 0.
varÂ floatÂ TP1shortPriceÂ =Â 0.
varÂ boolÂ is_TP1_REACHEDÂ =Â false
ifÂ (strategy.position_sizeÂ <=Â 0Â andÂ bull)
Â Â Â Â TP1longPriceÂ :=Â use_TP_PercentÂ ?Â entry_price_longÂ *Â (1Â +Â ProfitPerc1)Â :Â entry_price_longÂ +Â RR_TP1_ATRÂ *Â rewardRatioATR1
elseÂ ifÂ (strategy.position_sizeÂ >=Â 0Â andÂ bear)
Â Â Â Â 
Â Â Â Â TP1shortPriceÂ :=Â use_TP_PercentÂ ?Â entry_price_shortÂ *Â (1Â -Â ProfitPerc1)Â :Â entry_price_shortÂ -Â RR_TP1_ATRÂ *Â rewardRatioATR1
ifÂ strategy.position_size[1]Â >Â 0Â andÂ highÂ >=Â TP1longPrice
Â Â Â Â is_TP1_REACHEDÂ :=Â true
elseÂ ifÂ strategy.position_size[1]Â <Â 0Â andÂ lowÂ <=Â TP1shortPrice
Â Â Â Â is_TP1_REACHEDÂ :=Â true
//Â PlotÂ takeÂ profitÂ valuesÂ forÂ confirmation
plot(series=strategy.position_sizeÂ >Â 0Â andÂ useTakeProfitÂ ?Â TP1longPriceÂ :Â na,Â color=color.new(color.green,Â 0),Â style=plot.style_circles,Â linewidth=3,Â title='LongÂ TakeÂ ProfitÂ 1')
plot(series=strategy.position_sizeÂ <Â 0Â andÂ useTakeProfitÂ ?Â TP1shortPriceÂ :Â na,Â color=color.new(color.red,Â 0),Â style=plot.style_circles,Â linewidth=3,Â title='ShortÂ TakeÂ ProfitÂ 1')
//Â UsedÂ forÂ debugÂ andÂ checkÂ theÂ ATRÂ TPÂ value
plot(use_TP_ATRÂ andÂ strategy.position_sizeÂ !=Â 0Â ?Â RR_TP1_ATRÂ *Â rewardRatioATR1Â :Â na,Â color=color.new(color.green,Â 100),Â title='ATRÂ TP1Â Value')
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â StopÂ LossÂ ToÂ BreakevenÂ |
//Â #Â =========================================================================Â #
varÂ boolÂ SL_BE_REACHEDÂ =Â false
varÂ boolÂ is_SL_REACHEDÂ =Â false
ifÂ use_sl_beÂ andÂ useSL
Â Â Â Â current_profitÂ =Â strategy.opentrades.profit(strategy.opentradesÂ -Â 1)
Â Â Â Â ifÂ strategy.position_size[1]Â >Â 0
Â Â Â Â Â Â Â Â ifÂ notÂ SL_BE_REACHED
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ sl_be_modeÂ ==Â "pips"Â andÂ current_profitÂ *Â pip()Â >=Â sl_be_valueÂ *Â pip()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â final_SL_LongÂ :=Â entry_price_longÂ //+Â (sl_be_valueÂ *Â pip())
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SL_BE_REACHEDÂ :=Â true
Â Â Â Â Â Â Â Â Â Â Â Â elseÂ ifÂ sl_be_modeÂ ==Â "$"Â andÂ current_profitÂ >=Â sl_be_value
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â final_SL_LongÂ :=Â entry_price_longÂ //+Â (sl_be_value)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SL_BE_REACHEDÂ :=Â true
Â Â Â Â Â Â Â Â Â Â Â Â elseÂ ifÂ sl_be_modeÂ ==Â "%"Â andÂ math.abs(((highÂ -Â entry_price_long)Â /Â entry_price_long))Â *Â 100Â >=Â sl_be_value
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â final_SL_LongÂ :=Â entry_price_longÂ //*Â (1Â +Â (sl_be_value/100))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SL_BE_REACHEDÂ :=Â true
Â Â Â Â elseÂ ifÂ strategy.position_size[1]Â <Â 0
Â Â Â Â Â Â Â Â ifÂ notÂ SL_BE_REACHED
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ sl_be_modeÂ ==Â "pips"Â andÂ current_profitÂ *Â pip()Â >=Â sl_be_valueÂ *Â pip()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â final_SL_ShortÂ :=Â entry_price_shortÂ //-Â (sl_be_valueÂ *Â pip())
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SL_BE_REACHEDÂ :=Â true
Â Â Â Â Â Â Â Â Â Â Â Â elseÂ ifÂ sl_be_modeÂ ==Â "$"Â andÂ current_profitÂ >=Â sl_be_value
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â final_SL_ShortÂ :=Â entry_price_short//Â -Â (sl_be_value)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SL_BE_REACHEDÂ :=Â true
Â Â Â Â Â Â Â Â Â Â Â Â elseÂ ifÂ sl_be_modeÂ ==Â "%"Â andÂ math.abs(((entry_price_shortÂ -Â low)Â /Â low))Â *Â 100Â >=Â sl_be_value
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â final_SL_ShortÂ :=Â entry_price_short//Â *Â (1Â -Â (sl_be_value/100))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â SL_BE_REACHEDÂ :=Â true
//Â PlotÂ stopÂ lossÂ valuesÂ forÂ confirmation
plot(series=strategy.position_sizeÂ >Â 0Â andÂ useSLÂ ?Â final_SL_LongÂ :Â na,Â color=color.new(color.red,Â 0),Â style=plot.style_cross,Â linewidth=2,Â title='LongÂ StopÂ Loss')
plot(series=strategy.position_sizeÂ <Â 0Â andÂ useSLÂ ?Â final_SL_ShortÂ :Â na,Â color=color.new(color.red,Â 0),Â style=plot.style_cross,Â linewidth=2,Â title='ShortÂ StopÂ Loss')
//Â UsedÂ forÂ debugÂ andÂ checkÂ theÂ ATRÂ SLÂ value
plot(use_SL_ATRÂ andÂ strategy.position_sizeÂ !=Â 0Â ?Â RR_STOP_ATRÂ *Â riskRatioATRÂ :Â na,Â color=color.new(color.red,Â 100),Â title='ATRÂ StopÂ Value')
//Â SessionÂ calculations
//Â TheÂ BarInSessionÂ functionÂ returnsÂ trueÂ when
//Â theÂ currentÂ barÂ isÂ insideÂ theÂ sessionÂ parameter
BarInSession(sess)Â =>
Â Â Â Â time(timeframe.period,Â sess)Â !=Â 0
in_sessionÂ =Â BarInSession(Session)
okToTradeInSessionÂ =Â CloseSessionÂ ?Â in_sessionÂ :Â true
new_sessionÂ =Â in_sessionÂ andÂ notÂ in_session[1]
bgcolor(color=CloseSessionÂ andÂ BarInSession(Session)[1]Â ?Â color.new(color.green,Â 85)Â :Â na,Â title='TradingÂ Session')
//Â consolidationÂ ofÂ theÂ conditions
okToTradeÂ =Â okToTradeWeeklyÂ andÂ okToTradeLossStreakÂ andÂ okToTradeWinStreakÂ andÂ TradeDateIsAllowed()Â andÂ okToTradeInSessionÂ Â //Â andÂ TradeHourlyIsAllowed()
//Â OrdersÂ part
longs_openedÂ =Â strategy.position_sizeÂ >Â 0
shorts_openedÂ =Â strategy.position_sizeÂ <Â 0
trades_openedÂ =Â strategy.position_sizeÂ !=Â 0
longs_opened_in_sessionÂ =Â CloseSessionÂ andÂ longs_opened
shorts_opened_in_sessionÂ =Â CloseSessionÂ andÂ shorts_opened
//Â trades_opened_in_sessionÂ =Â CloseSessionÂ andÂ trades_opened
open_allÂ =Â OpenDirectionÂ ==Â 'ALL'
open_all_longsÂ =Â OpenDirectionÂ !=Â 'SHORT'
open_all_shortsÂ =Â OpenDirectionÂ !=Â 'LONG'
close_allÂ =Â CloseDirectionÂ ==Â 'ALL'
close_all_longsÂ =Â CloseDirectionÂ !=Â 'SHORT'
close_all_shortsÂ =Â CloseDirectionÂ !=Â 'LONG'
//Â GoÂ long
longConditionÂ =Â bull
ifÂ longConditionÂ andÂ okToTradeÂ andÂ okToTradeInSessionÂ andÂ open_all_longs
Â Â Â Â alert_message_long_txtÂ =Â "entry:Â "Â +Â str.tostring(close)Â +Â "Â sl:Â "Â +Â str.tostring(final_SL_Long)Â +Â "Â tp:Â "Â +Â str.tostring(TP1longPrice)
Â Â Â Â strategy.entry('Long',Â strategy.long,Â alert_message=alert_message_long_txt,Â commentÂ =Â alert_message_long_txt)
//Â GoÂ Short
shortConditionÂ =Â bear
ifÂ shortConditionÂ andÂ okToTradeÂ andÂ okToTradeInSessionÂ andÂ open_all_shorts
Â Â Â Â alert_message_short_txtÂ =Â "entry:Â "Â +Â str.tostring(close)Â +Â "Â sl:Â "Â +Â str.tostring(final_SL_Short)Â +Â "Â tp:Â "Â +Â str.tostring(TP1shortPrice)
Â Â Â Â strategy.entry('Short',Â strategy.short,Â alert_message=alert_message_short_txt,Â commentÂ =Â alert_message_short_txt)
//Â ExecuteÂ Exits
ifÂ closeOnOppositeÂ andÂ strategy.position_sizeÂ >Â 0Â andÂ shortConditionÂ Â //Â andÂ open_all_shorts
Â Â Â Â strategy.close(id='Long',Â comment='ShortÂ Signal\nCloseÂ Long')
ifÂ closeOnOppositeÂ andÂ strategy.position_sizeÂ <Â 0Â andÂ longConditionÂ Â //Â andÂ open_all_longs
Â Â Â Â strategy.close(id='Short',Â comment='LongÂ Signal\nCloseÂ Short')
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â CustomÂ User-DefinedÂ closeÂ |
//Â #Â =========================================================================Â #
ifÂ strategy.position_sizeÂ >Â 0Â andÂ exit_bullÂ andÂ close_all_longs
Â Â Â Â strategy.close(id='Long',Â alert_message=i_alert_txt_exit_custom_long,Â comment='CustomÂ User-Defined\nCloseÂ LongÂ Signal')
Â Â Â Â alert(i_alert_txt_exit_custom_long,Â alert.freq_once_per_bar_close)
ifÂ strategy.position_sizeÂ <Â 0Â andÂ exit_bearÂ andÂ close_all_shorts
Â Â Â Â strategy.close(id='Short',Â alert_message=i_alert_txt_exit_custom_short,Â comment='CustomÂ User-Defined\nCloseÂ ShortÂ Signal')
Â Â Â Â alert(i_alert_txt_exit_custom_short,Â alert.freq_once_per_bar_close)
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â CustomÂ templateÂ closeÂ |
//Â #Â =========================================================================Â #
custom_exit_bullÂ =Â custom_exit_modeÂ ==Â "NumberÂ ofÂ bars"Â andÂ ta.barssince(bullÂ andÂ strategy.position_sizeÂ <=Â 0)Â >=Â i_custom_exit_nb_bars
custom_exit_bearÂ =Â custom_exit_modeÂ ==Â "NumberÂ ofÂ bars"Â andÂ ta.barssince(bearÂ andÂ strategy.position_sizeÂ >=Â 0)Â >=Â i_custom_exit_nb_bars
//plot(ta.barssince(bullÂ andÂ strategy.position_sizeÂ <=Â 0),Â titleÂ =Â "test",Â displayÂ =Â display.data_window)
ifÂ strategy.position_sizeÂ >Â 0Â andÂ custom_exit_bullÂ andÂ close_all_longs
Â Â Â Â strategy.close(id='Long',Â alert_message=i_alert_txt_exit_custom_long,Â comment='CustomÂ CloseÂ Signal\nCloseÂ Long')
Â Â Â Â alert(i_alert_txt_exit_custom_long,Â alert.freq_once_per_bar_close)
ifÂ strategy.position_sizeÂ <Â 0Â andÂ custom_exit_bearÂ andÂ close_all_shorts
Â Â Â Â strategy.close(id='Short',Â alert_message=i_alert_txt_exit_custom_short,Â comment='CustomÂ CloseÂ Signal\nCloseÂ Short')
Â Â Â Â alert(i_alert_txt_exit_custom_short,Â alert.freq_once_per_bar_close)
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â SL/TP1/TP2Â exitsÂ Â |
//Â #Â =========================================================================Â #
ifÂ strategy.position_sizeÂ >Â 0Â andÂ close_all_longs
Â Â Â Â strategy.exit(id='ExitÂ LongÂ SL/TP',Â from_entry='Long',Â stop=useSLÂ ?Â final_SL_LongÂ :Â na,Â limitÂ =Â useTakeProfitÂ ?Â TP1longPriceÂ :Â na,Â comment_lossÂ =Â "ExitÂ SLÂ Long",Â alert_lossÂ =Â i_alert_txt_exit_SL_long,Â comment_profitÂ =Â "ExitÂ TPÂ Long",Â alert_profitÂ =Â i_alert_txt_exit_TP1_long)
ifÂ strategy.position_sizeÂ <Â 0Â andÂ close_all_shorts
Â Â Â Â strategy.exit(id='ExitÂ ShortÂ SL/TP',Â from_entry='Short',Â stop=useSLÂ ?Â final_SL_ShortÂ :Â na,Â limitÂ =Â useTakeProfitÂ ?Â TP1shortPriceÂ :Â na,Â comment_lossÂ =Â "ExitÂ SLÂ Short",Â alert_lossÂ =Â i_alert_txt_exit_SL_short,Â comment_profitÂ =Â "ExitÂ TPÂ Short",Â alert_profitÂ =Â i_alert_txt_exit_TP1_short)
//Â //Â CloseÂ allÂ LongsÂ only
//Â ifÂ notÂ okToTradeInSessionÂ andÂ close_all_longsÂ andÂ longs_opened_in_session
//Â Â Â Â Â strategy.close(id="Long")
//Â //Â CloseÂ allÂ ShortsÂ only
//Â ifÂ notÂ okToTradeInSessionÂ andÂ close_all_shortsÂ andÂ shorts_opened_in_session
//Â Â Â Â Â strategy.close(id="Short")
//Â CloseÂ allÂ positionsÂ atÂ theÂ endÂ ofÂ eachÂ sessionÂ regardelessÂ ofÂ theirÂ profit/loss
ifÂ notÂ okToTradeInSessionÂ andÂ close_allÂ andÂ trades_opened
Â Â Â Â strategy.close_all()
//Â FlattenÂ strategyÂ whenÂ maxÂ losingÂ streakÂ isÂ reached
close_stratÂ =Â notÂ okToTradeWeeklyÂ orÂ notÂ okToTradeLossStreakÂ orÂ notÂ okToTradeWinStreakÂ orÂ notÂ TradeDateIsAllowed()
ifÂ close_strat
Â Â Â Â //Â closeÂ allÂ existingÂ orders
Â Â Â Â strategy.close_all()
//Â ColourÂ codeÂ theÂ candles
bclrÂ =Â notÂ clrBarsÂ ?Â naÂ :Â strategy.position_sizeÂ ==Â 0Â ?Â color.grayÂ :Â longs_openedÂ ?Â color.limeÂ :Â shorts_openedÂ ?Â color.redÂ :Â color.gray
barcolor(bclr,Â title='TradeÂ StateÂ BarÂ Colouring')
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â EntryÂ PriceÂ Â |
//Â #Â =========================================================================Â #
plot(strategy.position_sizeÂ !=Â 0Â ?Â strategy.position_avg_priceÂ :Â na,Â titleÂ =Â "EntryÂ Price",Â styleÂ =Â plot.style_circles,Â linewidthÂ =Â 2)
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â TableÂ Â |
//Â #Â =========================================================================Â #
f_location()Â =>
Â Â Â Â _locÂ =Â ""
Â Â Â Â ifÂ _table_locationÂ ==Â "TOPÂ LEFT"
Â Â Â Â Â Â Â Â _locÂ :=Â position.top_left
Â Â Â Â elseÂ ifÂ _table_locationÂ ==Â "TOPÂ CENTER"Â Â Â Â 
Â Â Â Â Â Â Â Â _locÂ :=Â position.top_center
Â Â Â Â elseÂ ifÂ _table_locationÂ ==Â "TOPÂ RIGHT"Â 
Â Â Â Â Â Â Â Â _locÂ :=Â position.top_right
Â Â Â Â elseÂ ifÂ _table_locationÂ ==Â "BOTTOMÂ LEFT"Â Â Â Â Â 
Â Â Â Â Â Â Â Â _locÂ :=Â position.bottom_left
Â Â Â Â elseÂ ifÂ _table_locationÂ ==Â "BOTTOMÂ CENTER"Â Â 
Â Â Â Â Â Â Â Â _locÂ :=Â position.bottom_center
Â Â Â Â elseÂ ifÂ _table_locationÂ ==Â "BOTTOMÂ RIGHT"Â Â 
Â Â Â Â Â Â Â Â _locÂ :=Â position.bottom_right
Â Â Â Â _loc
varÂ table_locationÂ =Â f_location()
varÂ current_trades_tableÂ =Â table.new(positionÂ =Â table_location,Â 
Â columnsÂ =Â 8,
Â rowsÂ =Â 10,Â 
Â bgcolorÂ =Â table_header_bg_color,Â 
Â frame_colorÂ =Â table_frame_color,Â 
Â frame_widthÂ =Â table_frame_width,Â 
Â border_colorÂ =Â table_border_color,Â 
Â border_widthÂ =Â table_border_width
Â )
table_txt_sizeÂ =Â switchÂ _table_txt_size
Â Â Â Â "Tiny"Â =>Â size.tiny
Â Â Â Â "Small"Â =>Â size.small
Â Â Â Â "Normal"Â =>Â size.normal
Â Â Â Â "Large"Â =>Â size.large
Â Â Â Â "Huge"Â =>Â size.huge
tradeDirection(_size)Â =>
Â Â Â Â _sizeÂ <Â 0Â ?Â "Short"Â :Â "Long"
varÂ intÂ nb_rowÂ =Â 0
//Â FunctionsÂ fromÂ theÂ refmanÂ V5
//Â GetÂ theÂ biggestÂ maxÂ tradeÂ runÂ upÂ valueÂ fromÂ allÂ ofÂ theÂ openÂ trades.
maxOpenTradeRunUp()Â =>
Â Â Â Â maxRunupÂ =Â 0.0
Â Â Â Â forÂ tradeNoÂ =Â 0Â toÂ strategy.opentradesÂ -Â 1
Â Â Â Â Â Â Â Â maxRunupÂ :=Â math.max(maxRunup,Â strategy.opentrades.max_runup(tradeNo))
Â Â Â Â resultÂ =Â maxRunup
//Â GetÂ theÂ biggestÂ maxÂ tradeÂ drawdownÂ valueÂ fromÂ allÂ ofÂ theÂ openÂ trades.
maxTradeDrawDown()Â =>
Â Â Â Â maxDrawdownÂ =Â 0.0
Â Â Â Â forÂ tradeNoÂ =Â 0Â toÂ strategy.opentradesÂ -Â 1
Â Â Â Â Â Â Â Â maxDrawdownÂ :=Â math.max(maxDrawdown,Â strategy.opentrades.max_drawdown(tradeNo))
Â Â Â Â resultÂ =Â maxDrawdown
//Â CalculateÂ openÂ profitÂ orÂ lossÂ forÂ theÂ openÂ positions.
tradeOpenPL()Â =>
Â Â Â Â sumProfitÂ =Â 0.0
Â Â Â Â forÂ tradeNoÂ =Â 0Â toÂ strategy.opentradesÂ -Â 1
Â Â Â Â Â Â Â Â sumProfitÂ +=Â strategy.opentrades.profit(tradeNo)
Â Â Â Â resultÂ =Â sumProfit
//Â CalculateÂ avgÂ entryÂ priceÂ forÂ theÂ openÂ positions.
tradeAvgEntryPrice()Â =>
Â Â Â Â avgProfitÂ =Â 0.0
Â Â Â Â forÂ tradeNoÂ =Â 0Â toÂ strategy.opentradesÂ -Â 1
Â Â Â Â Â Â Â Â avgProfitÂ +=Â strategy.opentrades.entry_price(tradeNo)
Â Â Â Â resultÂ =Â nz(avgProfitÂ /Â strategy.opentrades)
//Â ReturnÂ theÂ numberÂ ofÂ openedÂ longsÂ andÂ shorts
tradeOpenNbLongsShorts()Â =>
Â Â Â Â 
Â Â Â Â nbLongsÂ =Â 0
Â Â Â Â nbShortsÂ =Â 0
Â Â Â Â forÂ tradeNoÂ =Â 0Â toÂ strategy.opentradesÂ -Â 1
Â Â Â Â Â Â Â Â sizeÂ =Â strategy.opentrades.size(tradeNo)
Â Â Â Â Â Â Â Â ifÂ sizeÂ >Â 0
Â Â Â Â Â Â Â Â Â Â Â Â nbLongsÂ +=Â 1
Â Â Â Â Â Â Â Â else
Â Â Â Â Â Â Â Â Â Â Â Â nbShortsÂ +=Â 1
Â Â Â Â [nbLongs,Â nbShorts]
ifÂ barstate.islastconfirmedhistoryÂ andÂ strategy.opentradesÂ >Â 0Â andÂ display_last_trade_data
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 0,Â rowÂ =Â 0,Â textÂ =Â "TradeÂ No",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 1,Â rowÂ =Â 0,Â textÂ =Â "Direction",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 2,Â rowÂ =Â 0,Â textÂ =Â "EntryÂ Price",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 3,Â rowÂ =Â 0,Â textÂ =Â "EntryÂ Time",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 4,Â rowÂ =Â 0,Â textÂ =Â "Profit/Loss",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 5,Â rowÂ =Â 0,Â textÂ =Â "MaxÂ Drawdown",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 6,Â rowÂ =Â 0,Â textÂ =Â "MaxÂ RunUp",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 7,Â rowÂ =Â 0,Â textÂ =Â "Equity",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â forÂ tradeNoÂ =Â 0Â toÂ strategy.opentradesÂ -Â 1
Â Â Â Â Â Â Â Â nb_rowÂ :=Â tradeNoÂ +Â 1
Â Â Â Â Â Â Â Â str_tradeNoÂ Â Â Â =Â str.tostring(nb_row)
Â Â Â Â Â Â Â Â str_directionÂ Â Â =Â tradeDirection(strategy.opentrades.size(tradeNo))
Â Â Â Â Â Â Â Â str_entry_PriceÂ =Â str.tostring(strategy.opentrades.entry_price(tradeNo),Â format.mintick)
Â Â Â Â Â Â Â Â str_entry_TimeÂ Â =Â str.format_time(strategy.opentrades.entry_time(tradeNo),Â Â "yyyy-MM-ddÂ HH:mm",Â syminfo.timezone)
Â Â Â Â Â Â Â Â str_profit_lossÂ =Â str.tostring(strategy.opentrades.profit(tradeNo),Â "#.##")
Â Â Â Â Â Â Â Â str_max_DDÂ Â Â Â Â Â =Â str.tostring(strategy.opentrades.max_drawdown(tradeNo),Â "#.##")
Â Â Â Â Â Â Â Â str_max_runUPÂ Â Â =Â str.tostring(strategy.opentrades.max_runup(tradeNo),Â "#.##")
Â Â Â Â Â Â Â Â str_equityÂ Â Â Â Â Â =Â str.tostring(strategy.equity,Â "#.##")Â +Â "Â "Â +Â strategy.account_currency
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 0,Â rowÂ =Â nb_row,Â textÂ =Â str_tradeNo,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 1,Â rowÂ =Â nb_row,Â textÂ =Â str_direction,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 2,Â rowÂ =Â nb_row,Â textÂ =Â str_entry_Price,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 3,Â rowÂ =Â nb_row,Â textÂ =Â str_entry_Time,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 4,Â rowÂ =Â nb_row,Â textÂ =Â str_profit_loss,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 5,Â rowÂ =Â nb_row,Â textÂ =Â str_max_DD,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 6,Â rowÂ =Â nb_row,Â textÂ =Â str_max_runUP,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 7,Â rowÂ =Â nb_row,Â textÂ =Â str_equity,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â //Â displayÂ SumÂ ifÂ thereÂ isÂ moreÂ thanÂ 1Â tradeÂ opened
Â Â Â Â ifÂ strategy.opentradesÂ >Â 1Â andÂ nb_rowÂ ==Â strategy.opentrades
Â Â Â Â Â Â Â Â //Â CreatingÂ theÂ TotalÂ mergedÂ row
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 0,Â rowÂ =Â strategy.opentradesÂ +Â 1,Â textÂ =Â "Total",Â text_colorÂ =Â table_header_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_header_bg_color)
Â Â Â Â Â Â Â Â table.merge_cells(current_trades_table,Â 0,Â strategy.opentradesÂ +Â 1,Â 7,Â strategy.opentradesÂ +Â 1)
Â Â Â Â Â Â Â Â //Â DisplayingÂ theÂ total
Â Â Â Â Â Â Â Â LastRowÂ =Â strategy.opentradesÂ +Â 2
Â Â Â Â Â Â Â Â str_nb_opened_tradesÂ =Â "OpenedÂ trades:Â "Â +Â str.tostring(strategy.opentrades)
Â Â Â Â Â Â Â Â [nbLongs,Â nbShorts]Â =Â tradeOpenNbLongsShorts()
Â Â Â Â Â Â Â Â str_nbLongsShortsÂ =Â ""
Â Â Â Â Â Â Â Â ifÂ nbLongsÂ >Â 0
Â Â Â Â Â Â Â Â Â Â Â Â str_nbLongsShortsÂ :=Â "OpenedÂ Longs:Â "Â +Â str.tostring(nbLongs)
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ nbShortsÂ >Â 0
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â str_nbLongsShortsÂ :=Â str_nbLongsShortsÂ +Â "\n"
Â Â Â Â Â Â Â Â ifÂ nbShortsÂ >Â 0
Â Â Â Â Â Â Â Â Â Â Â Â str_nbLongsShortsÂ :=Â str_nbLongsShortsÂ +Â "OpenedÂ Shorts:Â "Â +Â str.tostring(nbShorts)
Â Â Â Â Â Â Â Â str_avg_entry_priceÂ Â =Â str.tostring(tradeAvgEntryPrice(),Â "#.##")
Â Â Â Â Â Â Â Â str_last_entry_TimeÂ Â =Â "LastÂ OpenedÂ TradeÂ Time:Â "Â +Â str.format_time(strategy.opentrades.entry_time(strategy.opentradesÂ -Â 1),Â Â "yyyy-MM-ddÂ HH:mm",Â syminfo.timezone)
Â Â Â Â Â Â Â Â str_sum_profit_lossÂ =Â str.tostring(tradeOpenPL(),Â "#.##")
Â Â Â Â Â Â Â Â str_max_DDÂ Â Â Â Â Â =Â str.tostring(maxTradeDrawDown(),Â "#.##")
Â Â Â Â Â Â Â Â str_max_runUPÂ Â Â =Â str.tostring(maxOpenTradeRunUp(),Â "#.##")
Â Â Â Â Â Â Â Â str_equityÂ Â Â Â Â Â =Â str.tostring(strategy.equity,Â "#.##")Â +Â "Â "Â +Â strategy.account_currency
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 0,Â rowÂ =Â LastRow,Â textÂ =Â str_nb_opened_trades,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 1,Â rowÂ =Â LastRow,Â textÂ =Â str_nbLongsShorts,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 2,Â rowÂ =Â LastRow,Â textÂ =Â str_avg_entry_price,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 3,Â rowÂ =Â LastRow,Â textÂ =Â str_last_entry_Time,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 4,Â rowÂ =Â LastRow,Â textÂ =Â str_sum_profit_loss,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 5,Â rowÂ =Â LastRow,Â textÂ =Â str_max_DD,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 6,Â rowÂ =Â LastRow,Â textÂ =Â str_max_runUP,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 7,Â rowÂ =Â LastRow,Â textÂ =Â str_equity,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
Â Â Â Â Â Â Â Â //table.cell(table_idÂ =Â current_trades_table,Â columnÂ =Â 7,Â rowÂ =Â LastRow,Â textÂ =Â str_equity,Â text_colorÂ =Â table_cell_txt_color,Â text_halignÂ =Â text.align_center,Â text_valignÂ =Â text.align_center,Â text_sizeÂ =Â table_txt_size,Â bgcolorÂ =Â table_cell_bg_color)
//Â //Â #Â =========================================================================Â #
//Â //Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â PIEÂ CHARTÂ Â |
//Â //Â #Â =========================================================================Â #
//Â rÂ Â Â Â Â Â Â Â Â =Â input.intÂ (0Â Â Â Â ,"*InsideÂ radius*Â Â ",minval=0,maxval=50,step=10Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,inline="3")
//Â RÂ Â Â Â Â Â Â Â Â =Â input.intÂ (120Â Â ,"*OutsideÂ radius*",minval=80,maxval=200,step=10Â Â Â Â Â Â Â Â Â ,tooltip="ğŸ”˜Â RadiusÂ ofÂ insiderÂ andÂ outerÂ circleÂ Â \nNOTEğŸ”°\n*IfÂ thisÂ largerÂ radiusÂ exceedsÂ theÂ allowedÂ limit,\ntheÂ chartÂ mayÂ disappearÂ So,Â toÂ solveÂ thisÂ problem,Â shiftÂ theÂ graphÂ toÂ theÂ leftsideÂ *ğŸ‘‡"Â Â ,inline="3")
//Â wÂ Â Â Â Â Â Â Â Â =Â input.intÂ (10Â Â Â ,"|Overlap|",minval=0,maxval=10,step=2Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,inline="4")
//Â p_xÂ Â Â Â Â Â Â =Â input.intÂ (-50Â Â ,"<<==Shift==>>Â "Â ,step=50Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,tooltip="Overlap:LinesÂ ThicknessÂ \nÂ shift:Â (-)shiftÂ toÂ leftsideÂ _OR_Â rightside(+)Â "Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,inline="4")
//Â colorÂ CLRÂ =Â na
//Â win_rateÂ Â =Â math.round((strategy.wintradesÂ /Â strategy.closedtrades)Â *Â 100,Â 2)
//Â loss_rateÂ =Â math.round((strategy.losstradesÂ /Â strategy.closedtrades)Â *Â 100,Â 2)
//Â C1Â =Â int(win_rateÂ *Â 360Â /Â 100)
//Â C2Â =Â C1Â +Â int(loss_rateÂ *Â 360Â /Â 100)
//Â forÂ iÂ Â =Â 0Â toÂ 360Â byÂ 1
//Â Â Â Â Â x0Â =Â int(r*math.sin(math.toradians(i)))
//Â Â Â Â Â y0Â =Â int(r*math.cos(math.toradians(i)))
//Â Â Â Â Â xÂ Â =Â int(R*math.sin(math.toradians(i)))
//Â Â Â Â Â yÂ Â =Â int(R*math.cos(math.toradians(i)))
//Â Â Â Â Â CLRÂ :=Â iÂ <Â C1Â ?Â color.limeÂ :Â iÂ <Â C2Â ?Â color.redÂ :Â color.fuchsia
//Â Â Â Â Â ifÂ barstate.islastÂ andÂ display_pie_chart
//Â Â Â Â Â Â Â Â Â lineÂ =Â line.new(bar_index+p_x+R+x0Â ,Â close+y0Â Â ,Â bar_index+p_x+Â x+R,Â closeÂ +Â yÂ Â Â Â Â Â Â Â ,Â color=Â CLRÂ Â Â Â Â Â Â Â ,style=Â w==0?Â line.style_arrow_right:line.style_solid,Â extendÂ =Â extend.none,Â width=w)
Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â L1Â Â Â =label.new(bar_index+p_x+RÂ Â Â Â ,closeÂ Â Â Â Â Â ,"Winners/LosersÂ \nğŸ”DistributionğŸ”"Â ,Â color=color.blackÂ Â ,style=label.style_label_center,textcolor=color.yellow,textalign=text.align_center,size=size.small)
//Â ifÂ display_pie_chartÂ andÂ strategy.closedtradesÂ >Â 0
//Â Â Â Â Â L2=label.new(bar_index+p_x+R+Â int(Â (r+R)/2*math.sin(math.toradians(C1/2)))Â Â Â Â Â ,close+Â int(Â (r+R)/2*math.cos(math.toradians(C1/2)))Â Â Â Â Â ,"WinnersÂ =Â "+Â str.tostring(win_rate)Â Â Â Â Â Â Â Â Â Â +Â Â "Â %"Â ,style=Â label.style_none,textcolor=color.whiteÂ Â Â Â Â Â Â Â Â Â Â ,textalign=text.align_centerÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,size=size.largeÂ ,tooltip="WinÂ Rate")
//Â Â Â Â Â label.delete(L2[1])
//Â Â Â Â Â L3=label.new(bar_index+p_x+R+Â int(Â (r+R)/2*math.sin(math.toradians((C1+C2)/2))),close+Â int(Â (r+R)/2*math.cos(math.toradians((C1+C2)/2)))Â ,"ETH.DÂ =Â "+Â str.tostring(loss_rate)Â Â Â Â Â Â Â Â Â +Â Â "Â %"Â ,style=Â label.style_none,textcolor=color.whiteÂ Â Â Â Â Â Â Â Â Â Â ,textalign=text.align_centerÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ,size=size.normal,tooltip="LossÂ Rate")
//Â Â Â Â Â label.delete(L3[1])
ifÂ strategy.position_sizeÂ ==Â 0Â 
Â orÂ (strategy.position_sizeÂ >Â 0Â andÂ strategy.position_size[1]Â <Â 0)
Â orÂ (strategy.position_sizeÂ <Â 0Â andÂ strategy.position_size[1]Â >Â 0)
Â Â Â Â is_TP1_REACHEDÂ :=Â false
Â Â Â Â SL_BE_REACHEDÂ :=Â false
Expand (831 lines)