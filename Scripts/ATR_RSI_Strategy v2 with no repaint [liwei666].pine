Script Name: ATR_RSI_Strategy v2 with no repaint [liwei666]
Author: liwei666
Description: ğŸ² Overview

ğŸ¯ this is a optimized version based on ATR_RSI_Strategy with no-repaint. 
Sharpe ratio: 1.4, trade times: 116 ,
trade symbol:  BINANCE:BTCUSDTPERP  15M
you can get same backtesting result with the correct settings.

ğŸ² Strategy Logic

ğŸ¯ the core logic is quite simple, use ATR and RSI and SMA
1. when price is in high volatility ( atr_value > atr_ma);
2....
PineScript code:

Pine Scriptâ„¢ strategy
ATR_RSI_Strategy v2 with no repaint [liwei666]
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
//Â Â©Â liwei666
//@version=5
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â StrategyÂ Â |
//Â #Â =========================================================================Â #
strategy(
Â titleÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â =Â "ATR_RSI_StrategyÂ v2[liwei666]",
Â shorttitleÂ Â Â Â Â Â Â Â Â Â Â =Â "ATR_RSI_Strategy",
Â overlayÂ Â Â Â Â Â Â Â Â Â Â Â Â Â =Â Â true,
Â max_lines_countÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â =Â Â 500,Â 
Â max_labels_countÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â =Â Â 500,Â 
Â max_boxes_countÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â =Â Â 500,
Â max_bars_backÂ =Â 5000,
Â initial_capitalÂ =Â 10000,
Â default_qty_type=strategy.percent_of_equity,Â 
Â default_qty_value=10,Â commission_type=strategy.commission.percent,Â pyramiding=1,Â 
Â commission_value=0.05
Â )
//Â #Â =========================================================================Â #
//Â #Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â StrategyÂ Â |
//Â #Â =========================================================================Â #
atr_lengthÂ Â =Â input.int(26,Â "atr_length",Â minvalÂ =Â 6,Â maxvalÂ =Â 100,Â step=1)
atr_ma_lengthÂ =Â input.int(45,Â "atr_ma_length",Â minvalÂ =Â 6,Â maxvalÂ =Â 100,Â step=1)
rsi_lengthÂ =Â input.int(15,Â "rsi_length",Â minvalÂ =Â 6,Â maxvalÂ =Â 100,Â step=1)
rsi_entryÂ =Â input.int(10,Â "rsi_entry",Â minvalÂ =Â 6,Â maxvalÂ =Â 100,Â step=1)
atr_ma_norm_minÂ =Â input.float(0.3,Â "atr_ma_norm_min",Â minvalÂ =Â 0.1,Â maxvalÂ =Â 0.5,Â step=0.1)
atr_ma_norm_maxÂ =Â input.float(0.7,Â "atr_ma_norm_max",Â minvalÂ =Â 0.5,Â maxvalÂ =Â 1,Â step=0.1)
trailing_percent=Â input.float(1.5,Â "trailing_stop_percent",Â minvalÂ =Â 0.1,Â maxvalÂ =Â 2,Â step=0.1)
varÂ rsi_buyÂ =Â 50Â +Â rsi_entry
varÂ rsi_sellÂ =Â 50Â -Â rsi_entry
sma_norm_h_45()Â =>Â 
Â Â Â Â sourceÂ =Â high
Â Â Â Â nÂ =Â 45
Â Â Â Â smaÂ =Â ta.sma(source,Â n)Â 
Â Â Â Â sma_normÂ =Â (smaÂ -Â ta.lowest(sma,Â n))Â /Â (ta.highest(sma,n)Â -Â ta.lowest(sma,Â n))
Â Â Â Â sma_norm
atr_valueÂ =Â ta.atr(atr_length)
atr_maÂ =Â ta.sma(atr_value,Â atr_ma_length)Â 
rsi_valueÂ =Â ta.rsi(close,Â lengthÂ =Â rsi_length)Â 
atr_ma_normÂ =Â atr_maÂ /Â closeÂ *Â 100
sma_normÂ =Â sma_norm_h_45()
varÂ intra_trade_highÂ =Â 0.0
varÂ intra_trade_lowÂ =Â 0.0
varÂ long_slÂ =Â 0.0
varÂ long_tpÂ =Â 0.0
varÂ short_slÂ =Â 0.0
varÂ short_tpÂ =Â 0.0
ifÂ strategy.position_sizeÂ ==Â 0
Â Â Â Â intra_trade_highÂ :=Â high
Â Â Â Â intra_trade_lowÂ :=Â low
Â Â Â Â //Â whenÂ inÂ livingÂ trading,Â enterÂ afterÂ freq_once_per_bar_close
Â Â Â Â ifÂ atr_ma_normÂ >=Â atr_ma_norm_minÂ andÂ atr_ma_normÂ <=Â atr_ma_norm_max
Â Â Â Â Â Â Â Â ifÂ atr_valueÂ >Â atr_ma
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ rsi_valueÂ >Â rsi_buy
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strategy.entry("B1",Â strategy.long,Â limitÂ =Â closeÂ +Â 5Â )
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert("LongÂ B1",Â alert.freq_once_per_bar_close)
Â Â Â Â Â Â Â Â Â Â Â Â elseÂ ifÂ rsi_valueÂ <Â rsi_sell
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strategy.entry("S1",Â strategy.short,Â limitÂ =Â closeÂ -Â 5Â )
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert("ShortÂ S1",Â alert.freq_once_per_bar_close)
elseÂ ifÂ strategy.position_sizeÂ >Â 0
Â Â Â Â intra_trade_highÂ :=Â math.max(intra_trade_high,Â high)
Â Â Â Â intra_trade_lowÂ :=Â low
Â Â Â Â long_slÂ :=Â intra_trade_highÂ *Â (1Â -Â trailing_percentÂ /Â 100)
Â Â Â Â long_tpÂ :=Â strategy.position_avg_priceÂ *Â 1.03
Â Â Â Â strategy.exit("ExitÂ B1",Â from_entry="B1",Â stopÂ =Â long_sl,Â limitÂ =Â long_tp)
elseÂ ifÂ strategy.position_sizeÂ <Â 0
Â Â Â Â intra_trade_highÂ :=Â high
Â Â Â Â intra_trade_lowÂ :=Â math.min(intra_trade_low,Â low)Â 
Â Â Â Â short_slÂ :=Â intra_trade_lowÂ *Â (1Â +Â trailing_percentÂ /Â 100)
Â Â Â Â short_tpÂ :=Â strategy.position_avg_priceÂ *Â 0.94
Â Â Â Â strategy.exit("ExitÂ S1",Â from_entry="S1",Â stopÂ =Â short_sl,Â limitÂ =Â short_tp)
//Â whenÂ inÂ livingÂ trading,Â SLÂ andÂ TPÂ shouldÂ useÂ freq_once_per_bar
//Â youÂ canÂ compareÂ withÂ trade_listÂ ofÂ backtestÂ result
//Â longÂ ExitÂ alert
ifÂ strategy.position_sizeÂ >Â 0Â andÂ lowÂ <Â long_sl
Â Â Â Â alert("B1Â Stop_loss",Â alert.freq_once_per_bar)
elseÂ ifÂ strategy.position_sizeÂ >Â 0Â andÂ highÂ >Â long_tp
Â Â Â Â alert("B1Â Take_profit",Â alert.freq_once_per_bar)Â 
//Â shortÂ ExitÂ alert
ifÂ strategy.position_sizeÂ <Â 0Â andÂ highÂ >Â short_sl
Â Â Â Â alert("S1Â Stop_loss",Â alert.freq_once_per_bar)
elseÂ ifÂ strategy.position_sizeÂ >Â 0Â andÂ lowÂ <Â short_tp
Â Â Â Â alert("S1Â Take_profit",Â alert.freq_once_per_bar)
Expand (99 lines)