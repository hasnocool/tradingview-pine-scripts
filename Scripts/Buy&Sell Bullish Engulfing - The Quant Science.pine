Script Name: Buy&Sell Bullish Engulfing - The Quant Science
Author: thequantscience
Description: ğŸ‡ºğŸ‡¸
 GENERAL OVERVIEW 
 Buy&Sell Bullish Engulfing - The Quant Science  It is a Buy&Sell strategy based on the 'Bullish Engulfing' candlestick pattern. The main goal of the strategy is to achieve a consistent and sustainable return over time, with a manageable level of risk.

 Bullish Engulfing 
The template was developed at the top of the Indicator provided by...
PineScript code:

Pine Scriptâ„¢ strategy
Buy&Sell Bullish Engulfing - The Quant Science
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//Â Â©Â thequantscience
//Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—Â â–ˆâ–ˆâ•—Â Â Â â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—Â Â Â Â Â â–ˆâ–ˆâ•—Â Â Â Â Â â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—Â Â â–ˆâ–ˆâ•—Â Â Â Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—Â Â Â â–ˆâ–ˆâ•—Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—Â â–ˆâ–ˆâ•—Â Â Â â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—Â Â Â Â Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—Â Â Â â–ˆâ–ˆâ•—Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—Â 
//Â â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘Â Â â–ˆâ–ˆâ•‘Â Â Â Â â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•Â â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•Â 
//Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘Â Â Â Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—Â Â â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â â–ˆâ–ˆâ–ˆâ•—
//Â â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘Â Â Â Â â–ˆâ–ˆâ•”â•â•â•Â Â â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•”â•â•â•Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â Â â–ˆâ–ˆâ•‘
//Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â Â â–ˆâ–ˆâ•‘Â Â Â Â â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘Â â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘Â Â Â Â Â â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘Â â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
//Â â•šâ•â•â•â•â•â•Â Â â•šâ•â•â•â•â•â•Â â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•Â Â â•šâ•â•Â Â Â Â â•šâ•â•â•â•â•â•â•â•šâ•â•Â Â â•šâ•â•â•â•Â â•šâ•â•â•â•â•â•Â Â â•šâ•â•â•â•â•â•Â â•šâ•â•â•â•â•â•â•â•šâ•â•Â Â Â Â Â â•šâ•â•â•šâ•â•Â Â â•šâ•â•â•â•Â â•šâ•â•â•â•â•â•Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//@version=5
strategy(
Â Â Â Â Â "Buy&SellÂ BullishÂ EngulfingÂ -Â TheÂ QuantÂ Science",
Â Â Â Â Â overlayÂ =Â true,
Â Â Â Â Â default_qty_typeÂ =Â strategy.percent_of_equity,Â 
Â Â Â Â Â default_qty_valueÂ =Â 100,
Â Â Â Â Â pyramidingÂ =Â 1,
Â Â Â Â Â currencyÂ =Â currency.EUR,
Â Â Â Â Â initial_capitalÂ =Â 10000,
Â Â Â Â Â commission_typeÂ =Â strategy.commission.percent,
Â Â Â Â Â commission_valueÂ =Â 0.07,
Â Â Â Â Â process_orders_on_closeÂ =Â true,Â 
Â Â Â Â Â close_entries_ruleÂ =Â "ANY"
Â Â Â Â Â )
startDateÂ Â =Â input.int(title="D:Â ",Â defval=1,Â Â Â Â minval=1,Â Â Â Â maxval=31,Â Â Â inlineÂ =Â 'Start',Â groupÂ =Â "STARTÂ DATEÂ BACKTESTING",Â tooltipÂ =Â "DÂ isÂ Day,Â MÂ isÂ Month,Â YÂ isÂ Year.")
startMonthÂ =Â input.int(title="M:Â ",Â defval=1,Â Â Â Â minval=1,Â Â Â Â maxval=12,Â Â Â inlineÂ =Â 'Start',Â groupÂ =Â "STARTÂ DATEÂ BACKTESTING",Â tooltipÂ =Â "DÂ isÂ Day,Â MÂ isÂ Month,Â YÂ isÂ Year.")
startYearÂ Â =Â input.int(title="Y:Â ",Â defval=2022,Â minval=1800,Â maxval=2100,Â inlineÂ =Â 'Start',Â groupÂ =Â "STARTÂ DATEÂ BACKTESTING",Â tooltipÂ =Â "DÂ isÂ Day,Â MÂ isÂ Month,Â YÂ isÂ Year.")
endDateÂ Â Â Â =Â input.int(title="D:Â ",Â defval=31,Â Â Â minval=1,Â Â Â Â maxval=31,Â Â Â inlineÂ =Â 'End',Â Â Â groupÂ =Â "ENDÂ DATEÂ BACKTESTING",Â tooltipÂ =Â "DÂ isÂ Day,Â MÂ isÂ Month,Â YÂ isÂ Year.")
endMonthÂ Â Â =Â input.int(title="M:Â ",Â defval=12,Â Â Â minval=1,Â Â Â Â maxval=12,Â Â Â inlineÂ =Â 'End',Â Â Â groupÂ =Â "ENDÂ DATEÂ BACKTESTING",Â tooltipÂ =Â "DÂ isÂ Day,Â MÂ isÂ Month,Â YÂ isÂ Year.")
endYearÂ Â Â Â =Â input.int(title="Y:Â ",Â defval=2023,Â minval=1800,Â maxval=2100,Â inlineÂ =Â 'End',Â Â Â groupÂ =Â "ENDÂ DATEÂ BACKTESTING",Â tooltipÂ =Â "DÂ isÂ Day,Â MÂ isÂ Month,Â YÂ isÂ Year.")
inDateRangeÂ =Â (timeÂ >=Â timestamp(syminfo.timezone,Â startYear,Â startMonth,Â startDate,Â 0,Â 0))Â andÂ (timeÂ <Â timestamp(syminfo.timezone,Â endYear,Â endMonth,Â endDate,Â 0,Â 0))
PROFITÂ Â Â =Â input.float(defvalÂ =Â 1,Â minvalÂ =Â 0,Â titleÂ =Â "TargetÂ profitÂ (%):Â ",Â stepÂ =Â 0.10,Â groupÂ =Â "TAKEÂ PROFIT-STOPÂ LOSS")
STOPLOSSÂ =Â input.float(defvalÂ =Â 1,Â minvalÂ =Â 0,Â titleÂ =Â "StopÂ LossÂ (%):Â ",Â Â Â Â Â stepÂ =Â 0.10,Â groupÂ =Â "TAKEÂ PROFIT-STOPÂ LOSS")
varÂ floatÂ equity_tradesÂ =Â 0
equity_tradesÂ :=Â strategy.initial_capital
varÂ floatÂ equityÂ Â Â =Â 0
varÂ floatÂ qty_orderÂ Â Â =Â 0
t_ordersizeÂ =Â "PercentageÂ sizeÂ ofÂ eachÂ newÂ order.Â WithÂ 'ReinvestmentÂ Profit'Â activate,Â theÂ sizeÂ willÂ beÂ calculateÂ onÂ theÂ equity,Â withÂ 'ReinvestmentÂ Profit'Â deactivateÂ theÂ sizeÂ willÂ beÂ calculateÂ onÂ theÂ initialÂ capital."
orders_sizeÂ =Â input.float(defvalÂ =Â 2,Â titleÂ =Â "OrdersÂ sizeÂ (%):Â ",Â minvalÂ =Â 0.10,Â stepÂ =Â 0.10,Â Â maxvalÂ =Â 100,Â groupÂ =Â "RISKÂ MANAGEMENT",Â tooltipÂ =Â t_ordersize)
qty_orderÂ :=Â ((equity_tradesÂ *Â orders_size)Â /Â 100Â )Â /Â closeÂ 
C_DownTrendÂ =Â true
C_UpTrendÂ Â Â =Â true
varÂ trendRule1Â =Â "SMA50"
varÂ trendRule2Â =Â "SMA50,Â SMA200"
varÂ trendRuleÂ =Â input.string(trendRule1,Â "DetectÂ TrendÂ BasedÂ On",Â options=[trendRule1,Â trendRule2,Â "NoÂ detection"],Â groupÂ =Â "BULLISHÂ ENGULFING")
ifÂ trendRuleÂ ==Â trendRule1
Â Â Â Â priceAvgÂ =Â ta.sma(close,Â 50)
Â Â Â Â C_DownTrendÂ :=Â closeÂ <Â priceAvg
Â Â Â Â C_UpTrendÂ :=Â closeÂ >Â priceAvg
ifÂ trendRuleÂ ==Â trendRule2
Â Â Â Â sma200Â =Â ta.sma(close,Â 200)
Â Â Â Â sma50Â Â =Â ta.sma(close,Â 50)
Â Â Â Â C_DownTrendÂ :=Â closeÂ <Â sma50Â andÂ sma50Â <Â sma200
Â Â Â Â C_UpTrendÂ :=Â closeÂ >Â sma50Â andÂ sma50Â >Â sma200
C_LenÂ =Â 14
C_ShadowPercentÂ =Â 5.0Â 
C_ShadowEqualsPercentÂ =Â 100.0
C_DojiBodyPercentÂ =Â 5.0
C_FactorÂ =Â 2.0Â 
C_BodyHiÂ =Â math.max(close,Â open)
C_BodyLoÂ =Â math.min(close,Â open)
C_BodyÂ =Â C_BodyHiÂ -Â C_BodyLo
C_BodyAvgÂ =Â ta.ema(C_Body,Â C_Len)
C_SmallBodyÂ =Â C_BodyÂ <Â C_BodyAvg
C_LongBodyÂ =Â C_BodyÂ >Â C_BodyAvg
C_UpShadowÂ =Â highÂ -Â C_BodyHi
C_DnShadowÂ =Â C_BodyLoÂ -Â low
C_HasUpShadowÂ =Â C_UpShadowÂ >Â C_ShadowPercentÂ /Â 100Â *Â C_Body
C_HasDnShadowÂ =Â C_DnShadowÂ >Â C_ShadowPercentÂ /Â 100Â *Â C_Body
C_WhiteBodyÂ =Â openÂ <Â close
C_BlackBodyÂ =Â openÂ >Â close
C_RangeÂ =Â high-low
C_IsInsideBarÂ =Â C_BodyHi[1]Â >Â C_BodyHiÂ andÂ C_BodyLo[1]Â <Â C_BodyLo
C_BodyMiddleÂ =Â C_BodyÂ /Â 2Â +Â C_BodyLo
C_ShadowEqualsÂ =Â C_UpShadowÂ ==Â C_DnShadowÂ orÂ (math.abs(C_UpShadowÂ -Â C_DnShadow)Â /Â C_DnShadowÂ *Â 100)Â <Â C_ShadowEqualsPercentÂ andÂ (math.abs(C_DnShadowÂ -Â C_UpShadow)Â /Â C_UpShadowÂ *Â 100)Â <Â C_ShadowEqualsPercent
C_IsDojiBodyÂ =Â C_RangeÂ >Â 0Â andÂ C_BodyÂ <=Â C_RangeÂ *Â C_DojiBodyPercentÂ /Â 100
C_DojiÂ =Â C_IsDojiBodyÂ andÂ C_ShadowEquals
patternLabelPosLowÂ Â =Â lowÂ Â -Â (ta.atr(30)Â *Â 0.6)
patternLabelPosHighÂ =Â highÂ +Â (ta.atr(30)Â *Â 0.6)
label_color_bullishÂ =Â input.color(color.rgb(43,Â 255,Â 0),Â titleÂ =Â "LabelÂ ColorÂ Bullish",Â groupÂ =Â "BULLISHÂ ENGULFING")
C_EngulfingBullishNumberOfCandlesÂ =Â 2
C_EngulfingBullishÂ =Â C_DownTrendÂ andÂ C_WhiteBodyÂ andÂ C_LongBodyÂ andÂ C_BlackBody[1]Â andÂ C_SmallBody[1]Â andÂ closeÂ >=Â open[1]Â andÂ openÂ <=Â close[1]Â andÂ (Â closeÂ >Â open[1]Â orÂ openÂ <Â close[1]Â )
ifÂ C_EngulfingBullish
Â Â Â Â varÂ ttBullishEngulfingÂ =Â "Engulfing\nAtÂ theÂ endÂ ofÂ aÂ givenÂ downwardÂ trend,Â thereÂ willÂ mostÂ likelyÂ beÂ aÂ reversalÂ pattern.Â ToÂ distinguishÂ theÂ firstÂ day,Â thisÂ candlestickÂ patternÂ usesÂ aÂ smallÂ body,Â followedÂ byÂ aÂ dayÂ whereÂ theÂ candleÂ bodyÂ fullyÂ overtakesÂ theÂ bodyÂ fromÂ theÂ dayÂ before,Â andÂ closesÂ inÂ theÂ trendâ€™sÂ oppositeÂ direction.Â AlthoughÂ similarÂ toÂ theÂ outsideÂ reversalÂ chartÂ pattern,Â itÂ isÂ notÂ essentialÂ forÂ thisÂ patternÂ toÂ completelyÂ overtakeÂ theÂ rangeÂ (highÂ toÂ low),Â ratherÂ onlyÂ theÂ openÂ andÂ theÂ close."
Â Â Â Â label.new(bar_index,Â patternLabelPosLow,Â text="BE",Â style=label.style_label_up,Â colorÂ =Â label_color_bullish,Â textcolor=color.white,Â tooltipÂ =Â ttBullishEngulfing)
bgcolor(ta.highest(C_EngulfingBullish?1:0,Â C_EngulfingBullishNumberOfCandles)!=0Â ?Â color.new(#21f321,Â 90)Â :Â na,Â offset=-(C_EngulfingBullishNumberOfCandles-1))
varÂ floatÂ cÂ Â Â Â Â Â Â =Â 0
varÂ floatÂ oÂ Â Â Â Â Â Â =Â 0
varÂ floatÂ c_exitÂ Â =Â 0
varÂ floatÂ c_stoplÂ =Â 0
ifÂ C_EngulfingBullishÂ andÂ strategy.opentrades==0Â andÂ inDateRangeÂ 
Â Â Â Â cÂ :=Â strategy.equity
Â Â Â Â oÂ :=Â close
Â Â Â Â c_exitÂ Â :=Â cÂ +Â (cÂ *Â PROFITÂ /Â 100)
Â Â Â Â c_stoplÂ :=Â cÂ -Â (cÂ *Â STOPLOSSÂ /Â 100)
Â Â Â Â strategy.entry(idÂ =Â "LONG",Â directionÂ =Â strategy.long,Â qtyÂ =Â qty_order,Â limitÂ =Â o)
ifÂ ta.crossover(strategy.equity,Â c_exit)
Â Â Â Â strategy.exit(idÂ =Â "CLOSE-LONG",Â from_entryÂ =Â "LONG",Â limitÂ =Â close)
ifÂ ta.crossunder(strategy.equity,Â c_stopl)
Â Â Â Â strategy.exit(idÂ =Â "CLOSE-LONG",Â from_entryÂ =Â "LONG",Â limitÂ =Â close)
Expand (115 lines)