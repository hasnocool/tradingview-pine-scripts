Script Name: Moon Phases Strategy [LuxAlgo]
Author: LuxAlgo
Description: Trading moon phases has become quite popular among traders, believing that there exists a relationship between moon phases and market movements. This strategy is based on an estimate of moon phases with the possibility to use different methods to determine long/short positions based on moon phases.

Note that we assume moon phases are perfectly periodic with a...
PineScript code:

Pine Scriptâ„¢ strategy
Moon Phases Strategy [LuxAlgo]
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
//Â ThisÂ workÂ isÂ licensedÂ underÂ aÂ Attribution-NonCommercial-ShareAlikeÂ 4.0Â InternationalÂ (CCÂ BY-NC-SAÂ 4.0)Â https://creativecommons.org/licenses/by-nc-sa/4.0/
//Â Â©Â LuxAlgo
//@version=4
strategy("MoonÂ PhasesÂ StrategyÂ [LuxAlgo]",Â overlay=true,process_orders_on_close=true)
newÂ Â Â Â =Â input(title="NewÂ MoonÂ ReferenceÂ Date",Â type=input.time,Â defval=timestamp("2021-01-13:05:00"))
buyÂ Â Â Â =Â input('FullÂ Moon',options=['NewÂ Moon','FullÂ Moon','HigherÂ Moon','LowerÂ Moon'],inline='buy')
sellÂ Â Â =Â input('NewÂ Moon',options=['NewÂ Moon','FullÂ Moon','HigherÂ Moon','LowerÂ Moon'],inline='sell')
longcolÂ Â =Â input(color.new(#2157f3,80),'',inline='buy')
shortcolÂ =Â input(color.new(#ff1100,80),'',inline='sell')
//----
nÂ =Â bar_index
cycleÂ =Â 2551442876.8992
dayÂ =Â 8.64e+7
diffÂ =Â (newÂ +Â timeÂ +Â day*2)%cycle/cycle
//----
newmoonÂ =Â crossover(diff,.5)
fullmoonÂ =Â diffÂ <Â diff[1]
plotshape(newmoonÂ ?Â lowÂ :Â na,"NewÂ Moon",shape.labelup,location.top,na,0,text="ğŸŒ‘",size=size.tiny)
plotshape(fullmoonÂ ?Â highÂ :Â na,"FullÂ Moon",shape.labeldown,location.bottom,na,0,text="ğŸŒ•",size=size.tiny)Â 
//----
srcÂ =Â close
varÂ boolÂ longÂ =Â na
varÂ boolÂ shortÂ =Â na
ifÂ buyÂ ==Â 'NewÂ Moon'
Â Â Â Â longÂ :=Â newmoon
elseÂ ifÂ buyÂ ==Â 'FullÂ Moon'
Â Â Â Â longÂ :=Â fullmoon
elseÂ ifÂ buyÂ ==Â 'HigherÂ Moon'
Â Â Â Â longÂ :=Â valuewhen(newmoonÂ orÂ fullmoon,src,0)Â >Â valuewhen(newmoonÂ orÂ fullmoon,src,1)
else
Â Â Â Â longÂ :=Â valuewhen(newmoonÂ orÂ fullmoon,src,0)Â <Â valuewhen(newmoonÂ orÂ fullmoon,src,1)
//----
ifÂ sellÂ ==Â 'NewÂ Moon'
Â Â Â Â shortÂ :=Â newmoon
elseÂ ifÂ sellÂ ==Â 'FullÂ Moon'
Â Â Â Â shortÂ :=Â fullmoon
elseÂ ifÂ sellÂ ==Â 'HigherÂ Moon'
Â Â Â Â shortÂ :=Â valuewhen(newmoonÂ orÂ fullmoon,src,0)Â >Â valuewhen(newmoonÂ orÂ fullmoon,src,1)
else
Â Â Â Â shortÂ :=Â valuewhen(newmoonÂ orÂ fullmoon,src,0)Â <Â valuewhen(newmoonÂ orÂ fullmoon,src,1)
//----
varÂ posÂ =Â 0
ifÂ long
Â Â Â Â posÂ :=Â 1
Â Â Â Â strategy.close("Short")
Â Â Â Â strategy.entry("Long",Â strategy.long)
ifÂ short
Â Â Â Â posÂ :=Â -1
Â Â Â Â strategy.close("Long")
Â Â Â Â strategy.entry("Short",Â strategy.short)
bgcolor(posÂ ==Â 1Â ?Â longcolÂ :Â shortcol)
Expand (55 lines)