Script Name: Etlers Instantenous Trendline
Author: OrcChieftain
Description: This script uses @cheatcountry  script  to calculate Ehlers Instantenous Trendline .

Backtest offers 3 capital management tools. One that will always calculate order size as initial capital/close, one that uses the same calculation but adds or substracts profit. The last one allows you to enter manually the size you want to trade.

Green and red horizontal lines...
PineScript code:

Pine Scriptâ„¢ strategy
Etlers Instantenous Trendline
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//Â Â©Â greenmask9,Â @cheatcountry
//@version=4
strategy(title=Â "EtlersÂ InstantenousÂ Trendline",Â shorttitleÂ =Â "InstantenousÂ Trendline",Â overlay=true)
//commission_type=strategy.commission.percent,Â commission_value=.5
//
//CapitalÂ Management
capitaltypeÂ =Â input(defval="Initial",Â title="CapitalÂ Settings",Â options=["Initial",Â "Growing","Manual"],Â type=input.string)
manualcapitalÂ =Â input(title="ManualÂ PositionÂ Size",Â defval=100.3,Â type=input.float)
leverageÂ =Â input(title="Leverage",Â defval=1,Â type=input.float)
capitalsystem(capitaltype)Â =>
Â Â Â Â v1Â =Â floor(strategy.initial_capital/close)Â *Â leverage
Â Â Â Â v2Â =Â floor((strategy.initial_capitalÂ +Â strategy.netprofit)/close)Â *Â leverage
Â Â Â Â v3Â =Â manualcapital
Â Â Â Â capitaltype==Â "Initial"?Â v1Â :Â capitaltypeÂ ==Â "Growing"Â ?Â v2Â :Â v3
ordersize=capitalsystem(capitaltype)
//Targets,Â Stops
percentagesÂ =Â input(title="PercentageÂ stopÂ ğŸ¯",Â defval=true)
targetpercentageÂ =Â input(title="ProfitÂ (%)",Â type=input.float,Â minval=0.0,Â step=0.1,Â defval=1)Â *Â 0.01
stoppercentageÂ =Â input(title="StopÂ LossÂ (%)",Â type=input.float,Â minval=0.0,Â step=0.1,Â defval=1)Â *Â 0.01
longtpÂ Â =Â strategy.position_avg_priceÂ *Â (1Â +Â targetpercentage)
shorttpÂ =Â strategy.position_avg_priceÂ *Â (1Â -Â targetpercentage)
longStopPriceÂ Â =Â strategy.position_avg_priceÂ *Â (1Â -Â stoppercentage)
shortStopPriceÂ =Â strategy.position_avg_priceÂ *Â (1Â +Â stoppercentage)
//Cheatcountry'sÂ part
//Â CopyrightÂ (c)Â 2019-present,Â FranklinÂ MoormannÂ (cheatcountry)
//Â EhlersÂ InstantaneousÂ TrendlineÂ V2Â [CC]Â scriptÂ mayÂ beÂ freelyÂ distributedÂ underÂ theÂ MITÂ license.
inpÂ =Â input(title="Source",Â type=input.source,Â defval=hl2)
resÂ =Â input(title="Resolution",Â type=input.resolution,Â defval="")
srcÂ =Â security(syminfo.tickerid,Â res,Â inp[barstate.isrealtimeÂ ?Â 1Â :Â 0])[barstate.isrealtimeÂ ?Â 0Â :Â 1]
alphaÂ =Â input(title="Alpha",Â type=input.float,Â defval=0.07,Â minval=0.01,Â stepÂ =Â 0.01)
itrendÂ =Â 0.0
itrendÂ :=Â bar_indexÂ <Â 7Â ?Â (srcÂ +Â (2Â *Â nz(src[1]))Â +Â nz(src[2]))Â /Â 4Â :Â ((alphaÂ -Â (pow(alpha,Â 2)Â /Â 4))Â *Â src)Â +Â (0.5Â *Â pow(alpha,Â 2)Â *Â nz(src[1]))Â -Â 
Â Â Â Â Â Â Â Â Â ((alphaÂ -Â (0.75Â *Â pow(alpha,Â 2)))Â *Â nz(src[2]))Â +Â (2Â *Â (1Â -Â alpha)Â *Â nz(itrend[1]))Â -Â (pow(1Â -Â alpha,Â 2)Â *Â nz(itrend[2]))
triggerÂ =Â (2Â *Â itrend)Â -Â nz(itrend[2])
sigÂ =Â triggerÂ >Â itrendÂ ?Â 1Â :Â triggerÂ <Â itrendÂ ?Â -1Â :Â 0
itColorÂ =Â sigÂ >Â 0Â ?Â color.greenÂ :Â sigÂ <Â 0Â ?Â color.redÂ :Â color.black
plot(trigger,Â title="Trigger",Â color=itColor,Â linewidth=2)
plot(itrend,Â title="ITrend",Â color=color.black,Â linewidth=1)
//EndÂ Cheatcountry'sÂ part
//Things
buyÂ =Â crossover(trigger,Â itrend)
sellÂ =Â crossunder(trigger,Â itrend)
ifÂ (buy)
Â Â Â Â strategy.entry("Buy",Â strategy.long,Â ordersize)
ifÂ (percentages)
Â Â Â Â strategy.exit(Â "Buy",Â from_entry="Buy",Â stop=longStopPrice,Â limit=Â longtp)
//Â Â Â Â ifÂ (targetÂ andÂ stop)
//Â Â Â Â Â Â Â Â strategy.exit(Â "SetÂ ValueÂ tp/sl",Â from_entry="Buy",Â profit=targetticks,Â loss=stopnumberticks)
//Â Â Â Â ifÂ (targetÂ andÂ notÂ stop)
//Â Â Â Â Â Â Â Â strategy.exit(Â "SetÂ ValueÂ tp/sl",Â from_entry="Buy",Â profit=targetticks)
//Â Â Â Â ifÂ (stopÂ andÂ notÂ target)
//Â Â Â Â Â Â Â Â strategy.exit(Â "SetÂ ValueÂ tp/sl",Â from_entry="Buy",Â loss=stopnumberticks)
//strategy.close("Buy",Â buyend)
ifÂ (sell)
Â Â Â Â strategy.entry("Short",Â strategy.short,Â ordersize)
ifÂ (percentages)
Â Â Â Â strategy.exit(Â "Short",Â from_entry="Short",Â stop=shortStopPrice,Â limitÂ =Â shorttp)
plot(series=(strategy.position_sizeÂ >Â 0)Â ?Â longStopPriceÂ :Â na,
Â Â Â Â Â color=color.red,Â style=plot.style_linebr,
Â Â Â Â Â linewidth=2,Â title="LongÂ StopÂ Loss")
plot(series=(strategy.position_sizeÂ <Â 0)Â ?Â shortStopPriceÂ :Â na,
Â Â Â Â Â color=color.red,Â style=plot.style_linebr,
Â Â Â Â Â linewidth=2,Â title="ShortÂ StopÂ Loss")
plot(series=(strategy.position_sizeÂ >Â 0)Â ?Â longtpÂ :Â na,
Â Â Â Â Â color=color.lime,Â style=plot.style_linebr,
Â Â Â Â Â linewidth=2,Â title="LongÂ StopÂ Loss")
plot(series=(strategy.position_sizeÂ <Â 0)Â ?Â shorttpÂ :Â na,
Â Â Â Â Â color=color.lime,Â style=plot.style_linebr,
Â Â Â Â Â linewidth=2,Â title="ShortÂ StopÂ Loss")
Expand (101 lines)