Script Name: Ichimoku Long and Short Strategy
Author: M3RZI
Description: This is a script which tell u when all the parameters in the ichimoku are positive or negative this to open a long or short.

Conditions to show a long:

-Ichimoku cloud in green
-Price Close above Ichimoku cloud
-Lagging span above cloud
-Conversion line above base line

Conditions to show a short:

-Ichimoku cloud in red
-Price close below Ichimoku...
PineScript code:

Pine Scriptâ„¢ strategy
Ichimoku Long and Short Strategy
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//Â Â©Â M3RZI
//@version=4
strategy("IchimokuÂ Strategy",Â overlayÂ =Â true)
//ICHIMOKU-------
conversionPeriodsÂ =Â input(9,Â minval=1,Â title="ConversionÂ LineÂ Length",Â groupÂ =Â "IchimokuÂ Settings")
basePeriodsÂ =Â input(26,Â minval=1,Â title="BaseÂ LineÂ Length",Â groupÂ =Â "IchimokuÂ Settings")
laggingSpan2PeriodsÂ =Â input(52,Â minval=1,Â title="LaggingÂ SpanÂ 2Â Length",Â groupÂ =Â "IchimokuÂ Settings")
displacementÂ =Â input(26,Â minval=1,Â title="Displacement",Â groupÂ =Â "IchimokuÂ Settings")
entryStrategyÂ =Â input(titleÂ =Â "EntryÂ Strategy",Â defvalÂ =Â "Ichimoku",Â optionsÂ =Â ["Ichimoku"],Â typeÂ =Â Â input.string,Â groupÂ =Â "EntryÂ Strategy")
exitStrategyÂ =Â input(titleÂ =Â "ExitÂ Strategy",Â defvalÂ =Â "Ichimoku",Â optionsÂ =Â ["Ichimoku","ATRÂ Pullback"],Â typeÂ =Â input.string,Â groupÂ =Â "PositionÂ ExitÂ Settings")
exitATRLengthÂ =Â input(14,Â titleÂ =Â "ATRÂ Length",Â minvalÂ =Â 1Â ,typeÂ =Â input.integer,Â groupÂ =Â "PositionÂ ExitÂ Settings")
exitATRMultÂ =Â input(2,Â titleÂ =Â "ATRÂ Multiplier",Â minvalÂ =Â 0.1Â ,Â stepÂ =Â 0.1Â ,typeÂ =Â input.float,Â groupÂ =Â "PositionÂ ExitÂ Settings")
riskRewardÂ =Â input(2,Â titleÂ =Â "RiskÂ RewardÂ Ratio",Â minvalÂ =Â 0.1Â ,Â stepÂ =Â 0.1Â ,typeÂ =Â input.float,Â groupÂ =Â "PositionÂ ExitÂ Settings")
closeLagBelowÂ =Â input(true,Â titleÂ =Â "CloseÂ longÂ positionÂ ifÂ laggingÂ spanÂ crossesÂ belowÂ theÂ price",Â typeÂ =Â input.bool,Â groupÂ =Â "PositionÂ ExitÂ Settings")
closelagAboveÂ =Â input(true,Â titleÂ =Â "CloseÂ shortÂ positionÂ ifÂ laggingÂ spanÂ crossesÂ aboveÂ theÂ price",Â typeÂ =Â input.bool,Â groupÂ =Â "PositionÂ ExitÂ Settings")
showDashÂ =Â input(true,Â titleÂ =Â "ShowÂ Dashboard",Â typeÂ =Â input.bool,Â groupÂ =Â "DashboardÂ Options")
colorDashÂ =Â input(color.new(#696969,Â 80),Â titleÂ =Â "BackgroundÂ Color",Â typeÂ =Â input.color,Â inlineÂ =Â "DashÂ Colors",Â groupÂ =Â "DashboardÂ Options")
colorTextDashÂ =Â input(color.new(#FFFFFF,0),Â titleÂ =Â "TextÂ Color",Â typeÂ =Â input.color,Â inlineÂ =Â "DashÂ Colors",Â groupÂ =Â "DashboardÂ Options")
distanceÂ =Â input(30,Â titleÂ =Â "BarsÂ DistanceÂ (toÂ rigth)",Â minvalÂ =Â 1Â ,typeÂ =Â input.integer,Â groupÂ =Â "DashboardÂ Options")
showSignalsÂ =Â input(true,Â titleÂ =Â "ShowÂ SignalsÂ (long/short)",Â typeÂ =Â input.bool,Â groupÂ =Â "ExtraÂ Options")
showTargetsÂ =Â input(true,Â titleÂ =Â "ShowÂ TargetsÂ (Profit/Loss)",Â typeÂ =Â input.bool,Â groupÂ =Â "ExtraÂ Options")
donchian(len)Â =>Â avg(lowest(len),Â highest(len))
conversionLineÂ =Â donchian(conversionPeriods)
baseLineÂ =Â donchian(basePeriods)
leadLine1Â =Â avg(conversionLine,Â baseLine)
leadLine2Â =Â donchian(laggingSpan2Periods)
//---------------------
varÂ longÂ =Â false
varÂ shortÂ =Â false
varÂ signalLongÂ =Â false
varÂ signalShortÂ =Â false
//LONGÂ 
conAbvBaseÂ =Â conversionLineÂ >Â baseLineÂ 
cloudGreenÂ =Â leadLine1Â >Â leadLine2Â 
closeAbvCloudÂ =Â openÂ >Â leadLine1[displacement]Â andÂ openÂ >Â leadLine2[displacement]Â 
lagSpanAbvCloudÂ =Â closeÂ >Â leadLine1[displacement*2]Â andÂ closeÂ >Â leadLine2[displacement*2]Â 
conditionLongÂ =Â notÂ longÂ andÂ conAbvBaseÂ andÂ cloudGreenÂ andÂ closeAbvCloudÂ andÂ lagSpanAbvCloudÂ 
//SHORT
conBlwBaseÂ =Â conversionLineÂ <Â baseLineÂ 
cloudRedÂ =Â leadLine2Â >Â leadLine1Â 
closeBlwCloudÂ =Â openÂ <Â leadLine1[displacement]Â andÂ openÂ <Â leadLine2[displacement]Â 
lagSpanBlwCloudÂ =Â closeÂ <Â leadLine1[displacement*2]Â andÂ closeÂ <Â leadLine2[displacement*2]Â 
conditionShortÂ =Â notÂ shortÂ andÂ conBlwBaseÂ andÂ cloudRedÂ andÂ closeBlwCloudÂ andÂ lagSpanBlwCloudÂ 
varÂ drawingÂ =Â false
varÂ waitingLongÂ =Â false
varÂ waitingShortÂ =Â false
varÂ profitÂ =Â 0.0
varÂ currentÂ =Â 0.0
varÂ lossÂ =Â 0.0
varÂ pullPriceÂ =Â 0.0
atrExitÂ =Â atr(exitATRLength)
ifÂ conditionLong
Â Â Â Â longÂ :=Â true
Â Â Â Â shortÂ :=Â false
Â Â Â Â signalLongÂ :=Â true
Â Â Â Â signalShortÂ :=Â false
Â Â Â Â drawingÂ :=Â true
Â Â Â Â ifÂ exitStrategyÂ ==Â "Ichimoku"
Â Â Â Â Â Â Â Â lossÂ :=Â leadLine2[displacement]Â <Â leadLine1[displacement]Â ?Â leadLine2[displacement]Â :Â leadLine1[displacement]
Â Â Â Â Â Â Â Â profitÂ :=Â openÂ +Â ((openÂ -Â loss)Â *Â riskReward)
Â Â Â Â Â Â Â Â currentÂ :=Â open
Â Â Â Â else
Â Â Â Â Â Â Â Â lossÂ :=Â openÂ -Â atrExitÂ *Â exitATRMult
Â Â Â Â Â Â Â Â currentÂ :=Â open
Â Â Â Â Â Â Â Â profitÂ :=Â openÂ +Â (openÂ -Â loss)Â *Â riskReward
Â Â Â Â strategy.entry("Long",Â strategy.long,Â 10Â ,alert_messageÂ =Â "LongÂ PositionÂ Open")
Â Â Â Â strategy.exit("LongÂ exit",Â "Long",Â limitÂ =Â profit,Â stopÂ =Â loss,Â alert_messageÂ =Â "LongÂ PositionÂ Close")
ifÂ conditionShort
Â Â Â Â shortÂ :=Â true
Â Â Â Â longÂ :=Â false
Â Â Â Â signalShortÂ :=Â true
Â Â Â Â signalLongÂ :=Â false
Â Â Â Â drawingÂ :=Â true
Â Â Â Â ifÂ exitStrategyÂ ==Â "Ichimoku"
Â Â Â Â Â Â Â Â lossÂ :=Â leadLine2[displacement]Â >Â leadLine1[displacement]Â ?Â leadLine2[displacement]Â :Â leadLine1[displacement]
Â Â Â Â Â Â Â Â profitÂ :=Â openÂ -Â ((lossÂ -Â open)Â *Â riskReward)
Â Â Â Â Â Â Â Â currentÂ :=Â open
Â Â Â Â elseÂ 
Â Â Â Â Â Â Â Â lossÂ :=Â openÂ +Â atrExitÂ *Â exitATRMult
Â Â Â Â Â Â Â Â currentÂ :=Â open
Â Â Â Â Â Â Â Â profitÂ :=Â openÂ -Â (lossÂ -Â open)Â *Â riskReward
Â Â Â Â strategy.entry("Short",Â strategy.short,Â 10Â ,Â alert_messageÂ =Â "ShortÂ PositionÂ Open")
Â Â Â Â strategy.exit("ShortÂ exit","Short",Â limitÂ =Â profit,Â stopÂ =Â loss,Â alert_messageÂ =Â "ShortÂ PositionÂ Close")
ifÂ long
Â Â Â Â ifÂ closeLagBelowÂ andÂ openÂ <Â close[displacementÂ +Â 1]
Â Â Â Â Â Â Â Â drawingÂ :=Â false
Â Â Â Â Â Â Â Â signalLongÂ :=Â false
Â Â Â Â Â Â Â Â strategy.close("Long",Â alert_messageÂ =Â "LongÂ ClosedÂ byÂ LaggingÂ SpanÂ CrossingÂ BelowÂ Price")
Â Â Â Â elseÂ ifÂ high[1]Â >=Â profitÂ orÂ low[1]Â <=Â loss
Â Â Â Â Â Â Â Â drawingÂ :=Â false
Â Â Â Â Â Â Â Â signalLongÂ :=Â false
Â Â Â Â Â Â Â Â strategy.close("Long",Â alert_messageÂ =Â "LongÂ Closed")
ifÂ shortÂ 
Â Â Â Â ifÂ closelagAboveÂ andÂ openÂ >Â close[displacementÂ +Â 1]
Â Â Â Â Â Â Â Â drawingÂ :=Â false
Â Â Â Â Â Â Â Â signalShortÂ :=Â false
Â Â Â Â Â Â Â Â strategy.close("Short",Â alert_messageÂ =Â "ShortÂ ClosedÂ byÂ LaggingÂ SpanÂ CrossingÂ AboveÂ Price")
Â Â Â Â elseÂ ifÂ low[1]Â <=Â profitÂ Â orÂ high[1]Â >=Â loss
Â Â Â Â Â Â Â Â drawingÂ :=Â false
Â Â Â Â Â Â Â Â signalShortÂ :=Â false
Â Â Â Â Â Â Â Â strategy.close("Short",Â alert_messageÂ =Â "ShortÂ Closed")
Â Â Â Â Â Â Â Â 
decision(condition)Â =>
Â Â Â Â varÂ textÂ =Â ""
Â Â Â Â ifÂ condition
Â Â Â Â Â Â Â Â textÂ :=Â "ðŸŸ¢"
Â Â Â Â else
Â Â Â Â Â Â Â Â textÂ :=Â "ðŸ”´"
positionÂ =Â time+((time-time[1])*distance)
PandLÂ =Â signalLongÂ ?Â ((open-current)/current)*100Â :Â signalShortÂ ?Â (((open-current)/current)*100)*-1Â :Â 0.0
ifÂ showDash
Â Â Â Â labelÂ dashBoardÂ =Â label.new(position,open,
Â Â Â Â Â textÂ =Â "-----------LongÂ conditions-----------"
Â Â Â Â Â +"\n\n"+decision(signalLong)+"Â LongÂ positionÂ isÂ open"
Â Â Â Â Â +"\n\n"+decision(conAbvBase)+"Â ConversionÂ lineÂ aboveÂ baseÂ line"
Â Â Â Â Â +"\n\n"+decision(cloudGreen)+"Â CloudÂ isÂ green"
Â Â Â Â Â +"\n\n"+decision(closeAbvCloud)+"Â PriceÂ closedÂ aboveÂ cloud"
Â Â Â Â Â +"\n\n"+decision(lagSpanAbvCloud)+"Â LaggingÂ spanÂ aboveÂ cloud"
Â Â Â Â Â +"\n\n-----------ShortÂ conditions-----------"
Â Â Â Â Â +"\n\n"+decision(signalShort)+"Â ShortÂ positionÂ isÂ open"
Â Â Â Â Â +"\n\n"+decision(conBlwBase)+"Â ConversionÂ lineÂ belowÂ baseÂ line"
Â Â Â Â Â +"\n\n"+decision(cloudRed)+"Â CloudÂ isÂ red"
Â Â Â Â Â +"\n\n"+decision(closeBlwCloud)+"Â PriceÂ closedÂ belowÂ cloud"
Â Â Â Â Â +"\n\n"+decision(lagSpanBlwCloud)+"Â LaggingÂ spanÂ belowÂ cloud"
Â Â Â Â Â +"\n\n---------------Extra---------------"
Â Â Â Â Â +"\n\nUnrealizedÂ P&L(%):Â "+tostring(PandL),
Â Â Â Â Â xlocÂ =Â xloc.bar_time,Â textalignÂ =Â text.align_left,Â styleÂ =Â label.style_label_left,Â colorÂ =Â colorDash,Â textcolorÂ =Â colorTextDash)
Â Â Â Â label.delete(dashBoard[1])
//DRAWING
plotshape(showSignalsÂ ?Â conditionLongÂ :Â na,Â titleÂ =Â "LongÂ Signal",Â location=location.belowbar,style=shape.labelup,color=color.green,textcolor=color.white,size=size.small,text="Long")
plotshape(showSignalsÂ ?Â conditionShortÂ :Â na,Â titleÂ =Â "ShortÂ Signal",Â location=location.abovebar,style=shape.labeldown,color=color.red,textcolor=color.white,size=size.small,text="Short")
profitLineÂ =Â plot(showTargetsÂ ?Â drawingÂ ?Â profitÂ :Â naÂ :Â na,Â titleÂ =Â "TakeÂ profit",Â colorÂ =Â color.green,Â styleÂ =Â plot.style_linebr)
currentLineÂ =plot(showTargetsÂ ?Â drawingÂ ?Â currentÂ :Â naÂ :Â na,Â titleÂ =Â "MiddleÂ Line",Â colorÂ =Â color.white,Â styleÂ =Â plot.style_linebr)
lossLineÂ =Â plot(showTargetsÂ ?Â drawingÂ ?Â lossÂ :Â naÂ :Â na,Â titleÂ =Â "StopÂ Loss",Â colorÂ =Â color.red,Â styleÂ =Â plot.style_linebr)
fill(currentLine,profitLine,Â titleÂ =Â "ProfitÂ Background"Â ,colorÂ =Â color.new(color.green,75))
fill(currentLine,lossLine,Â titleÂ =Â "LossÂ Background"Â ,colorÂ =Â color.new(color.red,75))
plot(conversionLine,Â colorÂ =Â #0496ff,Â titleÂ =Â "ConversionÂ Line")
plot(baseLine,Â colorÂ =Â color.yellow,Â titleÂ =Â "BaseÂ Line")
plot(close,Â offsetÂ =Â -displacementÂ +Â 1,Â colorÂ =Â color.purple,Â titleÂ =Â "LaggingÂ Span")
p1Â =Â plot(leadLine1,Â offsetÂ =Â displacementÂ -Â 1,Â color=color.green,
Â Â Â Â Â title="LeadÂ 1")
p2Â =Â plot(leadLine2,Â offsetÂ =Â displacementÂ -Â 1,Â color=color.red,
Â Â Â Â Â title="LeadÂ 2")
fill(p1,Â p2,Â titleÂ =Â "LeadÂ 1Â andÂ 2Â Background"Â ,colorÂ =Â leadLine1Â >Â leadLine2Â ?Â color.greenÂ :Â color.red)
//------NOTEÂ FORÂ ALERTS
//IFÂ YOUÂ WANTÂ TOÂ RECIVEÂ AÂ ALERTÂ JUSTÂ FOLLOWÂ THEÂ NEXTÂ STEPS:
//1.-GOÂ TOÂ ALERTSÂ ANDÂ CLICKÂ INÂ "CREATEÂ NEWÂ ALERT"
//2.-INÂ CONDITIONÂ Â CHOOSEÂ THEÂ "ICHIMOKUÂ STRATEGY"
//3.-GIVEÂ THEÂ ALERTÂ AÂ NAME
//4.-INÂ MESSAGEÂ YOUÂ AREÂ GOINGÂ TOÂ WRITEÂ "{{strategy.order.alert_message}}",Â WITHÂ THISÂ WHENÂ AÂ SHORTÂ ORÂ LONGÂ SIGNALÂ APPEARÂ WILLÂ SHOWÂ THEÂ "alert_message"Â INÂ THEÂ ALERT.
//THEÂ alert_messageÂ ISÂ DEFINEDÂ INÂ THEÂ "strategy.entry"Â andÂ "strategy.exit"
//------NOTEÂ IFÂ YOUÂ WANTÂ TOÂ USEÂ AÂ BOTÂ WITHÂ THISÂ STRATEGY
//THISÂ ISÂ AÂ STRATEGYÂ SOÂ YOUÂ ONLYÂ CANÂ RECIVEÂ ALERTSÂ FROMÂ THEÂ "strategy.entry"Â ANDÂ "strategy.exit"Â BUTÂ THISÂ AREÂ ONLYÂ INÂ ONEÂ ALERT
//SOÂ IFÂ YOUÂ WANTÂ TOÂ USEÂ AÂ BOTHÂ WITHÂ THEÂ STRATEGYÂ FOLLOWÂ THEÂ NEXTÂ STEPS:
//1.-ALREADYÂ HAVEÂ AÂ BOTÂ CREATED
//2.-LOCATEÂ Â YOURÂ WEBHOOKÂ ANDÂ COMMANDSÂ FORÂ THEÂ BOTÂ 
//3.-INÂ THEÂ "alert_message"Â OFÂ THEÂ "strategy.entryÂ (LINEÂ 95)"Â YOUÂ WILLÂ PASTEÂ THEÂ COMMANDÂ OFÂ YOURÂ BOTÂ FORÂ ENTERÂ AÂ LONGÂ ANDÂ INÂ THEÂ "strategy.exitÂ (LINEÂ 96)"Â THATÂ AREÂ BELOWÂ INÂ THEÂ "alert_message"Â PASTEÂ THEÂ COMMANDÂ THATÂ ISÂ FORÂ CLOSEÂ THEÂ LONGÂ POSITION
//4.-YOUÂ WILLÂ DOÂ THEÂ SAMEÂ FORÂ THEÂ "strategy.entryÂ (LINEÂ 109)"Â ANDÂ THEÂ "strategy.exitÂ (LINEÂ 110)"Â BUTÂ THISÂ TIMEÂ WITHÂ THEÂ COMMANDÂ OFÂ OPENÂ AÂ SHORTÂ ANDÂ CLOSEÂ AÂ SHORT
//5.-AFTERÂ THEÂ PREVIOUSÂ STEPSÂ GOÂ TOÂ ALERTSÂ ANDÂ CLICKÂ INÂ "CREATEÂ NEWÂ ALERT"
//6.-INÂ CONDITIONÂ CHOOSEÂ THEÂ "ICHIMOKUÂ STRATEGY"
//7.-SELECTÂ "URLÂ fromÂ webhook"
//8.-GIVEÂ THEÂ ALERTÂ AÂ NAME
//9.-INÂ MESSAGEÂ WRITEÂ "{{strategy.order.alert_message}}"
//10.-NOWÂ WITHÂ ALLÂ THISÂ EACHÂ TIMEÂ AÂ SIGNALÂ APPEARÂ INÂ THEÂ STRATEGYÂ THISÂ WILLÂ SENDÂ THEÂ COMMANDÂ TOÂ YOURÂ BOTÂ TOÂ OPENÂ ORÂ CLOSEÂ AÂ LONGÂ ORÂ SHORT
////------ANOTHERÂ IMPORTANTÂ NOTEÂ FORÂ PEOPLEÂ THATÂ WANTÂ TOÂ USEÂ AÂ BOT
//IÂ NOWÂ THATÂ I'MÂ SOÂ BADÂ EXPLAININGÂ THINGSÂ SOÂ WATCHÂ THEÂ FOLLOWINGÂ VIDEOÂ THATÂ EXPLAINSÂ BETTERÂ THANÂ ME,Â ITSÂ FROMÂ THEÂ CHANNELÂ "TheÂ ArtÂ ofÂ Trading"
//ANDÂ ALSOÂ UÂ CANÂ CHECKÂ HISÂ TRADINGVIEWÂ ACCOUNT,Â HEÂ CREATEÂ ANÂ AMAZINGÂ SCRIPTÂ FORÂ THEÂ COMMUNITYÂ ANDÂ CHECKÂ HISÂ CHANNELÂ TOÂ LEARNÂ PINEÂ SCRIPT
//https://www.youtube.com/watch?v=-d_rFRd3o-0
//https://es.tradingview.com/u/ZenAndTheArtOfTrading/#published-charts
Expand (206 lines)