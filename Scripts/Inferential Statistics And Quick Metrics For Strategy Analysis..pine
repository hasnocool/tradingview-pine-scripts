Script Name: Inferential Statistics And Quick Metrics For Strategy Analysis.
Author: pAulseperformance
Description: Part of this script is used to calculate inferential statistics and metrics not available through the built in variables in the strategy tester.

A label will be created on the last bar displaying important strategy results,  so you can test and analyze strategies quicker. 

The built in strategy itself is just an example. You can copy and paste the metrics into...
PineScript code:

Pine Scriptâ„¢ strategy
Inferential Statistics And Quick Metrics For Strategy Analysis.
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
//@version=4
//Â InferentialÂ StatisticsÂ andÂ tradingÂ metricsÂ forÂ anyÂ strategyÂ toÂ helpÂ youÂ quicklyÂ analyzeÂ strategyÂ results.
//Â TheÂ strategyÂ itselfÂ isÂ aÂ momentumÂ strategyÂ thatÂ isÂ meantÂ forÂ 4hrÂ toÂ DailyÂ timeframes,Â butÂ itÂ isÂ veyÂ basicÂ andÂ isÂ justÂ showcasingÂ theÂ metrics
//Â APPT:Â AverageÂ ProfitÂ PerÂ TradeÂ withÂ confidenceÂ interval.Â DefaultÂ isÂ 95%Â confidence,Â butÂ canÂ beÂ changedÂ inÂ theÂ setting.
//Â TradesÂ Needed:Â ShowsÂ #Â ofÂ tradesÂ neededÂ forÂ statisticalÂ significanceÂ basedÂ onÂ CIÂ andÂ CL
//Â TradesÂ Closed:Â SumÂ ofÂ allÂ tradesÂ closed.Â SameÂ asÂ metricÂ inÂ strategyÂ tester
//Â NetÂ Profit:Â SumÂ ofÂ allÂ tradesÂ profit/lossÂ includingÂ commission.Â SameÂ asÂ strategyÂ Tester
//Â MaxÂ Drawdown:Â SameÂ asÂ strategyÂ tester.Â ThisÂ metricÂ couldÂ beÂ improved,Â rightÂ nowÂ it'sÂ notÂ veryÂ intuitive
//Â BuyÂ &Â HoldÂ Return:Â SameÂ asÂ strategyÂ tester.
//Â Author:Â @Gammapips
//Â Version:Â v0.2
//Â Published:Â 2020.10.13Â 12:04:00Â UTC
strategy(shorttitle="GammapipsÂ EMAÂ Cross",Â 
Â Â Â Â Â Â Â Â Â title="GPX",Â 
Â Â Â Â Â Â Â Â Â overlay=true,
Â Â Â Â Â Â Â Â Â initial_capital=10000,
Â Â Â Â Â Â Â Â Â currency=currency.USD,
Â Â Â Â Â Â Â Â Â //Â ticksÂ ofÂ slippage.Â ThisÂ shouldÂ beÂ changedÂ accordingÂ toÂ liquidityÂ andÂ positionÂ sizeÂ ofÂ yourÂ targetÂ market.
Â Â Â Â Â Â Â Â Â slippage=5,
Â Â Â Â Â Â Â Â Â //Â ThisÂ commissionÂ shouldÂ matchÂ yourÂ broker/exchange.Â ItÂ couldÂ beÂ higherÂ orÂ lower
Â Â Â Â Â Â Â Â Â commission_type=strategy.commission.percent,
Â Â Â Â Â Â Â Â Â commission_value=0.1,Â Â Â 
Â Â Â Â Â Â Â Â Â default_qty_type=strategy.percent_of_equity,
Â Â Â Â Â Â Â Â Â default_qty_value=1,
Â Â Â Â Â Â Â Â Â //Â 'FIFO'Â orÂ 'ANY'Â CheckÂ withÂ yourÂ broker.Â FOREXÂ isÂ FIFO
Â Â Â Â Â Â Â Â Â close_entries_rule='ANY',
Â Â Â Â Â Â Â Â Â process_orders_on_close=false
Â Â Â Â Â Â Â Â Â )
//Â FUNCTIONÂ DEFINITIONS
//Â TrackingÂ TradesÂ forÂ StatisticsÂ sinceÂ weÂ don'tÂ haveÂ accessÂ toÂ individualÂ tradesÂ fromÂ builtÂ inÂ variablesÂ andÂ weÂ needÂ toÂ measureÂ variance.
//Â InferentialÂ Statistics
i_CLÂ =Â input(95,Â "ConfidenceÂ Level",Â options=[80,85,90,95,99,99.5,99.9])
i_CIÂ =Â input(10,Â "ConfidenceÂ Interval")Â /Â 100Â Â //Â aka.Â MarginÂ ofÂ Error
f_getZScore()Â =>
Â Â Â Â //Â ThisÂ valueÂ measuresÂ yourÂ degreeÂ ofÂ certaintyÂ regardingÂ howÂ wellÂ aÂ sampleÂ representsÂ theÂ overallÂ populationÂ 
Â Â Â Â //Â withinÂ yourÂ chosenÂ marginÂ ofÂ error.
Â Â Â Â Â _zScoreÂ =Â i_CLÂ ==Â 80Â ?Â 1.282Â :Â i_CLÂ ==Â 85Â ?Â 1.440Â :Â i_CLÂ ==Â 90Â ?Â 1.645Â :Â i_CLÂ ==Â 95Â ?Â 1.960Â :Â i_CLÂ ==Â 99Â ?Â 2.576Â :Â i_CLÂ ==Â 99.5Â ?Â 2.87Â :Â 3.291
f_sampleSizeNeeded()Â =>
Â Â Â Â //Â â—Â :Â NotÂ sureÂ ifÂ thisÂ isÂ beingÂ computedÂ correctlyÂ yet.
Â Â Â Â //Â IfÂ ourÂ strategyÂ doesn'tÂ takeÂ enoughÂ tradesÂ weÂ can'tÂ beÂ confidentÂ it'sÂ givingÂ usÂ theÂ correctÂ results.
Â Â Â Â //Â ThisÂ willÂ findÂ theÂ recommendedÂ amountÂ ofÂ samples(trades)Â weÂ needÂ toÂ takeÂ toÂ beÂ statisticallyÂ significant.
Â Â Â Â //Â https://www.surveysystem.com/sscalc.htm#one
Â Â Â Â _zScoreÂ =Â f_getZScore()
Â Â Â Â _SDÂ Â Â Â Â =Â 0.5Â Â Â Â Â Â Â Â Â //Â standardÂ ofÂ deviationÂ ==Â .5
Â Â Â Â _NÂ Â Â Â Â Â =Â bar_indexÂ Â Â //Â ThisÂ populationÂ shouldÂ representÂ theÂ maximumÂ amountÂ ofÂ tradesÂ thatÂ couldÂ beÂ takenÂ forÂ eachÂ bar.
Â Â Â Â _sampleSizeNeededÂ =Â round((pow(_zScore,Â 2)*_SD*(1-_SD)/pow(i_CI,2))/(1Â +Â (pow(_zScore,Â 2)*_SD*(1-_SD)/(pow(i_CI,2)*_N))))
f_findCI(_samples)Â =>
Â Â Â Â //Â CalculatesÂ theÂ actualÂ confidenceÂ intervalÂ accordingÂ toÂ theÂ sampleÂ size.Â https://www.alchemer.com/resources/blog/how-to-calculate-confidence-intervals/
Â Â Â Â //Â https://www.scribbr.com/statistics/confidence-interval/
Â Â Â Â //Â _samples:Â MustÂ beÂ anÂ array.floatÂ orÂ array.integer.
Â Â Â Â //Â ReturnsÂ aÂ tupleÂ containingÂ theÂ sampleÂ meanÂ andÂ positiveÂ confidenceÂ interval.
Â Â Â Â _nÂ Â =Â array.size(_samples)Â Â Â Â Â Â //Â SampleÂ sizeÂ (amount),Â n
Â Â Â Â _xÂ Â =Â array.avg(_samples)Â Â Â Â Â Â Â //Â SampleÂ MeanÂ (average),Â X
Â Â Â Â _SDÂ =Â array.stdev(_samples)Â Â Â Â Â //Â StandardÂ Deviation,Â ÏƒÂ orÂ sÂ Â Â theÂ populationÂ standardÂ deviation
Â Â Â Â _zÂ =Â f_getZScore()Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â theÂ criticalÂ valueÂ ofÂ theÂ z-distribution
Â Â Â Â _iÂ =Â _z*(_SD/sqrt(_n))Â Â Â Â Â Â Â Â Â Â //Â Interval.Â +-
Â Â Â Â [_x,Â _i]
f_APPT()Â =>Â 
Â Â Â Â //Â APPTÂ -Â AverageÂ ProfitÂ PerÂ TradeÂ https://www.investopedia.com/articles/forex/07/profit_loss.asp
Â Â Â Â //Â APPTÂ =Â (PWÃ—AW)Â âˆ’Â (PLÃ—AL)Â (WinÂ ProbabilityÂ xÂ AverageÂ Win)Â (LoseÂ ProbabailyÂ xÂ AverageÂ Loss)
Â Â Â Â _PWÂ Â Â =Â strategy.wintrades/strategy.closedtrades
Â Â Â Â _AWÂ Â Â =Â strategy.grossprofit/strategy.wintrades
Â Â Â Â _PLÂ Â Â =Â strategy.losstrades/strategy.closedtrades
Â Â Â Â _ALÂ Â Â =Â strategy.grossloss/strategy.losstrades
Â Â Â Â _APPTÂ =Â ((_PW*_AW)Â -Â (_PL*_AL))
f_PPT()Â =>
Â Â Â Â //Â ForÂ everyÂ closedÂ tradeÂ weÂ pushÂ theÂ netÂ profitÂ toÂ anÂ array.
Â Â Â Â varÂ a_PPTÂ =Â array.new_float(0)
Â Â Â Â _profitPerTradeÂ =Â strategy.netprofitÂ -Â strategy.netprofit[1]
Â Â Â Â ifÂ strategy.closedtradesÂ >Â strategy.closedtrades[1]Â Â 
Â Â Â Â Â Â Â Â array.push(a_PPT,Â _profitPerTrade)
Â Â Â Â a_PPT
f_rD(_float)Â =>
Â Â Â Â //Â RoundÂ DecimalÂ points
Â Â Â Â round(_float*10)/10
f_buyAndHoldReturn()Â =>
Â Â Â Â _entryPriceÂ =Â valuewhen(strategy.closedtradesÂ ==Â 0Â andÂ strategy.opentradesÂ >Â 0,Â strategy.position_avg_price,Â 0)
Â Â Â Â ((strategy.initial_capitalÂ /Â _entryPrice)Â *Â close)Â -Â strategy.initial_capital
Â Â Â Â 
f_stratMetrics()Â =>
Â Â Â Â //Â StrategyÂ MetricsÂ forÂ quickÂ analysis
Â Â Â Â _stratMetricsÂ =Â "StrategyÂ Metrics\n====================="
Â Â Â Â 
Â Â Â Â //Â GetÂ AverageÂ ProfitÂ PerÂ Trade:Â MethodÂ 1
Â Â Â Â //Â _stratMetricsÂ :=Â _stratMetricsÂ +Â "APPT:Â "Â +Â tostring(f_rD(f_APPT()))
Â Â Â Â 
Â Â Â Â //Â AverageÂ ProfitÂ PerÂ Trade:Â MethodÂ 2Â withÂ confidenceÂ interval.
Â Â Â Â [_x,Â _i]Â =Â f_findCI(f_PPT())Â 
Â Â Â Â _stratMetricsÂ :=Â _stratMetricsÂ +Â "\nAPPT:Â "Â +Â tostring(f_rD(_x))Â +Â "Â +-Â "Â +Â tostring(f_rD(_i))
Â Â Â Â //Â TradesÂ neededÂ toÂ beÂ i_CLÂ confidentÂ withinÂ +-Â i_CI%Â Â 
Â Â Â Â //â—Â LookingÂ forÂ helpÂ here
Â Â Â Â //Â _stratMetricsÂ :=Â _stratMetricsÂ +Â "\nTradesÂ Needed:Â "Â +Â tostring(f_sampleSizeNeeded())Â Â 
Â Â Â Â _stratMetricsÂ :=Â _stratMetricsÂ +Â "\nTradesÂ Closed:Â "Â +Â tostring(strategy.closedtrades)
Â Â Â Â //Â SharpÂ Ratio
Â Â Â Â //Â TODO
Â Â Â Â 
Â Â Â Â //Â NetÂ ProfitÂ &Â MaxÂ Drawdon
Â Â Â Â _stratMetricsÂ :=Â _stratMetricsÂ +Â "\nNetÂ Profit:Â "Â +Â tostring(f_rD(strategy.netprofit))Â +
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "\nMaxÂ Drawdown:Â "Â +Â tostring(f_rD(strategy.max_drawdown))
Â Â Â Â //Â BuyÂ &Â HoldÂ ReturnÂ 
Â Â Â Â _stratMetricsÂ :=Â _stratMetricsÂ +Â "\nBuyÂ &Â HoldÂ Return:Â "Â +Â tostring(f_rD(f_buyAndHoldReturn()))
Â Â Â Â 
Â Â Â Â //Â PrintÂ toÂ Chart
Â Â Â Â dtÂ =Â time-time[1]
Â Â Â Â varÂ statLabelÂ =Â label.new(timeÂ +Â 5*dt,Â high,Â xloc=xloc.bar_time,Â text=_stratMetrics)
Â Â Â Â label.set_text(statLabel,Â _stratMetrics)
Â Â Â Â label.set_x(statLabel,Â timeÂ +Â 5*dt)
Â Â Â Â label.set_y(statLabel,Â high*(1.05))
f_stratMetrics()
//Â CALCULATIONS
smaFastÂ Â Â Â Â Â Â =Â sma(close,Â 100)
smaSlowÂ Â Â Â Â Â Â =Â sma(close,Â 200)
emaFastÂ Â Â Â Â Â Â =Â ema(close,Â 12)
emaSlowÂ Â Â Â Â Â Â =Â ema(close,Â 26)
buyConditionÂ Â =Â crossunder(emaSlow,Â emaFast)Â andÂ (closeÂ >=Â smaFast)Â Â //Â ifÂ yellowÂ crossesÂ belowÂ redÂ andÂ priceÂ isÂ aboveÂ greenÂ ->Â Buy
sellConditionÂ =Â crossover(emaSlow,Â emaFast)Â andÂ (closeÂ <=Â smaFast)Â Â Â //Â ifÂ yellowÂ crossesÂ overÂ redÂ andÂ priceÂ isÂ belowÂ greenÂ ->Â SELL
//Â plot()Â CALLS
plotchar(sellCondition,Â char="ğŸ»",Â title="SellÂ Condition",Â size=size.tiny,Â location=location.top)
plotchar(buyCondition,Â Â char="ğŸ®",Â title="BuyÂ Condition",Â Â size=size.tiny,Â location=location.bottom)
plot(smaFast,Â title="FastÂ SMA",Â color=color.green,Â Â linewidth=4)
plot(emaSlow,Â title="SlowÂ EMA",Â color=color.yellow,Â linewidth=2)
plot(emaFast,Â title="FastÂ EMA",Â color=color.red,Â Â Â Â linewidth=1)
//Â strategy.*()Â CALLS
ifÂ (buyCondition)
Â Â Â Â strategy.entry("BE",Â strategy.long)
if(sellCondition)
Â Â Â Â strategy.entry("SE",Â strategy.short)
Expand (152 lines)