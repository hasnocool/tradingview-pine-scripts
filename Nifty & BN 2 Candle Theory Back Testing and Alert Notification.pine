Script Name: Nifty & BN 2 Candle Theory Back Testing and Alert Notification
Author: abdullabashaa
Description: How To Initiate Long Trade-in Index Future/ Buy Call Options â€“ 3 Min TF

â–ª If The Index Futures Trades Above The VWAP, the Following Parameters are Checked For 2 Candle Theory on the long side
â–ª RSI Trades Above 50 & Between 50-75/80
â–ª Volume Of 2 Consecutive Bars Is Above 50 K for BN & 125 K For Nifty
â–ª All the indicators (Parabolic SAR, Super Trend, VMA, VWAP)...
PineScript code:

Pine Scriptâ„¢ strategy
Nifty & BN 2 Candle Theory Back Testing and Alert Notification
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//@version=5
//---------------------------//2Â CandleÂ TheoreyÂ +Â GoldenÂ Crossover\\------------------------------\\
strategy('2Â CandleÂ TheoreyÂ V2',Â process_orders_on_close=true,Â overlayÂ =Â true)
//---------------------------------//Options\\---------------------------------\\
showsessionÂ =Â input.bool(defval=false,Â title='',Â inline='Session',Â group='Timefilter')
session2Â =Â input.session(defval='1430-1000',Â title='SessionÂ Timings(toÂ avoidÂ trades)',Â inline='Session',Â group='Timefilter')
profitMultiplierÂ =Â input.float(defval=2.0,Â minval=0.1,step=0.1,Â maxval=10.0,Â title='RiskÂ toÂ Reward',Â group='MainÂ Settings',Â tooltip='ModifyÂ RiskÂ toÂ RewardÂ forÂ TakeÂ Profit')
volumecutoffÂ =Â input.float(defval=50000,Â minval=Â 10000Â ,Â step=Â 1000,Â maxval=1000000,Â title='VolumeÂ Cutoff',Â tooltip='ModifyÂ VolumeÂ CutoffÂ ex:Â 2Â CandlesÂ withÂ VolumeÂ aboveÂ 50kÂ forÂ EntryÂ Condition',Â group='MainÂ Settings')
showVolumeColorÂ =Â input.bool(defval=true,title='',Â group='MainÂ Settings',Â inline='Color')
colorÂ volumeColorInputÂ =Â input.color(color.new(color.yellow,20),Â "Â ShowÂ HighÂ VolumeÂ Candles",Â group='MainÂ Settings',Â tooltip='ChangeÂ CanldeÂ ColorÂ forÂ CandlesÂ aboveÂ VolumeÂ Cutoff',Â inline='Color')
varÂ g_filterÂ =Â 'FilterÂ Settings'
emaFilterÂ =Â input.int(title='EMAÂ Filter',Â defval=0,Â group=g_filter,Â tooltip='EMAÂ lengthÂ toÂ filterÂ tradesÂ -Â setÂ toÂ zeroÂ toÂ disable')
i_startTimeÂ =Â input.time(title='StartÂ DateÂ Filter',Â defval=timestamp('01Â JanÂ 2000Â 13:30Â +0000'),Â group=g_filter,Â tooltip='DateÂ &Â timeÂ toÂ beginÂ tradingÂ from')
i_endTimeÂ =Â input.time(title='EndÂ DateÂ Filter',Â defval=timestamp('1Â JanÂ 2099Â 19:30Â +0000'),Â group=g_filter,Â tooltip='DateÂ &Â timeÂ toÂ stopÂ trading')
//Â BacktesterÂ Settings
varÂ g_testerÂ =Â 'BacktesterÂ Settings'
startBalanceÂ =Â input.float(title='StartingÂ Balance',Â defval=10000.0,Â group=g_tester,Â tooltip='YourÂ startingÂ balanceÂ forÂ theÂ customÂ inbuiltÂ testerÂ system')
riskPerTradeÂ =Â input.float(title='RiskÂ PerÂ Trade',Â defval=1.0,Â group=g_tester,Â tooltip='YourÂ desiredÂ %Â riskÂ perÂ tradeÂ (asÂ aÂ wholeÂ number)')
drawTesterÂ =Â input.bool(title='DrawÂ Backtester',Â defval=true,Â group=g_tester,Â tooltip='TurnÂ on/offÂ inbuiltÂ backtesterÂ display')
//-----------------------------//Â CustomÂ FunctionsÂ \\---------------------------------\\
Â Â Â Â 
//Â CustomÂ functionÂ toÂ truncateÂ (cut)Â excessÂ decimalÂ places
truncate(_number,Â _decimalPlaces)Â =>
Â Â Â Â _factorÂ =Â math.pow(10,Â _decimalPlaces)
Â Â Â Â int(_numberÂ *Â _factor)Â /Â _factor
//---------------------------------//EMAÂ Filter\\---------------------------------\\
emaÂ =Â ta.ema(close,Â emaFilterÂ ==Â 0Â ?Â 1Â :Â emaFilter)
//---------------------------------//RSIÂ Code\\---------------------------------\\
marsi(sourcersi,Â lengthrsi,Â typersi)Â =>
Â Â Â Â switchÂ typersi
Â Â Â Â Â Â Â Â "SMA"Â =>Â ta.sma(sourcersi,Â lengthrsi)
Â Â Â Â Â Â Â Â "BollingerÂ Bands"Â =>Â ta.sma(sourcersi,Â lengthrsi)
Â Â Â Â Â Â Â Â "EMA"Â =>Â ta.ema(sourcersi,Â lengthrsi)
Â Â Â Â Â Â Â Â "SMMAÂ (RMA)"Â =>Â ta.rma(sourcersi,Â lengthrsi)
Â Â Â Â Â Â Â Â "WMA"Â =>Â ta.wma(sourcersi,Â lengthrsi)
Â Â Â Â Â Â Â Â "VWMA"Â =>Â ta.vwma(sourcersi,Â lengthrsi)
rsiLengthInputÂ =Â input.int(14,Â minval=1,Â title="RSIÂ Length",Â group="RSIÂ Settings")
rsiSourceInputÂ =Â input.source(close,Â "Source",Â group="RSIÂ Settings")
maTypeInputÂ =Â input.string("SMA",Â title="MAÂ Type",Â options=["SMA",Â "BollingerÂ Bands",Â "EMA",Â "SMMAÂ (RMA)",Â "WMA",Â "VWMA"],Â group="RSIÂ Settings")
maLengthInputÂ =Â input.int(14,Â title="MAÂ Length",Â group="RSIÂ Settings")
bbMultInputÂ =Â input.float(2.0,Â minval=0.001,Â maxval=50,Â title="BBÂ StdDev",Â group="RSIÂ Settings")
up0Â =Â ta.rma(math.max(ta.change(rsiSourceInput),Â 0),Â rsiLengthInput)
down0Â =Â ta.rma(-math.min(ta.change(rsiSourceInput),Â 0),Â rsiLengthInput)
rsiÂ =Â down0Â ==Â 0Â ?Â 100Â :Â up0Â ==Â 0Â ?Â 0Â :Â 100Â -Â (100Â /Â (1Â +Â up0Â /Â down0))
rsiMAÂ =Â marsi(rsi,Â maLengthInput,Â maTypeInput)
isBBÂ =Â maTypeInputÂ ==Â "BollingerÂ Bands"
//---------------------------------//PSARÂ Code\\---------------------------------\\
start0Â =Â input(0.02)
increment0Â =Â input(0.02)
maximum0Â =Â input(0.2,Â "MaxÂ Value")
outÂ =Â ta.sar(start0,Â increment0,Â maximum0)
plot(out,Â "ParabolicSAR",Â style=plot.style_cross,Â color=#2962FF)
//---------------------------------//SupertrendÂ Code\\---------------------------------\\
lengthÂ =Â input(title='ATRÂ Period',Â defval=10,Â group="SupertrendÂ Settings")
multÂ =Â input.float(title='ATRÂ Multiplier',Â step=0.1,Â defval=2,Â group="SupertrendÂ Settings")
srcÂ =Â input(title='Source',Â defval=close,Â group="SupertrendÂ Settings")
wicksÂ =Â input(title='TakeÂ WicksÂ intoÂ AccountÂ ?',Â defval=true,Â group="SupertrendÂ Settings")
showLabelsÂ =Â input(title='ShowÂ Buy/SellÂ LabelsÂ ?',Â defval=true,Â group="SupertrendÂ Settings")
highlightStateÂ =Â input(title='HighlightÂ StateÂ ?',Â defval=true,Â group="SupertrendÂ Settings")
atrÂ =Â multÂ *Â ta.atr(length)
highPriceÂ =Â wicksÂ ?Â highÂ :Â close
lowPriceÂ =Â wicksÂ ?Â lowÂ :Â close
doji4priceÂ =Â openÂ ==Â closeÂ andÂ openÂ ==Â lowÂ andÂ openÂ ==Â high
longStopÂ =Â srcÂ -Â atr
longStopPrevÂ =Â nz(longStop[1],Â longStop)
ifÂ longStopÂ >Â 0
Â Â Â Â ifÂ doji4price
Â Â Â Â Â Â Â Â longStopÂ :=Â longStopPrev
Â Â Â Â Â Â Â Â longStop
Â Â Â Â else
Â Â Â Â Â Â Â Â longStopÂ :=Â lowPrice[1]Â >Â longStopPrevÂ ?Â math.max(longStop,Â longStopPrev)Â :Â longStop
Â Â Â Â Â Â Â Â longStop
else
Â Â Â Â longStopÂ :=Â longStopPrev
Â Â Â Â longStop
shortStopÂ =Â srcÂ +Â atr
shortStopPrevÂ =Â nz(shortStop[1],Â shortStop)
ifÂ shortStopÂ >Â 0
Â Â Â Â ifÂ doji4price
Â Â Â Â Â Â Â Â shortStopÂ :=Â shortStopPrev
Â Â Â Â Â Â Â Â shortStop
Â Â Â Â else
Â Â Â Â Â Â Â Â shortStopÂ :=Â highPrice[1]Â <Â shortStopPrevÂ ?Â math.min(shortStop,Â shortStopPrev)Â :Â shortStop
Â Â Â Â Â Â Â Â shortStop
else
Â Â Â Â shortStopÂ :=Â shortStopPrev
Â Â Â Â shortStop
varÂ intÂ dirÂ =Â 1
dirÂ :=Â dirÂ ==Â -1Â andÂ highPriceÂ >Â shortStopPrevÂ ?Â 1Â :Â dirÂ ==Â 1Â andÂ lowPriceÂ <Â longStopPrevÂ ?Â -1Â :Â dir
varÂ colorÂ longColorÂ =Â color.green
varÂ colorÂ shortColorÂ =Â color.red
longStopPlotÂ =Â plot(dirÂ ==Â 1Â ?Â longStopÂ :Â na,Â title='LongÂ Stop',Â style=plot.style_linebr,Â linewidth=2,Â color=color.new(longColor,Â 0))
buySignalÂ =Â dirÂ ==Â 1Â andÂ dir[1]Â ==Â -1
plotshape(buySignalÂ ?Â longStopÂ :Â na,Â title='LongÂ StopÂ Start',Â location=location.absolute,Â style=shape.circle,Â size=size.tiny,Â color=color.new(longColor,Â 0))
//plotshape(buySignalÂ andÂ showLabelsÂ ?Â longStopÂ :Â na,Â title='BuyÂ Label',Â text='Buy',Â location=location.absolute,Â style=shape.labelup,Â size=size.tiny,Â color=color.new(longColor,Â 0),Â textcolor=color.new(color.white,Â 0))
shortStopPlotÂ =Â plot(dirÂ ==Â 1Â ?Â naÂ :Â shortStop,Â title='ShortÂ Stop',Â style=plot.style_linebr,Â linewidth=2,Â color=color.new(shortColor,Â 0))
sellSignalÂ =Â dirÂ ==Â -1Â andÂ dir[1]Â ==Â 1
//plotshape(sellSignalÂ ?Â shortStopÂ :Â na,Â title='ShortÂ StopÂ Start',Â location=location.absolute,Â style=shape.circle,Â size=size.tiny,Â color=color.new(shortColor,Â 0))
//plotshape(sellSignalÂ andÂ showLabelsÂ ?Â shortStopÂ :Â na,Â title='SellÂ Label',Â text='Sell',Â location=location.absolute,Â style=shape.labeldown,Â size=size.tiny,Â color=color.new(shortColor,Â 0),Â textcolor=color.new(color.white,Â 0))
midPricePlotÂ =Â plot(ohlc4,Â title='',Â style=plot.style_circles,Â linewidth=0,Â display=display.none,Â editable=false)
longFillColorÂ =Â highlightStateÂ ?Â dirÂ ==Â 1Â ?Â longColorÂ :Â naÂ :Â na
shortFillColorÂ =Â highlightStateÂ ?Â dirÂ ==Â -1Â ?Â shortColorÂ :Â naÂ :Â na
//fill(midPricePlot,Â longStopPlot,Â title='LongÂ StateÂ Filling',Â color=longFillColor,Â transp=90)
//fill(midPricePlot,Â shortStopPlot,Â title='ShortÂ StateÂ Filling',Â color=shortFillColor,Â transp=90)
changeCondÂ =Â dirÂ !=Â dir[1]
//---------------------------------//VMAÂ Code\\---------------------------------\\
lenvmaÂ =Â input.int(20,Â "Length",Â minval=1,Â group="VMAÂ Settings")
srcvmaÂ =Â input(close,Â "Source",Â group="VMAÂ Settings")
mavmaÂ =Â ta.vwma(srcvma,Â lenvma)
offsetvmaÂ =Â input.int(0,Â "Offset",Â minvalÂ =Â -500,Â maxvalÂ =Â 500,Â group="VMAÂ Settings")
plot(mavma,Â title="VWMA",Â color=#2962FF,Â offsetÂ =Â offsetvma)
//---------------------------------//VWAPÂ Code\\---------------------------------\\
//Â Inputs
vwap_showÂ =Â input(true,Â title='ShowÂ VWAP',Â groupÂ =Â "VWAPÂ Settings")
vwapOffsetÂ =Â input(title='VWAPÂ offset',Â defval=0,Â groupÂ =Â "VWAPÂ Settings")
startÂ =Â request.security(syminfo.tickerid,Â 'D',Â time)
newSessionÂ =Â startÂ >Â start[1]Â ?Â 1Â :Â 0
vwapsumÂ =Â 0.0
volumesumÂ =Â 0.0
vwapsumÂ :=Â newSession[1]Â ?Â hlc3Â *Â volumeÂ :Â vwapsum[1]Â +Â hlc3Â *Â volume
volumesumÂ :=Â newSession[1]Â ?Â volumeÂ :Â volumesum[1]Â +Â volume
vwap_nowÂ =Â vwapsumÂ /Â volumesum
plot(vwap_now,Â color=color.new(color.white,Â 0),Â title='VWAP')
//---------------------------------//Logic\\---------------------------------\\
//Â CheckÂ SessionsÂ toÂ avoidÂ trades
sessionÂ =Â time('1',Â session2Â +Â string(':1234567'),Â str.tostring(syminfo.timezone))//'GMT+5:30')
sessioncondÂ =Â showsessionÂ ?Â notÂ sessionÂ :Â true
//Â SeeÂ ifÂ thisÂ bar'sÂ timeÂ happenedÂ withinÂ dateÂ filter
dateFilterÂ =Â timeÂ >=Â i_startTimeÂ andÂ timeÂ <=Â i_endTime
//Â CheckÂ EMAÂ Filter
emaFilterLongÂ =Â emaFilterÂ ==Â 0Â orÂ closeÂ >Â ema
emaFilterShortÂ =Â emaFilterÂ ==Â 0Â orÂ closeÂ <Â ema
//Â CheckÂ RSI
rsiFilterLongÂ =Â rsiÂ >Â 50Â andÂ rsiÂ <=Â 80
rsiFilterShortÂ =Â rsiÂ <Â 40Â andÂ rsiÂ >=Â 20
//Â CheckÂ VWAP
vwapFilterLongÂ =Â closeÂ >Â vwap_now
vwapFilterShortÂ =Â closeÂ <Â vwap_now
//Â CheckÂ Supertrend
supertrendFilterLongÂ =Â closeÂ >Â longStop
supertrendFilterShortÂ =Â closeÂ <Â shortStop
//Â CheckÂ VMA
vmaFilterLongÂ =Â closeÂ >Â mavma
vmaFilterShortÂ =Â closeÂ <Â mavma
//Â CheckÂ PSAR
psarFilterLongÂ =Â closeÂ >Â out
psarFilterShortÂ =Â closeÂ <Â out
//Â CheckÂ VolumeÂ 
volumeFilterÂ =Â volume[1]Â >Â volumecutoffÂ andÂ volumeÂ >Â volumecutoffÂ //andÂ barColorÂ ==Â barColor[1]
volumeLongCondÂ =Â closeÂ >Â openÂ andÂ close[1]Â >Â open[1]
volumeShortCondÂ =Â closeÂ <Â openÂ andÂ close[1]Â <Â open[1]
volumeLongEntryÂ =Â volumeFilterÂ andÂ volumeLongCond
volumeShortEntryÂ =Â volumeFilterÂ andÂ volumeShortCondÂ 
//Â DetermineÂ ifÂ weÂ haveÂ aÂ validÂ setup
validLongSetupÂ =Â rsiFilterLongÂ andÂ vwapFilterLongÂ andÂ supertrendFilterLongÂ andÂ vmaFilterLongÂ andÂ psarFilterLongÂ andÂ volumeFilterÂ andÂ volumeLongCondÂ andÂ emaFilterLongÂ andÂ sessioncond
validShortSetupÂ =Â rsiFilterShortÂ andÂ vwapFilterShortÂ andÂ supertrendFilterShortÂ andÂ vmaFilterShortÂ andÂ psarFilterShortÂ andÂ volumeFilterÂ andÂ volumeShortCondÂ andÂ emaFilterShortÂ andÂ sessioncond
//Â CheckÂ ifÂ weÂ haveÂ confirmationÂ forÂ ourÂ setup
validLongEntryÂ =Â validLongSetupÂ andÂ strategy.position_sizeÂ ==Â 0Â andÂ dateFilterÂ andÂ barstate.isconfirmed
validShortEntryÂ =Â validShortSetupÂ andÂ strategy.position_sizeÂ ==Â 0Â andÂ dateFilterÂ andÂ barstate.isconfirmed
//Â HighlightÂ candlesÂ aboveÂ VolumeÂ CutoffÂ ifÂ true
barcolor(showVolumeColor?Â volume>volumecutoffÂ ?Â volumeColorInputÂ :Â naÂ :Â na,Â title='BigÂ VolumeÂ Candles')
Â Â Â Â 
//---------------------------------//Â GoldenÂ CrossÂ Code\\---------------------------\\
//Â GoldenÂ CrossÂ Conditions
supertrendCrossBullÂ =Â ta.crossover(longStop,vwap_now)
supertrendCrossBearÂ =Â ta.crossunder(shortStop,vwap_now)
vmaCrossBullÂ =Â ta.crossover(mavma,vwap_now)
vmaCrossBearÂ =Â ta.crossunder(mavma,vwap_now)
//Â GoldenÂ CrossÂ 
validGoldenCrossBullSetupÂ =Â supertrendCrossBullÂ andÂ vmaCrossBullÂ andÂ volumeLongEntryÂ andÂ rsiFilterLong//andÂ validLongEntryÂ 
validGoldenCrossBearSetupÂ =Â supertrendCrossBearÂ andÂ vmaCrossBearÂ andÂ volumeShortEntryÂ andÂ rsiFilterShort//andÂ validShortEntry
//---------------------------------//Â StrategyÂ ExecutionÂ \\-------------------------\\
floatÂ slÂ =Â na
floatÂ tpÂ =Â na
slÂ :=Â nz(sl[1],Â 0.0)
tpÂ :=Â nz(tp[1],Â 0.0)
ifÂ validLongEntryÂ andÂ strategy.position_sizeÂ <=Â 0
Â Â Â Â strategy.entry('LongÂ Entry',Â strategy.long,Â when=validLongEntry)
Â Â Â Â slÂ :=Â low[1]
Â Â Â Â sl
Â Â Â Â alert(message=Â "2Â CandleÂ TheoreyÂ LongÂ Entry",Â freq=alert.freq_once_per_bar_close)
Â Â Â Â 
ifÂ validShortEntryÂ andÂ strategy.position_sizeÂ >=Â 0
Â Â Â Â strategy.entry('ShortÂ Entry',Â strategy.short,Â when=validShortEntry)
Â Â Â Â slÂ :=Â high[1]
Â Â Â Â sl
Â Â Â Â alert(message=Â "2Â CandleÂ TheoreyÂ ShortÂ Entry",Â freq=alert.freq_once_per_bar_close)
ifÂ validGoldenCrossBullSetupÂ andÂ strategy.position_sizeÂ <=Â 0
Â Â Â Â strategy.entry('GoldenÂ CrossÂ LongÂ Entry',Â strategy.long,Â when=validGoldenCrossBullSetup)
Â Â Â Â slÂ :=Â low[1]
Â Â Â Â sl
Â Â Â Â alert(message=Â "GoldenÂ CrossÂ LongÂ Entry",Â freq=alert.freq_once_per_bar_close)
Â Â Â Â 
ifÂ validGoldenCrossBearSetupÂ andÂ strategy.position_sizeÂ >=Â 0
Â Â Â Â strategy.entry('GoldenÂ CrossÂ ShortÂ Entry',Â strategy.short,Â when=validGoldenCrossBearSetup)
Â Â Â Â slÂ :=Â high[1]
Â Â Â Â sl
Â Â Â Â alert(message=Â "GoldenÂ CrossÂ ShortÂ Entry",Â freq=alert.freq_once_per_bar_close)
ifÂ slÂ !=Â 0.0
Â Â Â Â ifÂ strategy.position_sizeÂ >Â 0
Â Â Â Â Â Â Â Â tpÂ :=Â strategy.position_avg_priceÂ +Â (strategy.position_avg_priceÂ -Â sl)Â *Â profitMultiplier
Â Â Â Â Â Â Â Â strategy.exit(id='Exit',Â limit=tp,Â stop=sl)
Â Â Â Â ifÂ strategy.position_sizeÂ <Â 0
Â Â Â Â Â Â Â Â tpÂ :=Â strategy.position_avg_priceÂ -Â (slÂ -Â strategy.position_avg_price)Â *Â profitMultiplier
Â Â Â Â Â Â Â Â strategy.exit(id='Exit',Â limit=tp,Â stop=sl)
//---------------------------------//Plots\\---------------------------------\\
//Â DrawÂ tradeÂ data
plot(validLongEntryÂ orÂ validShortEntryÂ ?Â slÂ :Â na,Â title='TradeÂ StopÂ Price',Â color=color.new(color.red,Â 0),Â style=plot.style_linebr)
plot(validLongEntryÂ orÂ validShortEntryÂ ?Â tpÂ :Â na,Â title='TradeÂ TargetÂ Price',Â color=color.new(color.green,Â 0),Â style=plot.style_linebr)
//Â DrawÂ EMAÂ ifÂ it'sÂ enabled
plot(emaFilterÂ ==Â 0Â ?Â naÂ :Â ema,Â color=emaFilterLongÂ ?Â color.greenÂ :Â color.red,Â linewidth=2,Â title='EMA')
//Â DrawÂ GoldenÂ CrossÂ Setups
plotchar(validGoldenCrossBullSetup,"BullÂ GoldenÂ Cross",'ğŸš€',location.abovebar,offset=0,size=size.small)
plotchar(validGoldenCrossBearSetup,"BearÂ GoldenÂ Cross",'ğŸš€',location.belowbar,offset=0,size=size.small)
//---------------------------------//Dashbaord\\---------------------------------\\
//Â ---Â BEGINÂ TESTERÂ CODEÂ ---Â //
//Â DeclareÂ performanceÂ trackingÂ variables
varÂ balanceÂ =Â startBalance
varÂ drawdownÂ =Â 0.0
varÂ maxDrawdownÂ =Â 0.0
varÂ maxBalanceÂ =Â 0.0
varÂ totalPipsÂ =Â 0.0
varÂ totalWinsÂ =Â 0
varÂ totalLossÂ =Â 0
//Â DetectÂ winningÂ trades
ifÂ strategy.wintradesÂ !=Â strategy.wintrades[1]
Â Â Â Â balanceÂ +=Â riskPerTradeÂ /Â 100Â *Â balanceÂ *Â profitMultiplier
Â Â Â Â //totalPipsÂ +=Â math.abs(t_entryÂ -Â t_target)
Â Â Â Â totalWinsÂ +=Â 1
Â Â Â Â ifÂ balanceÂ >Â maxBalance
Â Â Â Â Â Â Â Â maxBalanceÂ :=Â balance
Â Â Â Â Â Â Â Â maxBalance
//Â DetectÂ losingÂ trades
ifÂ strategy.losstradesÂ !=Â strategy.losstrades[1]
Â Â Â Â balanceÂ -=Â riskPerTradeÂ /Â 100Â *Â balance
Â Â Â Â //totalPipsÂ -=Â math.abs(t_entryÂ -Â t_stop)
Â Â Â Â totalLossÂ +=Â 1
Â Â Â Â //Â UpdateÂ drawdown
Â Â Â Â drawdownÂ :=Â balanceÂ /Â maxBalanceÂ -Â 1
Â Â Â Â ifÂ drawdownÂ <Â maxDrawdown
Â Â Â Â Â Â Â Â maxDrawdownÂ :=Â drawdown
Â Â Â Â Â Â Â Â maxDrawdown
Â Â Â Â Â Â Â Â 
//Â ProfitFactorÂ returnsÂ theÂ strategy'sÂ currentÂ profitÂ factor,
ProfitFactorÂ =Â strategy.grossprofitÂ /Â strategy.grossloss
maxlossÂ =Â math.round(maxDrawdown*(-100))
winrateÂ =Â (strategy.wintradesÂ /Â strategy.closedtrades)Â *Â 100
initbalanceÂ =Â startBalance
//Â PrepareÂ statsÂ table
varÂ tableÂ testTableÂ =Â table.new(position.bottom_right,Â 5,Â 3,Â border_width=1)
f_fillCell(_table,Â _column,Â _row,Â _title,Â _value,Â _bgcolor,Â _txtcolor)Â =>
Â Â Â Â _cellTextÂ =Â _titleÂ +Â '\n'Â +Â _value
Â Â Â Â table.cell(_table,Â _column,Â _row,Â _cellText,Â bgcolor=_bgcolor,Â text_color=_txtcolor)
//Â DrawÂ statsÂ table
varÂ bgcolorÂ =Â color.new(color.black,Â 0)
ifÂ drawTester
Â Â Â Â ifÂ barstate.islastconfirmedhistory
Â Â Â Â Â Â Â Â //Â UpdateÂ table
Â Â Â Â Â Â Â Â dollarReturnÂ =Â balanceÂ -Â startBalance
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 0,Â 0,Â 'BacktesterÂ byÂ EtherMatt',Â str.tostring(syminfo.tickerid)Â ,Â color.blue,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 0,Â 1,Â '2Â CandleÂ TheoryÂ V2',Â str.tostring(timeframe.period)Â +Â 'M'Â ,Â color.blue,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 1,Â 0,Â 'TotalÂ Trades:',Â str.tostring(strategy.closedtrades),Â bgcolor,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 1,Â 1,Â 'WinÂ Rate:',Â str.tostring(truncate(winrate,Â 2))Â +Â '%',Â winrateÂ >Â 40Â ?Â color.greenÂ :Â color.red,Â color.white)//Â bgcolor,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 2,Â 0,Â 'Starting:',Â '$'Â +Â str.tostring(startBalance),Â bgcolor,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 2,Â 1,Â 'Ending:',Â '$'Â +Â str.tostring(truncate(balance,Â 2)),Â balanceÂ >Â initbalanceÂ ?Â color.greenÂ :Â color.red,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 3,Â 0,Â 'ProfitÂ Factor:',Â str.tostring(truncate(ProfitFactor,Â 2)),Â ProfitFactorÂ >Â 0Â ?Â color.greenÂ :Â color.red,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 3,Â 1,Â 'Consec.Â Loss:',Â str.tostring(maxloss),Â maxlossÂ <=Â 5Â ?Â color.greenÂ :Â color.red,Â color.white)//color.new(color.red,50),Â bgcolor,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 4,Â 0,Â 'Return:',Â (dollarReturnÂ >Â 0Â ?Â '+'Â :Â '')Â +Â str.tostring(truncate(dollarReturnÂ /Â startBalanceÂ *Â 100,Â 2))Â +Â '%',Â dollarReturnÂ >Â 0Â ?Â color.greenÂ :Â color.red,Â color.white)
Â Â Â Â Â Â Â Â f_fillCell(testTable,Â 4,Â 1,Â 'MaxÂ DD:',Â str.tostring(truncate(maxDrawdownÂ *Â 100,Â 2))Â +Â '%',Â color.red,Â color.white)
Expand (343 lines)