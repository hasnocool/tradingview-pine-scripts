Script Name: Adaptive MACD [LuxAlgo]
Author: LuxAlgo
Description: The Adaptive MACD indicator is an adaptive version of the popular Moving Average Convergence Divergence (MACD) oscillator, returning longer-term variations during trending markets and cyclic variations during ranging markets while filtering out noisy variations.

ğŸ”¶  USAGE 

  

The proposed oscillator contains all the elements within a regular MACD, such as a...
PineScript code:

Pine Scriptâ„¢ indicator
Adaptive MACD [LuxAlgo]
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
//Â ThisÂ workÂ isÂ licensedÂ underÂ aÂ Attribution-NonCommercial-ShareAlikeÂ 4.0Â InternationalÂ (CCÂ BY-NC-SAÂ 4.0)Â https://creativecommons.org/licenses/by-nc-sa/4.0/
//Â Â©Â LuxAlgo
//@version=5
indicator("AdaptiveÂ MACDÂ [LuxAlgo]",Â "LuxAlgoÂ -Â AdaptiveÂ MACD")
//------------------------------------------------------------------------------
//Settings
//-----------------------------------------------------------------------------{
lengthÂ =Â input.int(20,Â 'R2Â Period',Â minvalÂ =Â 2)
fastÂ =Â input.int(10,Â minvalÂ =Â 2)
slowÂ =Â input.int(20,Â minvalÂ =Â 2)
signalÂ =Â input.int(9,Â minvalÂ =Â 2)
//-----------------------------------------------------------------------------}
//UltimateÂ MACD
//-----------------------------------------------------------------------------{
varÂ macdÂ =Â 0.
varÂ lagÂ Â =Â (signalÂ -Â 1)Â /Â 2
varÂ a1Â Â Â =Â 2Â /Â (fastÂ +Â 1)
varÂ a2Â Â Â =Â 2Â /Â (slowÂ +Â 1)
r2Â =Â .5Â *Â math.pow(ta.correlation(close,Â bar_index,Â length),Â 2)Â +Â .5
KÂ =Â r2Â *Â ((1Â -Â a1)Â *Â (1Â -Â a2))Â +Â (1Â -Â r2)Â *Â ((1Â -Â a1)Â /Â (1Â -Â a2))
macdÂ :=Â (closeÂ -Â close[1])Â *Â (a1Â -Â a2)Â +Â (-a2Â -Â a1Â +Â 2)Â *Â nz(macd[1])Â -Â KÂ *Â nz(macd[2])
emaÂ =Â ta.ema(macd,Â signal)
histÂ =Â macdÂ -Â ema
//-----------------------------------------------------------------------------}
//Plots
//-----------------------------------------------------------------------------{
hist_cssÂ =Â histÂ >Â 0Â andÂ histÂ >Â hist[1]Â ?Â #5b9cf6Â 
Â Â :Â histÂ >Â 0Â andÂ histÂ <Â hist[1]Â ?Â color.new(#5b9cf6,Â 50)
Â Â :Â histÂ <Â 0Â andÂ histÂ <Â hist[1]Â ?Â #f77c80
Â Â :Â color.new(#f77c80,Â 50)
plot(hist,Â 'Histogram',Â hist_css,Â 1,Â plot.style_columns)
plot(macd,Â 'MACD',Â chart.fg_color)
plot(ema,Â 'Signal',Â #ff5d00)
//-----------------------------------------------------------------------------}
Expand (42 lines)