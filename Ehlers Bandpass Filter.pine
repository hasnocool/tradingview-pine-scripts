Script Name: Ehlers Bandpass Filter
Author: OrcChieftain
Description: This script uses @cheatcountry  script   to determine Ehlers Bandpass Filter.

Backtest offers 3 capital management tools. One that will always calculate order size as initial capital/close, one that uses the same calculation but adds or substracts profit. The last one allows you to enter manually the size you want to trade.

The time-based stop will close the...
PineScript code:

Pine Scriptâ„¢ strategy
Ehlers Bandpass Filter
Copy code
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
//Â ThisÂ sourceÂ codeÂ isÂ subjectÂ toÂ theÂ termsÂ ofÂ theÂ MozillaÂ PublicÂ LicenseÂ 2.0Â atÂ https://mozilla.org/MPL/2.0/
//Â Â©Â greenmask9,Â @cheatcountry
//@version=4
strategy(title=Â "EhlersÂ BandpassÂ Filter",Â shorttitleÂ =Â "BandpassÂ Filter",Â overlay=false)
//commission_type=strategy.commission.percent,Â commission_value=.5
//
//CapitalÂ Management
capitaltypeÂ =Â input(defval="Initial",Â title="CapitalÂ Settings",Â options=["Initial",Â "Growing","Manual"],Â type=input.string)
manualcapitalÂ =Â input(title="ManualÂ PositionÂ Size",Â defval=100.3,Â type=input.float)
leverageÂ =Â input(title="Leverage",Â defval=1,Â type=input.float)
capitalsystem(capitaltype)Â =>
Â Â Â Â v1Â =Â floor(strategy.initial_capital/close)Â *Â leverage
Â Â Â Â v2Â =Â floor((strategy.initial_capitalÂ +Â strategy.netprofit)/close)Â *Â leverage
Â Â Â Â v3Â =Â manualcapital
Â Â Â Â capitaltype==Â "Initial"?Â v1Â :Â capitaltypeÂ ==Â "Growing"Â ?Â v2Â :Â v3
ordersize=capitalsystem(capitaltype)
//Targets,Â Stops
percentagesÂ =Â input(title="PercentageÂ stopÂ ğŸ¯",Â defval=true)
targetpercentageÂ =Â input(title="ProfitÂ (%)",Â type=input.float,Â minval=0.0,Â step=0.1,Â defval=1.3)Â *Â 0.01
stoppercentageÂ =Â input(title="StopÂ LossÂ (%)",Â type=input.float,Â minval=0.0,Â step=0.1,Â defval=0.6)Â *Â 0.01
longtpÂ Â =Â strategy.position_avg_priceÂ *Â (1Â +Â targetpercentage)
shorttpÂ =Â strategy.position_avg_priceÂ *Â (1Â -Â targetpercentage)
longStopPriceÂ Â =Â strategy.position_avg_priceÂ *Â (1Â -Â stoppercentage)
shortStopPriceÂ =Â strategy.position_avg_priceÂ *Â (1Â +Â stoppercentage)
//Cheatcountry'sÂ part
//Â CopyrightÂ (c)Â 2019-present,Â FranklinÂ MoormannÂ (cheatcountry)
//Â EhlersÂ BandpassÂ FilterÂ scriptÂ mayÂ beÂ freelyÂ distributedÂ underÂ theÂ MITÂ license.
inpÂ =Â input(title="Source",Â type=input.source,Â defval=close)
resÂ =Â input(title="Resolution",Â type=input.resolution,Â defval="")
repÂ =Â input(title="AllowÂ Repainting?",Â type=input.bool,Â defval=false)
srcÂ =Â security(syminfo.tickerid,Â res,Â inp[repÂ ?Â 0Â :Â barstate.isrealtimeÂ ?Â 1Â :Â 0])[repÂ ?Â 0Â :Â barstate.isrealtimeÂ ?Â 0Â :Â 1]
lengthÂ =Â input(title="Length",Â type=input.integer,Â defval=20,Â minval=1)
bwÂ =Â input(title="Bandwidth",Â type=input.float,Â defval=0.3,Â minval=0.01,Â stepÂ =Â 0.01)
piÂ =Â 2Â *Â asin(1)
twoPiPrd1Â =Â 0.25Â *Â bwÂ *Â 2Â *Â piÂ /Â length
twoPiPrd2Â =Â 1.5Â *Â bwÂ *Â 2Â *Â piÂ /Â length
betaÂ =Â cos(2Â *Â piÂ /Â length)
gammaÂ =Â 1.0Â /Â cos(2Â *Â piÂ *Â bwÂ /Â length)
alpha1Â =Â gammaÂ -Â sqrt((gammaÂ *Â gamma)Â -Â 1)
alpha2Â =Â (cos(twoPiPrd1)Â +Â sin(twoPiPrd1)Â -Â 1)Â /Â cos(twoPiPrd1)
alpha3Â =Â (cos(twoPiPrd2)Â +Â sin(twoPiPrd2)Â -Â 1)Â /Â cos(twoPiPrd2)
hpÂ =Â 0.0
hpÂ :=Â ((1Â +Â (alpha2Â /Â 2))Â *Â (srcÂ -Â nz(src[1])))Â +Â ((1Â -Â alpha2)Â *Â nz(hp[1]))
bpÂ =Â 0.0
bpÂ :=Â bar_indexÂ >Â 2Â ?Â (0.5Â *Â (1Â -Â alpha1)Â *Â (hpÂ -Â nz(hp[2])))Â +Â (betaÂ *Â (1Â +Â alpha1)Â *Â nz(bp[1]))Â -Â (alpha1Â *Â nz(bp[2]))Â :Â 0
peakÂ =Â 0.0
peakÂ :=Â 0.991Â *Â nz(peak[1])
peakÂ :=Â abs(bp)Â >Â peakÂ ?Â abs(bp)Â :Â peak
signalÂ =Â peakÂ !=Â 0Â ?Â bpÂ /Â peakÂ :Â 0
triggerÂ =Â 0.0
triggerÂ :=Â ((1Â +Â (alpha3Â /Â 2))Â *Â (signalÂ -Â nz(signal[1])))Â +Â ((1Â -Â alpha3)Â *Â nz(trigger[1]))
sigÂ =Â triggerÂ >Â nz(trigger[1])Â ?Â 1Â :Â triggerÂ <Â nz(trigger[1])Â ?Â -1Â :Â 0
sigColorÂ =Â sigÂ >Â 0Â ?Â color.greenÂ :Â sigÂ <Â 0Â ?Â color.redÂ :Â color.black
plot(signal,Â title="Signal",Â color=sigColor,Â linewidth=2)
plot(trigger,Â title="Trigger",Â color=color.black,Â linewidth=1)
//EndÂ Cheatcountry'sÂ part
//Things
buyÂ =Â crossover(trigger,Â signal)
sellÂ =Â crossunder(trigger,Â signal)
ifÂ (buy)
Â Â Â Â strategy.entry("Buy",Â strategy.long,Â ordersize)
ifÂ (percentages)
Â Â Â Â strategy.exit(Â "Buy",Â from_entry="Buy",Â stop=longStopPrice,Â limit=Â longtp)
//Â Â Â Â ifÂ (targetÂ andÂ stop)
//Â Â Â Â Â Â Â Â strategy.exit(Â "SetÂ ValueÂ tp/sl",Â from_entry="Buy",Â profit=targetticks,Â loss=stopnumberticks)
//Â Â Â Â ifÂ (targetÂ andÂ notÂ stop)
//Â Â Â Â Â Â Â Â strategy.exit(Â "SetÂ ValueÂ tp/sl",Â from_entry="Buy",Â profit=targetticks)
//Â Â Â Â ifÂ (stopÂ andÂ notÂ target)
//Â Â Â Â Â Â Â Â strategy.exit(Â "SetÂ ValueÂ tp/sl",Â from_entry="Buy",Â loss=stopnumberticks)
//strategy.close("Buy",Â buyend)
ifÂ (sell)
Â Â Â Â strategy.entry("Short",Â strategy.short,Â ordersize)
ifÂ (percentages)
Â Â Â Â strategy.exit(Â "Short",Â from_entry="Short",Â stop=shortStopPrice,Â limitÂ =Â shorttp)
//plot(series=(strategy.position_sizeÂ >Â 0)Â ?Â longStopPriceÂ :Â na,
//Â Â Â Â Â color=color.red,Â style=plot.style_linebr,
//Â Â Â Â Â linewidth=2,Â title="LongÂ StopÂ Loss")
//plot(series=(strategy.position_sizeÂ <Â 0)Â ?Â shortStopPriceÂ :Â na,
//Â Â Â Â Â color=color.red,Â style=plot.style_linebr,
//Â Â Â Â Â linewidth=2,Â title="ShortÂ StopÂ Loss")
//plot(series=(strategy.position_sizeÂ >Â 0)Â ?Â longtpÂ :Â na,
//Â Â Â Â Â color=color.lime,Â style=plot.style_linebr,
//Â Â Â Â Â linewidth=2,Â title="LongÂ StopÂ Loss")
//plot(series=(strategy.position_sizeÂ <Â 0)Â ?Â shorttpÂ :Â na,
//Â Â Â Â Â color=color.lime,Â style=plot.style_linebr,
//Â Â Â Â Â linewidth=2,Â title="ShortÂ StopÂ Loss")
Expand (121 lines)